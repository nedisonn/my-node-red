[{"id":"f02c3977.c1b97","type":"tab","label":"Occupancy","disabled":false,"info":""},{"id":"1f49f273.0f37be","type":"tab","label":"Alexa","disabled":false,"info":""},{"id":"c3bc1a43.254dd","type":"tab","label":"Geral","disabled":false,"info":""},{"id":"cbdfe56c.84c388","type":"tab","label":"Banheiro","disabled":false,"info":""},{"id":"ecc79e8a.d4a1b","type":"tab","label":"Sala","disabled":false,"info":""},{"id":"1aa34a9.7045335","type":"tab","label":"Escritorio","disabled":false,"info":""},{"id":"ccb6d071.13253","type":"tab","label":"Quarto Nédi","disabled":false,"info":""},{"id":"1b3ccd2f.86a613","type":"tab","label":"Quarto Maria","disabled":false,"info":""},{"id":"1d7ecdc6.68c842","type":"tab","label":"Aqara Sensores","disabled":false,"info":""},{"id":"9639036b.0a3a6","type":"tab","label":"Home Assistant","disabled":false,"info":""},{"id":"c6be7449.1c6ce8","type":"tab","label":"Funcoes Auxiliares","disabled":false,"info":""},{"id":"fb543111.32fbd","type":"tab","label":"Spotify Helpers","disabled":false,"info":""},{"id":"29d165fe.c5376a","type":"tab","label":"Tarefas","disabled":false,"info":""},{"id":"a03558e.9e50d28","type":"mqtt-broker","name":"MQTT","broker":"localhost","port":"1883","clientid":"Node-Red","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","closeTopic":"","closeQos":"0","closeRetain":"false","closePayload":"","willTopic":"","willQos":"0","willRetain":"false","willPayload":""},{"id":"d04673cf.2f08f","type":"alexa-remote-account","name":"Alexa","authMethod":"proxy","proxyOwnIp":"raspberrypi.local","proxyPort":"3456","cookieFile":"/home/pi/.node-red/alexa-cookie.json","refreshInterval":"1","alexaServiceHost":"alexa.amazon.com.br","amazonPage":"amazon.com","acceptLanguage":"pt-BR","userAgent":"'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:99.0) Gecko/20100101 Firefox/99.0'","useWsMqtt":"on","autoInit":"on"},{"id":"eeeccf7f.6c0df8","type":"yeelight-compat-hue-config","hostname":"YeelightColorBulb-023F.local","port":"55443","name":"Luz do Escritorio"},{"id":"bbfd267.ea4ee58","type":"yeelight-compat-hue-config","hostname":"YeelightColorBulb-098F.local","port":"55443","name":"Luz da Sala"},{"id":"ea75f443.ed079","type":"yeelight-compat-hue-config","hostname":"YeelightColorBulb-235A.local","port":"55443","name":"Luz do Banheiro"},{"id":"fa56686d.1df858","type":"darksky-credentials","key_identifier":"DarkSky"},{"id":"8e6fc0d2.d9006","type":"pushbullet-config","name":"Nédison Neto Faria Velloso"},{"id":"d63d21ef.5e065","type":"server","name":"Home Assistant","legacy":false,"addon":false,"rejectUnauthorizedCerts":false,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true},{"id":"40e0a266.1beb0c","type":"hb-conf","username":"373-28-172"},{"id":"a6321728.b92898","type":"spotify-auth","name":"Spotify","scope":"user-read-private, playlist-modify-public,playlist-read-collaborative,playlist-modify-private"},{"id":"c674df2a.9ad11","type":"spotify-auth","name":"Spotify All","scope":"ugc-image-upload\nuser-read-recently-played\nuser-read-playback-position\nuser-top-read\nplaylist-modify-private\nplaylist-read-collaborative\nplaylist-read-private\nplaylist-modify-public\nstreaming\napp-remote-control\nuser-read-email\nuser-read-private\nuser-follow-read\nuser-follow-modify\nuser-library-modify\nuser-library-read\nuser-read-currently-playing\nuser-read-playback-state\nuser-modify-playback-state"},{"id":"61956bd4.93df44","type":"server","name":"Home Assistant","legacy":false,"addon":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true},{"id":"3233bf02.61ff38","type":"hb-event","z":"f02c3977.c1b97","name":"WiFi","Homebridge":"homebridge","Manufacturer":"Wifi presence 1.0","Service":"Occupancy Sensor","device":"homebridge0E:E6:D8:A7:98:38Wifi presence 1.0WiFi00000086","conf":"40e0a266.1beb0c","x":370,"y":160,"wires":[["1041a88a.43235f"]]},{"id":"294139fb.8b6546","type":"function","z":"f02c3977.c1b97","name":"True?","func":"if(msg.payload === true){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":220,"wires":[["822d92e.5d6567"]]},{"id":"1041a88a.43235f","type":"function","z":"f02c3977.c1b97","name":"Detected?","func":"if(msg.payload.OccupancyDetected === 1){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":160,"wires":[["822d92e.5d6567"]]},{"id":"1fbcb698.3f9c79","type":"function","z":"c3bc1a43.254dd","name":"Hora do Filme?","func":"var ocupado = global.get(\"horaDoFilme\");\nglobal.set(\"SalaOnFirstTime\", true);\nglobal.set(\"SalaOn\",false);\nglobal.set(\"EscritorioOnFirstTime\", true);\nif(     msg.payload === \"playing\" \n    ){\n    if(ocupado === false){\n        global.set(\"horaDoFilme\", true);\n        var date = new Date();\n        var Day = date.getDay(); \n        var Hour = date.getHours();\n        if(Day === 0 || Day === 6 || (Day < 6 && Day > 0)&& Hour >18) {\n                var newMsg;\n                newMsg = {payload: {\"On\":true}};\n                \n                node.status({fill:\"green\",shape:\"dot\",text:\"Movie Night On\"});\n                node.send(newMsg);\n                setTimeout(function(){\n                node.status({text:\"\"});\n                }, 15000);\n            }\n        }\n}\nif(\n    msg.payload.horaDoFilme === true\n    ){\n    return {payload: {\"On\":true}};\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1220,"wires":[["dbce4b90.0460d8","38c2acdf.200664","fd7289b3.a8e608","f5874454.f418c8","89380756.ecb5b8","51cf4986.06de48","26862a10.27c436","89b2df54.9d8d1","508446cd.af50f8"]]},{"id":"c9d5e111.03afa","type":"function","z":"c3bc1a43.254dd","name":"Escuro?","func":"if(msg.payload < 35 && msg.payload > 0){\n                global.set(\"salaEscura\", true);\n                node.status({fill:\"green\",shape:\"dot\",text:\"SalaEscura true\"});\n                flow.set(\"triggered\", true);\n                node.send(msg);\n}\nelse if(msg.payload > 250){\n                global.set(\"salaEscura\", false);\n                node.status({fill:\"yellow\",shape:\"dot\",text:\"SalaEscura false\"});\n}\nif(msg.payload < 60 && msg.payload > 0){\n                global.set(\"escritorioEscuro\", true);\n                node.status({fill:\"green\",shape:\"dot\",text:\"EscritorioEscuro true\"});\n                flow.set(\"triggered\", true);\n                node.send(msg);\n}\nelse if(msg.payload > 250){\n                global.set(\"escritorioEscuro\", false);\n                node.status({fill:\"yellow\",shape:\"dot\",text:\"EscritorioEscuro false\"});\n}\n\n    setTimeout(function(){\n    node.status({text:\"\"});\n    }, 15000);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":740,"y":360,"wires":[["8c00ea31.7a21e8"]]},{"id":"7af1ac1.13d72d4","type":"function","z":"c3bc1a43.254dd","name":"Sala On","func":"if(msg.payload === true){\n    var date = new Date();\n    var Hour = date.getHours(); //hours in 0-23\n    var minutes = \"0\" + date.getMinutes();\n    minutes = parseInt(minutes.substr(-2), 10);\n    var seconds = \"0\" + date.getSeconds();\n    seconds = parseInt(seconds.substr(-2), 10);\n    global.set(\"lastChangeSec\", seconds);\n    global.set(\"lastChangeMinute\", minutes);\n    var salaEscura = global.get(\"salaEscura\");\n    if(Hour > 16 && Hour < 20 && salaEscura === true){\n            if(global.get(\"SalaOn\") === false){\n                global.set(\"SalaOn\",true);\n                msg = {\"payload\": {\"On\":true}};\n                node.status({fill:\"green\",shape:\"dot\",text:\"Sala On\"});\n                node.send(msg);\n            }\n    }\n    setTimeout(function(){\n        node.status({text:\"\"});\n    }, 15000);\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1540,"y":340,"wires":[["9c0824cf.664cd8"]]},{"id":"1969a349.30c0cd","type":"mqtt in","z":"c3bc1a43.254dd","name":"Sensor Luz Sala","topic":"Sala/currentLight","qos":"0","datatype":"json","broker":"a03558e.9e50d28","x":220,"y":360,"wires":[["b1811e12.c8938"]]},{"id":"f48d64c8.bc9b28","type":"function","z":"c3bc1a43.254dd","name":"Escuro?","func":"global.set(\"luxQuarto\", msg.payload);\nvar quartoEscuro = global.get(\"quartoEscuro\");\nif(typeof QuartoEscuro !== \"undefined\"){\n    if(QuartoEscuro === true){\n        if(msg.payload > 30){\n            global.set(\"quartoEscuro\", false);\n            node.status({fill:\"yellow\",shape:\"dot\",text:\"QuartoEscuro false\"});\n        }\n    }\n    else{\n        if(msg.payload < 15 && msg.payload > 0){\n                global.set(\"quartoEscuro\", true);\n                node.status({fill:\"green\",shape:\"dot\",text:\"QuartoEscuro true\"});\n                node.send(msg);\n        }\n    }\n}\nelse{\n        if(msg.payload < 15 && msg.payload > 0){\n                global.set(\"quartoEscuro\", true);\n                node.status({fill:\"green\",shape:\"dot\",text:\"QuartoEscuro true\"});\n                node.send(msg);\n        }\n        else{\n            if(msg.payload > 30){\n                global.set(\"quartoEscuro\", false);\n                node.status({fill:\"yellow\",shape:\"dot\",text:\"QuartoEscuro false\"});\n            }\n        }\n}\n\n    setTimeout(function(){\n    node.status({text:\"\"});\n    }, 15000);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":620,"wires":[["8abcbb48.12bca8"]]},{"id":"a0c4580e.a6f4b","type":"function","z":"c3bc1a43.254dd","name":"Quarto On","func":"if(msg.payload === true){\n    if(global.get(\"quartoOn\")===false){\n        var date = new Date();\n        var Day = date.getDay(); \n        var Hour = date.getHours();\n        if(Hour >= 16 && Hour < 20){\n            global.set(\"quartoOn\",true);\n            node.status({fill:\"green\",shape:\"dot\",text:\"Quarto On\"});\n            msg.payload ={\"On\":true};\n            node.send(msg);\n            \n            setTimeout(function(){\n            node.status({text:\"\"});\n            }, 15000);\n        }\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1470,"y":680,"wires":[["d56dec55.6a517"]]},{"id":"f9875a96.4e039","type":"mqtt in","z":"c3bc1a43.254dd","name":"Sensor Luz Quarto Nédi","topic":"QuartoNedi/currentLight","qos":"0","datatype":"json","broker":"a03558e.9e50d28","x":270,"y":620,"wires":[["8278f085.42e96"]]},{"id":"3016694.6725c96","type":"sun events","z":"c3bc1a43.254dd","testmode":false,"verbose":false,"topic":"","name":"Sunset","x":330,"y":680,"wires":[["b2986c0c.ea0bd"]]},{"id":"9323dd8b.1c4b2","type":"sun events","z":"c3bc1a43.254dd","testmode":false,"verbose":false,"topic":"","name":"Sunset","x":430,"y":420,"wires":[["7eed4e62.45ef1"]]},{"id":"a3da8df4.ff838","type":"function","z":"c3bc1a43.254dd","name":"Sunset?","func":"\nif(msg.payload === \"sunsetStart\" || \nmsg.payload === \"sunset\"|| \nmsg.payload === \"goldenHour\"|| \nmsg.payload ===\"dusk\"){\n    node.status({fill:\"green\",shape:\"dot\",text:\"Sunset started\"});\n    flow.set(\"triggered\", true);\n    node.send(msg);\n    global.set(\"escritorioEscuro\", true);\n    global.set(\"salaEscura\", true);\n    setTimeout(function(){\n    node.status({text:\"\"});\n    }, 15000);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":740,"y":420,"wires":[["8c00ea31.7a21e8"]]},{"id":"b21d98c4.4b92e8","type":"function","z":"c3bc1a43.254dd","name":"Sunset?","func":"if(msg.payload === \"sunsetStart\" || \nmsg.payload === \"sunset\"|| \nmsg.payload === \"goldenHour\"|| \nmsg.payload ===\"dusk\"){\n    node.status({fill:\"green\",shape:\"dot\",text:\"Sunset started\"});\n    global.set(\"quartoEscuro\", true);\n    node.send(msg);    \n    setTimeout(function(){\n    node.status({text:\"\"});\n    }, 15000);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":680,"wires":[["8abcbb48.12bca8"]]},{"id":"508c6652.488c28","type":"function","z":"c3bc1a43.254dd","name":"Escritório On","func":"var contEscritorio = global.get(\"contEscritorio\");\nvar overrideEscritorio = global.get(\"overrideEscritorio\");\nvar escritorioEscuro = global.get(\"escritorioEscuro\");\nif(msg.payload === true){\n    if((contEscritorio < 2700 || overrideEscritorio === true) && escritorioEscuro === true){\n        var date = new Date();\n        var Day = date.getDay(); \n        var Hour = date.getHours();\n        if(Hour > 16 && Hour < 20){\n            if(((Day < 6 && Day > 0)||overrideEscritorio === true) && escritorioEscuro === true){\n                if(global.get(\"EscritorioOn\") === false){\n                        global.set(\"EscritorioOn\",true);\n                        node.status({fill:\"green\",shape:\"dot\",text:\"Escritorio On\"});\n                        msg.payload = {\"On\":true};\n                        node.send(msg);\n                }\n            }\n            setTimeout(function(){\n                node.status({text:\"\"});\n            }, 15000);\n        }\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1230,"y":400,"wires":[["711868e1.b7bc38"]]},{"id":"5a091587.fe341c","type":"switch","z":"c6be7449.1c6ce8","d":true,"name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"week day","vt":"str"},{"t":"eq","v":"weekend","vt":"str"},{"t":"eq","v":"any day","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":310,"y":120,"wires":[[],[],[]]},{"id":"51c2267.ac2ddd8","type":"function","z":"c6be7449.1c6ce8","d":true,"name":"","func":"var date = new Date();\nvar Day = date.getDay(); // sunday is 0 saturday is 6\nvar Hour = date.getHours(); //hours in 0-23\nif((Day < 6 && Day > 0)){\n    return \"week day\";\n}\nif(Day === 0 || Day === 6){\n    return \"weekend\";\n}\nelse\n    return \"any day\";","outputs":1,"noerr":0,"initialize":"","finalize":"","x":170,"y":120,"wires":[["5a091587.fe341c"]]},{"id":"c63cbd32.8d0df","type":"comment","z":"c6be7449.1c6ce8","name":"Dia da semana","info":"","x":120,"y":80,"wires":[]},{"id":"28df498d.b0fba6","type":"alexa-remote-routine","z":"c6be7449.1c6ce8","d":true,"name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":"Oi"},"volume":{"type":"num","value":"100"},"mode":"set","devices":["a9d590ebfbcd400dab7f40b75426db6d"]}},"x":410,"y":340,"wires":[["560dfa09.5af774"]]},{"id":"7a8a180e.f4f8b8","type":"inject","z":"c6be7449.1c6ce8","d":true,"name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":170,"y":340,"wires":[["28df498d.b0fba6"]]},{"id":"560dfa09.5af774","type":"alexa-remote-routine","z":"c6be7449.1c6ce8","d":true,"name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":""},"volume":{"type":"num","value":"50"},"mode":"set","devices":["a9d590ebfbcd400dab7f40b75426db6d"]}},"x":690,"y":340,"wires":[[]]},{"id":"581f1ce9.d9b254","type":"comment","z":"c6be7449.1c6ce8","name":"Alexa diz Oi","info":"","x":110,"y":300,"wires":[]},{"id":"7536da17.d873c4","type":"alexa-remote-routine","z":"c3bc1a43.254dd","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":"Bom filme."},"volume":{"type":"num","value":"50"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":1110,"y":1180,"wires":[[]]},{"id":"85ac8759.b54798","type":"alexa-remote-routine","z":"c3bc1a43.254dd","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":""},"volume":{"type":"num","value":"40"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":1390,"y":1240,"wires":[[]]},{"id":"9c0824cf.664cd8","type":"link out","z":"c3bc1a43.254dd","name":"Sala On","links":["64fa2a97.925a84"],"x":1635,"y":420,"wires":[]},{"id":"711868e1.b7bc38","type":"link out","z":"c3bc1a43.254dd","name":"Escritorio On","links":["a47983c5.55204","8e37e029.e25738"],"x":1395,"y":420,"wires":[]},{"id":"d56dec55.6a517","type":"link out","z":"c3bc1a43.254dd","name":"Quarto On","links":["e2aeba73.4e82b8"],"x":1595,"y":740,"wires":[]},{"id":"a792999e.fe4598","type":"function","z":"c3bc1a43.254dd","name":"True?","func":"if(msg.payload === \"on\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1090,"y":680,"wires":[["ec471f90.c534f"]]},{"id":"dbce4b90.0460d8","type":"delay","z":"c3bc1a43.254dd","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"hours","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":780,"y":1120,"wires":[["d7ff7023.7729e"]]},{"id":"d7ff7023.7729e","type":"function","z":"c3bc1a43.254dd","name":"horaDoFilme False","func":"global.set(\"horaDoFilme\", false);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":950,"y":1120,"wires":[[]]},{"id":"e74ef9a.fcb7f88","type":"function","z":"cbdfe56c.84c388","name":"","func":"var ocupado = global.get(\"BanheiroOcupado\");\nvar portaAberta = global.get(\"portaAbertaBanheiro\");\nvar newMsg;\nnewMsg = {\"payload\" : {\"On\":true}};\nglobal.set(\"isOnBanheiro\", true);\nglobal.set(\"BanheiroOcupado\", true);\nnode.send(newMsg);\nnode.status({fill:\"green\",shape:\"dot\",text:\"Ocupado: \"+ ocupado});\nsetTimeout(function(){\n    node.status({text:\"\"});\n    }, 15000);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1800,"y":280,"wires":[["66e0f051.5520d8","bc7be32d.890a28","17e5ec15.cf49b4"]]},{"id":"66e0f051.5520d8","type":"delay","z":"cbdfe56c.84c388","name":"","pauseType":"delay","timeout":"45","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2190,"y":300,"wires":[["9ec049.26e6efb8","ab500a8.a695378"]]},{"id":"bc7be32d.890a28","type":"function","z":"cbdfe56c.84c388","name":"Turn On","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nif(Hour > 16 || Hour < 8 || \n    global.get(\"botaoBanheiro\")=== true){\n        \n    if(msg.payload.On === true){\n            var newMsg;\n            newMsg = {payload: {\"on\":true}};\n            return newMsg;\n    }\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2200,"y":360,"wires":[["d77037ea.4506e8"]]},{"id":"64fa2a97.925a84","type":"link in","z":"ecc79e8a.d4a1b","name":"Sala On","links":["9c0824cf.664cd8"],"x":215,"y":240,"wires":[["854e670a.948e08","832afdc8.a5a6c","37effc1c.9c4f34","2aa20ebc.e47eb2"]]},{"id":"8e37e029.e25738","type":"link in","z":"1aa34a9.7045335","name":"Escritorio On","links":["711868e1.b7bc38"],"x":195,"y":340,"wires":[["7fcd7614.8f2a68","7e014f0.68b00b","13bef5ed.680ada"]]},{"id":"3fc1da86.2c49de","type":"yeelight-compat-hue-out","z":"1aa34a9.7045335","name":"Luz do Escritorio","server":"eeeccf7f.6c0df8","x":3150,"y":160,"wires":[]},{"id":"17262251.0ab2ce","type":"yeelight-compat-hue-out","z":"ecc79e8a.d4a1b","name":"Luz da Sala","server":"bbfd267.ea4ee58","x":3270,"y":180,"wires":[]},{"id":"285f180f.5766b8","type":"hb-control","z":"c3bc1a43.254dd","name":"Luz da TV","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeLuz da TV00000043","conf":"40e0a266.1beb0c","x":990,"y":1440,"wires":[]},{"id":"b9528d79.a3724","type":"change","z":"ecc79e8a.d4a1b","name":"Turn On","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"On\": true} ","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":380,"wires":[["94ec131c.6217c8"]]},{"id":"55f2c076.57273","type":"change","z":"1aa34a9.7045335","name":"Turn On","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"On\": true} ","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":400,"wires":[["dda7e9d2.170a08"]]},{"id":"a9a4f4e.5546908","type":"inject","z":"c3bc1a43.254dd","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":" {\"On\":true}","payloadType":"json","x":1240,"y":500,"wires":[["9c0824cf.664cd8","711868e1.b7bc38"]]},{"id":"e0af3522.c6b608","type":"yeelight-compat-hue-out","z":"c3bc1a43.254dd","name":"Luz da Sala","server":"bbfd267.ea4ee58","x":930,"y":1260,"wires":[]},{"id":"7fcd7614.8f2a68","type":"function","z":"1aa34a9.7045335","name":"Set Flow Variables","func":"\n\nif(global.get(\"EscritorioOnFirstTime\") === true){\n    global.set(\"EscritorioOnFirstTime\", false);    \n    \n    var date = new Date();\n    var hours = date.getHours(); //hourss in 0-23\n    var minutes = \"0\" + date.getMinutes();\n    minutes = parseInt(minutes.substr(-2), 10);\n    var seconds = \"0\" + date.getSeconds();\n    seconds = parseInt(seconds.substr(-2), 10);\n\n    flow.set(\"lastChangeSec\", seconds);\n    flow.set(\"lastChangeMinute\", minutes);\n    flow.set(\"lastChangeHour\", hours);\n    \n    flow.set(\"countBrightnessLuz\", 1);\n    flow.set(\"increasing\", true);\n    flow.set(\"auxCT\", 6100);\n    return {\"ajuda\": 1};\n}\nif(global.get(\"EscritorioOnFirstTime\") === false){\n    return {\"ajuda\": 2};\n}\nelse{\n    return {\"ajuda\": 3};\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":220,"wires":[["e11197a6.0b57b8"]]},{"id":"447ea5fb.c68a2c","type":"trigger","z":"1aa34a9.7045335","name":"","op1":"true","op2":"0","op1type":"json","op2type":"str","duration":"-30","extend":false,"units":"s","reset":"","bytopic":"all","outputs":1,"x":710,"y":260,"wires":[["a277a0cf.f250e"]]},{"id":"443c2cff.db8984","type":"function","z":"1aa34a9.7045335","name":"Turn On","func":"var date = new Date();\nvar hours = date.getHours(); //hourss in 0-23\nvar minutes = \"0\" + date.getMinutes();\nminutes = parseInt(minutes.substr(-2), 10);\nvar seconds = \"0\" + date.getSeconds();\nseconds = parseInt(seconds.substr(-2), 10);\nvar secondsLast = flow.get(\"lastChangeSec\");\nvar minutesLast = flow.get(\"lastChangeMinute\");\nvar hoursLast = flow.get(\"lastChangeHour\");\nvar increasing = flow.get(\"increasing\");\n\nif(hours >= 20){\n        increasing = false;\n        flow.set(\"increasing\", false)\n}\nif(msg.ajuda === 1){\n    \n        msg.payload =\n        {\n        \"on\": true,\n        \"bri\": 1,\n        \"ct\": 6100\n        };    \n        flow.set(\"lastChangeSec\", seconds);\n        flow.set(\"lastChangeMinute\", minutes);\n        flow.set(\"lastChangeHour\", hours);\n        return msg;\n}\nif(hours > hoursLast || seconds > secondsLast+20 || minutes > minutesLast){\n\n    var auxBrightness = flow.get(\"countBrightnessLuz\");\n    if(auxBrightness < msg.payload.state.bri-20 || auxBrightness > msg.payload.state.bri+20){\n        auxBrightness = msg.payload.state.bri;\n        flow.set(\"countBrightnessLuz\", auxBrightness);\n        \n    }    \n    var auxCT = flow.get(\"auxCT\");\n    if(auxCT < msg.payload.state.ct-100 || auxCT > msg.payload.state.ct+100){\n        auxCT = msg.payload.state.ct;\n        flow.set(\"auxCT\", auxCT);\n        \n    }\n    if(auxBrightness < 256 && increasing === true){\n        auxBrightness = auxBrightness + 2;\n        flow.set(\"countBrightnessLuz\",auxBrightness);\n    }\n    \n    if(auxCT < 6100 && increasing === true){\n        auxCT = auxCT +10;\n        flow.set(\"auxCT\", auxCT);\n    }\n    if(auxBrightness >50 && increasing === false){\n        auxBrightness = auxBrightness - 2;\n        flow.set(\"countBrightnessLuz\",auxBrightness);\n    }\n    if(auxCT > 2500 && increasing === false){\n        auxCT = auxCT -20;\n        flow.set(\"auxCT\", auxCT);\n    }\n    \n    msg.payload =\n        {\n        \"on\": true,\n        \"bri\": auxBrightness,\n        \"ct\": auxCT\n        };\n    flow.set(\"lastChangeSec\", seconds);\n    flow.set(\"lastChangeMinute\", minutes);\n    flow.set(\"lastChangeHour\", hours);    \n    if(auxBrightness > 254 && auxCT > 6000 && increasing === true){\n        msg.reset = 1;\n    }  \n    if(auxBrightness < 51 && auxCT < 2550 && increasing === false){\n        msg.reset = 1;\n    }\n    global.set(\"EscritorioOnFirstTime\", false);\n    global.set(\"EscritorioOn\", true);\n    return msg;\n    \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2720,"y":160,"wires":[["1b507b9f.cd04d4","8e7f0e9f.dc355","4503b984.e94a48"]]},{"id":"854e670a.948e08","type":"function","z":"ecc79e8a.d4a1b","name":"Set Flow Variables","func":"\nif(global.get(\"SalaOnFirstTime\") === true){\n    global.set(\"SalaOnFirstTime\", false);\n    \n    var date = new Date();\n    var hours = date.getHours(); //hourss in 0-23\n    var minutes = \"0\" + date.getMinutes();\n    minutes = parseInt(minutes.substr(-2), 10);\n    var seconds = \"0\" + date.getSeconds();\n    seconds = parseInt(seconds.substr(-2), 10);\n\n    flow.set(\"lastChangeSec\", seconds);\n    flow.set(\"lastChangeMinute\", minutes);\n    flow.set(\"lastChangeHour\", hours);\n    \n    flow.set(\"countBrightness\", 1);\n    flow.set(\"increasing\", true);\n    flow.set(\"auxCT\", 6100);\n    return {\"ajuda\": 1};\n}\nif(global.get(\"SalaOnFirstTime\") === false){\n    return {\"ajuda\": 2};\n}\nelse{\n    return {\"ajuda\": 3};\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":200,"wires":[["77801a36.d12114"]]},{"id":"dc27703a.ce8f3","type":"trigger","z":"ecc79e8a.d4a1b","name":"","op1":"true","op2":"0","op1type":"json","op2type":"str","duration":"-30","extend":false,"units":"s","reset":"","bytopic":"all","outputs":1,"x":890,"y":240,"wires":[["2f6e98a8.35ac08"]]},{"id":"536bcc14.b28374","type":"function","z":"ecc79e8a.d4a1b","name":"Turn On","func":"var date = new Date();\nvar hours = date.getHours(); //hourss in 0-23\nvar minutes = \"0\" + date.getMinutes();\nminutes = parseInt(minutes.substr(-2), 10);\nvar seconds = \"0\" + date.getSeconds();\nseconds = parseInt(seconds.substr(-2), 10);\nvar hoursLast = flow.get(\"lastChangeHour\");\nvar secondsLast = flow.get(\"lastChangeSec\");\nvar minutesLast = flow.get(\"lastChangeMinute\");\nvar increasing = flow.get(\"increasing\");\n\nif(hours >= 20){\n        increasing = false;\n        flow.set(\"increasing\", false)\n}\nif(msg.ajuda === 1){\n    \n        msg.payload =\n        {\n        \"on\": true,\n        \"bri\": 1,\n        \"ct\": 6100\n        };    \n        flow.set(\"lastChangeSec\", seconds);\n        flow.set(\"lastChangeMinute\", minutes);\n        flow.set(\"lastChangeHour\", hours);\n        return msg;\n}\nif(hours > hoursLast || seconds > secondsLast+20 || minutes > minutesLast){\n\n    var auxBrightness = flow.get(\"countBrightness\");\n    if(auxBrightness < msg.payload.state.bri-20 || auxBrightness > msg.payload.state.bri+20){\n        auxBrightness = msg.payload.state.bri;\n        flow.set(\"countBrightness\", auxBrightness);\n        \n    }    \n    var auxCT = flow.get(\"auxCT\");\n    if(auxCT < msg.payload.state.ct-100 || auxCT > msg.payload.state.ct+100){\n        auxCT = msg.payload.state.ct;\n        flow.set(\"auxCT\", auxCT);\n        \n    }\n    if(auxBrightness < 256 && increasing === true){\n        auxBrightness = auxBrightness + 2;\n        flow.set(\"countBrightness\",auxBrightness);\n    }\n    \n    if(auxCT < 6100 && increasing === true){\n        auxCT = auxCT +10;\n        flow.set(\"auxCT\", auxCT);\n    }\n    if(auxBrightness >50 && increasing === false){\n        auxBrightness = auxBrightness - 2;\n        flow.set(\"countBrightness\",auxBrightness);\n    }\n    if(auxCT > 2500 && increasing === false){\n        auxCT = auxCT -20;\n        flow.set(\"auxCT\", auxCT);\n    }\n    \n    flow.set(\"lastChangeSec\", seconds);\n    flow.set(\"lastChangeMinute\", minutes);\n    flow.set(\"lastChangeHour\", hours);\n    \n    msg.payload =\n        {\n        \"on\": true,\n        \"bri\": auxBrightness,\n        \"ct\": auxCT\n        };\n    if(auxBrightness > 254 && auxCT > 6000 && increasing === true){\n        msg.reset = 1;\n    }  \n    if(auxBrightness < 51 && auxCT < 2550 && increasing === false){\n        msg.reset = 1;\n    }\n    \n    global.set(\"SalaOnFirstTime\", false);\n    global.set(\"SalaOn\", true);\n    \n    return msg;\n    \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2940,"y":160,"wires":[["62c4486d.399b58","afec18cf.8b6318","8e60de77.ca5cf"]]},{"id":"afa0df09.bc458","type":"yeelight-compat-hue-state","z":"1aa34a9.7045335","name":"","server":"eeeccf7f.6c0df8","x":1290,"y":280,"wires":[["313bab76.09b364","ef68b40c.190218"]]},{"id":"f13340b.0470dc","type":"switch","z":"1aa34a9.7045335","name":"","property":"payload.resetar","propertyType":"msg","rules":[{"t":"null"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":1970,"y":260,"wires":[["5d3ae424.096d8c"],["50379460.3fa18c"]]},{"id":"29a615f5.b826fa","type":"change","z":"1aa34a9.7045335","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":3260,"y":320,"wires":[["447ea5fb.c68a2c"]]},{"id":"c20b6f3d.5e58c","type":"yeelight-compat-hue-state","z":"ecc79e8a.d4a1b","name":"","server":"bbfd267.ea4ee58","x":1470,"y":260,"wires":[["47164d52.41865c"]]},{"id":"c10ac12f.c7a9d","type":"inject","z":"1aa34a9.7045335","name":"Turn lights warmer and dimmer","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"*/20 20 * * *","once":false,"onceDelay":"","topic":"","payload":"true","payloadType":"bool","x":410,"y":300,"wires":[["447ea5fb.c68a2c","731480a6.2aea48"]]},{"id":"e11197a6.0b57b8","type":"switch","z":"1aa34a9.7045335","name":"","property":"ajuda","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":550,"y":180,"wires":[["2bc0ae4b.6d45d2","8fa5a15c.bd41a"],["447ea5fb.c68a2c"]]},{"id":"2bc0ae4b.6d45d2","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"delay","timeout":"20","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":720,"y":200,"wires":[["447ea5fb.c68a2c"]]},{"id":"b1084992.eddd68","type":"inject","z":"ecc79e8a.d4a1b","name":"Turn lights warmer and dimmer","props":[{"p":"payload"}],"repeat":"","crontab":"*/20 20 * * *","once":false,"onceDelay":"","topic":"","payload":"true","payloadType":"bool","x":530,"y":300,"wires":[["dc27703a.ce8f3","28aa2a5c.d692f6","f4909512.ed5718","1607f1ae.8e4bee"]]},{"id":"77801a36.d12114","type":"switch","z":"ecc79e8a.d4a1b","name":"","property":"ajuda","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":530,"y":200,"wires":[["1f8731a8.386e2e","12e47ae7.d37605"],["dc27703a.ce8f3"]]},{"id":"1f8731a8.386e2e","type":"delay","z":"ecc79e8a.d4a1b","name":"","pauseType":"delay","timeout":"20","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":680,"y":160,"wires":[["dc27703a.ce8f3"]]},{"id":"4c7ded6.995a614","type":"yeelight-compat-hue-out","z":"cbdfe56c.84c388","name":"Luz do Banheiro","server":"ea75f443.ed079","x":3280,"y":360,"wires":[]},{"id":"d1f8afe2.743b5","type":"function","z":"cbdfe56c.84c388","name":"Turn On/Off","func":"//diferentes brightness dependendo da hora\nvar date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nvar newMsg;\nnewMsg = {payload:{}};\nif(msg.payload.on === true){\n    if(Hour === 23){\n            newMsg.payload =\n            {\n            \"on\": true,\n            \"bri\": 50,\n            \"ct\": 5000\n            };\n            global.set(\"isOnBanheiro\", true);\n            \n            node.status({fill:\"green\",shape:\"dot\",text:\"Liga\"});\n            node.send(newMsg);\n            \n    }\n    if(Hour >= 0 && Hour < 8){\n            newMsg.payload =\n            {\n            \"on\": true,\n            \"bri\": 30,\n            \"ct\": 2500\n            };\n            global.set(\"isOnBanheiro\", true);\n            \n            node.status({fill:\"green\",shape:\"dot\",text:\"Liga\"});\n            node.send(newMsg);\n            \n    }\n    if((Hour > 17 && Hour < 22) || \n            global.get(\"botaoBanheiro\") === true){\n            global.set(\"botaoBanheiro\", false);\n            global.set(\"isOnBanheiro\", true);\n            newMsg.payload = \n                {\n                \"on\": true,\n                \"bri\": 255,\n                \"ct\": 6200\n                \n    };\n    node.status({fill:\"green\",shape:\"dot\",text:\"Liga\"});\n    node.send(newMsg);\n}\nelse{\n    newMsg.payload.on = false\n    node.status({fill:\"green\",shape:\"dot\",text:\"Desliga\"});\n    node.send(newMsg);\n}\nsetTimeout(function(){\n            node.status({text:\"\"});\n            }, 15000);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3110,"y":360,"wires":[["4c7ded6.995a614"]]},{"id":"70dac67f.c1bd28","type":"inject","z":"c6be7449.1c6ce8","d":true,"name":"Turn lights warmer and dimmer","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 21 * * *","once":false,"onceDelay":"","topic":"","payload":"true","payloadType":"bool","x":230,"y":500,"wires":[[]]},{"id":"f31afe2c.37666","type":"darksky in","z":"c3bc1a43.254dd","darksky":"fa56686d.1df858","name":"","key":"","lon":"-51.18650436","lat":"-30.01009828","date":"","time":"","lang":"en","units":"ca","x":430,"y":480,"wires":[["ca3b2a10.426b58"]]},{"id":"fdb9cb48.2926d","type":"function","z":"c3bc1a43.254dd","name":"Sunset?","func":"var dateNow = new Date();\nvar hoursNow = dateNow.getHours();\nvar minutesNow = \"0\" + dateNow.getMinutes();\nminutesNow = minutesNow.substr(-2)\nvar auxTime;\nif(msg.data.currently.summary.includes(\"cloudy\") === true ||\n    msg.data.currently.summary.includes(\"Cloudy\")=== true ||\n    msg.data.currently.summary.includes(\"rain\")=== true ||\n    msg.data.currently.summary.includes(\"Rain\")=== true  ||\n    msg.payload.clouds === 1){\n    auxTime = 2000;\n}\nelse{\n    auxTime = 1500;\n}\nvar dateSunset = new Date((msg.data.daily.data[0].sunsetTime-auxTime) * 1000);\nvar hoursSunset = dateSunset.getHours();\nvar minutesSunset = \"0\" + dateSunset.getMinutes();\nminutesSunset = minutesSunset.substr(-2)\n//msg = {payload: hoursSunset+\":\"+minutesSunset};\nif(hoursNow >= hoursSunset && minutesNow >= minutesSunset){\n    node.status({fill:\"green\",shape:\"dot\",text:\"Sunset started\"});\n    flow.set(\"triggered\", true);\n    node.send(msg);\n    global.set(\"escritorioEscuro\", true);\n    global.set(\"salaEscura\", true);\n    setTimeout(function(){\n    node.status({text:\"\"});\n    }, 15000);\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":740,"y":480,"wires":[["8c00ea31.7a21e8"]]},{"id":"82f29eb1.c546a","type":"function","z":"c3bc1a43.254dd","name":"Sunset?","func":"var dateNow = new Date();\nvar hoursNow = dateNow.getHours();\nvar minutesNow = \"0\" + dateNow.getMinutes();\nminutesNow = minutesNow.substr(-2)\nvar auxTime;\nif(msg.data.currently.summary.includes(\"cloudy\") === true ||\n    msg.data.currently.summary.includes(\"Cloudy\")=== true ||\n    msg.data.currently.summary.includes(\"rain\")=== true ||\n    msg.data.currently.summary.includes(\"Rain\")=== true  ||\n    msg.payload.clouds === 1){\n    auxTime = 2700;\n}\nelse{\n    auxTime = 1500;\n}\nvar dateSunset = new Date((msg.data.daily.data[0].sunsetTime-auxTime) * 1000);\nvar hoursSunset = dateSunset.getHours();\nvar minutesSunset = \"0\" + dateSunset.getMinutes();\nminutesSunset = minutesSunset.substr(-2)\n//msg = {payload: hoursSunset+\":\"+minutesSunset};\nif(hoursNow >= hoursSunset && minutesNow >= minutesSunset){\n    node.status({fill:\"green\",shape:\"dot\",text:\"Sunset started\"});\n    global.set(\"quartoEscuro\", true);\n    node.send(msg);\n    setTimeout(function(){\n    node.status({text:\"\"});\n    }, 15000);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":740,"wires":[["8abcbb48.12bca8"]]},{"id":"dd317cf4.b9bec8","type":"darksky in","z":"c3bc1a43.254dd","darksky":"fa56686d.1df858","name":"","key":"","lon":"-51.18650436","lat":"-30.01009828","date":"","time":"","lang":"en","units":"ca","x":330,"y":740,"wires":[["ac86ee5.cb6091"]]},{"id":"4cb38ef7.5736b","type":"alexa-remote-smarthome","z":"ccb6d071.13253","name":"","account":"d04673cf.2f08f","config":{"option":"action","value":[]},"outputs":1,"x":1930,"y":100,"wires":[[]]},{"id":"694ee688.8c94b8","type":"alexa-remote-smarthome","z":"ccb6d071.13253","name":"","account":"d04673cf.2f08f","config":{"option":"action","value":[]},"outputs":1,"x":1930,"y":160,"wires":[[]]},{"id":"e2aeba73.4e82b8","type":"link in","z":"ccb6d071.13253","name":"Quarto On","links":["d56dec55.6a517"],"x":175,"y":240,"wires":[["1d4d24f9.85c70b"]]},{"id":"8fa5a15c.bd41a","type":"function","z":"1aa34a9.7045335","name":"Begin Luz","func":"msg = {\"payload\":{\"state\":{\"bri\" : 1, \"ct\":6100}}, \"ajuda\": 1}\nflow.set(\"auxEmissor\", \"Yeelight\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":160,"wires":[["443c2cff.db8984"]]},{"id":"405d19e7.4c9ed8","type":"function","z":"ccb6d071.13253","name":"Time Check","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\n\n\nif((Hour > 6 && Hour < 23)){\n    msg = {\"payload\": 1};\n    return msg;\n}\nelse{\n    msg = {\"payload\": 2};\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1380,"y":240,"wires":[["9ce04583.7c10a8","bf80d75b.3135d8"]]},{"id":"9ce04583.7c10a8","type":"switch","z":"ccb6d071.13253","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1550,"y":260,"wires":[["5e3dfb6d.9d6424","6bfee78c.963388"],["cfb30077.a489d","8ad887fd.0fc8c8"]]},{"id":"505fda88.837514","type":"comment","z":"ccb6d071.13253","name":"Alguém entrou no quarto","info":"Alguém entrou no quarto e estava com as luzes desligada.","x":590,"y":160,"wires":[]},{"id":"c31821cd.7b51a","type":"comment","z":"c6be7449.1c6ce8","name":"Injetar numa hora do dia","info":"","x":150,"y":460,"wires":[]},{"id":"6a485651.c55a28","type":"switch","z":"c3bc1a43.254dd","name":"","property":"ajuda","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1210,"y":760,"wires":[["d56dec55.6a517","2c55436d.1a112c"],["ea427cf1.4eb9a","8487354c.b9a948"]]},{"id":"63dfa04e.20168","type":"link out","z":"c3bc1a43.254dd","name":"Quarto On Boa Noite","links":["71520bb0.9b2114"],"x":1495,"y":800,"wires":[]},{"id":"71520bb0.9b2114","type":"link in","z":"ccb6d071.13253","name":"Quarto On Boa Noite","links":["63dfa04e.20168"],"x":175,"y":760,"wires":[["e5b5f643.bd60a8"]]},{"id":"5a438892.4210d8","type":"comment","z":"ccb6d071.13253","name":"Ligar a luz baixinho e desligar logo depois","info":"","x":420,"y":680,"wires":[]},{"id":"976d0e1e.61a11","type":"alexa-remote-smarthome","z":"ccb6d071.13253","d":true,"name":"","account":"d04673cf.2f08f","config":{"option":"action","value":[{"entity":"f78e20f8-0e84-4e19-8441-c2dfea07d935","action":"setBrightness","value":{"type":"num","value":"10"}},{"entity":"f78e20f8-0e84-4e19-8441-c2dfea07d935","action":"setColorTemperature","value":{"type":"str","value":"incandescent"}},{"entity":"063c5681-d6a4-4bf2-af40-b7fa798204fc","action":"turnOn"}]},"outputs":1,"x":1120,"y":960,"wires":[[]]},{"id":"baadc359.0f772","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1370,"y":920,"wires":[["ec239872.46b048","44053648.80fec8","1e871423.157f8c"]]},{"id":"ec239872.46b048","type":"alexa-remote-smarthome","z":"ccb6d071.13253","d":true,"name":"","account":"d04673cf.2f08f","config":{"option":"action","value":[{"entity":"debedcda-d66e-46f6-9047-21579a1582fa","action":"turnOff"}]},"outputs":1,"x":1620,"y":880,"wires":[[]]},{"id":"c8623b89.3b7738","type":"catch","z":"ccb6d071.13253","name":"","scope":null,"uncaught":false,"x":260,"y":3720,"wires":[["f454ed62.8d3f","72b78ae0.8f9354"]]},{"id":"ce8e3f57.4f5e9","type":"alexa-remote-routine","z":"ccb6d071.13253","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"announcement","text":{"type":"str","value":"Erro na automação do Quarto Automações"},"volume":{"type":"num","value":"30"},"mode":"set","devices":["G090XG0894430B3V"]}},"x":1450,"y":3560,"wires":[[]]},{"id":"23643c4b.ed1364","type":"alexa-remote-routine","z":"ccb6d071.13253","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":""},"volume":{"type":"num","value":"40"},"mode":"set","devices":["G090XG0894430B3V"]}},"x":1610,"y":3640,"wires":[[]]},{"id":"3a4247b0.162248","type":"pushbullet","z":"ccb6d071.13253","config":"8e6fc0d2.d9006","pushtype":"note","title":"Erro em uma automação no Quarto Automation.","chan":"","name":"","x":1340,"y":3700,"wires":[]},{"id":"2d492869.b174f8","type":"e-mail","z":"ccb6d071.13253","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"nedisonn@me.com","dname":"","x":1250,"y":3760,"wires":[]},{"id":"9f825bec.52db48","type":"function","z":"ccb6d071.13253","name":"Create Error Message","func":"if(global.get(\"CatchErrors\") === false || global.get(\"ContCatchErrors\") > 4){\n    global.set(\"CatchErrors\", true);\n    msg = Object.assign({}, msg, {topic:\"Erro em uma automação no Quarto Automation.\"});\n\n    if(Array.isArray(msg.error) === true){\n        msg.payload = \" \";  \n     \n        for(var i = 0; i < 5; i++){\n            msg.payload = msg.payload + \"Erro numero \"+ i +\n            \"id: \" + msg.error[i].source.id+\". \"+\n            msg.error[i].source.name+ \". Tipo de erro:\" + \n            msg.error[i].source.type + \". Mensagem: \" +\n            msg.error[i].message + \"\\n\\n\";\n            \n        }\n    }\n    else{\n        msg.payload = \"Erro \"+ msg.error.source.id+\" \"+\n        msg.error.source.name+ \". Tipo de erro:\" + \n        msg.error.source.type + \". Mensagem: \" +\n        msg.error.message;\n    }\n   \n        return msg;\n}\n\nglobal.set(\"ContCatchErrors\", 0);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1010,"y":3700,"wires":[["3a4247b0.162248","2d492869.b174f8","e064c66d.06f518"]]},{"id":"f454ed62.8d3f","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":370,"y":3820,"wires":[["e3fb5f9.a5b0da"]]},{"id":"e3fb5f9.a5b0da","type":"function","z":"ccb6d071.13253","name":"Reset Aux Variables","func":"global.set(\"CatchErrors\",false);\nglobal.set(\"ContCatchErrors\", 0);","outputs":0,"noerr":0,"initialize":"","finalize":"","x":600,"y":3820,"wires":[]},{"id":"a9cb3206.6c00b","type":"catch","z":"1aa34a9.7045335","name":"","scope":null,"uncaught":false,"x":340,"y":2000,"wires":[["d11ea14.70cae6","ca1dcde.6309d3"]]},{"id":"c82d0c3a.482d9","type":"alexa-remote-routine","z":"1aa34a9.7045335","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"announcement","text":{"type":"str","value":"Erro na automação do Escritório Automações"},"volume":{"type":"num","value":"30"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":1510,"y":1860,"wires":[[]]},{"id":"2f65d89d.d846e8","type":"alexa-remote-routine","z":"1aa34a9.7045335","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":""},"volume":{"type":"num","value":"40"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":1710,"y":1940,"wires":[[]]},{"id":"6383a50a.32805c","type":"pushbullet","z":"1aa34a9.7045335","config":"8e6fc0d2.d9006","pushtype":"note","title":"Erro em uma automação no Escritório Automation.","chan":"","name":"","x":1490,"y":2000,"wires":[]},{"id":"38c404e9.0bfa1c","type":"e-mail","z":"1aa34a9.7045335","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"nedisonn@me.com","dname":"","x":1410,"y":2060,"wires":[]},{"id":"3c6b02cf.1cb1fe","type":"function","z":"1aa34a9.7045335","name":"Create Error Message","func":"if(global.get(\"CatchErrors\") === false || global.get(\"ContCatchErrors\") > 4){\n    global.set(\"CatchErrors\", true);\n    msg = Object.assign({}, msg, {topic:\"Erro em uma automação no Escritório Automation.\"});\n\n    if(Array.isArray(msg.error) === true){\n        msg.payload = \" \";  \n     \n        for(var i = 0; i < 5; i++){\n            msg.payload = msg.payload + \"Erro numero \"+ i +\n            \"id: \" + msg.error[i].source.id+\". \"+\n            msg.error[i].source.name+ \". Tipo de erro:\" + \n            msg.error[i].source.type + \". Mensagem: \" +\n            msg.error[i].message + \"\\n\\n\";\n            \n        }\n    }\n    else{\n        msg.payload = \"Erro \"+ msg.error.source.id+\" \"+\n        msg.error.source.name+ \". Tipo de erro:\" + \n        msg.error.source.type + \". Mensagem: \" +\n        msg.error.message;\n    }\n   \n        return msg;\n}\n\nglobal.set(\"ContCatchErrors\", 0);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1130,"y":2000,"wires":[["6383a50a.32805c","38c404e9.0bfa1c","8bce6cc9.8553c"]]},{"id":"d11ea14.70cae6","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":350,"y":2120,"wires":[["b5123509.1c7898"]]},{"id":"b5123509.1c7898","type":"function","z":"1aa34a9.7045335","name":"Reset Aux Variables","func":"global.set(\"CatchErrors\",false);\n\nglobal.set(\"ContCatchErrors\", 0);","outputs":0,"noerr":0,"initialize":"","finalize":"","x":580,"y":2120,"wires":[]},{"id":"233049b2.7a1b36","type":"catch","z":"ecc79e8a.d4a1b","name":"","scope":null,"uncaught":false,"x":240,"y":1300,"wires":[["e06b854f.b03dc8","29d93ca7.6f63f4"]]},{"id":"ed3e0d9c.14aa6","type":"alexa-remote-routine","z":"ecc79e8a.d4a1b","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"announcement","text":{"type":"str","value":"Erro na automação do Sala Automações"},"volume":{"type":"num","value":"30"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":1550,"y":1180,"wires":[[]]},{"id":"5bb8b72c.116fb8","type":"alexa-remote-routine","z":"ecc79e8a.d4a1b","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":""},"volume":{"type":"num","value":"40"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":1710,"y":1240,"wires":[[]]},{"id":"6ab4efb8.f967c","type":"pushbullet","z":"ecc79e8a.d4a1b","config":"8e6fc0d2.d9006","pushtype":"note","title":"Erro em uma automação no SalaAutomation.","chan":"","name":"","x":1410,"y":1320,"wires":[]},{"id":"dd5c47a.a5331b8","type":"e-mail","z":"ecc79e8a.d4a1b","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"nedisonn@me.com","dname":"","x":1330,"y":1380,"wires":[]},{"id":"4a76365a.e3e618","type":"function","z":"ecc79e8a.d4a1b","name":"Create Error Message","func":"if(global.get(\"CatchErrors\") === false || global.get(\"ContCatchErrors\") > 4){\n    global.set(\"CatchErrors\", true);\n    msg = Object.assign({}, msg, {topic:\"Erro em uma automação no Sala Automation.\"});\n\n    if(Array.isArray(msg.error) === true){\n        msg.payload = \" \";  \n     \n        for(var i = 0; i < 5; i++){\n            msg.payload = msg.payload + \"Erro numero \"+ i +\n            \"id: \" + msg.error[i].source.id+\". \"+\n            msg.error[i].source.name+ \". Tipo de erro:\" + \n            msg.error[i].source.type + \". Mensagem: \" +\n            msg.error[i].message + \"\\n\\n\";\n            \n        }\n    }\n    else{\n        msg.payload = \"Erro \"+ msg.error.source.id+\" \"+\n        msg.error.source.name+ \". Tipo de erro:\" + \n        msg.error.source.type + \". Mensagem: \" +\n        msg.error.message;\n    }\n   \n        return msg;\n}\n\nglobal.set(\"ContCatchErrors\", 0);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":1300,"wires":[["6ab4efb8.f967c","dd5c47a.a5331b8","facaceab.0605f"]]},{"id":"e06b854f.b03dc8","type":"delay","z":"ecc79e8a.d4a1b","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":270,"y":1400,"wires":[["c613a4d8.567248"]]},{"id":"c613a4d8.567248","type":"function","z":"ecc79e8a.d4a1b","name":"Reset Aux Variables","func":"global.set(\"CatchErrors\",false);\n\nglobal.set(\"ContCatchErrors\", 0);","outputs":0,"noerr":0,"initialize":"","finalize":"","x":470,"y":1400,"wires":[]},{"id":"7be518f4.7d8a78","type":"catch","z":"c3bc1a43.254dd","name":"","scope":null,"uncaught":false,"x":260,"y":1740,"wires":[["3b393d08.bc2152","994d801.ac8508"]]},{"id":"b70b5969.e61488","type":"alexa-remote-routine","z":"c3bc1a43.254dd","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"announcement","text":{"type":"str","value":"Erro na automação do HomeKit Automações"},"volume":{"type":"num","value":"30"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":1450,"y":1640,"wires":[[]]},{"id":"b0b884f8.fc8de8","type":"alexa-remote-routine","z":"c3bc1a43.254dd","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":""},"volume":{"type":"num","value":"40"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":1590,"y":1700,"wires":[[]]},{"id":"81f1bb0d.02d918","type":"pushbullet","z":"c3bc1a43.254dd","config":"8e6fc0d2.d9006","pushtype":"note","title":"Erro em uma automação no HomeKit Automation.","chan":"","name":"","x":1330,"y":1760,"wires":[]},{"id":"91fca71.a4ba358","type":"e-mail","z":"c3bc1a43.254dd","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"nedisonn@me.com","dname":"","x":1230,"y":1820,"wires":[]},{"id":"b1dd0672.b489e8","type":"function","z":"c3bc1a43.254dd","name":"Create Error Message","func":"if(global.get(\"CatchErrors\") === false || global.get(\"ContCatchErrors\") > 4){\n    global.set(\"CatchErrors\", true);\n    msg = Object.assign({}, msg, {topic:\"Erro em uma automação no HomeKit Automation.\"});\n\n    if(Array.isArray(msg.error) === true){\n        msg.payload = \" \";  \n     \n        for(var i = 0; i < 5; i++){\n            msg.payload = msg.payload + \"Erro numero \"+ i +\n            \"id: \" + msg.error[i].source.id+\". \"+\n            msg.error[i].source.name+ \". Tipo de erro:\" + \n            msg.error[i].source.type + \". Mensagem: \" +\n            msg.error[i].message + \"\\n\\n\";\n            \n        }\n    }\n    else{\n        msg.payload = \"Erro \"+ msg.error.source.id+\" \"+\n        msg.error.source.name+ \". Tipo de erro:\" + \n        msg.error.source.type + \". Mensagem: \" +\n        msg.error.message;\n    }\n   \n        return msg;\n}\n\nglobal.set(\"ContCatchErrors\", 0);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1000,"y":1740,"wires":[["81f1bb0d.02d918","91fca71.a4ba358","48b4e846.f43928"]]},{"id":"3b393d08.bc2152","type":"delay","z":"c3bc1a43.254dd","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":410,"y":1820,"wires":[["6bad05c3.274a8c"]]},{"id":"6bad05c3.274a8c","type":"function","z":"c3bc1a43.254dd","name":"Reset Aux Variables","func":"global.set(\"CatchErrors\",false);","outputs":0,"noerr":0,"initialize":"","finalize":"","x":610,"y":1820,"wires":[]},{"id":"bef23640.78f2f8","type":"switch","z":"ccb6d071.13253","name":"","property":"ajuda","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":730,"y":3720,"wires":[["9f825bec.52db48"],["75420fca.77cc2"]]},{"id":"ef47678d.97ae58","type":"function","z":"ccb6d071.13253","name":"Cont++","func":"if(global.get(\"ContCatchErrors\") === 0){\n\n    global.set(\"ContCatchErrors\", 1);\n    msg = Object.assign({}, msg, {ajuda:1});\n    return msg;\n}\nif(global.get(\"ContCatchErrors\") > 0){\n    global.set(\"ContCatchErrors\",global.get(\"ContCatchErrors\")+1);\n\n    msg = Object.assign({}, msg, {ajuda:2});\n    return msg;\n    \n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":3720,"wires":[["bef23640.78f2f8"]]},{"id":"75420fca.77cc2","type":"join","z":"ccb6d071.13253","name":"","mode":"custom","build":"array","property":"error","propertyType":"msg","key":"topic","joiner":"\\n\\n","joinerType":"str","accumulate":false,"timeout":"","count":"5","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":850,"y":3740,"wires":[["9f825bec.52db48"]]},{"id":"2e96e767.1d7b98","type":"join","z":"1aa34a9.7045335","name":"","mode":"custom","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n\\n","joinerType":"str","accumulate":false,"timeout":"","count":"5","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":930,"y":2040,"wires":[["3c6b02cf.1cb1fe"]]},{"id":"dc049d0f.c51aa","type":"switch","z":"1aa34a9.7045335","name":"","property":"ajuda","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":2000,"wires":[["3c6b02cf.1cb1fe"],["2e96e767.1d7b98"]]},{"id":"733c7618.abd128","type":"function","z":"1aa34a9.7045335","name":"Cont++","func":"if(global.get(\"ContCatchErrors\") === 0){\n\n    global.set(\"ContCatchErrors\", 1);\n    msg.ajuda = 1;    \n    return msg;\n}\nif(global.get(\"ContCatchErrors\") > 0){\n    global.set(\"ContCatchErrors\",global.get(\"ContCatchErrors\")+1);\n    msg.ajuda = 2;\n    return msg;\n    \n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":2000,"wires":[["dc049d0f.c51aa"]]},{"id":"a2bec063.833fa","type":"join","z":"ecc79e8a.d4a1b","name":"","mode":"custom","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n\\n","joinerType":"str","accumulate":false,"timeout":"","count":"5","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":890,"y":1340,"wires":[["4a76365a.e3e618"]]},{"id":"32bf5bc7.484b44","type":"switch","z":"ecc79e8a.d4a1b","name":"","property":"ajuda","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":750,"y":1300,"wires":[["4a76365a.e3e618"],["a2bec063.833fa"]]},{"id":"e9ece8f3.f089c8","type":"function","z":"ecc79e8a.d4a1b","name":"Cont++","func":"if(global.get(\"ContCatchErrors\") === 0){\n\n    global.set(\"ContCatchErrors\", 1);\n    msg.ajuda = 1;    \n    return msg;\n}\nif(global.get(\"ContCatchErrors\") > 0){\n    global.set(\"ContCatchErrors\",global.get(\"ContCatchErrors\")+1);\n    msg.ajuda = 2;\n    return msg;\n    \n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":1300,"wires":[["32bf5bc7.484b44"]]},{"id":"c6f7943b.819d98","type":"join","z":"c3bc1a43.254dd","name":"","mode":"custom","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n\\n","joinerType":"str","accumulate":false,"timeout":"","count":"5","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":810,"y":1780,"wires":[["b1dd0672.b489e8"]]},{"id":"a66ab513.3d5208","type":"switch","z":"c3bc1a43.254dd","name":"","property":"ajuda","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":690,"y":1740,"wires":[["b1dd0672.b489e8"],["c6f7943b.819d98"]]},{"id":"3c4980ba.6cda6","type":"function","z":"c3bc1a43.254dd","name":"Cont++","func":"if(global.get(\"ContCatchErrors\") === 0){\n\n    global.set(\"ContCatchErrors\", 1);\n    msg.ajuda = 1;    \n    return msg;\n}\nif(global.get(\"ContCatchErrors\") > 0){\n    global.set(\"ContCatchErrors\",global.get(\"ContCatchErrors\")+1);\n    msg.ajuda = 2;\n    return msg;\n    \n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":1740,"wires":[["a66ab513.3d5208"]]},{"id":"bb9c955b.b89cf8","type":"inject","z":"c6be7449.1c6ce8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":1050,"y":80,"wires":[["98c71240.afd62"]]},{"id":"98c71240.afd62","type":"function","z":"c6be7449.1c6ce8","name":"","func":"global.set(\"CatchErrors\",false);\nglobal.set(\"ContCatchErrors\", 0);","outputs":0,"noerr":0,"initialize":"","finalize":"","x":1190,"y":120,"wires":[]},{"id":"26ffb0af.01e1c","type":"function","z":"c6be7449.1c6ce8","name":"","func":"global.set(\"SalaOnFirstTime\", true);\nglobal.set(\"SalaOn\",false);\nglobal.set(\"salaEscura\",false);\nglobal.set(\"luzDaMesaOn\", false);\n        \nglobal.set(\"EscritorioOnFirstTime\", true);\nglobal.set(\"EscritorioOn\",false);\nglobal.set(\"escritorioEscuro\",false);\nglobal.set(\"overrideEscritorio\",false);\nglobal.set(\"contEscritorio\", 0); \n\nglobal.set(\"contBanheiro\", 0); \nglobal.set(\"botaoBanheiro\", false); \nglobal.set(\"abertaMuitoTempo\", false); \n\nglobal.set(\"LampadaOn\", false); \nglobal.set(\"turnOffDelay\", false); \nglobal.set(\"vouDormir\", false); \nglobal.set(\"botaoQuarto\", false); \nglobal.set(\"quartoOn\",false);\n\nglobal.set(\"horaDoFilme\", false);\nglobal.set(\"tvAuxFilme\", false);\nglobal.set(\"alexaCafeAux\", false);","outputs":0,"noerr":0,"initialize":"","finalize":"","x":1370,"y":440,"wires":[]},{"id":"2c9b4b26.1ad264","type":"inject","z":"c6be7449.1c6ce8","name":"Restart variables in the morning","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"*/30 7-8 * * *","once":false,"onceDelay":"","topic":"","payload":"true","payloadType":"bool","x":1140,"y":400,"wires":[["26ffb0af.01e1c"]]},{"id":"6b83c3ff.e5923c","type":"comment","z":"c6be7449.1c6ce8","name":"CatchErrors setup","info":"","x":1050,"y":40,"wires":[]},{"id":"59d11e9c.9445c","type":"comment","z":"c6be7449.1c6ce8","name":"Alexa Activity","info":"On Device Activity\nalexa-remote-event\n\n\n//input:\nmsg.payload.domainAttributes.nBestList[0].questionText;\n//or \nmsg.payload.description.summary;\n\n//alexa answer \nmsg.payload.domainAttributes.nBestList[0].answerText;\nreturn msg;\n\n\n","x":120,"y":600,"wires":[]},{"id":"facaceab.0605f","type":"function","z":"ecc79e8a.d4a1b","name":"Check if it's day","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nif(Hour < 23 && Hour > 10){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":1240,"wires":[["ed3e0d9c.14aa6","425fb5f5.1f6dcc"]]},{"id":"8bce6cc9.8553c","type":"function","z":"1aa34a9.7045335","name":"Check if it's day","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nif(Hour < 23 && Hour > 10){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1310,"y":1940,"wires":[["c82d0c3a.482d9","c174225c.6ce9a8"]]},{"id":"e064c66d.06f518","type":"function","z":"ccb6d071.13253","name":"Check if it's day","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nif(Hour < 23 && Hour > 10){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1230,"y":3640,"wires":[["ce8e3f57.4f5e9","1cdb6ec9.ebe911"]]},{"id":"48b4e846.f43928","type":"function","z":"c3bc1a43.254dd","name":"Check if it's day","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nif(Hour < 23 && Hour > 10){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1220,"y":1680,"wires":[["b70b5969.e61488","6dd9d017.c5888"]]},{"id":"e35de897.37c798","type":"catch","z":"cbdfe56c.84c388","name":"","scope":null,"uncaught":false,"x":220,"y":1160,"wires":[["cf4f3c83.535ee","db884489.800a68"]]},{"id":"e3d44a90.966ac8","type":"alexa-remote-routine","z":"cbdfe56c.84c388","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"announcement","text":{"type":"str","value":"Erro na automação do Banheiro Automações"},"volume":{"type":"num","value":"30"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":1430,"y":1020,"wires":[[]]},{"id":"59f278b3.9dc318","type":"alexa-remote-routine","z":"cbdfe56c.84c388","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":""},"volume":{"type":"num","value":"40"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":1630,"y":1080,"wires":[[]]},{"id":"f873ec84.b2935","type":"pushbullet","z":"cbdfe56c.84c388","config":"8e6fc0d2.d9006","pushtype":"note","title":"Erro em uma automação no Banheiro Automation.","chan":"","name":"","x":1390,"y":1140,"wires":[]},{"id":"acb0521a.b67d5","type":"e-mail","z":"cbdfe56c.84c388","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"nedisonn@me.com","dname":"","x":1290,"y":1200,"wires":[]},{"id":"226e7eee.3965f2","type":"function","z":"cbdfe56c.84c388","name":"Create Error Message","func":"if(global.get(\"CatchErrors\") === false || global.get(\"ContCatchErrors\") > 4){\n    global.set(\"CatchErrors\", true);\n    msg = Object.assign({}, msg, {topic:\"Erro em uma automação no Banheiro Automation.\"});\n\n    if(Array.isArray(msg.error) === true){\n        msg.payload = \" \";  \n     \n        for(var i = 0; i < 5; i++){\n            msg.payload = msg.payload + \"Erro numero \"+ i +\n            \"id: \" + msg.error[i].source.id+\". \"+\n            msg.error[i].source.name+ \". Tipo de erro:\" + \n            msg.error[i].source.type + \". Mensagem: \" +\n            msg.error[i].message + \"\\n\\n\";\n            \n        }\n    }\n    else{\n        msg.payload = \"Erro \"+ msg.error.source.id+\" \"+\n        msg.error.source.name+ \". Tipo de erro:\" + \n        msg.error.source.type + \". Mensagem: \" +\n        msg.error.message;\n    }\n   \n        return msg;\n}\n\nglobal.set(\"ContCatchErrors\", 0);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1040,"y":1140,"wires":[["f873ec84.b2935","acb0521a.b67d5","5061c704.846b18"]]},{"id":"cf4f3c83.535ee","type":"delay","z":"cbdfe56c.84c388","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":290,"y":1280,"wires":[["70f1dd3c.30e204"]]},{"id":"70f1dd3c.30e204","type":"function","z":"cbdfe56c.84c388","name":"Reset Aux Variables","func":"global.set(\"CatchErrors\",false);\nglobal.set(\"ContCatchErrors\", 0);\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":1280,"wires":[[]]},{"id":"5f60e5c2.5d568c","type":"join","z":"cbdfe56c.84c388","name":"","mode":"custom","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n\\n","joinerType":"str","accumulate":false,"timeout":"","count":"5","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":870,"y":1200,"wires":[["226e7eee.3965f2"]]},{"id":"6d1c8885.ae32b8","type":"switch","z":"cbdfe56c.84c388","name":"","property":"ajuda","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":730,"y":1160,"wires":[["226e7eee.3965f2"],["5f60e5c2.5d568c"]]},{"id":"bc97411e.19d3b","type":"function","z":"cbdfe56c.84c388","name":"Cont++","func":"if(global.get(\"ContCatchErrors\") === 0){\n\n    global.set(\"ContCatchErrors\", 1);\n    msg.ajuda = 1;    \n    return msg;\n}\nif(global.get(\"ContCatchErrors\") > 0){\n    global.set(\"ContCatchErrors\",global.get(\"ContCatchErrors\")+1);\n    msg.ajuda = 2;\n    return msg;\n    \n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":1160,"wires":[["6d1c8885.ae32b8"]]},{"id":"5061c704.846b18","type":"function","z":"cbdfe56c.84c388","name":"Check if it's day","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nif(Hour < 23 && Hour > 10){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1230,"y":1100,"wires":[["e3d44a90.966ac8","214ac00f.520f38"]]},{"id":"fa2c75b8.6a2cd8","type":"comment","z":"c3bc1a43.254dd","name":"Automações do Quarto","info":"","x":240,"y":560,"wires":[]},{"id":"203e0007.000e","type":"comment","z":"c3bc1a43.254dd","name":"Automações do Escritório e Sala","info":"","x":290,"y":80,"wires":[]},{"id":"ea381b10.3e4918","type":"comment","z":"c3bc1a43.254dd","name":"Automações do Movie Night","info":"","x":320,"y":1040,"wires":[]},{"id":"d0fe59ae.054b78","type":"comment","z":"cbdfe56c.84c388","name":"Catching Errors and notifying","info":"","x":260,"y":1100,"wires":[]},{"id":"21c4581e.74db08","type":"comment","z":"ecc79e8a.d4a1b","name":"Catching Errors and notifying","info":"","x":260,"y":1260,"wires":[]},{"id":"39722c5.db0ced4","type":"comment","z":"1aa34a9.7045335","name":"Catching Errors and notifying","info":"","x":300,"y":1960,"wires":[]},{"id":"2b9b6e14.647052","type":"comment","z":"ccb6d071.13253","name":"Catching Errors and notifying","info":"","x":320,"y":3660,"wires":[]},{"id":"200d5410.e20c3c","type":"comment","z":"c3bc1a43.254dd","name":"Catching Errors and notifying","info":"","x":360,"y":1660,"wires":[]},{"id":"27f8901a.d7bef","type":"inject","z":"c6be7449.1c6ce8","name":"Started!","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"","topic":"","payload":"true","payloadType":"bool","x":1060,"y":260,"wires":[["c0279044.d2892","336832f8.523fae"]]},{"id":"f3ff4782.60f578","type":"comment","z":"c6be7449.1c6ce8","name":"Start variables","info":"","x":1030,"y":200,"wires":[]},{"id":"c0279044.d2892","type":"function","z":"c6be7449.1c6ce8","name":"","func":"//Errors Variables\nglobal.set(\"CatchErrors\",false);\nglobal.set(\"ContCatchErrors\", 0);\n\n//Quarto Variables\nglobal.set(\"turnOffDelay\", false);\nglobal.set(\"quartoOn\", false);\nglobal.set(\"vouDormir\", false);\nglobal.set(\"botaoQuarto\", false);\nglobal.set(\"luxQuarto\", 25); \n\n//Hora do filme Variables\nglobal.set(\"horaDoFilme\", false);\n\n//Sala and Escritorio Variables\nvar date = new Date();\nvar hours = date.getHours();\nvar minutes = \"0\" + date.getMinutes();\nminutes = parseInt(minutes.substr(-2), 10);\nvar seconds = \"0\" + date.getSeconds();\nseconds = parseInt(seconds.substr(-2), 10);\nglobal.set(\"lastChangeSec\", seconds);\nglobal.set(\"lastChangeMinute\", minutes);\nglobal.set(\"lastChangeHour\", hours);\nglobal.set(\"SalaOnFirstTime\", true);\nglobal.set(\"SalaOn\",false);\nglobal.set(\"EscritorioOnFirstTime\", true);\nglobal.set(\"EscritorioOn\",false);\nglobal.set(\"salaEscura\",false);\nglobal.set(\"escritorioEscuro\",false);\nglobal.set(\"overrideEscritorio\", true);\nglobal.set(\"contEscritorio\", 0);\nglobal.set(\"luzDaMesaOn\", false);\n\n//Banheiro variables\nglobal.set(\"BanheiroOcupado\", false);\nglobal.set(\"contBanheiro\", 0);\nglobal.set(\"botaoBanheiro\", false);\nglobal.set(\"auxEmissorBanheiro\", \"\");\nglobal.set(\"isOnBanheiro\", false);\nglobal.set(\"abertaMuitoTempo\", false);\n\nglobal.set(\"auxContStatus\", 0);\nglobal.set(\"alexaCafeAux\", false);\nglobal.set(\"tvAuxFilme\", false);","outputs":0,"noerr":0,"initialize":"","finalize":"","x":1240,"y":280,"wires":[]},{"id":"7e8b7434.348fec","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"20","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":2500,"y":220,"wires":[["443c2cff.db8984"]]},{"id":"aff8e940.e8c4c8","type":"delay","z":"ecc79e8a.d4a1b","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"20","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":2700,"y":200,"wires":[["536bcc14.b28374","6eb3c8d0.4b38b8"]]},{"id":"ea427cf1.4eb9a","type":"function","z":"c3bc1a43.254dd","name":"Turn On Fraco","func":"var turnOffDelay = global.get(\"turnOffDelay\");\n\nif(turnOffDelay ===false){\n    \n    msg = {payload: {\"On\":true}};\n    node.status({fill:\"green\",shape:\"dot\",text:\"Quarto On Fraco\"});\n    node.send(msg);\n    node.done();\n\n    setTimeout(function(){\n    node.status({text:\"\"});\n    }, 15000);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1380,"y":800,"wires":[["63dfa04e.20168"]]},{"id":"8796fd61.222ce","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"delay","timeout":"40","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":720,"y":1500,"wires":[["57390478.036c5c"]]},{"id":"c36b49d3.804d58","type":"comment","z":"ccb6d071.13253","name":"Ligar as luzes de manha","info":"Ligar as luzes de manha caso o quarto esteja muito escuro.","x":310,"y":1960,"wires":[]},{"id":"f1ebc6f0.b7b2b8","type":"inject","z":"ccb6d071.13253","name":"Turn lights in the morning","repeat":"","crontab":"30 09 * * 1,2,3,4,5,6","once":false,"onceDelay":"","topic":"","payload":"true","payloadType":"bool","x":340,"y":2040,"wires":[["991f4b85.f34178"]]},{"id":"5d9f915a.fa6b9","type":"function","z":"ccb6d071.13253","name":"","func":"var luxQuarto = global.get(\"luxQuarto\");\nif(luxQuarto < 50 && luxQuarto > 0){\n    msg = {payload: {\"On\":true}};\n    return msg;\n\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":2040,"wires":[["cd47ed0f.892bc"]]},{"id":"cfff2860.d76978","type":"mqtt out","z":"ccb6d071.13253","name":"setOn RGB Strip","topic":"QuartoNedi/setOnRGB","qos":"","retain":"","broker":"a03558e.9e50d28","x":1550,"y":2040,"wires":[]},{"id":"3ac7fe33.d80902","type":"mqtt out","z":"ccb6d071.13253","name":"setRGB RGB Strip","topic":"QuartoNedi/setRGB","qos":"","retain":"","broker":"a03558e.9e50d28","x":1730,"y":2100,"wires":[]},{"id":"365cbf87.91c9c","type":"function","z":"ccb6d071.13253","name":"Turn On","func":"msg = {payload:1};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1330,"y":2080,"wires":[["cfff2860.d76978","51ba56ba.f06838"]]},{"id":"51ba56ba.f06838","type":"function","z":"ccb6d071.13253","name":"White","func":"msg = {payload:\"FFFFFF\"};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1520,"y":2120,"wires":[["3ac7fe33.d80902"]]},{"id":"38c2acdf.200664","type":"function","z":"c3bc1a43.254dd","name":"Anunciar Bom Filme","func":"var date = new Date();\nvar Day = date.getDay(); \nvar Hour = date.getHours();\nif(Hour >18) {\n                msg = {payload: {\"On\":true}};\n                \n    node.send(msg);\n    node.status({text:\"Enviou\"});\n    setTimeout(function(){\n    node.status({text:\"\"});\n    }, 3000);\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":1200,"wires":[["7536da17.d873c4","a9bbea7c.756538"]]},{"id":"ddcac793.bcf1a8","type":"yeelight-compat-hue-state","z":"c3bc1a43.254dd","name":"","server":"eeeccf7f.6c0df8","x":970,"y":1500,"wires":[["106e37eb.151f28"]]},{"id":"46c4d6fa.ab3648","type":"switch","z":"c3bc1a43.254dd","name":"","property":"payload.state.on","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1310,"y":1500,"wires":[["e6adafed.f4be4"],["a98dd6aa.2c9e98"]]},{"id":"224285bd.98b8ea","type":"yeelight-compat-hue-out","z":"c3bc1a43.254dd","name":"","server":"eeeccf7f.6c0df8","x":1690,"y":1480,"wires":[]},{"id":"e6adafed.f4be4","type":"function","z":"c3bc1a43.254dd","name":"Turn On Dim","func":"msg.payload = {\"on\": true,\"bri\":25, \"ct\": 3500};\n\n    node.send(msg);\n    node.status({text:\"Ligou\"});\n    setTimeout(function(){\n    node.status({text:\"\"});\n    }, 3000);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1470,"y":1480,"wires":[["224285bd.98b8ea"]]},{"id":"fd7289b3.a8e608","type":"function","z":"c3bc1a43.254dd","name":"Turn On Dim","func":"msg.payload = { On: true, Hue: 170, Saturation: 96, Brightness: 35 };\n\n    node.send(msg);\n    node.status({text:\"Ligou\"});\n    setTimeout(function(){\n    node.status({text:\"\"});\n    }, 3000);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":1440,"wires":[["285f180f.5766b8"]]},{"id":"b0be53ac.66296","type":"function","z":"ccb6d071.13253","name":"","func":"if(msg.payload === true){\n    var newMsg;\n    newMsg = {payload: {\"On\":true}};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1100,"y":2040,"wires":[["365cbf87.91c9c","42c77644.cb9678","a86c47ce.1db0f8"]]},{"id":"b8fa3939.5f78d8","type":"yeelight-compat-hue-state","z":"cbdfe56c.84c388","name":"","server":"ea75f443.ed079","x":720,"y":300,"wires":[["b899f9b5.68c78"]]},{"id":"d39ea2f.3d3646","type":"function","z":"cbdfe56c.84c388","name":"","func":"var newMsg;\nnewMsg = {\"payload\": {\"On\": false}};\nglobal.set(\"isOnBanheiro\", false);\nglobal.set(\"BanheiroOcupado\", false);\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1800,"y":220,"wires":[["ab500a8.a695378","9ec049.26e6efb8"]]},{"id":"5e3dfb6d.9d6424","type":"function","z":"ccb6d071.13253","d":true,"name":"","func":"var aux = [{},{},{}]\naux[0].entity = \"Luz do Quarto\";\naux[0].action = \"setColorTemperature\";\naux[0].value = \"cool\";\n\naux[1].entity = \"Luz do Quarto\";\naux[1].action = \"setBrightness\";\naux[1].value = 100;\n\naux[2].entity = \"Luz do Quarto\";\naux[2].action = \"turnOn\";\n\nmsg.payload = aux;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1728,"y":120,"wires":[["4cb38ef7.5736b"]]},{"id":"cfb30077.a489d","type":"function","z":"ccb6d071.13253","d":true,"name":"","func":"var aux = [{},{},{}]\naux[0].entity = \"Luz do Quarto\";\naux[0].action = \"setColorTemperature\";\naux[0].value = \"warm_white\";\n\naux[1].entity = \"Luz do Quarto\";\naux[1].action = \"setBrightness\";\naux[1].value = 20;\n\naux[2].entity = \"Luz do Quarto\";\naux[2].action = \"turnOn\";\n\nmsg.payload = aux;\nreturn msg;","outputs":1,"noerr":0,"x":1730,"y":180,"wires":[["694ee688.8c94b8"]]},{"id":"d610f80f.716578","type":"switch","z":"cbdfe56c.84c388","name":"","property":"payload.state.on","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1410,"y":200,"wires":[["22da9d31.c94e32"],["df6fc2c.78b344"]]},{"id":"35325abe.0ea4a6","type":"yeelight-compat-hue-state","z":"ecc79e8a.d4a1b","name":"","server":"bbfd267.ea4ee58","x":890,"y":800,"wires":[["ab6b6228.e2e578"]]},{"id":"6fc251d.b0a77b","type":"function","z":"ecc79e8a.d4a1b","name":"Start","func":"\n    return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":860,"wires":[["9eca7a2d.ae43f","8152ca95.a4f1d8","6c512738.7e02e8","86f0ecba.57dc9","91e26ead.1e0bd"]]},{"id":"c77bc1ef.07ab1","type":"yeelight-compat-hue-out","z":"ecc79e8a.d4a1b","name":"","server":"bbfd267.ea4ee58","x":2290,"y":880,"wires":[]},{"id":"a0da7873.9ef568","type":"function","z":"ecc79e8a.d4a1b","name":"Turn Off","func":"if(msg.payload === true){\n    var newMsg;\n    newMsg = {payload : {\"On\": false, \"on\": false}};\n    global.set(\"SalaOn\", false);\n    global.set(\"SalaEscura\", false);\n    return newMsg;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2030,"y":800,"wires":[["c77bc1ef.07ab1","290f3555.4dc2e2","5b5ec652.24edb8","f1141369.1a20d8","7c08d9e2.100078","9dd3ebd7.9f9608","bd69cab5.7e114"]]},{"id":"4b4a6516.4a99ac","type":"function","z":"ecc79e8a.d4a1b","name":"Turn On","func":"if(msg.payload === true){\n    var newMsg;\n    newMsg = {payload : {\"On\": true, \"on\": true}};\n    global.set(\"SalaOn\", true);\n    return newMsg;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2030,"y":860,"wires":[["c77bc1ef.07ab1","de7fa9de.f5ec38","a7400577.7e50e8","38f74926.b39b6e","83aec2a2.d1e7c8"]]},{"id":"fd4a8493.0277d8","type":"comment","z":"ecc79e8a.d4a1b","name":"Botao sala foi clicado","info":"","x":240,"y":780,"wires":[]},{"id":"24fce9ea.b836f6","type":"yeelight-compat-hue-state","z":"1aa34a9.7045335","name":"","server":"eeeccf7f.6c0df8","x":870,"y":960,"wires":[["a8b5e80f.0b4578"]]},{"id":"2d8e9c02.b1dde4","type":"yeelight-compat-hue-out","z":"1aa34a9.7045335","name":"","server":"eeeccf7f.6c0df8","x":2390,"y":980,"wires":[]},{"id":"56a0d89f.a6a158","type":"function","z":"1aa34a9.7045335","name":"Turn On","func":"if(msg.payload === true){\n    var newMsg;\n    newMsg = {payload : {\"On\": true, \"on\": true}};\n    newMsg.payload.brightness = 255\n    global.set(\"EscritorioOn\", true);\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2100,"y":1060,"wires":[["2d8e9c02.b1dde4","15c450ae.b2caff","4c833408.a26c5c","abfce220.1b0de","9303145a.3c1ef8","34026fe6.2b91b8"]]},{"id":"8c57029e.e7dcf","type":"function","z":"1aa34a9.7045335","name":"Start","func":"return msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":1060,"wires":[["7d8f2f88.df6b4","ab775e6.a748ea","2d785535.d9822a","426d0485.4cc6dc","20cec006.5f69f"]]},{"id":"e30bc0ac.13c7b","type":"comment","z":"1aa34a9.7045335","name":"Botao escritorio foi clicado","info":"","x":270,"y":960,"wires":[]},{"id":"7d8f2f88.df6b4","type":"hb-status","z":"1aa34a9.7045335","name":"Fita do Escritorio","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita do Escritorio00000043","conf":"40e0a266.1beb0c","x":730,"y":1200,"wires":[["eb8ff5bd.7a0938"]]},{"id":"73ce46bb.d90398","type":"switch","z":"ccb6d071.13253","name":"","property":"payload.On","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":530,"y":1507,"wires":[["8796fd61.222ce","d13c0748.e04bf8"]]},{"id":"1cdb6ec9.ebe911","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"delay","timeout":"8","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1380,"y":3640,"wires":[["23643c4b.ed1364"]]},{"id":"c174225c.6ce9a8","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"delay","timeout":"8","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1500,"y":1940,"wires":[["2f65d89d.d846e8"]]},{"id":"425fb5f5.1f6dcc","type":"delay","z":"ecc79e8a.d4a1b","name":"","pauseType":"delay","timeout":"8","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1500,"y":1240,"wires":[["5bb8b72c.116fb8"]]},{"id":"214ac00f.520f38","type":"delay","z":"cbdfe56c.84c388","name":"","pauseType":"delay","timeout":"8","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1420,"y":1100,"wires":[["59f278b3.9dc318"]]},{"id":"6dd9d017.c5888","type":"delay","z":"c3bc1a43.254dd","name":"","pauseType":"delay","timeout":"8","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1380,"y":1700,"wires":[["b0b884f8.fc8de8"]]},{"id":"a9bbea7c.756538","type":"delay","z":"c3bc1a43.254dd","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1180,"y":1240,"wires":[["85ac8759.b54798"]]},{"id":"95cf4546.561c48","type":"hb-status","z":"ccb6d071.13253","name":"Fita do Quarto","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita do Quarto00000043","conf":"40e0a266.1beb0c","x":1000,"y":360,"wires":[["d5822b77.89f098","e3a41d53.a20ed"]]},{"id":"d5822b77.89f098","type":"function","z":"ccb6d071.13253","name":"Check if it's already On","func":"if(msg.payload.On === false){\n    flow.set(\"iterFitaDoQuartoInc\", 1);\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1270,"y":420,"wires":[["10e9f60f.49c23a"]]},{"id":"601cee9c.5000c","type":"function","z":"cbdfe56c.84c388","name":"Set Triggered","func":"global.set(\"contBanheiro\", 0);\nflow.set(\"triggered1\", true);\nvar date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\n\nif(Hour < 18 && Hour > 7){\n    msg.isDay = true;\n} else{\n    msg.isDay = false\n}\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":360,"wires":[["72246ed7.2613f"]]},{"id":"6612769f.911a3","type":"alexa-remote-smarthome","z":"cbdfe56c.84c388","name":"Luz do Banheiro","account":"d04673cf.2f08f","config":{"option":"query","value":[]},"outputs":1,"x":840,"y":360,"wires":[["2e9c685a.7f55a"]]},{"id":"2051b6f9.04dd6a","type":"switch","z":"cbdfe56c.84c388","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1410,"y":280,"wires":[["fb15926c.a0f988"],["af47e21f.5475b"]]},{"id":"d3cea0f0.7597","type":"alexa-remote-smarthome","z":"cbdfe56c.84c388","name":"","account":"d04673cf.2f08f","config":{"option":"action","value":[]},"outputs":1,"x":3430,"y":180,"wires":[[]]},{"id":"7b7d74b1.ad4b24","type":"function","z":"cbdfe56c.84c388","name":"Turn On","func":"//diferentes brightness dependendo da hora\nvar date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nif(typeof msg.payload.on === \"undefined\"){\n    msg.payload ={\"on\": msg.payload.On};\n}\n\nif(typeof msg.payload.On === \"undefined\"){\n    msg.payload = {\"On\": msg.payload.on};\n}\n\nif(msg.payload.on === true || msg.payload.On === true ){\n    if(Hour > 17 && Hour < 22){\n        msg.payload = \n            {\n            \"powerState\": \"ON\",\n            \"brightness\": 255,\n            \"colorTemperatureInKelvin\": 6200\n            \n            };\n            \n    }\n    if(Hour === 23){\n        msg.payload =\n        {\n        \"powerState\": \"ON\",\n        \"brightness\": 50,\n        \"colorTemperatureInKelvin\": 5000\n        };\n    }\n    if(Hour >= 0 && Hour < 8){\n        msg.payload =\n        {\n        \"powerState\": \"ON\",\n        \"brightness\": 30,\n        \"colorTemperatureInKelvin\": 2500\n        };\n        \n    }\n    var aux = [{},{},{}]\n    aux[0].entity = \"Luz do Banheiro\";\n    aux[0].action = \"setColorTemperature\";\n    aux[0].value = msg.payload.colorTemperatureInKelvin;\n    \n    aux[1].entity = \"Luz do Banheiro\";\n    aux[1].action = \"setBrightness\";\n    aux[1].value = msg.payload.brightness;\n    \n    \n    aux[2].entity = \"Luz do Banheiro\";\n    aux[2].action = \"turnOn\";\n    \n    msg.payload = aux;\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3240,"y":180,"wires":[["d3cea0f0.7597","9251b2bc.991bb"]]},{"id":"ab0a748f.af1d08","type":"alexa-remote-smarthome","z":"cbdfe56c.84c388","name":"","account":"d04673cf.2f08f","config":{"option":"action","value":[]},"outputs":1,"x":3430,"y":280,"wires":[[]]},{"id":"ab500a8.a695378","type":"function","z":"cbdfe56c.84c388","name":"Turn Off","func":"var newMsg;\nnewMsg = { \"payload\" : {\"on\":false}};\nnode.status({fill:\"green\",shape:\"dot\",text:\"Desliga\"});\nnode.send(newMsg);    \nglobal.set(\"botaoBanheiro\", false);\nglobal.set(\"BanheiroOcupado\", false);\nglobal.set(\"isOnBanheiro\", false);\nsetTimeout(function(){\n    node.status({text:\"\"});\n    }, 15000);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2500,"y":280,"wires":[["92510fb6.c39308","90b90d98.a1c79"]]},{"id":"cb7a46db.958f7","type":"function","z":"cbdfe56c.84c388","name":"Query","func":"var aux = [{}]\naux[0].entity = \"SKILL_eyJza2lsbElkIjoiYW16bjEuYXNrLnNraWxsLjZiYjkxNzE0LWFiNWQtNDFiOS1hYzI5LWI3ZWQ4YWFiNmNjNCIsInN0YWdlIjoibGl2ZSJ9_312904351\";\naux[0].property = \"powerState\";\nmsg.payload = aux;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":360,"wires":[["6612769f.911a3"]]},{"id":"b1811e12.c8938","type":"delay","z":"c3bc1a43.254dd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":400,"y":360,"wires":[["52923f67.2f44c"]]},{"id":"8278f085.42e96","type":"delay","z":"c3bc1a43.254dd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":520,"y":620,"wires":[["f48d64c8.bc9b28"]]},{"id":"72b78ae0.8f9354","type":"switch","z":"ccb6d071.13253","name":"","property":"error.message","propertyType":"msg","rules":[{"t":"cont","v":"unexpected response","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":430,"y":3720,"wires":[[],["ef47678d.97ae58"]]},{"id":"ca1dcde.6309d3","type":"switch","z":"1aa34a9.7045335","name":"","property":"error.message","propertyType":"msg","rules":[{"t":"cont","v":"unexpected response","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":530,"y":2000,"wires":[[],["733c7618.abd128"]]},{"id":"29d93ca7.6f63f4","type":"switch","z":"ecc79e8a.d4a1b","name":"","property":"error.message","propertyType":"msg","rules":[{"t":"cont","v":"unexpected response","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":410,"y":1300,"wires":[[],["e9ece8f3.f089c8"]]},{"id":"db884489.800a68","type":"switch","z":"cbdfe56c.84c388","name":"","property":"error.message","propertyType":"msg","rules":[{"t":"cont","v":"unexpected response","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":1160,"wires":[[],["bc97411e.19d3b"]]},{"id":"994d801.ac8508","type":"switch","z":"c3bc1a43.254dd","name":"","property":"error.message","propertyType":"msg","rules":[{"t":"cont","v":"unexpected response","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":410,"y":1740,"wires":[[],["3c4980ba.6cda6"]]},{"id":"12e47ae7.d37605","type":"function","z":"ecc79e8a.d4a1b","name":"Begin Luz","func":"msg = {\"payload\":{\"state\":{\"bri\" : 1, \"ct\":6100}}, \"ajuda\": 1}\nflow.set(\"auxEmissor\", \"Yeelight\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":180,"wires":[["536bcc14.b28374"]]},{"id":"16ce7e78.a99c12","type":"yeelight-compat-hue-out","z":"c3bc1a43.254dd","name":"","server":"eeeccf7f.6c0df8","x":1690,"y":1540,"wires":[]},{"id":"a98dd6aa.2c9e98","type":"function","z":"c3bc1a43.254dd","name":"Turn On Dimmer","func":"msg.payload = {\"on\": true, \"bri\":5, \"ct\": 3500};\n\n    node.send(msg);\n    node.status({text:\"Ligou\"});\n    setTimeout(function(){\n    node.status({text:\"\"});\n    }, 3000);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1490,"y":1540,"wires":[["16ce7e78.a99c12"]]},{"id":"d6a5b0ef.490708","type":"function","z":"ccb6d071.13253","d":true,"name":"","func":"var aux = [{},{},{}]\naux[0].entity = \"Luz do Quarto\";\naux[0].action = \"setColorTemperature\";\naux[0].value = \"3000\";\n\naux[1].entity = \"Luz do Quarto\";\naux[1].action = \"setBrightness\";\naux[1].value = 25;\n\naux[2].entity = \"Luz do Quarto\";\naux[2].action = \"turnOn\";\n\nmsg.payload = aux;\nreturn msg;","outputs":1,"noerr":0,"x":940,"y":960,"wires":[["976d0e1e.61a11"]]},{"id":"1e22b7e.5f64ec8","type":"function","z":"c3bc1a43.254dd","name":"Dark?","func":"global.set(\"vouDormir\", msg.payload);\nvar luxQuarto = global.get(\"luxQuarto\");\nvar quartoEscuro = global.get(\"quartoEscuro\");\n\nvar date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nvar minutes = \"0\" + date.getMinutes();\nminutes = parseInt(minutes.substr(-2), 10);\nvar seconds = \"0\" + date.getSeconds();\nseconds = parseInt(seconds.substr(-2), 10);\n    \n    \nif(Hour > 8 && Hour < 17 && (luxQuarto < 5 && luxQuarto > 0)){\n    node.send({ajuda: 1});\n}\n    \nif(Hour > 17 && Hour < 23 && ((luxQuarto < 20 && luxQuarto > 0) || quartoEscuro === true)){\n    if(msg.payload === false){\n        node.status({fill:\"green\",shape:\"dot\",text:\"Acordado\"});\n        \n        node.send({ajuda: 1});\n        node.done();\n    }\n    else{\n        node.send({ajuda: 2});\n        node.done();\n    }\n}\nsetTimeout(function(){\n    node.status({text:\"\"});\n}, 15000);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1070,"y":780,"wires":[["6a485651.c55a28","91a33746.bfc5e8"]]},{"id":"24f5362b.35f9fa","type":"switch","z":"ccb6d071.13253","name":"","property":"payload.On","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":630,"y":2700,"wires":[["d7197b9.bdafd08","3754e10d.6fd4e6","c0fde806.82c8f8","57cb1259.e2543c","b30dfa21.a37968","e2f23827.30c848","a38d1885.3c1858","5afc7cd1.f5dda4","88df21e9.b51f9"],["b6446a86.8c8fc8"]]},{"id":"bf939783.4685c8","type":"alexa-remote-smarthome","z":"ccb6d071.13253","name":"","account":"d04673cf.2f08f","config":{"option":"action","value":[{"entity":"bb3addbc-ee3f-4720-8237-9797ba33b6e6","action":"turnOff"}]},"outputs":1,"x":1020,"y":2680,"wires":[[]]},{"id":"d7197b9.bdafd08","type":"function","z":"ccb6d071.13253","d":true,"name":"","func":"global.set(\"vouDormir\", true);\nvar aux = [{}, {}]\naux[0].entity = \"Fita do Quarto\";\naux[0].action = \"turnOff\";\n\naux[1].entity = \"Fita do Quarto\";\naux[1].action = \"turnOff\";\n\nmsg.payload = aux;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":2680,"wires":[["bf939783.4685c8"]]},{"id":"7df51e28.6f1588","type":"mqtt out","z":"ccb6d071.13253","name":"setOn","topic":"QuartoNedi/setOnRGB","qos":"","retain":"","broker":"a03558e.9e50d28","x":1030,"y":2740,"wires":[]},{"id":"3754e10d.6fd4e6","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"msg = {payload:0};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":2740,"wires":[["7df51e28.6f1588"]]},{"id":"567dd73b.7289a","type":"hb-control","z":"ccb6d071.13253","name":"Fita do Quarto","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita do Quarto00000043","conf":"40e0a266.1beb0c","x":2000,"y":2800,"wires":[]},{"id":"b6446a86.8c8fc8","type":"function","z":"ccb6d071.13253","name":"","func":"global.set(\"vouDormir\", false);\nglobal.set(\"botaoQuarto\", false);","outputs":0,"noerr":0,"initialize":"","finalize":"","x":740,"y":2840,"wires":[]},{"id":"d192402d.f75fa8","type":"delay","z":"cbdfe56c.84c388","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1240,"y":320,"wires":[["d610f80f.716578","2051b6f9.04dd6a","50b93860.552e1"]]},{"id":"d77037ea.4506e8","type":"delay","z":"cbdfe56c.84c388","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":2520,"y":360,"wires":[["b7f737c6.052cb8","9613c454.4ef0c8"]]},{"id":"92510fb6.c39308","type":"delay","z":"cbdfe56c.84c388","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":2700,"y":280,"wires":[["9613c454.4ef0c8"]]},{"id":"7382c8f5.eb5bc8","type":"function","z":"cbdfe56c.84c388","name":"Turn Off","func":"if(typeof msg.payload.on === \"undefined\"){\n    msg.payload ={ \"on\": msg.payload.On};\n}\nelse{\n    if(typeof msg.payload.On === \"undefined\"){\n        msg.payload = {\"On\": msg.payload.on};\n    }\n}\nif(msg.payload.on === false || msg.payload.On === false ){\n    var aux = [{}];\n    \n    aux[0].entity = \"Luz do Banheiro\";\n    aux[0].action = \"turnOff\";\n    \n    msg.payload = aux;\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3240,"y":260,"wires":[["ab0a748f.af1d08","55919b10.455794"]]},{"id":"9251b2bc.991bb","type":"debug","z":"cbdfe56c.84c388","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3310,"y":140,"wires":[]},{"id":"55919b10.455794","type":"debug","z":"cbdfe56c.84c388","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3390,"y":240,"wires":[]},{"id":"2bbde7f6.4b6f88","type":"trigger","z":"cbdfe56c.84c388","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-10","extend":false,"units":"s","reset":"","bytopic":"all","outputs":1,"x":2030,"y":560,"wires":[["f5f878b0.eadec"]]},{"id":"f5f878b0.eadec","type":"function","z":"cbdfe56c.84c388","name":"Cont++","func":"var contBanheiro = global.get(\"contBanheiro\");\nvar portaAberta = global.get(\"portaAbertaBanheiro\");\nif(portaAberta === false){\n    newMsg = {\"reset\" : 1};\n    global.set(\"contBanheiro\", 0);        \n    node.send(newMsg);\n    global.set(\"abertoMuitoTempo\", false);\n    node.status({fill:\"green\",shape:\"dot\",text:\"Porta aberta\"});\n}\nelse{\n    if(contBanheiro >= 300){\n        newMsg = {\"payload\" : {\"On\":false}, \"ajuda\": 1};\n        gode.send(newMsg);\n        node.status({fill:\"green\",shape:\"dot\",text:\"Desliga corredor\"});\n        \n    }\n    if(contBanheiro >= 1200){\n        newMsg = {\"payload\" : {\"On\":false}, \"ajuda\": 2};\n        gode.send(newMsg);\n        node.status({fill:\"green\",shape:\"dot\",text:\"Desliga corredor\"});\n        \n    }\n    else if(contBanheiro >= 2400){\n        newMsg = {\"reset\" : 1};\n        global.set(\"contBanheiro\", 0);\n        global.set(\"abertoMuitoTempo\", true);\n        node.send(newMsg);\n        node.status({fill:\"green\",shape:\"dot\",text:\"Desliga a luz\"});\n        \n    }\n    else{\n        global.set(\"contBanheiro\", contBanheiro+10)    \n        node.status({fill:\"green\",shape:\"dot\",text:\"cont\"+contBanheiro});\n    }\n}\nsetTimeout(function(){\n    node.status({text:\"\"});\n    }, 15000);\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2030,"y":500,"wires":[["2bbde7f6.4b6f88","fe1845b8.deb198"]]},{"id":"b0b3d492.9c71a8","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"20","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":3060,"y":320,"wires":[["29a615f5.b826fa"]]},{"id":"7fb428b4.d3b778","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"30","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":700,"y":220,"wires":[["95cf4546.561c48","2f8ed9ee.760226"]]},{"id":"8a60af65.3a01c8","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"30","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":740,"y":760,"wires":[["d6a5b0ef.490708","fee87ad1.10f418","6308754c.58fecc"]]},{"id":"991f4b85.f34178","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"30","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":600,"y":2040,"wires":[["5d9f915a.fa6b9"]]},{"id":"c44f8a1d.98671","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"10","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":460,"y":2660,"wires":[["24f5362b.35f9fa"]]},{"id":"5cecca17.2934fc","type":"delay","z":"cbdfe56c.84c388","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":230,"y":360,"wires":[["601cee9c.5000c"]]},{"id":"c088a6a2.afb6e8","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":360,"y":1507,"wires":[["73ce46bb.d90398"]]},{"id":"313ccd4c.4954c2","type":"alexa-remote-event","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","event":"ws-device-activity","x":190,"y":520,"wires":[["edc747ea.64603","c7461a4.bd276e8","916d47c4.c01b78","6be25259.436ffc","cca42cd0.361b","2141b982.595956","b80450c8.ce969","3b721c32.e3e9a4","f1ebdd3b.04636","47c9d60.1d7922c","76813a45.e33004","48cba549.98678c","726076cd.2e8d58","5fa3c4d0.df6cec","891401bf.c4c5c8","3b9d5245.f43f9e","f79561ad.c14b7","7b5bcce7.bd7f14","c81b50f5.7e9a5","c3b6c1c0.6b977","fa6fdbee.d6db88","94e53080.028ea","9db583b0.8e8d8","e92e4e26.8e848","1b53b9fc.ae43e6","180e9813.2d6ac8","2771e2e9.3d183e","ed04fb09.39fc1","f05f1150.a0335","40c4def6.1fcb4","d0994fe7.b9f8f","904736f9.26deb8","78f29ba6.590484","98571aaa.955cb8"]]},{"id":"e08f909b.252238","type":"link in","z":"ccb6d071.13253","name":"Vou dormir","links":["6262b9a5.fd7e1","7efa07a4.fe5de8","d4f3104a.c425f8","cb3db0de.e21d5"],"x":295,"y":2540,"wires":[["c44f8a1d.98671"]]},{"id":"230ad6ab.4ea00a","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1090,"y":580,"wires":[["1d2204cc.18e90b"]]},{"id":"9613c454.4ef0c8","type":"switch","z":"cbdfe56c.84c388","name":"","property":"auxEmissorBanheiro","propertyType":"global","rules":[{"t":"eq","v":"Alexa","vt":"str"},{"t":"eq","v":"Yeelight","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":2910,"y":320,"wires":[["7bd00aac.5ac324","23b9cee.83be7b2"],["5adf9cca.4e9a1c","e155da29.089298","d1f8afe2.743b5"]]},{"id":"7bd00aac.5ac324","type":"switch","z":"cbdfe56c.84c388","name":"","property":"isOnBanheiro","propertyType":"global","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":3090,"y":240,"wires":[["7b7d74b1.ad4b24"],["7382c8f5.eb5bc8"]]},{"id":"22da9d31.c94e32","type":"change","z":"cbdfe56c.84c388","name":"set aux","rules":[{"t":"set","p":"auxEmissorBanheiro","pt":"global","to":"Yeelight","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1560,"y":160,"wires":[["d39ea2f.3d3646"]]},{"id":"df6fc2c.78b344","type":"change","z":"cbdfe56c.84c388","name":"set aux","rules":[{"t":"set","p":"auxEmissorBanheiro","pt":"global","to":"Yeelight","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1560,"y":200,"wires":[["e74ef9a.fcb7f88"]]},{"id":"bb11a241.24108","type":"alexa-remote-smarthome","z":"ccb6d071.13253","d":true,"name":"","account":"d04673cf.2f08f","config":{"option":"query","value":[]},"outputs":1,"x":530,"y":1360,"wires":[["de7b8143.9b6678","c0a9cfad.d6e48"]]},{"id":"edc747ea.64603","type":"function","z":"1f49f273.0f37be","name":"Cozy time","func":"if(\n    msg.payload.name===\"Echo Dot do Quarto Nédi\" &&(\n    msg.payload.description.summary.includes('descansar')===true || \n    msg.payload.description.summary.includes('cama')===true\n    )){\n\n    global.set(\"turnOffDelay\", true);\n    var newMsg;\n    newMsg = {\"payload\": {\"On\": true}};\n    return newMsg;\n    \n    \n    \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":740,"wires":[["2d28197c.7845c6","114cf310.11d845"]]},{"id":"fa0a6604.9402a8","type":"comment","z":"c6be7449.1c6ce8","name":"Javascript helpers","info":"if(typeof Variable !== \"undefined\"){\n}","x":510,"y":620,"wires":[]},{"id":"d88874bd.e7a0e8","type":"trigger","z":"1aa34a9.7045335","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-1","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":550,"y":600,"wires":[["c155219f.8be","7dc4744f.cb9a4c"]]},{"id":"1cbb0285.c175dd","type":"function","z":"1aa34a9.7045335","name":"Turn On","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nvar aux = flow.get(\"countBrightnessFita\");\nvar increasing = flow.get(\"increasing\");\n\nmsg.payload =\n{\"On\":true,     \"Brightness\": aux,\n    \"Hue\": 165, \"Saturation\": 78\n};\nif(Hour < 21){\n    increasing = true;\n    flow.set(\"increasing\", true);\n}\nif(aux < 100 && increasing === true){\n    aux = aux + 2;\n    flow.set(\"countBrightnessFita\",aux);\n}\nif(Hour > 21){\n    increasing = false;\n    flow.set(\"increasing\", false);\n}\nif(aux >50 && increasing === false){\n    aux = aux - 2;\n    flow.set(\"countBrightnessFita\",aux);\n}\nif((aux < 51 && increasing === false) || (aux > 96&& increasing === true)){\n    msg.reset = 1;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":900,"y":600,"wires":[["230ad6ab.4ea00a","d88874bd.e7a0e8","7cee7409.f9b1fc"]]},{"id":"68447159.86868","type":"hb-event","z":"1aa34a9.7045335","name":"Fita do Escritorio","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita do Escritorio00000043","conf":"40e0a266.1beb0c","x":500,"y":500,"wires":[["79a27030.bea82"]]},{"id":"9fa14fb.00c06b","type":"change","z":"1aa34a9.7045335","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":540,"wires":[["d88874bd.e7a0e8"]]},{"id":"79a27030.bea82","type":"switch","z":"1aa34a9.7045335","name":"","property":"payload.On","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":650,"y":520,"wires":[[],["9fa14fb.00c06b"]]},{"id":"7e014f0.68b00b","type":"function","z":"1aa34a9.7045335","name":"Begin Fita","func":"flow.set(\"countBrightnessFita\", 2);\nflow.set(\"increasing\", true);\nmsg.payload =\n{\"On\":true,     \"Brightness\": 1,\n    \"Hue\": 165, \"Saturation\": 78\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":540,"wires":[["d88874bd.e7a0e8","230ad6ab.4ea00a"]]},{"id":"a277a0cf.f250e","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"20","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":900,"y":260,"wires":[["8151a8e.837a5d8"]]},{"id":"e56acd64.ccf1c","type":"delay","z":"ecc79e8a.d4a1b","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"20","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1280,"y":240,"wires":[["c20b6f3d.5e58c","1556def6.c40b81"]]},{"id":"1d2204cc.18e90b","type":"hb-control","z":"1aa34a9.7045335","name":"Fita do Escritorio","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita do Escritorio00000043","conf":"40e0a266.1beb0c","x":1310,"y":600,"wires":[]},{"id":"15c450ae.b2caff","type":"hb-control","z":"1aa34a9.7045335","name":"Fita do Escritorio","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita do Escritorio00000043","conf":"40e0a266.1beb0c","x":2390,"y":1160,"wires":[]},{"id":"57390478.036c5c","type":"change","z":"ccb6d071.13253","name":"","rules":[{"t":"set","p":"botaoQuarto","pt":"global","to":"false","tot":"bool"},{"t":"set","p":"turnOffDelay","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":900,"y":1500,"wires":[[]]},{"id":"d13c0748.e04bf8","type":"change","z":"ccb6d071.13253","name":"","rules":[{"t":"set","p":"botaoQuarto","pt":"global","to":"true","tot":"bool"},{"t":"set","p":"turnOffDelay","pt":"global","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":1560,"wires":[[]]},{"id":"e80871ad.a217a","type":"hb-status","z":"ccb6d071.13253","name":"Fita do Quarto","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita do Quarto00000043","conf":"40e0a266.1beb0c","x":1360,"y":1400,"wires":[["8ae02b9f.1599d8"]]},{"id":"1db16c2a.ff9fc4","type":"yeelight-compat-hue-state","z":"1aa34a9.7045335","name":"","server":"eeeccf7f.6c0df8","x":910,"y":360,"wires":[["ac6b9c15.7e977","d5a0f997.d231f8"]]},{"id":"ac6b9c15.7e977","type":"function","z":"1aa34a9.7045335","name":"auxCT","func":"\nif(flow.get(\"triggered2\")===true){\n    flow.set(\"triggered2\", false);\n    if(msg.payload.state.ct < 5000){\n        flow.set(\"auxCT\",msg.payload.state.ct);\n    }\n    if(msg.payload.state.bri > 100){\n        flow.set(\"countBrightnessLuz\",msg.payload.state.bri);\n    }\n}","outputs":0,"noerr":0,"initialize":"","finalize":"","x":1110,"y":360,"wires":[]},{"id":"a8616316.c40f2","type":"yeelight-compat-hue-state","z":"ecc79e8a.d4a1b","name":"","server":"bbfd267.ea4ee58","x":1050,"y":320,"wires":[["a4b5ffbe.fdfaf"]]},{"id":"a4b5ffbe.fdfaf","type":"function","z":"ecc79e8a.d4a1b","name":"auxCT","func":"if(flow.get(\"triggered2\")=== true){\n    flow.set(\"triggered2\", false);\n    if(msg.payload.state.ct < 5000){\n        flow.set(\"auxCT\",msg.payload.state.ct);\n    }\n    \n    if(msg.payload.state.bri > 100){\n        flow.set(\"countBrightness\",msg.payload.state.bri);\n    }\n}\n\n","outputs":0,"noerr":0,"initialize":"","finalize":"","x":1210,"y":320,"wires":[]},{"id":"33f02a39.732f56","type":"hb-status","z":"1aa34a9.7045335","name":"Fita do Escritorio","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita do Escritorio00000043","conf":"40e0a266.1beb0c","x":990,"y":660,"wires":[["28121938.969e76","5a6e8af1.0b7814"]]},{"id":"c367466d.fc0bb8","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"30","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1320,"y":660,"wires":[["70aa5eeb.9abfd"]]},{"id":"70aa5eeb.9abfd","type":"change","z":"1aa34a9.7045335","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":660,"wires":[["d88874bd.e7a0e8"]]},{"id":"28121938.969e76","type":"switch","z":"1aa34a9.7045335","name":"","property":"payload.On","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1170,"y":660,"wires":[[],["c367466d.fc0bb8"]]},{"id":"aaf9f7c3.b2c248","type":"link in","z":"c3bc1a43.254dd","name":"Movimento Quarto","links":["6b6b0d93.f61eac","dde4a24e.19f23"],"x":767,"y":800,"wires":[["57eeaeff.7b12d","2db06ff8.808af"]]},{"id":"faa6246d.3b3a98","type":"function","z":"1d7ecdc6.68c842","name":"Botão Quarto Nédi Click","func":"if(msg.payload.entity_id === \"binary_sensor.botao_quarto_nedi\" && msg.payload.event.click_type === \"single\"){\n\n    global.set(\"botaoQuarto\",true);\n    return msg;\n}\n//sensor_switch.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":380,"wires":[["26b4a3b2.dc164c"]]},{"id":"26b4a3b2.dc164c","type":"link out","z":"1d7ecdc6.68c842","name":"Botao Clique Quarto Nédi","links":["2871b458.b74b9c","6bed6cbc.d1bb54"],"x":715,"y":380,"wires":[]},{"id":"4347206e.0152e","type":"function","z":"1d7ecdc6.68c842","name":"Botão Quarto Nédi Double","func":"if(msg.payload.entity_id === \"binary_sensor.botao_quarto_nedi\" && msg.payload.event.click_type === \"double\"){\n\n    \n    global.set(\"botaoQuarto\",true);\n    return msg;\n}\n//sensor_switch.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":420,"wires":[["d4f3104a.c425f8"]]},{"id":"d4f3104a.c425f8","type":"link out","z":"1d7ecdc6.68c842","name":"Botao Duplo Clique Quarto Nédi","links":["e08f909b.252238"],"x":715,"y":420,"wires":[]},{"id":"c3aafca7.63d3a8","type":"function","z":"1d7ecdc6.68c842","name":"Movimento Quarto Nédi","func":"if(msg.payload.entity_id === \"binary_sensor.movimento_quarto_nedi\"){\n        var newMsg;\n        newMsg = {payload:{On : true}};\n        return newMsg;\n}\n//sensor_motion.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":840,"wires":[["dde4a24e.19f23"]]},{"id":"dde4a24e.19f23","type":"link out","z":"1d7ecdc6.68c842","name":"Movimento Quarto Nédi","links":["aaf9f7c3.b2c248"],"x":715,"y":840,"wires":[]},{"id":"b0235b17.ba525","type":"function","z":"1d7ecdc6.68c842","name":"Botão Avulso Click","func":"if(msg.payload.entity_id === \"binary_sensor.botao_avulso\" && msg.payload.event.click_type === \"single\"){\n    return msg;\n}\n//sensor_switch.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":460,"wires":[["bc98621d.482598"]]},{"id":"5d7222a3.0f12cc","type":"function","z":"1d7ecdc6.68c842","name":"Botão Avulso Double","func":"if(msg.payload.entity_id === \"binary_sensor.botao_avulso\" && msg.payload.event.click_type === \"double\"){\n    return msg;\n}\n//sensor_switch.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":500,"wires":[["8e76ed55.398978"]]},{"id":"bc98621d.482598","type":"link out","z":"1d7ecdc6.68c842","name":"Botao Clique Avulso","links":["3e2f636f.8b63b4"],"x":715,"y":460,"wires":[]},{"id":"6262b9a5.fd7e1","type":"link out","z":"1d7ecdc6.68c842","name":"Botao Duplo Clique Avulso","links":["e08f909b.252238"],"x":855,"y":520,"wires":[]},{"id":"2c92ebd0.1c5594","type":"comment","z":"1d7ecdc6.68c842","name":"Mensagens do Aqara","info":"Clique do botão:\n\n    fromip: \"192.168.0.56:4321\"\n    ip: \"192.168.0.56\"\n    port: 4321\n    payload: object\n    cmd: \"report\"\n    model: \"sensor_switch.aq2\"\n    sid: \"158d00023e8629\"\n    params: array[1]\n    0: object\n    button_0: \"click\"\n    _msgid: \"1203d8b7.5ccdd7\"\n    \nDuplo clique do botão:\n    fromip: \"192.168.0.56:4321\"\n    ip: \"192.168.0.56\"\n    port: 4321\n    payload: object\n    cmd: \"report\"\n    model: \"sensor_switch.aq2\"\n    sid: \"158d00023e8629\"\n    params: array[1]\n    0: object\n    button_0: \"double_click\"\n    _msgid: \"ebe10ada.859dd8\"\n\nSensor de movimento:\n    fromip: \"192.168.0.56:4321\"\n    ip: \"192.168.0.56\"\n    port: 4321\n    payload: object\n    cmd: \"report\"\n    model: \"sensor_motion.aq2\"\n    sid: \"158d00035feb3d\"\n    params: array[2]\n    0: object\n    illumination: 0\n    1: object\n    lux: 0\n    _msgid: \"d9c2a184.98232\"\n    \n    fromip: \"192.168.0.56:4321\"\n    ip: \"192.168.0.56\"\n    port: 4321\n    payload: object\n    cmd: \"report\"\n    model: \"sensor_motion.aq2\"\n    sid: \"158d00035feb3d\"\n    params: array[1]\n    0: object\n    motion_status: \"motion\"\n    _msgid: \"f691105f.78934\"\n        ","x":240,"y":300,"wires":[]},{"id":"6d234bb2.1370cc","type":"link out","z":"1d7ecdc6.68c842","name":"Movimento Cozinha","links":[],"x":715,"y":900,"wires":[]},{"id":"797dd9ee.65fea8","type":"function","z":"1d7ecdc6.68c842","name":"Movimento Cozinha","func":"if(msg.payload.entity_id === \"binary_sensor.movimento_cozinha\"){\n        var newMsg;\n        newMsg = {payload:{On : true}};\n        return newMsg;\n}\n//sensor_motion.aq2","outputs":1,"noerr":0,"x":520,"y":900,"wires":[["6d234bb2.1370cc","74c616d4.d076e8"]]},{"id":"d46429fe.002788","type":"function","z":"1d7ecdc6.68c842","name":"Botão Sala Double","func":"if(msg.payload.entity_id === \"binary_sensor.botao_sala\"){\n    if(msg.payload.event.click_type === \"double\"){\n        return msg;\n    }\n}\n//remote.b286acn01\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":600,"wires":[["82c6986.62e2968"]]},{"id":"8ce80743.c3812","type":"function","z":"1d7ecdc6.68c842","name":"Botão Sala Click","func":"if(msg.payload.entity_id === \"binary_sensor.botao_sala\"){\n    if(msg.payload.event.click_type === \"single\"){\n        return msg;\n    }\n}\n//remote.b286acn01\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":560,"wires":[["f2645d31.8d14"]]},{"id":"f2645d31.8d14","type":"link out","z":"1d7ecdc6.68c842","name":"Botao Clique Sala","links":["58c3ee06.be4568"],"x":715,"y":560,"wires":[]},{"id":"82c6986.62e2968","type":"link out","z":"1d7ecdc6.68c842","name":"Botao Duplo Clique Sala","links":["46ee101f.c9b82"],"x":715,"y":600,"wires":[]},{"id":"771756fa.87ad68","type":"function","z":"1d7ecdc6.68c842","name":"Porta Fechada","func":"if(msg.topic === \"binary_sensor.porta_banheiro\"){\n    if(msg.payload === false){\n        global.set(\"portaAbertaBanheiro\",false);\n        //abriu\n        return msg;\n    }\n}\n//sensor_magnet.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1420,"wires":[["2b910853.e22d38"]]},{"id":"b60c6540.e38f78","type":"function","z":"1d7ecdc6.68c842","name":"Porta Aberta","func":"if(msg.topic === \"binary_sensor.porta_banheiro\"){\n    if(msg.payload === true){\n        global.set(\"portaAbertaBanheiro\",true);\n        //abriu\n        return msg;\n    }\n}\n//sensor_magnet.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":1360,"wires":[["c02988a3.d137d8"]]},{"id":"c02988a3.d137d8","type":"link out","z":"1d7ecdc6.68c842","name":"Porta Banheiro Aberta","links":["9a824400.3fd808","e5f7ace1.cf9c88","2888f5bb.ace53a"],"x":715,"y":1360,"wires":[]},{"id":"2b910853.e22d38","type":"link out","z":"1d7ecdc6.68c842","name":"Porta Banheiro Fechada","links":["f058656b.8b2d18","939f7c5f.f82bb"],"x":715,"y":1420,"wires":[]},{"id":"45aee67a.a4fac8","type":"function","z":"1d7ecdc6.68c842","name":"Botão Escritório Double","func":"if(msg.payload.entity_id === \"binary_sensor.botao_escritorio\"){\n    if(msg.payload.event.click_type === \"double\"){\n        return msg;\n    }\n}\n//remote.b286acn01\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":680,"wires":[["8ad92ac8.7b7018"]]},{"id":"5f7c02.fca47c","type":"function","z":"1d7ecdc6.68c842","name":"Botão Escritório Click","func":"if(msg.payload.entity_id === \"binary_sensor.botao_escritorio\"){\n    if(msg.payload.event.click_type === \"single\"){\n        return msg;\n    }\n}\n//remote.b286acn01\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":640,"wires":[["14e69af.af5ca65"]]},{"id":"14e69af.af5ca65","type":"link out","z":"1d7ecdc6.68c842","name":"Botao Clique Escritorio","links":["c1c3f5bb.bf7db8"],"x":715,"y":640,"wires":[]},{"id":"8ad92ac8.7b7018","type":"link out","z":"1d7ecdc6.68c842","name":"Botao Duplo Clique Escritorio","links":["46ee101f.c9b82"],"x":715,"y":680,"wires":[]},{"id":"1c2b00a0.493b4f","type":"function","z":"1d7ecdc6.68c842","name":"Botão Banheiro Double","func":"if(msg.payload.entity_id === \"binary_sensor.botao_banheiro\" && msg.payload.event.click_type === \"double\"){\n\n    global.set(\"botaoBanheiro\", true);\n    return msg;\n}\n//sensor_switch.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":780,"wires":[["9d8a314c.24cf7"]]},{"id":"fa289c.e680cf68","type":"function","z":"1d7ecdc6.68c842","name":"Botão Banheiro Click","func":"if(msg.payload.entity_id === \"binary_sensor.botao_banheiro\" && msg.payload.event.click_type === \"single\"){\n\n    global.set(\"botaoBanheiro\", true);\n    return msg;\n}\n//sensor_switch.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":740,"wires":[["c9897dac.61bb6"]]},{"id":"c9897dac.61bb6","type":"link out","z":"1d7ecdc6.68c842","name":"Botao Clique Banheiro","links":["c99629eb.be11","875a8de8.c38a38"],"x":715,"y":740,"wires":[]},{"id":"9d8a314c.24cf7","type":"link out","z":"1d7ecdc6.68c842","name":"Botao Duplo Clique Banheiro","links":[],"x":715,"y":780,"wires":[]},{"id":"c99629eb.be11","type":"link in","z":"cbdfe56c.84c388","name":"Botao Banheiro","links":["c9897dac.61bb6"],"x":115,"y":329,"wires":[["5cecca17.2934fc"]]},{"id":"e5f7ace1.cf9c88","type":"link in","z":"cbdfe56c.84c388","name":"Porta Banheiro Aberta","links":["c02988a3.d137d8","2cac04a0.1e088c"],"x":115,"y":389,"wires":[["5cecca17.2934fc"]]},{"id":"58c3ee06.be4568","type":"link in","z":"ecc79e8a.d4a1b","name":"Botao Clique Sala","links":["f2645d31.8d14"],"x":255,"y":820,"wires":[["6fc251d.b0a77b"]]},{"id":"c1c3f5bb.bf7db8","type":"link in","z":"1aa34a9.7045335","name":"Botao Clique Escritorio ","links":["14e69af.af5ca65"],"x":275,"y":1060,"wires":[["8c57029e.e7dcf"]]},{"id":"3e2f636f.8b63b4","type":"link in","z":"1f49f273.0f37be","name":"Cozy Time","links":["bc98621d.482598","4b903524.21b4ec"],"x":655,"y":660,"wires":[["114cf310.11d845"]]},{"id":"114cf310.11d845","type":"change","z":"1f49f273.0f37be","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.On","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":820,"y":700,"wires":[["34d03ea2.01dbb2","1e98bac8.8c9a55","a088b030.4664a8","865fd848.06d918","c73f0a01.1a0558","46ab8d9f.5019e4","770b5f2c.b4f96"]]},{"id":"13c99a52.be8116","type":"function","z":"1d7ecdc6.68c842","name":"","func":"if(msg.payload.event.entity_id === \"binary_sensor.vibration\"){\n    if(msg.payload.event.new_state.state === \"on\"){\n        //movimento\n    }\n    if(msg.payload.event.new_state.state === \"off\"){\n        //movimento parou\n        \n    }\n    return msg;\n}\n//vibration.aq1\n","outputs":1,"noerr":0,"x":440,"y":1500,"wires":[[]]},{"id":"fb15926c.a0f988","type":"change","z":"cbdfe56c.84c388","name":"set aux","rules":[{"t":"set","p":"auxEmissorBanheiro","pt":"global","to":"Alexa","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1560,"y":240,"wires":[["d39ea2f.3d3646"]]},{"id":"af47e21f.5475b","type":"change","z":"cbdfe56c.84c388","name":"set aux","rules":[{"t":"set","p":"auxEmissorBanheiro","pt":"global","to":"Alexa","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1560,"y":280,"wires":[["e74ef9a.fcb7f88"]]},{"id":"f058656b.8b2d18","type":"link in","z":"cbdfe56c.84c388","name":"Porta Fechada","links":["2b910853.e22d38","eba7fc0a.43f6d"],"x":1415,"y":560,"wires":[["4eeb3045.c88368","cadee65.c1bd618"]]},{"id":"9a824400.3fd808","type":"link in","z":"cbdfe56c.84c388","name":"Porta Banheiro Aberta","links":["c02988a3.d137d8","2cac04a0.1e088c"],"x":1625,"y":520,"wires":[["a90d8f21.3171f8"]]},{"id":"a90d8f21.3171f8","type":"delay","z":"cbdfe56c.84c388","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1740,"y":520,"wires":[["f5f878b0.eadec"]]},{"id":"4eeb3045.c88368","type":"delay","z":"cbdfe56c.84c388","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1740,"y":560,"wires":[["2bbde7f6.4b6f88"]]},{"id":"b899f9b5.68c78","type":"function","z":"cbdfe56c.84c388","name":"Triggered?","func":"if(flow.get(\"triggered1\")===true){\n    flow.set(\"triggered1\", false);\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1010,"y":300,"wires":[["d192402d.f75fa8"]]},{"id":"2e9c685a.7f55a","type":"function","z":"cbdfe56c.84c388","name":"Triggered?","func":"if(flow.get(\"triggered1\")===true){\n    flow.set(\"triggered1\", false);\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1010,"y":360,"wires":[["d192402d.f75fa8"]]},{"id":"28aa2a5c.d692f6","type":"change","z":"ecc79e8a.d4a1b","name":"","rules":[{"t":"set","p":"triggered2","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":320,"wires":[["a8616316.c40f2"]]},{"id":"2f6e98a8.35ac08","type":"change","z":"ecc79e8a.d4a1b","name":"","rules":[{"t":"set","p":"triggered1","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1090,"y":240,"wires":[["e56acd64.ccf1c"]]},{"id":"9eca7a2d.ae43f","type":"change","z":"ecc79e8a.d4a1b","name":"","rules":[{"t":"set","p":"triggered3","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":800,"wires":[["35325abe.0ea4a6","82970f14.d1562"]]},{"id":"ab6b6228.e2e578","type":"function","z":"ecc79e8a.d4a1b","name":"Add Topic","func":"var newMsg;\nif(typeof msg.ajuda !== \"undefined\"){\n    if(msg.ajuda === 1){\n        newMsg = {\"topic\":\"Luz\", \"payload\": true};\n        flow.set(\"triggered3\", false);\n        return newMsg;\n    }\n}\nif(flow.get(\"triggered3\")===true){\n    flow.set(\"triggered3\", false);\n    if(msg.ajuda !== 1){\n        if(msg.payload.state.on === true)\n        {\n            newMsg = {\"topic\":\"Luz\", \"payload\": true};\n            return newMsg;\n        }\n        if(msg.payload.state.on === false)\n        {\n            newMsg = {\"topic\":\"Luz\",\"payload\": false};\n            return newMsg;\n        }\n    }    \n    \n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1120,"y":800,"wires":[["92dd7dd.20ea28"]]},{"id":"a8b5e80f.0b4578","type":"function","z":"1aa34a9.7045335","name":"Add Topic","func":"var newMsg;\nif(typeof msg.ajuda !== \"undefined\"){\n    if(msg.ajuda === 1){\n        newMsg = {\"topic\":\"Luz\", \"payload\": true};\n        flow.set(\"triggered3\", false);\n        return newMsg;\n    }\n}\nif(flow.get(\"triggered3\")===true){\n    flow.set(\"triggered3\", false);\n    if(msg.payload.state.on === true)\n    {\n        newMsg = {\"topic\":\"Luz\", \"payload\": true};\n        return newMsg;\n    }\n    if(msg.payload.state.on === false)\n    {\n        newMsg = {\"topic\":\"Luz\",\"payload\": false};\n        return newMsg;\n    }\n\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1100,"y":960,"wires":[["ee393f5d.b8373"]]},{"id":"ab775e6.a748ea","type":"change","z":"1aa34a9.7045335","name":"","rules":[{"t":"set","p":"triggered3","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":960,"wires":[["24fce9ea.b836f6","cf845136.b8ca"]]},{"id":"731480a6.2aea48","type":"change","z":"1aa34a9.7045335","name":"","rules":[{"t":"set","p":"triggered2","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":360,"wires":[["1db16c2a.ff9fc4"]]},{"id":"8151a8e.837a5d8","type":"change","z":"1aa34a9.7045335","name":"","rules":[{"t":"set","p":"triggered1","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1090,"y":260,"wires":[["afa0df09.bc458","35098841.1463e8"]]},{"id":"313bab76.09b364","type":"function","z":"1aa34a9.7045335","name":"was triggered?","func":"if(flow.get(\"triggered1\")===true){\n    flow.set(\"triggered1\", false);\n    var newMsg;\n    if(msg.payload.state.on === true){\n        newMsg = {payload:{state:{bri:msg.payload.state.bri,\n                                  ct: msg.payload.state.ct\n                                  }\n                            },\n                            came: \"Yeelight\"\n        };\n        return newMsg;\n    }\n    if(msg.payload.state.on === false){\n        newMsg = {payload:{resetar: true}};\n        return newMsg;\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1480,"y":280,"wires":[["7a56f188.a8e3f"]]},{"id":"e3a41d53.a20ed","type":"debug","z":"ccb6d071.13253","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1210,"y":360,"wires":[]},{"id":"4e494f43.429e78","type":"function","z":"ccb6d071.13253","name":"","func":"var newMsg;\nnewMsg = {payload:\"on\",\n          data:{attributes:{brightness: 10}}};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":1400,"wires":[["bb11a241.24108","509db79a.e95438","ab339416.d4ff6"]]},{"id":"8ccdfd9e.f0ac08","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"if(msg.payload === true ){\n    global.set(\"quartoOn\",false);\n    var newMsg;\n    newMsg = {payload : {}};\n    newMsg.payload.On = false;\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2585,"y":1280,"wires":[["3fd94c91.a1c804","f8fe85a2.a5656","c6cd7d7d.fef05","c05c170f.0b0aa8","ba5a3d75.8a0c1","2856c6fb.8ab38a","aec3693f.306ab8","f6c00da8.7cf79","94d3fde3.fb5ea","4ef9d787.1aa0d","fc91a28a.e2609"]]},{"id":"c345721d.13761","type":"function","z":"ccb6d071.13253","name":"Turn On","func":"if(msg.payload === false){\n        \n    global.set(\"quartoOn\",true);\n    var newMsg;\n    newMsg = {payload : {}};\n    newMsg.payload.On = true;\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2580,"y":1340,"wires":[["2611e27d.31b046","f233f8e5.ec73d8","c05c170f.0b0aa8","1a9ee5d5.6e14ba","293abd.acd5e544","b816d246.781b8","148a1137.1caa6f"]]},{"id":"f0abdd53.5d1cc8","type":"hb-control","z":"ccb6d071.13253","name":"Fita do Quarto","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita do Quarto00000043","conf":"40e0a266.1beb0c","x":4020,"y":1300,"wires":[]},{"id":"3fd94c91.a1c804","type":"function","z":"ccb6d071.13253","d":true,"name":"","func":"global.set(\"vouDormir\", true);\nvar aux = [{}]\naux[0].entity = \"Luz do Quarto\";\naux[0].action = \"turnOff\";\n\nvar newMsg;\nnewMsg = { payload: aux};\nreturn newMsg;","outputs":1,"noerr":0,"x":2940,"y":1560,"wires":[["447c5b61.e6e81c"]]},{"id":"447c5b61.e6e81c","type":"alexa-remote-smarthome","z":"ccb6d071.13253","name":"","account":"d04673cf.2f08f","config":{"option":"action","value":[]},"outputs":1,"x":3130,"y":1560,"wires":[[]]},{"id":"2611e27d.31b046","type":"function","z":"ccb6d071.13253","d":true,"name":"","func":"var aux = [{},{},{}]\naux[0].entity = \"Luz do Quarto\";\naux[0].action = \"setColorTemperature\";\naux[0].value = \"cool\";\n\naux[1].entity = \"Luz do Quarto\";\naux[1].action = \"setBrightness\";\naux[1].value = 100;\n\naux[2].entity = \"Luz do Quarto\";\naux[2].action = \"turnOn\";\nvar newMsg;\nnewMsg = { payload: aux};\nreturn newMsg;","outputs":1,"noerr":0,"x":2940,"y":1500,"wires":[["acd92faa.069b78"]]},{"id":"acd92faa.069b78","type":"alexa-remote-smarthome","z":"ccb6d071.13253","name":"","account":"d04673cf.2f08f","config":{"option":"action","value":[]},"outputs":1,"x":3130,"y":1500,"wires":[[]]},{"id":"b8ef9a64.667d2","type":"mqtt out","z":"ccb6d071.13253","name":"setOn RGB Strip","topic":"QuartoNedi/setOnRGB","qos":"","retain":"","broker":"a03558e.9e50d28","x":3150,"y":1060,"wires":[]},{"id":"f8fe85a2.a5656","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"msg = {payload:0};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2940,"y":1060,"wires":[["b8ef9a64.667d2"]]},{"id":"8e76ed55.398978","type":"function","z":"1d7ecdc6.68c842","name":"Turn On","func":"msg.payload = {\"On\":true};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":520,"wires":[["6262b9a5.fd7e1"]]},{"id":"3537c314.ac8754","type":"comment","z":"ccb6d071.13253","name":"Se luz do quarto estiver ligada baixinho, aumentar o brilho","info":"","x":2210,"y":1660,"wires":[]},{"id":"de7b8143.9b6678","type":"function","z":"ccb6d071.13253","name":"","func":"if(msg.payload === \"on\"){\n        if(msg.data.attributes.brightness < 128)\n        {\n            msg.ajuda = 1;\n            return msg;\n        }\n        else{\n            \n            msg.ajuda = 2;\n            return msg;\n        }\n}\nelse{\n    \n            msg.ajuda = 2;\n            return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":1360,"wires":[["e454dcdd.75518","aa28b066.cd5a8"]]},{"id":"bdb350f2.9e284","type":"switch","z":"ccb6d071.13253","name":"","property":"ajuda","propertyType":"msg","rules":[{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1130,"y":1360,"wires":[["e80871ad.a217a","10436b4a.4fa0b5","772a9272.c5113c","ad7b4188.54dda","b59eb7ec.167468"],["e00993ec.a26b38"]]},{"id":"4a54ae9d.c91e58","type":"hb-control","z":"ccb6d071.13253","name":"Fita do Quarto","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita do Quarto00000043","conf":"40e0a266.1beb0c","x":2580,"y":1540,"wires":[]},{"id":"331685ee.1a5152","type":"function","z":"ccb6d071.13253","d":true,"name":"","func":"var aux = [{},{},{}]\naux[0].entity = \"Luz do Quarto\";\naux[0].action = \"setColorTemperature\";\naux[0].value = \"cool\";\n\naux[1].entity = \"Luz do Quarto\";\naux[1].action = \"setBrightness\";\naux[1].value = 100;\n\naux[2].entity = \"Luz do Quarto\";\naux[2].action = \"turnOn\";\n\nmsg.payload = aux;\nreturn msg;","outputs":1,"noerr":0,"x":1670,"y":1660,"wires":[["a0eb03d7.99d128"]]},{"id":"a0eb03d7.99d128","type":"alexa-remote-smarthome","z":"ccb6d071.13253","name":"","account":"d04673cf.2f08f","config":{"option":"action","value":[]},"outputs":1,"x":1870,"y":1660,"wires":[[]]},{"id":"babe5d82.600e78","type":"function","z":"ccb6d071.13253","name":"Turn On","func":"msg.payload = {};\nmsg.payload.On = true;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":1600,"wires":[["385ed0f0.4efdd"]]},{"id":"c6cd7d7d.fef05","type":"debug","z":"ccb6d071.13253","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2930,"y":900,"wires":[]},{"id":"10436b4a.4fa0b5","type":"function","z":"ccb6d071.13253","name":"Luz do Quarto Topic","func":"var newMsg;\nif(msg.payload === \"on\")\n{\n    global.set(\"quartoOn\",true);\n    newMsg = {\"topic\":\"Luz\",\"payload\": true};\n    return newMsg;\n}\nif(msg.payload === \"off\")\n{\n    newMsg = {\"topic\":\"Luz\",\"payload\": false};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1380,"y":1460,"wires":[["79bbdcd2.3a6d7c"]]},{"id":"8ae02b9f.1599d8","type":"function","z":"ccb6d071.13253","name":"","func":"var newMsg;\nif(msg.payload.On === true)\n{\n    global.set(\"quartoOn\",true);\n    newMsg = {\"topic\":\"Fita\",\"payload\": true};\n    return newMsg;\n}\nif(msg.payload.On === false)\n{\n    newMsg = {\"topic\":\"Fita\",\"payload\": false};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1640,"y":1400,"wires":[["c857c330.62bea8"]]},{"id":"4b9b5fc8.18359","type":"function","z":"ccb6d071.13253","name":"","func":"var newMsg;\nif(msg.payload === true){\n        newMsg = {\"topic\":\"Lampada\",\n                \"payload\": true\n        };\n        return newMsg;\n    \n}\nif(msg.payload ===false){\n        newMsg = {\"topic\":\"Lampada\",\n                \"payload\": false\n        };\n        return newMsg;\n    \n}\nvar homeassistant = global.get(\"homeassistant\");\nif(homeassistant.homeAssistant.states[\"switch.lampada\"].state === \"on\"){\n        newMsg = {\"topic\":\"Lampada\",\n                \"payload\": true\n        };\n        return newMsg;\n}\nelse{\n        newMsg = {\"topic\":\"Lampada\",\n                \"payload\": false\n        };\n        return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1640,"y":1280,"wires":[["2f2af8aa.ac4dc"]]},{"id":"2f2af8aa.ac4dc","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1800,"y":1280,"wires":[["5d0dc213.d1d57c"]]},{"id":"c857c330.62bea8","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1800,"y":1400,"wires":[["5d0dc213.d1d57c"]]},{"id":"79bbdcd2.3a6d7c","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1800,"y":1460,"wires":[["5d0dc213.d1d57c"]]},{"id":"5d0dc213.d1d57c","type":"BooleanLogicUltimate","z":"ccb6d071.13253","name":"","filtertrue":"both","persist":false,"sInitializeWith":"WaitForPayload","triggertopic":"trigger","outputtriggeredby":"all","inputCount":"3","topic":"result","x":2020,"y":1340,"wires":[[],["410ef033.af117","627a5442.11989c","87463004.6af3e8"],[]]},{"id":"690a6dbe.bc1064","type":"BooleanLogicUltimate","z":"1aa34a9.7045335","name":"","filtertrue":"both","persist":false,"sInitializeWith":"WaitForPayload","triggertopic":"trigger","outputtriggeredby":"all","inputCount":"3","topic":"result","x":1540,"y":1060,"wires":[[],["db6dad27.a6909","40d7e1.7190c82","91d75310.f4f92"],[]]},{"id":"db6dad27.a6909","type":"InvertUltimate","z":"1aa34a9.7045335","name":"Invert","x":1890,"y":1060,"wires":[["56a0d89f.a6a158"]]},{"id":"91d75310.f4f92","type":"function","z":"1aa34a9.7045335","name":"Turn Off","func":"if(msg.payload === true){\n    var newMsg;\n    newMsg = {payload : {\"On\": false, \"on\": false}};\n    global.set(\"EscritorioOn\", false);\n    global.set(\"EscritorioEscuro\", false);\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2100,"y":1000,"wires":[["2d8e9c02.b1dde4","15c450ae.b2caff","bb3c3b7d.9df2d8","dca68d84.201a7","43154595.1348ec","a70090cc.73e91","3ad219c1.14088e","1aab9a5a.59c1ae"]]},{"id":"2d78271d.1500a8","type":"BooleanLogicUltimate","z":"ecc79e8a.d4a1b","name":"","filtertrue":"both","persist":false,"sInitializeWith":"WaitForPayload","triggertopic":"trigger","outputtriggeredby":"all","inputCount":"3","topic":"result","x":1500,"y":860,"wires":[[],["ceb92be5.b08008","a0da7873.9ef568"],[]]},{"id":"ceb92be5.b08008","type":"InvertUltimate","z":"ecc79e8a.d4a1b","name":"Invert","x":1750,"y":860,"wires":[["4b4a6516.4a99ac"]]},{"id":"f233f8e5.ec73d8","type":"debug","z":"ccb6d071.13253","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2930,"y":1920,"wires":[]},{"id":"410ef033.af117","type":"debug","z":"ccb6d071.13253","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2250,"y":1220,"wires":[]},{"id":"6c73045b.dca7fc","type":"function","z":"ecc79e8a.d4a1b","name":"Add Topic","func":"var newMsg;\nif(msg.payload === true)\n{\n    newMsg = {\"topic\":\"Tunel\", \"payload\": true};\n    flow.set(\"tunelLigado\",true);\n    return newMsg;\n}\nif(msg.payload === false)\n{\n    newMsg = {\"topic\":\"Tunel\",\"payload\": false};\n    flow.set(\"tunelLigado\",false);\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1120,"y":920,"wires":[["8a76eced.b9499"]]},{"id":"ee67748b.840a58","type":"function","z":"1aa34a9.7045335","name":"Add Topic","func":"var newMsg;\nvar abajurOn = global.get(\"abajurOn\");\nif(msg.payload === true)\n{\n    newMsg = {\"topic\":\"Abajur\", \"payload\": true};\n    flow.set(\"abajurLigado\", true);\n    global.set(\"abajurOn\", true);\n    return newMsg;\n}\nif(msg.payload === false)\n{\n    newMsg = {\"topic\":\"Abajur\",\"payload\": false};\n    flow.set(\"abajurLigado\", false);\n    global.set(\"abajurOn\", false);\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1040,"y":1080,"wires":[["d5617b3a.5bb628"]]},{"id":"eb8ff5bd.7a0938","type":"function","z":"1aa34a9.7045335","name":"Add Topic","func":"var newMsg;\nif(msg.payload.On === true)\n{\n    newMsg = {\"topic\":\"Fita\", \"payload\": true};\n    return newMsg;\n}\nif(msg.payload.On === false)\n{\n    newMsg = {\"topic\":\"Fita\",\"payload\": false};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1040,"y":1200,"wires":[["dd51985a.ecb848"]]},{"id":"1791fc19.e36bb4","type":"inject","z":"ecc79e8a.d4a1b","name":"","props":[{"p":"payload","v":"","vt":"date"},{"p":"topic","v":"","vt":"string"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":240,"y":920,"wires":[["6fc251d.b0a77b"]]},{"id":"7ccaec36.b9a2e4","type":"inject","z":"1aa34a9.7045335","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":260,"y":1120,"wires":[["8c57029e.e7dcf"]]},{"id":"cf845136.b8ca","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":820,"y":900,"wires":[["88101bbc.553118"]]},{"id":"88101bbc.553118","type":"function","z":"1aa34a9.7045335","name":"In Case of Error","func":"msg.ajuda = 1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":900,"wires":[["a8b5e80f.0b4578"]]},{"id":"a52cb142.e30c8","type":"function","z":"ecc79e8a.d4a1b","name":"In Case of Error","func":"msg.ajuda = 1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":960,"y":760,"wires":[["ab6b6228.e2e578"]]},{"id":"82970f14.d1562","type":"delay","z":"ecc79e8a.d4a1b","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":800,"y":760,"wires":[["a52cb142.e30c8"]]},{"id":"bb3c3b7d.9df2d8","type":"debug","z":"1aa34a9.7045335","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2330,"y":720,"wires":[]},{"id":"4c833408.a26c5c","type":"debug","z":"1aa34a9.7045335","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2350,"y":1360,"wires":[]},{"id":"40d7e1.7190c82","type":"debug","z":"1aa34a9.7045335","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1750,"y":980,"wires":[]},{"id":"509db79a.e95438","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":540,"y":1420,"wires":[["de7b8143.9b6678"]]},{"id":"c0a9cfad.d6e48","type":"function","z":"ccb6d071.13253","name":"","func":"flow.set(\"respondeu\", true);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":710,"y":1300,"wires":[[]]},{"id":"627a5442.11989c","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":2415,"y":1280,"wires":[["8ccdfd9e.f0ac08"]]},{"id":"87463004.6af3e8","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":2420,"y":1340,"wires":[["c345721d.13761"]]},{"id":"e00993ec.a26b38","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1360,"y":1540,"wires":[["babe5d82.600e78","331685ee.1a5152","9c6b712a.3ce1d","2d935265.4a437e"]]},{"id":"e454dcdd.75518","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":920,"y":1360,"wires":[["bdb350f2.9e284"]]},{"id":"5adf9cca.4e9a1c","type":"debug","z":"cbdfe56c.84c388","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3090,"y":300,"wires":[]},{"id":"23b9cee.83be7b2","type":"debug","z":"cbdfe56c.84c388","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3090,"y":180,"wires":[]},{"id":"73d33b99.c26c94","type":"link out","z":"1d7ecdc6.68c842","name":"Movimento Escritório","links":["444f36d4.83b368"],"x":715,"y":960,"wires":[]},{"id":"90728293.3d228","type":"function","z":"1d7ecdc6.68c842","name":"Movimento Escritório","func":"if(msg.payload.entity_id === \"binary_sensor.movimento_escritorio\"){\n    var newMsg = {payload: {MotionDetected: true}}\n    return msg;\n}\n//sensor_motion.aq2","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":960,"wires":[["73d33b99.c26c94"]]},{"id":"238ed80.34b9228","type":"trigger","z":"1aa34a9.7045335","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-30","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":770,"y":1620,"wires":[["76e80b84.116cec","d5256963.e41b08"]]},{"id":"76e80b84.116cec","type":"function","z":"1aa34a9.7045335","name":"Cont++","func":"var contEscritorio = global.get(\"contEscritorio\");\nif(msg.payload.MotionDetected === true){\n    global.set(\"contEscritorio\", 0);   \n    node.send(msg);\n    node.status({fill:\"green\",shape:\"dot\",text:\"Movimento no Escritório\"});\n\n}\nelse{\n    if(contEscritorio >= 2700){\n        msg.reset = 1;\n        global.set(\"contEscritorio\", 2700)\n        global.set(\"overrideEscritorio\",false);\n        node.send(msg);\n        node.status({fill:\"green\",shape:\"dot\",text:\"Sem movimento, \"});\n        \n    }\n    else{\n        global.set(\"contEscritorio\", contEscritorio+30);\n        node.status({fill:\"green\",shape:\"dot\",text:\"cont\"+contEscritorio});\n    }\n}\nif(global.get(\"escritorioEscuro\")===true &&\n    global.get(\"EscritorioOn\")===false){\n        global.set(\"overrideEscritorio\",true);\n        msg.reset = 1;\n        node.send(msg);\n    }\nsetTimeout(function(){\n    node.status({text:\"\"});\n    }, 15000);\n    \n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":1540,"wires":[["b1b59a55.b66bb8","47254480.0f118c"]]},{"id":"e65a683c.5b41","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":490,"y":1540,"wires":[["98f63383.c6d94"]]},{"id":"444f36d4.83b368","type":"link in","z":"1aa34a9.7045335","name":"Movimento Escritório","links":["73d33b99.c26c94"],"x":375,"y":1540,"wires":[["e65a683c.5b41"]]},{"id":"d65131b7.ff6058","type":"link in","z":"c3bc1a43.254dd","name":"Movimento Escritório Escuro","links":["ddabef18.3c694","16045565.be2dab"],"x":788,"y":524,"wires":[["8c00ea31.7a21e8"]]},{"id":"ddabef18.3c694","type":"link out","z":"1aa34a9.7045335","name":"Escritorio Movimento Escuro","links":["d65131b7.ff6058"],"x":1295,"y":1540,"wires":[]},{"id":"aa9ce6f7.87db78","type":"function","z":"1aa34a9.7045335","name":"Motion Detected","func":"if(msg.payload.MotionDetected === true){\n    if(global.get(\"escritorioEscuro\")===true && global.get(\"EscritorioOn\")=== false){\n        global.set(\"overrideEscritorio\",true);\n        return msg;\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1160,"y":1540,"wires":[["ddabef18.3c694"]]},{"id":"f3bc1bc1.a6a2a8","type":"function","z":"9639036b.0a3a6","name":"set aux","func":"var newMsg;\nnewMsg = {payload: {}};\nif(msg.payload === true){\n    global.set(\"LampadaOn\", true);\n    newMsg.payload = {\"On\": true};\n    \n}\nif(msg.payload === false){\n    global.set(\"LampadaOn\", false);\n    newMsg.payload = {\"On\": false};\n}   \n    \nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":160,"wires":[[]]},{"id":"69f7a413.fce52c","type":"server-state-changed","z":"9639036b.0a3a6","name":"State Lampada","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.lampada","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":270,"y":160,"wires":[["f3bc1bc1.a6a2a8"],["f3bc1bc1.a6a2a8"]]},{"id":"afd38c4e.f57fd8","type":"function","z":"9639036b.0a3a6","name":"set aux","func":"var newMsg;\nnewMsg = {payload: {}};\nif(msg.payload === true){\n    global.set(\"AbajurOn\", true);\n    newMsg.payload = {\"On\": true};\n    \n}\nif(msg.payload === false){\n    global.set(\"AbajurOn\", false);\n    newMsg.payload = {\"On\": false};\n}   \n    \nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":260,"wires":[[]]},{"id":"ac7274e7.ac3338","type":"server-state-changed","z":"9639036b.0a3a6","name":"State Abajur","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.abajur","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":280,"y":260,"wires":[["afd38c4e.f57fd8"],["afd38c4e.f57fd8"]]},{"id":"41a5e47.ad4c31c","type":"function","z":"9639036b.0a3a6","name":"nothing yet","func":"var newMsg;\nnewMsg = {payload: {}};\nif(msg.payload === true){\n    newMsg.payload = {\"Active\": true};\n    \n}\nif(msg.payload === false){\n    newMsg.payload = {\"Active\": false};\n}   \n    \nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":380,"wires":[[]]},{"id":"53166bc8.c16a44","type":"server-state-changed","z":"9639036b.0a3a6","d":true,"name":"State Tomada TV","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.tomada_tv","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":270,"y":380,"wires":[["41a5e47.ad4c31c"],["41a5e47.ad4c31c"]]},{"id":"45599e1c.699668","type":"function","z":"9639036b.0a3a6","name":"nothing yet","func":"var newMsg;\nnewMsg = {payload: {}};\nif(msg.payload === true){\n    newMsg.payload = {\"On\": true};\n    \n}\nif(msg.payload === false){\n    newMsg.payload = {\"On\": false};\n}   \n    \nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":480,"wires":[[]]},{"id":"47c0d8c6.95485","type":"server-state-changed","z":"9639036b.0a3a6","d":true,"name":"State Cafeteira","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.cafeteira","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":270,"y":480,"wires":[["45599e1c.699668"],["45599e1c.699668"]]},{"id":"a621000d.09fd28","type":"function","z":"9639036b.0a3a6","name":"set aux","func":"var newMsg;\nnewMsg = {payload: {}};\nif(msg.payload === true){\n    global.set(\"TunelOn\", true);\n    newMsg.payload = {\"On\": true};\n    \n}\nif(msg.payload === false){\n    global.set(\"TunelOn\", false);\n    newMsg.payload = {\"On\": false};\n}   \n    \nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":580,"wires":[[]]},{"id":"fc2c9e5d.6235e8","type":"server-state-changed","z":"9639036b.0a3a6","name":"State Tunel","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.tunel","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":280,"y":580,"wires":[["a621000d.09fd28"],["a621000d.09fd28"]]},{"id":"ee6e3556.b171c8","type":"function","z":"9639036b.0a3a6","name":"nothing yet","func":"var newMsg;\nnewMsg = {payload: {}};\nif(msg.payload === true){\n    newMsg.payload = {\"On\": true};\n    \n}\nif(msg.payload === false){\n    newMsg.payload = {\"On\": false};\n}   \n    \nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":720,"wires":[[]]},{"id":"ccfdb1a3.60bf7","type":"server-state-changed","z":"9639036b.0a3a6","d":true,"name":"State Luz Rebeca","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.luz_da_rebeca","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":260,"y":720,"wires":[["ee6e3556.b171c8"],["ee6e3556.b171c8"]]},{"id":"bc64ca93.749b38","type":"link in","z":"9639036b.0a3a6","name":"AbajurOnOff","links":["9f17c2d.3ee754","dda7e9d2.170a08"],"x":545,"y":280,"wires":[["a1ad85c0.7a4bd"]]},{"id":"d42bb3e8.fdb408","type":"link in","z":"9639036b.0a3a6","name":"TunelOnOff","links":["f93ec142.3fe47","94ec131c.6217c8","b04e5bcb.8000d8","50adf190.73852","30bfabb3.1a10d4","33357c8f.37baa4"],"x":545,"y":620,"wires":[["4ae010a6.dc7358"]]},{"id":"e841b68.f5246c8","type":"link in","z":"9639036b.0a3a6","name":"LuzRebecaOnOff","links":["dca68d84.201a7"],"x":545,"y":760,"wires":[["a3ece82.e1f6818"]]},{"id":"dca68d84.201a7","type":"link out","z":"1aa34a9.7045335","name":"LuzRebecaOnOff","links":["e841b68.f5246c8"],"x":2295,"y":780,"wires":[]},{"id":"431f74ce.609c8c","type":"link in","z":"9639036b.0a3a6","name":"LampadaOnOff","links":["16e2dd57.1adedb","21a17194.8be5c6","385ed0f0.4efdd","90f01dce.bf0b6","c05c170f.0b0aa8"],"x":545,"y":180,"wires":[["beb10d5c.6bc55"]]},{"id":"385ed0f0.4efdd","type":"link out","z":"ccb6d071.13253","name":"LampadaOnOff","links":["431f74ce.609c8c"],"x":1795,"y":1600,"wires":[]},{"id":"c05c170f.0b0aa8","type":"link out","z":"ccb6d071.13253","name":"LampadaOnOff","links":["431f74ce.609c8c"],"x":2995,"y":1340,"wires":[]},{"id":"e7850bf3.7351e8","type":"function","z":"9639036b.0a3a6","name":"","func":"var newMsg;\n    newMsg = {payload:{}}\n    if(msg.payload.On === true){\n        newMsg.payload = {\n            \n          \"domain\": \"switch\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"switch.lampada\",\n\n        }\n    }\n    if(msg.payload.On === false){\n        newMsg.payload = {\n          \"domain\": \"switch\",\n          \"service\": \"turn_off\",\n          \"entity_id\": \"switch.lampada\",\n\n        }\n    }\n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":180,"wires":[["320b3ba7.2c1d2c"]]},{"id":"ac05be1a.d11b88","type":"function","z":"9639036b.0a3a6","name":"","func":"var newMsg\n    newMsg = {payload:{}}\n    if(msg.payload.On === true){\n        newMsg.payload = {\n            \n          \"domain\": \"switch\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"switch.abajur\",\n\n        }\n    }\n    if(msg.payload.On === false){\n        newMsg.payload = {\n            \n          \"domain\": \"switch\",\n          \"service\": \"turn_off\",\n          \"entity_id\": \"switch.abajur\",\n\n        }\n    }\n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":280,"wires":[["303a9c81.6a51dc"]]},{"id":"beb10d5c.6bc55","type":"delay","z":"9639036b.0a3a6","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":670,"y":180,"wires":[["e7850bf3.7351e8"]]},{"id":"a1ad85c0.7a4bd","type":"delay","z":"9639036b.0a3a6","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":670,"y":280,"wires":[["ac05be1a.d11b88"]]},{"id":"74881c1e.26bf24","type":"function","z":"9639036b.0a3a6","name":"","func":"var newMsg;\n\n    \n    newMsg = {payload:{}}\n    if(msg.payload.On === true){\n        newMsg.payload = {\n            \n          \"domain\": \"switch\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"switch.tunel\",\n\n        }\n    }\n    if(msg.payload.On === false){\n        newMsg.payload = {\n            \n          \"domain\": \"switch\",\n          \"service\": \"turn_off\",\n          \"entity_id\": \"switch.tunel\",\n\n        }\n    }\n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":620,"wires":[["d60e9c25.9e4898"]]},{"id":"b6301882.64b3b8","type":"function","z":"9639036b.0a3a6","name":"","func":"var newMsg;\n    newMsg = {payload:{}}\n    if(msg.payload.On === true){\n        newMsg.payload = {\n            \n          \"domain\": \"switch\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"switch.luz_da_rebeca\",\n\n        }\n    }\n    if(msg.payload.On === false){\n        newMsg.payload = {\n            \n          \"domain\": \"switch\",\n          \"service\": \"turn_off\",\n          \"entity_id\": \"switch.luz_da_rebeca\",\n\n        }\n    }\n    return newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":760,"wires":[["21c88da2.f92772"]]},{"id":"4ae010a6.dc7358","type":"delay","z":"9639036b.0a3a6","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":670,"y":620,"wires":[["74881c1e.26bf24"]]},{"id":"a3ece82.e1f6818","type":"delay","z":"9639036b.0a3a6","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":670,"y":760,"wires":[["b6301882.64b3b8"]]},{"id":"320b3ba7.2c1d2c","type":"api-call-service","z":"9639036b.0a3a6","name":"Lampada OnOff","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.lampada","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":990,"y":180,"wires":[[]]},{"id":"303a9c81.6a51dc","type":"api-call-service","z":"9639036b.0a3a6","name":"Abajur OnOff","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.abajur","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":980,"y":280,"wires":[[]]},{"id":"d60e9c25.9e4898","type":"api-call-service","z":"9639036b.0a3a6","name":"Tunel OnOff","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.tunel","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":980,"y":620,"wires":[[]]},{"id":"21c88da2.f92772","type":"api-call-service","z":"9639036b.0a3a6","name":"Luz Rebeca OnOff","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.luz_da_rebeca","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1000,"y":760,"wires":[[]]},{"id":"f151f1cf.a394b","type":"mqtt out","z":"1f49f273.0f37be","name":"Rainbow Slow","topic":"QuartoNedi/setMode08","qos":"0","retain":"false","broker":"a03558e.9e50d28","x":1360,"y":580,"wires":[]},{"id":"34d03ea2.01dbb2","type":"function","z":"1f49f273.0f37be","d":true,"name":"Liga","func":"msg = {payload:1};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1159,"y":580,"wires":[["f151f1cf.a394b"]]},{"id":"1855dbf.2ef0524","type":"hb-control","z":"1f49f273.0f37be","name":"Fita do Quarto","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita do Quarto00000043","conf":"40e0a266.1beb0c","x":1442,"y":700,"wires":[]},{"id":"1e98bac8.8c9a55","type":"function","z":"1f49f273.0f37be","name":"Menos Brilho & Turquesa","func":"msg.payload = {\n    \"On\" : true,\n    \"Hue\" : 174,\n    \"Saturation\" : 100,\n    \"Brightness\" : 10\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1222,"y":700,"wires":[["1855dbf.2ef0524"]]},{"id":"94ec131c.6217c8","type":"link out","z":"ecc79e8a.d4a1b","name":"TunelOnOff","links":["d42bb3e8.fdb408"],"x":635,"y":380,"wires":[]},{"id":"dda7e9d2.170a08","type":"link out","z":"1aa34a9.7045335","name":"AbajurOn","links":["bc64ca93.749b38"],"x":615,"y":400,"wires":[]},{"id":"3a78966f.1fc26a","type":"link in","z":"c3bc1a43.254dd","name":"Sun down","links":["ea8f030f.c171c","887b4600.764898"],"x":788,"y":568,"wires":[["8c00ea31.7a21e8"]]},{"id":"cadee65.c1bd618","type":"function","z":"cbdfe56c.84c388","name":"Aberto Muito Tempo","func":"var abertoMuitoTempo = global.get(\"abertoMuitoTempo\");\nif(msg.payload.ContactSensorState === false){\n    if(abertoMuitoTempo === true){\n        global.set(\"auxEmissorBanheiro\", \"Yeelight\");\n        global.set(\"isOnBanheiro\", false);\n        msg.ajuda = 1;\n        return msg;\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1600,"y":440,"wires":[["e74ef9a.fcb7f88"]]},{"id":"af81402b.6be26","type":"switch","z":"cbdfe56c.84c388","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"},{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":2210,"y":420,"wires":[["ab500a8.a695378","90b90d98.a1c79"],["b7f737c6.052cb8"]]},{"id":"ab0c9399.d30288","type":"comment","z":"cbdfe56c.84c388","name":"Se a porta fecha com a luz desligada há muito tempo, a luz liga","info":"","x":1810,"y":620,"wires":[]},{"id":"beba1b39.f80be8","type":"comment","z":"cbdfe56c.84c388","name":"Se a porta fica aberta com a luz ligada há muito tempo, a luz desliga","info":"","x":1820,"y":660,"wires":[]},{"id":"73d9e98f.7b5d98","type":"comment","z":"cbdfe56c.84c388","name":"Botão foi clicado","info":"","x":180,"y":269,"wires":[]},{"id":"7bbf8218.addeac","type":"comment","z":"cbdfe56c.84c388","name":"A porta foi aberta.","info":"","x":190,"y":449,"wires":[]},{"id":"502dd569.ee308c","type":"comment","z":"cbdfe56c.84c388","name":"Check se a luz do banheiro está ligada","info":"","x":810,"y":120,"wires":[]},{"id":"6026cd4f.c32764","type":"comment","z":"cbdfe56c.84c388","name":"Liga ou desliga a luz conforme a lógica","info":"","x":2870,"y":140,"wires":[]},{"id":"98f63383.c6d94","type":"function","z":"1aa34a9.7045335","name":"Start Cont","func":"global.set(\"contEscritorio\", 0);   \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":630,"y":1540,"wires":[["76e80b84.116cec"]]},{"id":"27197993.685266","type":"api-call-service","z":"ccb6d071.13253","name":"Luz do Quarto Nédi","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.luz_do_quarto_nedi","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2750,"y":260,"wires":[[]]},{"id":"770423da.25729c","type":"function","z":"ccb6d071.13253","name":"Turn On Bright","func":"var i = parseInt(flow.get(\"iterLuzDoQuartoInc\"));\nvar newMsg;\nif (i > 255) {\n        /*newMsg= {payload : {\n            \"domain\": \"light\",\n            \"service\": \"turn_on\",\n            data:{\n                \n                \"entity_id\": \"light.luz_do_quarto_nedi\",\n                \"brightness\": 255,\n                \"rgb_color\": [255, 255, 255]\n            }\n        }};\n        */\n        //node.send(newMsg);\n        newMsg={reset: true};    \n        return newMsg;\n}\nnewMsg= {payload : {\n            \"domain\": \"light\",\n            \"service\": \"turn_on\",\n            data:{\n                \n                \"entity_id\": \"light.luz_do_quarto_nedi\",\n                \"brightness\": i,\n                \"rgb_color\": [i, i, i]\n            }\n}};    \ni += 35\nflow.set(\"iterLuzDoQuartoInc\", i);\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2140,"y":240,"wires":[["11baa81c.8c2e88","160214ce.874fab"]]},{"id":"799b7bb.f2e0e84","type":"function","z":"ccb6d071.13253","name":"Turn On Dim","func":"var i = parseInt(flow.get(\"iterLuzDoQuartoInc\"));\nvar newMsg;\nif (i > 255) {\n        return {reset: true};\n}\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_on\",\n        data:{\n            \n            \"entity_id\": \"light.luz_do_quarto_nedi\",\n            \"brightness\": parseInt(i/15),\n            \"rgb_color\": [255, 181, 107]\n        }\n    }};\ni += 50\nflow.set(\"iterLuzDoQuartoInc\", i);\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2130,"y":320,"wires":[["fbe1624a.cd6a4"]]},{"id":"c22678a9.036de8","type":"api-call-service","z":"ccb6d071.13253","name":"Luz do Quarto Nédi","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.luz_do_quarto_nedi","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2030,"y":2640,"wires":[[]]},{"id":"8e8dfee8.a2f7d","type":"api-call-service","z":"cbdfe56c.84c388","name":"Luz Noturna","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.aqara_hub","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3250,"y":600,"wires":[[]]},{"id":"f8099a5e.4621d8","type":"api-call-service","z":"ccb6d071.13253","name":"Luz do Quarto Nédi","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.luz_do_quarto_nedi","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2370,"y":820,"wires":[[]]},{"id":"90b90d98.a1c79","type":"function","z":"cbdfe56c.84c388","name":"Turn On Verde","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nglobal.set(\"BanheiroOcupado\", false);\nif(Hour < 18 && Hour > 6){\n    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_on\",\n        data:{\n            \"entity_id\": \"light.aqara_hub\",\n            \"brightness\": 6,\n            \"rgb_color\": [0,10,0]\n        }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2700,"y":480,"wires":[["8e8dfee8.a2f7d","9f2b9863.e2b47"]]},{"id":"b7f737c6.052cb8","type":"function","z":"cbdfe56c.84c388","name":"Turn On Vermelho","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nglobal.set(\"BanheiroOcupado\", true);\n\nif(Hour < 18 && Hour > 6){\n    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_on\",\n        data:{\n            \"entity_id\": \"light.aqara_hub\",\n            \"brightness\": 6,\n            \"rgb_color\": [10,0,0]\n        }\n    }};\n    \n    return newMsg;\n} ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2710,"y":600,"wires":[["8e8dfee8.a2f7d","9f2b9863.e2b47"]]},{"id":"ab339416.d4ff6","type":"api-current-state","z":"ccb6d071.13253","name":"Luz do Quarto Nédi","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.luz_do_quarto_nedi","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":530,"y":1300,"wires":[["de7b8143.9b6678","d349a248.972af8"]]},{"id":"d349a248.972af8","type":"debug","z":"ccb6d071.13253","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":670,"y":1240,"wires":[]},{"id":"b0a93044.b380e","type":"inject","z":"ccb6d071.13253","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":260,"y":1260,"wires":[["4e494f43.429e78"]]},{"id":"62b82523.2aee44","type":"api-call-service","z":"1f49f273.0f37be","name":"Luz do Quarto","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.luz_do_quarto_nedi","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1440,"y":820,"wires":[[]]},{"id":"a088b030.4664a8","type":"function","z":"1f49f273.0f37be","name":"Luz do Quarto Off","func":"var newMsg;\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.luz_do_quarto_nedi\"\n    }\n}};\n\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1200,"y":820,"wires":[["62b82523.2aee44"]]},{"id":"c7461a4.bd276e8","type":"function","z":"1f49f273.0f37be","name":"Hora do Filme","func":"if(\n    \n    msg.payload.name===\"Echo Dot da Sala\" &&(\n    msg.payload.description.summary.includes('hora do filme')===true||\n    msg.payload.description.summary.includes('filme')===true\n    \n    )){\n    var newMsg;\n    newMsg = {\"payload\": {\"horaDoFilme\": true}};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1900,"wires":[["49863967.bafc38","61d1ae3a.704c3"]]},{"id":"49863967.bafc38","type":"link out","z":"1f49f273.0f37be","name":"Hora do filme","links":["79e2642d.93bbbc"],"x":655,"y":1900,"wires":[]},{"id":"79e2642d.93bbbc","type":"link in","z":"c3bc1a43.254dd","name":"Hora do Filme","links":["49863967.bafc38","d20321f.f5ce5e"],"x":355,"y":1280,"wires":[["1fbcb698.3f9c79"]]},{"id":"916d47c4.c01b78","type":"function","z":"1f49f273.0f37be","name":"Luz do Quarto On","func":"if(msg.payload.description.summary.includes('liga a luz do quarto')===true||\n    msg.payload.description.summary.includes('acende luz do quarto')===true||\n    msg.payload.description.summary.includes('liga luz do quarto')===true||\n    msg.payload.description.summary.includes('liga as luzes do quarto')===true||\n    msg.payload.description.summary.includes('liga luzes do quarto')===true ||\n    msg.payload.description.summary.includes('ligar a luz do quarto')===true||\n    msg.payload.description.summary.includes('ligar luz do quarto')===true||\n    msg.payload.description.summary.includes('ligar as luzes do quarto')===true||\n    msg.payload.description.summary.includes('ligar luzes do quarto')===true ||\n    msg.payload.description.summary.includes('acende a luz do quarto')===true||\n    msg.payload.description.summary.includes('acende as luzes do quarto')===true||\n    msg.payload.description.summary.includes('ligue a luz do quarto')===true||\n    msg.payload.description.summary.includes('ligue luz do quarto')===true||\n    msg.payload.description.summary.includes('ligue as luzes do quarto')===true||\n    msg.payload.description.summary.includes('ligue luzes do quarto')===true ||\n    (msg.payload.name===\"Echo Dot do Quarto Nédi\" &&\n       (\n       msg.payload.description.summary.includes('acende a luz')===true ||\n       msg.payload.description.summary.includes('liga a luz')===true ||\n       msg.payload.description.summary.includes('liga luz')===true||\n       msg.payload.description.summary.includes('liga luzes')===true ||\n       msg.payload.description.summary.includes('liga as luzes')===true ||\n       msg.payload.description.summary.includes('ligar a luz')===true ||\n       msg.payload.description.summary.includes('ligar luz')===true||\n       msg.payload.description.summary.includes('ligar luzes')===true ||\n       msg.payload.description.summary.includes('ligar as luzes')===true||\n       msg.payload.description.summary.includes('ligue a luz')===true ||\n       msg.payload.description.summary.includes('ligue luz')===true||\n       msg.payload.description.summary.includes('ligue luzes')===true ||\n       msg.payload.description.summary.includes('ligue as luzes')===true\n       ))\n    ){\n    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_on\",\n        \"data\":{\n            \"entity_id\": \"light.luz_do_quarto_nedi\",\n            \"rgb_color\": [255, 255, 255],\n            \"brightness\": 255,\n            \"transition\": 30\n        }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":1000,"wires":[["1dec777b.cf16a9","7e21169a.d2cde8"]]},{"id":"6be25259.436ffc","type":"function","z":"1f49f273.0f37be","name":"Luz do Quarto Off","func":"if(msg.payload.description.summary.includes('desliga a luz do quarto')===true||\n    msg.payload.description.summary.includes('desliga luz do quarto')===true||\n    msg.payload.description.summary.includes('desliga as luzes do quarto')===true||\n    msg.payload.description.summary.includes('desliga luzes do quarto')===true ||\n    msg.payload.description.summary.includes('desligar a luz do quarto')===true||\n    msg.payload.description.summary.includes('desligar luz do quarto')===true||\n    msg.payload.description.summary.includes('desligar as luzes do quarto')===true||\n    msg.payload.description.summary.includes('desligar luzes do quarto')===true ||\n    msg.payload.description.summary.includes('desligue a luz do quarto')===true||\n    msg.payload.description.summary.includes('desligue luz do quarto')===true||\n    msg.payload.description.summary.includes('desligue as luzes do quarto')===true||\n    msg.payload.description.summary.includes('desligue luzes do quarto')===true ||\n    (msg.payload.name===\"Echo Dot do Quarto Nédi\" &&\n       (\n       msg.payload.description.summary.includes('desliga a luz')===true ||\n       msg.payload.description.summary.includes('desliga luz')===true||\n       msg.payload.description.summary.includes('desliga luzes')===true ||\n       msg.payload.description.summary.includes('desliga as luzes')===true ||\n       msg.payload.description.summary.includes('desligar a luz')===true ||\n       msg.payload.description.summary.includes('desligar luz')===true||\n       msg.payload.description.summary.includes('desligar luzes')===true ||\n       msg.payload.description.summary.includes('desligar as luzes')===true || \n       msg.payload.description.summary.includes('desligue a luz')===true ||\n       msg.payload.description.summary.includes('desligue luz')===true||\n       msg.payload.description.summary.includes('desligue luzes')===true ||\n       msg.payload.description.summary.includes('desligue as luzes')===true\n       ))\n    ){\n    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_off\",\n        data:{\n            \"entity_id\": \"light.luz_do_quarto_nedi\"\n        }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":1040,"wires":[["1dec777b.cf16a9","7e21169a.d2cde8"]]},{"id":"1dec777b.cf16a9","type":"api-call-service","z":"1f49f273.0f37be","name":"Luz do Quarto Nédi","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.luz_do_quarto_nedi","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":790,"y":1060,"wires":[[]]},{"id":"7a2f5278.408f44","type":"function","z":"9639036b.0a3a6","name":"Sunset","func":"\nif(msg.data.new_state.attributes.elevation < 4){\n        return msg;\n}\n//Sunset","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":880,"wires":[["70f5a8e6.ddd148","896fbe77.0922e"]]},{"id":"896fbe77.0922e","type":"function","z":"9639036b.0a3a6","name":"","func":"msg.payload = \"Sunset \" + msg.data.new_state.attributes.elevation;\nmsg.topic = \"Sunset\";\nglobal.set(\"salaEscura\", true);\nglobal.set(\"escritorioEscuro\", true);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":860,"wires":[["887b4600.764898"]]},{"id":"70f5a8e6.ddd148","type":"debug","z":"9639036b.0a3a6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":600,"y":920,"wires":[]},{"id":"887b4600.764898","type":"link out","z":"9639036b.0a3a6","name":"Sun down","links":["3a78966f.1fc26a"],"x":725,"y":860,"wires":[]},{"id":"6d2fd84d.8b68e8","type":"inject","z":"cbdfe56c.84c388","name":"Passou das 18h","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 18 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":2930,"y":460,"wires":[["b157a009.f05ad"]]},{"id":"cca42cd0.361b","type":"function","z":"1f49f273.0f37be","name":"Globo","func":"if((msg.payload.description.summary.includes('globo')===true ||\n    msg.payload.description.summary.includes('novela')===true||\n    msg.payload.description.summary.includes('jornal')===true||\n   (msg.payload.name===\"Echo Dot da Sala\" && \n   (msg.payload.description.summary.includes('liga a t.v.')===true)||\n   (msg.payload.description.summary.includes('liga a t. v.')===true)||\n   (msg.payload.description.summary.includes('liga t.v.')===true)||\n   (msg.payload.description.summary.includes('liga t. v.')===true)||\n   (msg.payload.description.summary.includes('ligue a t.v.')===true)||\n   (msg.payload.description.summary.includes('ligue a t. v.')===true)||\n   (msg.payload.description.summary.includes('ligue t.v.')===true)||\n   (msg.payload.description.summary.includes('ligue t. v.')===true) ||\n        (msg.payload.name===\"Echo Dot da Sala\" && ((\n       (msg.payload.description.summary.includes('liga')===true) ||\n       (msg.payload.description.summary.includes('ligue')===true) ) &&\n       msg.payload.description.summary.includes('t.')===true &&\n       msg.payload.description.summary.includes('v.')===true))\n   )) && (msg.payload.description.summary.includes('desliga') === false &&\n        msg.payload.description.summary.includes('desligue') === false\n   )){\n    var newMsg;\n        newMsg = {payload:{}}\n    newMsg.payload = {\n        \"domain\": \"media_player\",\n        \"service\": \"turn_on\",\n        \"entity_id\": \"media_player.tv_da_sala\",\n        \"data\":{\n          \"entity_id\": \"media_player.tv_da_sala\",\n        }\n    }\n    node.send(newMsg);\n        newMsg = {payload:{}}\n    newMsg.payload = {\n        \"domain\": \"media_player\",\n        \"service\": \"play_media\",\n        \"entity_id\": \"media_player.tv_da_sala\",\n        \"data\":{\n          \"entity_id\": \"media_player.tv_da_sala\",\n          \"media_content_type\": \"send_key\",\n          \"media_content_id\": \"ST_HDMI1\"\n        }\n    }\n    node.send(newMsg);\n    newMsg= {payload : {\n        \"domain\": \"media_player\",\n        \"service\": \"play_media\",\n        \"data\":{\n            \"entity_id\": \"media_player.tv_da_sala\",\n            \"media_content_id\": 512,\n            \"media_content_type\": \"channel\"\n        }\n    }};\n    \n    node.send(newMsg);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":1960,"wires":[["3249e2e0.7b002e"]]},{"id":"2141b982.595956","type":"function","z":"1f49f273.0f37be","name":"Desliga","func":"if(msg.payload.description.summary.includes('desliga a t.v. da sala')===true||\n   msg.payload.description.summary.includes('desliga a t. v. da sala')===true||\n   \n        (msg.payload.name===\"Echo Dot da Sala\" && ((\n       (msg.payload.description.summary.includes('desliga')===true) ||\n       (msg.payload.description.summary.includes('desligue')===true) ) &&\n       msg.payload.description.summary.includes('t.')===true &&\n       msg.payload.description.summary.includes('v.')===true))\n   ){\n    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"media_player\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"media_player.tv_da_sala\"\n        }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":2000,"wires":[["3249e2e0.7b002e"]]},{"id":"d3676c7d.31b83","type":"api-call-service","z":"1f49f273.0f37be","name":"TV da Sala","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"media_player.tv_da_sala","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":930,"y":2140,"wires":[[]]},{"id":"e155da29.089298","type":"delay","z":"cbdfe56c.84c388","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3100,"y":420,"wires":[["c1f60460.f25f78"]]},{"id":"c1f60460.f25f78","type":"function","z":"cbdfe56c.84c388","name":"Make sure it turned off","func":"flow.set(\"triggered2\", true);\nflow.set(\"didItTurnOffCheck\",msg.payload.on);\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3290,"y":420,"wires":[["37841a2f.1823e6"]]},{"id":"37841a2f.1823e6","type":"yeelight-compat-hue-state","z":"cbdfe56c.84c388","name":"","server":"ea75f443.ed079","x":3500,"y":420,"wires":[["ce6c4670.6dd9c8"]]},{"id":"ce6c4670.6dd9c8","type":"function","z":"cbdfe56c.84c388","name":"Turn Off","func":"if(flow.get(\"triggered2\")===true){\n    var newMsg;\n    flow.set(\"triggered2\", false);\n    if(flow.get(\"didItTurnOffCheck\")===false){\n        newMsg = { payload : {\"on\":false}};\n        node.status({fill:\"green\",shape:\"dot\",text:\"Desliga\"});\n        node.send(newMsg);   \n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3660,"y":420,"wires":[["6bcfb924.e363b8"]]},{"id":"6bcfb924.e363b8","type":"yeelight-compat-hue-out","z":"cbdfe56c.84c388","name":"Luz do Banheiro","server":"ea75f443.ed079","x":3840,"y":420,"wires":[]},{"id":"b80450c8.ce969","type":"function","z":"1f49f273.0f37be","name":"GNT","func":"if(         (msg.payload.name===\"Echo Dot da Sala\" && (\n        (msg.payload.description.summary.includes('g.')===true && \n        msg.payload.description.summary.includes('n.')===true &&\n        msg.payload.description.summary.includes('t.')===true) ||\n        msg.payload.description.summary.includes('g. n. t.')===true||\n        msg.payload.description.summary.includes('GNT')===true\n    ))){\n    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"media_player\",\n        \"service\": \"play_media\",\n        \"data\":{\n            \"entity_id\": \"media_player.tv_da_sala\",\n            \"media_content_id\": 541,\n            \"media_content_type\": \"channel\"\n        }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"x":490,"y":2040,"wires":[["3249e2e0.7b002e"]]},{"id":"3b721c32.e3e9a4","type":"function","z":"1f49f273.0f37be","name":"Volume -","func":"if(               (msg.payload.name===\"Echo Dot da Sala\" && (\n        msg.payload.description.summary.includes('muito alto')===true||\n        msg.payload.description.summary.includes('abaixa o volume')===true||\n        msg.payload.description.summary.includes('baixa o volume')===true||\n        msg.payload.description.summary.includes('abaixa volume')===true||\n        msg.payload.description.summary.includes('baixa volume')===true||\n        msg.payload.description.summary.includes('abaixe o volume')===true||\n        msg.payload.description.summary.includes('baixe o volume')===true||\n        msg.payload.description.summary.includes('abaixe volume')===true||\n        msg.payload.description.summary.includes('baixe volume')===true\n    ))){\n    for(var i = 0 ; i < 5 ; i++){\n        newMsg= {payload : {\n            \"domain\": \"media_player\",\n            \"service\": \"volume_down\",\n            \"data\":{\n                \"entity_id\": \"media_player.tv_da_sala\"\n            }\n        }};\n        \n        node.send(newMsg);\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":2100,"wires":[["3249e2e0.7b002e"]]},{"id":"f1ebdd3b.04636","type":"function","z":"1f49f273.0f37be","name":"Volume + ","func":"if(          (msg.payload.name===\"Echo Dot da Sala\" && (\n        msg.payload.description.summary.includes('muito baixo')===true||\n        msg.payload.description.summary.includes('aumenta o volume')===true||\n        msg.payload.description.summary.includes('aumenta volume')===true\n    ))){\n    var newMsg;\n    for(var i = 0 ; i < 5 ; i++){\n        newMsg= {payload : {\n            \"domain\": \"media_player\",\n            \"service\": \"volume_up\",\n            \"data\":{\n                \"entity_id\": \"media_player.tv_da_sala\"\n            }\n        }};\n        \n        node.send(newMsg);\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":2160,"wires":[["3249e2e0.7b002e"]]},{"id":"ba543e2.d4efbc","type":"comment","z":"1f49f273.0f37be","name":"Abaixa o volume","info":"","x":320,"y":2040,"wires":[]},{"id":"5ce8f592.8781ec","type":"comment","z":"1f49f273.0f37be","name":"Aumenta o volume","info":"","x":310,"y":2100,"wires":[]},{"id":"bcab567e.e18e88","type":"comment","z":"1f49f273.0f37be","name":"Troca de canal","info":"","x":320,"y":1920,"wires":[]},{"id":"47c9d60.1d7922c","type":"function","z":"1f49f273.0f37be","name":"Pausar","func":"if((msg.payload.name===\"Echo Dot do Sala\" && (\n        msg.payload.description.summary.includes('pausa')===true||\n        msg.payload.description.summary.includes('pausar')===true||\n        msg.payload.description.summary.includes('já volto')===true||\n        msg.payload.description.summary.includes('vou ao banheiro')===true||\n        msg.payload.description.summary.includes('vou no banheiro')===true\n    ))){\n    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"media_player\",\n        \"service\": \"media_stop\",\n        \"data\":{\n            \"entity_id\": \"media_player.tv_da_sala\"\n        }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":2220,"wires":[["f86eb4e1.3754c8","3249e2e0.7b002e"]]},{"id":"f86eb4e1.3754c8","type":"function","z":"1f49f273.0f37be","name":"","func":"\n    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"media_player\",\n        \"service\": \"media_play_pause\",\n        \"data\":{\n            \"entity_id\": \"media_player.apple_tv\"\n        }\n    }};\n    return newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":2220,"wires":[["e8edd2cd.06edd"]]},{"id":"76813a45.e33004","type":"function","z":"1f49f273.0f37be","name":"Mute TV","func":"var newMsg;\nif(     (msg.payload.name===\"Echo Dot do Sala\" && (\n        msg.payload.description.summary.includes('silêncio')===true||\n        msg.payload.description.summary.includes('silencio')===true||\n        msg.payload.description.summary.includes('silencia')===true||\n        msg.payload.description.summary.includes('silenciar')===true||\n        msg.payload.description.summary.includes('mudo')===true||\n        msg.payload.description.summary.includes('vaca amarela')===true\n    ))){\n    newMsg= {payload : {\n        \"domain\": \"media_player\",\n        \"service\": \"volume_mute\",\n        \"data\":{\n            \"entity_id\": \"media_player.tv_da_sala\",\n            \"is_volume_muted\": false\n        }\n    }};\n    \n    return newMsg;\n}\n\nif(     (msg.payload.name===\"Echo Dot do Sala\" && ( \n        msg.payload.description.summary.includes('volta ao normal')===true||\n        msg.payload.description.summary.includes('normal')===true||\n        msg.payload.description.summary.includes('silencia')===true||\n        msg.payload.description.summary.includes('silenciar')===true||\n        msg.payload.description.summary.includes('mudo')===true||\n        msg.payload.description.summary.includes('vaca amarela')===true\n    ))){\n    newMsg= {payload : {\n        \"domain\": \"media_player\",\n        \"service\": \"volume_mute\",\n        \"data\":{\n            \"entity_id\": \"media_player.tv_da_sala\",\n            \"is_volume_muted\": true\n        }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"x":500,"y":2280,"wires":[["3249e2e0.7b002e"]]},{"id":"25c5a007.79336","type":"function","z":"c6be7449.1c6ce8","name":"Tocar ringtone no acpartner","func":"\n    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"xiaomi_aqara\",\n        \"service\": \"play_ringtone\",\n        \"data\":{\n            \"gw_mac\": \"44237c81c932\",\n            \"ringtone_id\": 10,\n            \"ringtone_vol\": 100\n\n        }\n    }};\n    return newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":700,"wires":[["d1d23aae.d05e88"]]},{"id":"9fad2471.285698","type":"server-events","z":"1d7ecdc6.68c842","name":"Click","server":"d63d21ef.5e065","event_type":"xiaomi_aqara.click","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"x":230,"y":480,"wires":[["4347206e.0152e","faa6246d.3b3a98","b0235b17.ba525","5d7222a3.0f12cc","8ce80743.c3812","d46429fe.002788","5f7c02.fca47c","45aee67a.a4fac8","fa289c.e680cf68","1c2b00a0.493b4f","43fcb1b4.a8d","a9fca138.ecc46","56beb9e2.538d28"]]},{"id":"2555f98e.5e57d6","type":"server-events","z":"1d7ecdc6.68c842","name":"Movimento","server":"d63d21ef.5e065","event_type":"xiaomi_aqara.motion","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"x":240,"y":880,"wires":[["c3aafca7.63d3a8","797dd9ee.65fea8","90728293.3d228","ad7492d1.a29de","96f70792.3034c8","ab2134f4.a3c558","e9a26f15.a324a"]]},{"id":"d0b34d64.f4b34","type":"server-events","z":"1d7ecdc6.68c842","name":"Vibração","server":"d63d21ef.5e065","event_type":"xiaomi_aqara.movement","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"x":290,"y":1500,"wires":[["13c99a52.be8116","75d8d78c.24b648"]]},{"id":"75d8d78c.24b648","type":"debug","z":"1d7ecdc6.68c842","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":430,"y":1560,"wires":[]},{"id":"c5e18382.37267","type":"server-state-changed","z":"1d7ecdc6.68c842","name":"Porta Banheiro","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.porta_banheiro","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":300,"y":1400,"wires":[["b60c6540.e38f78","5868a50e.94e6cc"],["771756fa.87ad68","5868a50e.94e6cc"]]},{"id":"ad7492d1.a29de","type":"function","z":"1d7ecdc6.68c842","name":"Movimento Corredor","func":"if(msg.payload.entity_id === \"binary_sensor.movimento_corredor\"){\n    var newMsg;\n    newMsg = {payload:{entity_id:\"sensor.sensor_de_luz_corredor\"}};\n    return newMsg;\n}\n//sensor_motion.aq2","outputs":1,"noerr":0,"x":520,"y":1020,"wires":[["41b18f.6f954e7","12bbc229.55e32e"]]},{"id":"91478376.a78de","type":"function","z":"1d7ecdc6.68c842","name":"Turn On","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nvar banheiroOcupado = global.get(\"BanheiroOcupado\");\nvar newMsg;\nif(Hour > 18 ||Hour < 7 || msg.payload < 5){\n    if(Hour < 18 && Hour > 6){ \n        if(banheiroOcupado === false){\n            \n            newMsg= {payload : {\n                \"domain\": \"light\",\n                \"service\": \"turn_on\",\n                data:{\n                    \"entity_id\": \"light.aqara_hub\",\n                    \"brightness\": 6,\n                    \"rgb_color\": [0,10,0]\n                }\n            }};\n        \n            return newMsg;\n        }\n        \n        if(banheiroOcupado === true){\n            \n            newMsg= {payload : {\n                \"domain\": \"light\",\n                \"service\": \"turn_on\",\n                data:{\n                    \"entity_id\": \"light.aqara_hub\",\n                    \"brightness\": 6,\n                    \"rgb_color\": [10,0,0]\n                }\n            }};\n        \n            return newMsg;\n        }\n    }\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_on\",\n        data:{\n            \"entity_id\": \"light.aqara_hub\",\n            \"brightness\": 6,\n            \"rgb_color\": [10,10,10]\n        }\n    }};\n    \n    return newMsg;\n} ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":1020,"wires":[["5631bad4.af38d4"]]},{"id":"5631bad4.af38d4","type":"api-call-service","z":"1d7ecdc6.68c842","name":"Luz Noturna On","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.aqara_hub","data":"{\"entity_id\":\"light.aqara_hub\",\"brightness\":6,\"rgb_color\":[10,10,10]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1100,"y":1020,"wires":[[]]},{"id":"41b18f.6f954e7","type":"delay","z":"1d7ecdc6.68c842","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":720,"y":1080,"wires":[["54dbd006.0304f"]]},{"id":"54dbd006.0304f","type":"function","z":"1d7ecdc6.68c842","name":"Turn Off","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nif(Hour > 18){\n    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_off\",\n        data:{\n            \"entity_id\": \"light.aqara_hub\",\n        }\n    }};\n    \n    return newMsg;\n} ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":860,"y":1080,"wires":[["2ad8defd.5a5172"]]},{"id":"2ad8defd.5a5172","type":"api-call-service","z":"1d7ecdc6.68c842","name":"Luz Noturna Off","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.aqara_hub","data":"{\"entity_id\":\"light.aqara_hub\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1020,"y":1080,"wires":[[]]},{"id":"96f70792.3034c8","type":"debug","z":"1d7ecdc6.68c842","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":260,"y":1020,"wires":[]},{"id":"43fcb1b4.a8d","type":"debug","z":"1d7ecdc6.68c842","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":470,"y":220,"wires":[]},{"id":"385749ae.d89836","type":"api-call-service","z":"c3bc1a43.254dd","name":"TV da Sala","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"media_player.tv_da_sala","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":930,"y":1060,"wires":[[]]},{"id":"f5874454.f418c8","type":"function","z":"c3bc1a43.254dd","name":"Liga a TV","func":"var newMsg;\nnewMsg= {payload : {\n    \"domain\": \"media_player\",\n    \"service\": \"turn_on\",\n    \"data\":{\n        \"entity_id\": \"media_player.tv_da_sala\"\n    }\n}};\n    \nreturn newMsg;\n","outputs":1,"noerr":0,"x":780,"y":1060,"wires":[["385749ae.d89836"]]},{"id":"d5256963.e41b08","type":"yeelight-compat-hue-state","z":"1aa34a9.7045335","name":"","server":"eeeccf7f.6c0df8","x":350,"y":1680,"wires":[["46f3856d.6af474"]]},{"id":"46f3856d.6af474","type":"function","z":"1aa34a9.7045335","name":"Turned off, reset cont","func":"var date = new Date();\nvar Hour = date.getHours();\nif(Hour >= 18 && Hour < 23){\n    if(msg.payload.state.on === false){\n        msg.reset = 1;\n        return msg;\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":1680,"wires":[["238ed80.34b9228"]]},{"id":"cc499079.e0bf","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"Fala rouca","account":"d04673cf.2f08f","routineNode":{"type":"speak","payload":{"type":"ssml","text":{"type":"ssml","value":"<speak><prosody pitch=\"-50%\" \trate=\"80%\" volume=\"+0dB\">\tIsto é um teste! <break time='100ms'/> Como posso te ajudar? \t</prosody></speak>"},"devices":["G090XG0793643C6P"]}},"x":2310,"y":1100,"wires":[[]]},{"id":"6e28a56e.b7fbe4","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2140,"y":1100,"wires":[["cc499079.e0bf"]]},{"id":"2e228305.c1d71c","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"Fala \"soft\"","account":"d04673cf.2f08f","routineNode":{"type":"speak","payload":{"type":"ssml","text":{"type":"ssml","value":"<speak><amazon:effect phonation=\"soft\">\tIsto é um teste! <break time='100ms'/> Como posso te ajudar? \t</amazon:effect></speak>"},"devices":["G090XG0793643C6P"]}},"x":2310,"y":1160,"wires":[[]]},{"id":"1a5f52be.63bded","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2140,"y":1160,"wires":[["2e228305.c1d71c"]]},{"id":"c4bdec86.386528","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"Fala que nem monstro","account":"d04673cf.2f08f","routineNode":{"type":"speak","payload":{"type":"ssml","text":{"type":"ssml","value":"<speak><amazon:effect vocal-tract-length=\"+80%\">\tIsto é um teste! <break time='100ms'/> Como posso te ajudar? \t</amazon:effect></speak>"},"devices":["G090XG0793643C6P"]}},"x":2340,"y":1220,"wires":[[]]},{"id":"c5a36ee3.5d4478","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2140,"y":1220,"wires":[["c4bdec86.386528"]]},{"id":"43570778.c19038","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"Rapido cochicho ","account":"d04673cf.2f08f","routineNode":{"type":"speak","payload":{"type":"ssml","text":{"type":"ssml","value":"<speak>   <prosody rate=\"150%\" pitch=      \"+50%\"                         volume      =      \"x-soft\">    Rapido cuchicho   </prosody> </speak>"},"devices":["G090XG0793643C6P"]}},"x":2330,"y":1280,"wires":[[]]},{"id":"72dba6b.ba3d558","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2140,"y":1280,"wires":[["43570778.c19038"]]},{"id":"7cf7584a.c66ee8","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speak","payload":{"type":"ssml","text":{"type":"ssml","value":"<speak>     <prosody volume=\"x-loud\"><amazon:effect name=\"whispered\">Eu não sou um humano real </amazon:effect></prosody> </speak>"},"devices":["G090XG0793271TAE"]}},"x":2760,"y":1300,"wires":[[]]},{"id":"a8472945.3115f","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2140,"y":1340,"wires":[["617538c4.b766","617b4039.f2ece8","b7c54f2c.fa1368"]]},{"id":"c3a40302.86c418","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"Wow","account":"d04673cf.2f08f","routineNode":{"type":"speak","payload":{"type":"ssml","text":{"type":"ssml","value":"<speak>     <say-as interpret-as=\"interjection\">Wow</say-as>, Não vi isso vindo </speak>\t"},"devices":["G090XG0793643C6P"]}},"x":2290,"y":1440,"wires":[[]]},{"id":"7842c6de.fe439","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2140,"y":1440,"wires":[["c3a40302.86c418"]]},{"id":"617538c4.b766","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":""},"volume":{"type":"num","value":"100"},"mode":"set","devices":["G090XG0793271TAE"]}},"x":2470,"y":1340,"wires":[[]]},{"id":"617b4039.f2ece8","type":"delay","z":"1f49f273.0f37be","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2440,"y":1400,"wires":[["b82aa3c1.ce846"]]},{"id":"b82aa3c1.ce846","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":""},"volume":{"type":"num","value":"40"},"mode":"set","devices":["G090XG0793271TAE"]}},"x":2690,"y":1400,"wires":[[]]},{"id":"b7c54f2c.fa1368","type":"delay","z":"1f49f273.0f37be","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2560,"y":1300,"wires":[["7cf7584a.c66ee8"]]},{"id":"c1c6bbf5.1b5d88","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speak","payload":{"type":"ssml","text":{"type":"ssml","value":"<speak> <voice name=\"Kendra\"><lang xml:lang=\"en-US\">Normal speech.   <amazon:emotion name=\"excited\" intensity=\"medium\"> I am excited - medium.  </amazon:emotion>  <amazon:emotion name=\"excited\" intensity=\"medium\"> I am excited - medium.  </amazon:emotion>  <amazon:emotion name=\"excited\" intensity=\"low\"> I am excited - low.  </amazon:emotion>  <amazon:emotion name=\"excited\" intensity=\"high\"> I am excited - high.  </amazon:emotion>  Now back to normal speech. </lang></voice></speak>"},"devices":["G090XG0793643C6P"]}},"x":2320,"y":1500,"wires":[[]]},{"id":"861c6bb4.37af9","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2140,"y":1500,"wires":[["c1c6bbf5.1b5d88"]]},{"id":"12bbc229.55e32e","type":"api-current-state","z":"1d7ecdc6.68c842","name":"Corredor escuro?","server":"d63d21ef.5e065","version":1,"outputs":2,"halt_if":"5","halt_if_type":"num","halt_if_compare":"lt","override_topic":false,"entity_id":"sensor.sensor_de_luz_corredor","state_type":"num","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":750,"y":1020,"wires":[["91478376.a78de"],["91478376.a78de"]]},{"id":"fe1845b8.deb198","type":"switch","z":"cbdfe56c.84c388","name":"","property":"ajuda","propertyType":"msg","rules":[{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":2210,"y":480,"wires":[["ab500a8.a695378","9ec049.26e6efb8"],["90b90d98.a1c79"]]},{"id":"5c4a6a77.7db324","type":"comment","z":"ccb6d071.13253","name":"Botão foi clicado","info":"Ligar as luzes se estiverem desligadas\nDesligar as luzes se estiverem ligadas e acima de 50% de brilho\nAumentar o brilho caso estiverem abaixo de 50%","x":260,"y":1200,"wires":[]},{"id":"a2c7068c.e923a8","type":"inject","z":"9639036b.0a3a6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 23 * * 1,2,3,4,0","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":310,"y":1340,"wires":[["d127ae8.c80dd5"]]},{"id":"d4a5fff3.aada1","type":"inject","z":"9639036b.0a3a6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 22 * * 1,2,3,4,0","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":310,"y":1220,"wires":[["5230c6f2.210148"]]},{"id":"1fc43f3f.102f21","type":"inject","z":"9639036b.0a3a6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"30 22 * * 1,2,3,4,0","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":310,"y":1280,"wires":[["2cc81350.302a0c"]]},{"id":"8957d6a6.c61848","type":"inject","z":"9639036b.0a3a6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"30 23 * * 1,2,3,4,0","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":310,"y":1400,"wires":[["6c8fce9b.3edfe"]]},{"id":"a164cfa2.127c1","type":"api-call-service","z":"9639036b.0a3a6","name":"TV Set Volume","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"media_play","entityId":"media_player.tv_da_sala","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":720,"y":1220,"wires":[[]]},{"id":"5230c6f2.210148","type":"function","z":"9639036b.0a3a6","name":"Volume 20","func":"if(global.get(\"horaDoFilme\") === false){\n    var newMsg;\n    newMsg = {payload:{}}\n    newMsg.payload = {\n        \"domain\": \"media_player\",\n        \"service\": \"play_media\",\n        \"data\":{\n          \"entity_id\": \"media_player.tv_da_sala\",\n          \"media_content_type\": \"send_key\",\n          \"media_content_id\": \"ST_VOL20\"\n        }\n    }\n        return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":1220,"wires":[["a164cfa2.127c1"]]},{"id":"2cc81350.302a0c","type":"function","z":"9639036b.0a3a6","name":"Volume 18","func":"if(global.get(\"horaDoFilme\") === false){\n    var newMsg;\n    newMsg = {payload:{}}\n    newMsg.payload = {\n        \"domain\": \"media_player\",\n        \"service\": \"play_media\",\n        \"entity_id\": \"media_player.tv_da_sala\",\n        \"data\":{\n          \"entity_id\": \"media_player.tv_da_sala\",\n          \"media_content_type\": \"send_key\",\n          \"media_content_id\": \"ST_VOL18\"\n        }\n    }\n        return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":1280,"wires":[["a164cfa2.127c1"]]},{"id":"d127ae8.c80dd5","type":"function","z":"9639036b.0a3a6","name":"Volume 16","func":"if(global.get(\"horaDoFilme\") === false){\n    var newMsg;\n    newMsg = {payload:{}}\n    newMsg.payload = {\n        \"domain\": \"media_player\",\n        \"service\": \"play_media\",\n        \"entity_id\": \"media_player.tv_da_sala\",\n        \"data\":{\n          \"entity_id\": \"media_player.tv_da_sala\",\n          \"media_content_type\": \"send_key\",\n          \"media_content_id\": \"ST_VOL16\"\n        }\n    }\n        return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":1340,"wires":[["a164cfa2.127c1"]]},{"id":"6c8fce9b.3edfe","type":"function","z":"9639036b.0a3a6","name":"Volume 14","func":"if(global.get(\"horaDoFilme\") === false){\n    var newMsg;\n    newMsg = {payload:{}}\n    newMsg.payload = {\n        \"domain\": \"media_player\",\n        \"service\": \"play_media\",\n        \"entity_id\": \"media_player.tv_da_sala\",\n        \"data\":{\n          \"entity_id\": \"media_player.tv_da_sala\",\n          \"media_content_type\": \"send_key\",\n          \"media_content_id\": \"ST_VOL14\"\n        }\n    }\n        return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":1400,"wires":[["a164cfa2.127c1"]]},{"id":"89380756.ecb5b8","type":"change","z":"c3bc1a43.254dd","name":"Turn Off","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"On\": false} ","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":1320,"wires":[["50adf190.73852"]]},{"id":"50adf190.73852","type":"link out","z":"c3bc1a43.254dd","name":"TunelOnOff","links":["d42bb3e8.fdb408"],"x":875,"y":1320,"wires":[]},{"id":"d1d23aae.d05e88","type":"api-call-service","z":"c6be7449.1c6ce8","name":"","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"xiaomi_aqara","service":"play_ringtone","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":680,"y":700,"wires":[[]]},{"id":"1ad50483.7369ab","type":"inject","z":"c6be7449.1c6ce8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":680,"wires":[["25c5a007.79336"]]},{"id":"dd93ef9f.d779f","type":"function","z":"c6be7449.1c6ce8","name":"Yeelight modes","func":"\n    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"xiaomi_aqara\",\n        \"service\": \"play_ringtone\",\n        \"data\":{\n            \"gw_mac\": \"44237c81c932\",\n            \"ringtone_id\": 10,\n            \"ringtone_vol\": 30\n\n        }\n    }};\n    return newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":820,"wires":[["ee6502d3.76c22"]]},{"id":"ee6502d3.76c22","type":"api-call-service","z":"c6be7449.1c6ce8","name":"","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"xiaomi_aqara","service":"play_ringtone","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":680,"y":820,"wires":[[]]},{"id":"6cf2e2be.9b397c","type":"inject","z":"c6be7449.1c6ce8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":800,"wires":[["dd93ef9f.d779f"]]},{"id":"ef68b40c.190218","type":"debug","z":"1aa34a9.7045335","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1470,"y":320,"wires":[]},{"id":"1b507b9f.cd04d4","type":"debug","z":"1aa34a9.7045335","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2870,"y":120,"wires":[]},{"id":"8c72052c.5a4de8","type":"change","z":"1aa34a9.7045335","name":"","rules":[{"t":"delete","p":"reset","pt":"msg"},{"t":"delete","p":"came","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2300,"y":240,"wires":[["7e8b7434.348fec"]]},{"id":"8e7f0e9f.dc355","type":"function","z":"1aa34a9.7045335","name":"Reset","func":"if(msg.reset === 1){  \n    return {payload: true};\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2890,"y":320,"wires":[["b0b3d492.9c71a8"]]},{"id":"47164d52.41865c","type":"function","z":"ecc79e8a.d4a1b","name":"was triggered?","func":"if(flow.get(\"triggered1\")===true){\n    flow.set(\"triggered1\", false);\n    var newMsg;\n    if(msg.payload.state.on === true){\n        newMsg = {payload:{state:{bri:msg.payload.state.bri,\n                                  ct: msg.payload.state.ct\n                                  }\n                            },\n                            came: \"Yeelight\"\n        };\n        return newMsg;\n    }\n    if(msg.payload.state.on === false){\n        newMsg = {payload:{resetar: true}};\n        return newMsg;\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1640,"y":260,"wires":[["96a9d03f.5ed93"]]},{"id":"a8071585.a36a6","type":"switch","z":"ecc79e8a.d4a1b","name":"","property":"payload.resetar","propertyType":"msg","rules":[{"t":"istype","v":"undefined","vt":"undefined"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":2150,"y":260,"wires":[["acbae851.ed8808"],["e3bdb4c9.195048"]]},{"id":"62c4486d.399b58","type":"function","z":"ecc79e8a.d4a1b","name":"Reset","func":"if(msg.reset === 1){  \n    return {payload: true};\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3150,"y":320,"wires":[["35bc2bb0.b9c974"]]},{"id":"5a6e8af1.0b7814","type":"debug","z":"1aa34a9.7045335","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1170,"y":720,"wires":[]},{"id":"5868a50e.94e6cc","type":"debug","z":"1d7ecdc6.68c842","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":490,"y":1300,"wires":[]},{"id":"bfd4ce29.d018d8","type":"server-state-changed","z":"9639036b.0a3a6","name":"Sun below horizon","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sun.sun","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"above_horizon","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":260,"y":880,"wires":[["7a2f5278.408f44","9dc878a2.553dd8"],["7a2f5278.408f44","973265ad.bc6fe8"]]},{"id":"48cba549.98678c","type":"function","z":"1f49f273.0f37be","name":"Liga a Fire TV","func":"if(\n        msg.payload.description.summary.includes('liga a t. v. do quarto')===true ||\n        msg.payload.description.summary.includes('liga t. v. do quarto')===true||\n        msg.payload.description.summary.includes('ligue a t. v. do quarto')===true||\n        msg.payload.description.summary.includes('ligue t. v. do quarto')===true||       \n        (msg.payload.name===\"Echo Dot do Quarto\" && ((\n       (msg.payload.description.summary.includes('liga')===true) ||\n       (msg.payload.description.summary.includes('ligue')===true) ) &&\n       msg.payload.description.summary.includes('t.')===true &&\n       msg.payload.description.summary.includes('v.')===true))\n    ){\n        var newMsg;\n        newMsg= {payload : {\n            \"domain\": \"light\",\n            \"service\": \"turn_off\",\n            \"data\":{\n                \"entity_id\": \"light.luz_do_quarto_nedi\"\n            }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":2560,"wires":[["3b9b5459.d8ad8c","885d2e99.e44f","dbec4c35.b8445","11e8c054.32bc18"]]},{"id":"3b9b5459.d8ad8c","type":"api-call-service","z":"1f49f273.0f37be","name":"Luz do Quarto Nédi","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.luz_do_quarto_nedi","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":750,"y":2600,"wires":[[]]},{"id":"6bce07ab.aa0f6","type":"api-call-service","z":"1f49f273.0f37be","name":"Fire TV","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"turn_on","entityId":"media_player.fire_tv","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1100,"y":2700,"wires":[[]]},{"id":"891401bf.c4c5c8","type":"function","z":"1f49f273.0f37be","name":"Turn off Fire TV","func":"if(\n        msg.payload.description.summary.includes('desliga a t. v. do quarto')===true ||\n        msg.payload.description.summary.includes('desliga t. v. do quarto')===true||\n        msg.payload.description.summary.includes('desligue a t. v. do quarto')===true||\n        msg.payload.description.summary.includes('desligue t. v. do quarto')===true||\n       (msg.payload.name===\"Echo Dot do Quarto Nédi\" && ((\n       (msg.payload.description.summary.includes('desliga')===true) ||\n       (msg.payload.description.summary.includes('desligue')===true) ) &&\n       msg.payload.description.summary.includes('t.')===true &&\n       msg.payload.description.summary.includes('v.')===true\n    ))){\n    var newMsg;\n    newMsg= {payload : \n                {\n                    \"domain\": \"media_player\",\n                    \"service\": \"turn_off\",\n                    \"data\":{\n                        \"entity_id\": \"media_player.fire_tv\"\n                    }\n                }\n            };\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":2900,"wires":[["ac97f17e.03064","48442dec.b35e24"]]},{"id":"cfe8eace.27e808","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg= {payload : \n            {\n                \"domain\": \"media_player\",\n                \"service\": \"volume_set\",\n                \"data\":{\n                    \"entity_id\": \"media_player.fire_tv\",\n                    \"volume_level\": 0.6\n                }\n            }\n        };\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":2640,"wires":[["6bce07ab.aa0f6"]]},{"id":"885d2e99.e44f","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":"                                                         "},"volume":{"type":"num","value":"50"},"mode":"set","devices":["G090XG0894430B3V"]}},"x":770,"y":2540,"wires":[[]]},{"id":"70d4c6d1.9b7a8","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg= {payload : \n            {\n                \"domain\": \"media_player\",\n                \"service\": \"select_source\",\n                \"data\":{\n                    \"entity_id\": \"media_player.fire_tv\",\n                    \"source\": 'com.netflix.ninja'\n                }\n            }\n        };\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":2700,"wires":[["6bce07ab.aa0f6"]]},{"id":"6d9c617e.fbd1f","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg= {payload : \n            {\n                \"domain\": \"androidtv\",\n                \"service\": \"adb_command\",\n                \"data\":{\n                    \"entity_id\": \"media_player.fire_tv\",\n                    \"command\": 'MUTE'\n                }\n            }\n        };\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":2760,"wires":[["6bce07ab.aa0f6"]]},{"id":"542885e2.09fe74","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg= {payload : \n            {\n                \"domain\": \"media_player\",\n                \"service\": \"media_pause\",\n                \"data\":{\n                    \"entity_id\": \"media_player.fire_tv\"\n                }\n            }\n        };\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":2960,"wires":[["ac97f17e.03064"]]},{"id":"726076cd.2e8d58","type":"function","z":"1f49f273.0f37be","name":"Já volto / pausa","func":"if(\n    (msg.payload.name===\"Echo Dot do Quarto Nédi\" && \n        (msg.payload.description.summary.includes('já volto')===true || \n        msg.payload.description.summary.includes('pausa')===true || \n        msg.payload.description.summary.includes('pausar')===true\n        ))\n    ){\n        var newMsg;\n        newMsg= {payload : {\n            \"domain\": \"light\",\n            \"service\": \"turn_on\",\n            \"data\":{\n                \"entity_id\": \"light.luz_do_quarto_nedi\",\n                \"brightness\":50\n            }\n            }}; \n    node.send(newMsg);        \n    newMsg= {payload : {\n            \"domain\": \"light\",\n            \"service\": \"turn_on\",\n            \"data\":{\n                \"entity_id\": \"light.luz_do_quarto_nedi\",\n                \"brightness\":50\n            }\n            }};\n    \n    node.send(newMsg);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":2960,"wires":[["542885e2.09fe74","601b4cb0.5f99c4","48442dec.b35e24"]]},{"id":"601b4cb0.5f99c4","type":"api-call-service","z":"1f49f273.0f37be","name":"Luz do Quarto Nédi","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.luz_do_quarto_nedi","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":750,"y":3020,"wires":[[]]},{"id":"d5a0f997.d231f8","type":"debug","z":"1aa34a9.7045335","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1110,"y":400,"wires":[]},{"id":"832afdc8.a5a6c","type":"delay","z":"ecc79e8a.d4a1b","name":"","pauseType":"delay","timeout":"8","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":360,"y":380,"wires":[["b9528d79.a3724"]]},{"id":"9653f406.bfbe98","type":"comment","z":"1aa34a9.7045335","name":"Liga o escritório aos poucos","info":"","x":300,"y":160,"wires":[]},{"id":"a3cb0e2c.c787b","type":"comment","z":"ecc79e8a.d4a1b","name":"Liga a sala aos poucos","info":"","x":260,"y":120,"wires":[]},{"id":"e988da0.6983528","type":"inject","z":"ecc79e8a.d4a1b","name":"Reset","props":[{"p":"reset","v":"1","vt":"str"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":"","topic":"reset","x":610,"y":260,"wires":[["dc27703a.ce8f3"]]},{"id":"f4df226d.b8d61","type":"inject","z":"1aa34a9.7045335","name":"Reset","props":[{"p":"payload"},{"p":"reset","v":"1","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":"","topic":"","payload":"reset","payloadType":"str","x":490,"y":260,"wires":[["447ea5fb.c68a2c"]]},{"id":"51cf4986.06de48","type":"function","z":"c3bc1a43.254dd","name":"Trigger","func":"flow.set(\"triggered\", true);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":770,"y":1500,"wires":[["ddcac793.bcf1a8"]]},{"id":"106e37eb.151f28","type":"function","z":"c3bc1a43.254dd","name":"Was Triggered?","func":"if(flow.set(\"triggered\")===true){\n    flow.set(\"triggered\", false);\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1160,"y":1500,"wires":[["46c4d6fa.ab3648"]]},{"id":"5fa3c4d0.df6cec","type":"function","z":"1f49f273.0f37be","name":"Mute TV","func":"var newMsg;\nif(     (msg.payload.name===\"Echo Dot do Quarto Nédi\" && (\n        msg.payload.description.summary.includes('silêncio')===true||\n        msg.payload.description.summary.includes('silencio')===true||\n        msg.payload.description.summary.includes('silencia')===true||\n        msg.payload.description.summary.includes('silenciar')===true||\n        msg.payload.description.summary.includes('mudo')===true||\n        msg.payload.description.summary.includes('vaca amarela')===true\n    ))){\n    newMsg= {payload : {\n        \"domain\": \"media_player\",\n        \"service\": \"volume_mute\",\n        \"data\":{\n            \"entity_id\": \"media_player.fire_tv\",\n            \"is_volume_muted\": false\n        }\n    }};\n    \n    return newMsg;\n}\n\nif(     (msg.payload.name===\"Echo Dot do Quarto\" && ( \n        msg.payload.description.summary.includes('volta ao normal')===true||\n        msg.payload.description.summary.includes('normal')===true\n    ))){\n    newMsg= {payload : {\n        \"domain\": \"media_player\",\n        \"service\": \"volume_mute\",\n        \"data\":{\n            \"entity_id\": \"media_player.fire_tv\",\n            \"is_volume_muted\": true\n        }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":2840,"wires":[["ac97f17e.03064","48442dec.b35e24"]]},{"id":"ac97f17e.03064","type":"api-call-service","z":"1f49f273.0f37be","name":"Fire TV","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"turn_on","entityId":"media_player.fire_tv","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":900,"y":2900,"wires":[[]]},{"id":"dbec4c35.b8445","type":"delay","z":"1f49f273.0f37be","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":720,"y":2680,"wires":[["cfe8eace.27e808","70d4c6d1.9b7a8","6d9c617e.fbd1f"]]},{"id":"fa6fdbee.d6db88","type":"function","z":"1f49f273.0f37be","name":"Claro","func":"if(     (msg.payload.name===\"Echo Dot da Sala\" && (\n        msg.payload.description.summary.includes('claro')===true\n    ))){\n    var newMsg;\n    newMsg = {payload:{}}\n    newMsg.payload = {\n        \"domain\": \"media_player\",\n        \"service\": \"play_media\",\n        \"entity_id\": \"media_player.tv_da_sala\",\n        \"data\":{\n          \"entity_id\": \"media_player.tv_da_sala\",\n          \"media_content_type\": \"send_key\",\n          \"media_content_id\": \"ST_HDMI1\"\n        }\n    }\n        return newMsg;\n}","outputs":1,"noerr":0,"x":490,"y":2320,"wires":[["3249e2e0.7b002e"]]},{"id":"40b65039.8b4a5","type":"inject","z":"9639036b.0a3a6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 22 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":310,"y":1000,"wires":[["37aee08f.26b15"]]},{"id":"37aee08f.26b15","type":"function","z":"9639036b.0a3a6","name":"Netflix","func":"var newMsg;\nnewMsg= {payload : \n            {\n                \"domain\": \"media_player\",\n                \"service\": \"play_media\",\n                \"data\":{\n                    \"entity_id\": \"media_player.tv_da_sala\",\n                    \"media_content_type\": \"video\",\n                    \"media_content_id\": \"org.tizen.netflix-app\"\n                }\n            }\n        };\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":1000,"wires":[["a164cfa2.127c1"]]},{"id":"4eb0affd.08021","type":"inject","z":"9639036b.0a3a6","name":"","repeat":"","crontab":"00 22 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":310,"y":1060,"wires":[["4479399b.350288"]]},{"id":"4479399b.350288","type":"function","z":"9639036b.0a3a6","name":"Prime Video","func":"var newMsg;\nnewMsg= {payload : \n            {\n                \"domain\": \"media_player\",\n                \"service\": \"play_media\",\n                \"data\":{\n                    \"entity_id\": \"media_player.tv_da_sala\",\n                    \"media_content_type\": \"video\",\n                    \"media_content_id\": \"org.tizen.ignition\"\n                }\n            }\n        };\nreturn newMsg;","outputs":1,"noerr":0,"x":450,"y":1060,"wires":[["a164cfa2.127c1"]]},{"id":"2656545a.19383c","type":"inject","z":"9639036b.0a3a6","name":"","repeat":"","crontab":"00 22 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":310,"y":1120,"wires":[["b3d79ba4.3db758"]]},{"id":"b3d79ba4.3db758","type":"function","z":"9639036b.0a3a6","name":"Spotify","func":"var newMsg;\nnewMsg= {payload : \n            {\n                \"domain\": \"media_player\",\n                \"service\": \"play_media\",\n                \"data\":{\n                    \"entity_id\": \"media_player.tv_da_sala\",\n                    \"media_content_type\": \"video\",\n                    \"media_content_id\": \"3201606009684\"\n                }\n            }\n        };\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":1120,"wires":[["a164cfa2.127c1"]]},{"id":"7f824e0f.310148","type":"api-call-service","z":"1f49f273.0f37be","name":"Lampada","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.lampada","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1420,"y":880,"wires":[[]]},{"id":"865fd848.06d918","type":"function","z":"1f49f273.0f37be","name":"Lampada Off","func":"var newMsg;\nnewMsg= {payload : {\n    \"domain\": \"switch\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"switch.lampada\"\n    }\n}};\n\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1182,"y":880,"wires":[["7f824e0f.310148"]]},{"id":"f1141369.1a20d8","type":"hb-control","z":"ecc79e8a.d4a1b","name":"Luz da TV","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeLuz da TV00000043","conf":"40e0a266.1beb0c","x":2291,"y":660,"wires":[]},{"id":"c7cd3e84.2a036","type":"change","z":"ecc79e8a.d4a1b","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":3570,"y":320,"wires":[["dc27703a.ce8f3"]]},{"id":"35bc2bb0.b9c974","type":"delay","z":"ecc79e8a.d4a1b","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"20","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":3350,"y":320,"wires":[["c7cd3e84.2a036"]]},{"id":"9f2b9863.e2b47","type":"delay","z":"cbdfe56c.84c388","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2890,"y":560,"wires":[["b157a009.f05ad"]]},{"id":"b157a009.f05ad","type":"function","z":"cbdfe56c.84c388","name":"Turn Off","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nif(Hour > 18){\n    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_off\",\n        data:{\n            \"entity_id\": \"light.aqara_hub\",\n        }\n    }};\n    \n    return newMsg;\n} ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3100,"y":560,"wires":[["8e8dfee8.a2f7d"]]},{"id":"f9d60e0d.86a74","type":"alexa-remote-list","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","config":{"option":"getListItems","value":{"list":{"type":"str","value":"YW16bjEuYWNjb3VudC5BSEZOR1FIUlgyQ1U0RzZSTERSQ01IT1NQV0lBLVNIT1BQSU5HX0lURU0="}}},"x":440,"y":4180,"wires":[["12b4e88b.da9d17","7432223.eb861dc"]]},{"id":"3e4f9320.f7f3f4","type":"debug","z":"1f49f273.0f37be","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1090,"y":4380,"wires":[]},{"id":"1e4925e3.8272fa","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg = {};\nglobal.set(\"HA-ShoppingList-old\", msg.payload);\nvar shoppingListHA = msg.payload;\nvar shoppingListAlexa = global.get(\"Alexa-ShoppingList-aux\");\nvar adicionarFlag = 0;\nfor(var i = 0; i < shoppingListAlexa.length; i++){\n    if(shoppingListAlexa[i].completed === false){\n        for(var j = 0; j < shoppingListHA.length; j++){\n            if(shoppingListHA[j].name.toLowerCase() === shoppingListAlexa[i].value.toLowerCase()){\n                adicionarFlag = 1\n            }\n        }\n        if(adicionarFlag === 0){\n                newMsg = {payload : \n                    {\n                    \"domain\": \"shopping_list\",\n                    \"service\": \"add_item\",\n                    \"data\":{\n                        \"name\": shoppingListAlexa[i].value.charAt(0).toUpperCase() + shoppingListAlexa[i].value.slice(1)\n                        }\n                    }\n                }\n                node.send(newMsg);\n        }\n        adicionarFlag = 0;\n    }\n    else{\n        \n        for(var j = 0; j < shoppingListHA.length; j++){\n            if(shoppingListHA[j].name.toLowerCase() === shoppingListAlexa[i].value.toLowerCase()){\n                if(shoppingListHA[j].complete === false){\n                    newMsg = {payload : \n                        {\n                        \"domain\": \"shopping_list\",\n                        \"service\": \"complete_item\",\n                        \"data\":{\n                            \"name\": shoppingListHA[j].name\n                            }\n                        }\n                    }\n                    node.send(newMsg);\n                }\n            }\n        }\n    }\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1270,"y":4180,"wires":[["d4a0b996.5c8ba8"]]},{"id":"3b9d5245.f43f9e","type":"function","z":"1f49f273.0f37be","name":"Apple TV On","func":"if(msg.payload.description.summary.includes('apple')===true &&\n   msg.payload.description.summary.includes(\"sai da apple\") === false    \n    ){\n    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"media_player\",\n        \"service\": \"turn_on\",\n        \"data\":{\n            \"entity_id\": \"media_player.apple_tv\"\n        }\n    }};\n    node.send(newMsg);\n    \n    newMsg = {payload:{}}\n    newMsg.payload = {\n        \"domain\": \"media_player\",\n        \"service\": \"play_media\",\n        \"entity_id\": \"media_player.tv_da_sala\",\n        \"data\":{\n          \"entity_id\": \"media_player.tv_da_sala\",\n          \"media_content_type\": \"send_key\",\n          \"media_content_id\": \"ST_HDMI2\"\n        }\n    }\n    node.send(newMsg);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":1160,"wires":[["91233706.969d48","74ef912b.9eeb3"]]},{"id":"91233706.969d48","type":"api-call-service","z":"1f49f273.0f37be","name":"Apple TV","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"media_player.apple_tv","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":720,"y":1180,"wires":[[]]},{"id":"ee4a97cb.8eefb8","type":"api-call-service","z":"1f49f273.0f37be","name":"Shopping List","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"","service":"","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1660,"y":4180,"wires":[[]]},{"id":"f5a6bae8.cdb5e8","type":"comment","z":"1f49f273.0f37be","name":"Sincronizar a Lista Alexa com HA","info":"","x":410,"y":4140,"wires":[]},{"id":"9dc878a2.553dd8","type":"debug","z":"9639036b.0a3a6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":420,"y":820,"wires":[]},{"id":"973265ad.bc6fe8","type":"debug","z":"9639036b.0a3a6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":440,"y":920,"wires":[]},{"id":"c6a2742b.c72ca8","type":"alexa-remote-other","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","config":{"option":"addListItem","value":{"list":{"type":"str","value":"SHOPPING_ITEM"},"text":{"type":"msg","value":"item"}}},"x":2010,"y":4280,"wires":[["24840626.6e827a"]]},{"id":"7098916b.0ee3","type":"ha-api","z":"1f49f273.0f37be","name":"","server":"d63d21ef.5e065","debugenabled":false,"protocol":"websocket","method":"get","path":"","data":"{\"type\": \"shopping_list/items\"}","dataType":"json","location":"payload","locationType":"msg","responseType":"json","x":790,"y":4300,"wires":[["1f43818d.c77d2e","96eaba5e.a67ed8"]]},{"id":"52e06b44.f40ae4","type":"function","z":"1f49f273.0f37be","name":"","func":"global.set(\"HA-ShoppingList-aux\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":1090,"y":4300,"wires":[["4ab5e843.52ce98"]]},{"id":"689d131d.ab9bac","type":"inject","z":"1f49f273.0f37be","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"*/30 7-22 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":290,"y":4180,"wires":[["f9d60e0d.86a74"]]},{"id":"307f6151.cd7f9e","type":"server-events","z":"1f49f273.0f37be","name":"Novo item","server":"d63d21ef.5e065","event_type":"shopping_list_updated","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"x":340,"y":4380,"wires":[["6c4763b5.d99a1c","ffcd95f2.76f178"]]},{"id":"1f43818d.c77d2e","type":"delay","z":"1f49f273.0f37be","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":950,"y":4380,"wires":[["3e4f9320.f7f3f4"]]},{"id":"96eaba5e.a67ed8","type":"delay","z":"1f49f273.0f37be","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":950,"y":4300,"wires":[["52e06b44.f40ae4"]]},{"id":"6c4763b5.d99a1c","type":"delay","z":"1f49f273.0f37be","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":490,"y":4340,"wires":[["e2d51bae.70cdf8"]]},{"id":"464e855d.25e82c","type":"function","z":"1f49f273.0f37be","name":"","func":"var shoppingListHA = global.get(\"HA-ShoppingList-aux\");\nvar shoppingListAlexa = msg.payload;\nvar newMsg;\nvar noNewItem = true;\nvar newItemPosition = [];\nvar i;\nfor(i = 0; i< shoppingListHA.length; i++){\n    for(var j = 0; j <shoppingListAlexa.length; j++){\n            if(\n                    shoppingListHA[i].name.toLowerCase() === shoppingListAlexa[j].value.toLowerCase()\n                ){\n                    \n                if(\n                    shoppingListHA[i].complete === true && \n                    shoppingListAlexa[j].completed === false\n                    ){\n                        newMsg = {payload:{\n                                  id: shoppingListAlexa[j].id,\n                                  item: shoppingListAlexa[j].value,\n                                  list: \"YW16bjEuYWNjb3VudC5BSEZOR1FIUlgyQ1U0RzZSTERSQ01IT1NQV0lBLVNIT1BQSU5HX0lURU0=\"\n                                },\n                                  id: shoppingListAlexa[j].id,\n                                  item: shoppingListAlexa[j].value,\n                                  list: \"YW16bjEuYWNjb3VudC5BSEZOR1FIUlgyQ1U0RzZSTERSQ01IT1NQV0lBLVNIT1BQSU5HX0lURU0=\",\n                                ajuda: true\n                        };\n                        node.send(newMsg);\n                    }\n                noNewItem = false;\n            }\n        }\n        if(noNewItem === true && shoppingListHA[i].complete === false){\n            newItemPosition.push(i);\n        }\n        noNewItem = true;\n}\nif(newItemPosition.length > 0){\n    for(i=0; i< newItemPosition.length; i++){\n        if(shoppingListHA[newItemPosition[i]].complete === false){\n            newMsg = {payload:{item: shoppingListHA[newItemPosition[i]].name, \n                      list: \"YW16bjEuYWNjb3VudC5BSEZOR1FIUlgyQ1U0RzZSTERSQ01IT1NQV0lBLVNIT1BQSU5HX0lURU0=\",\n                      ajuda: false}};\n            node.send(newMsg);\n        }\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1450,"y":4300,"wires":[["d9c4aeaf.4b0b9"]]},{"id":"ffcd95f2.76f178","type":"debug","z":"1f49f273.0f37be","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":530,"y":4400,"wires":[]},{"id":"e2d51bae.70cdf8","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg = {payload: true};\nreturn newMsg;","outputs":1,"noerr":0,"x":650,"y":4340,"wires":[["7098916b.0ee3"]]},{"id":"f79561ad.c14b7","type":"function","z":"1f49f273.0f37be","name":"Desliga o escritório","func":"if(\n    (msg.payload.description.summary.includes('desliga')===true || \n    msg.payload.description.summary.includes('desligue')===true) &&\n    (msg.payload.description.summary.includes('escritório')===true|| \n    msg.payload.description.summary.includes('escritorio')===true)\n        \n    ){\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"mqtt\",\n    \"service\": \"publish\",\n    data:{\n\n        \"topic\": \"iotlink/workgroup/soft-pc/commands/shutdown\",\n        \"payload\": \"\"\n    }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":280,"wires":[["24ae9286.3aea5e"]]},{"id":"24840626.6e827a","type":"debug","z":"1f49f273.0f37be","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2170,"y":4240,"wires":[]},{"id":"c031b7d5.c392f8","type":"ha-api","z":"1f49f273.0f37be","name":"","server":"d63d21ef.5e065","debugenabled":false,"protocol":"websocket","method":"get","path":"","data":"{\"type\": \"shopping_list/items\"}","dataType":"json","location":"payload","locationType":"msg","responseType":"json","x":930,"y":4180,"wires":[["f88228cd.6938f8","d9294359.c0af3"]]},{"id":"eef20ff2.90bb1","type":"alexa-remote-list","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","config":{"option":"removeItem","value":{"list":{"type":"str","value":"YW16bjEuYWNjb3VudC5BSEZOR1FIUlgyQ1U0RzZSTERSQ01IT1NQV0lBLVNIT1BQSU5HX0lURU0="},"item":{"type":"msg","value":"id"}}},"x":1990,"y":4340,"wires":[["62637f50.667d6"]]},{"id":"12b4e88b.da9d17","type":"debug","z":"1f49f273.0f37be","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":610,"y":4240,"wires":[]},{"id":"4ab5e843.52ce98","type":"alexa-remote-list","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","config":{"option":"getListItems","value":{"list":{"type":"str","value":"YW16bjEuYWNjb3VudC5BSEZOR1FIUlgyQ1U0RzZSTERSQ01IT1NQV0lBLVNIT1BQSU5HX0lURU0="}}},"x":1260,"y":4300,"wires":[["464e855d.25e82c","999851c5.ef851"]]},{"id":"728816.e7d6a7ec","type":"ha-api","z":"c6be7449.1c6ce8","name":"","server":"d63d21ef.5e065","debugenabled":false,"protocol":"websocket","method":"get","path":"","data":"{\"type\": \"shopping_list/items\"}","dataType":"json","location":"payload","locationType":"msg","responseType":"json","x":1390,"y":340,"wires":[["51a62e68.5e8bf"]]},{"id":"51a62e68.5e8bf","type":"function","z":"c6be7449.1c6ce8","name":"","func":"global.set(\"HA-ShoppingList-old\", msg.payload);\nvar newMsg;\nnewMsg = {payload: true};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1580,"y":340,"wires":[[]]},{"id":"7432223.eb861dc","type":"function","z":"1f49f273.0f37be","name":"","func":"global.set(\"Alexa-ShoppingList-aux\", msg.payload);\nvar newMsg;\nnewMsg = {payload: true};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":4180,"wires":[["4ee894c6.453ecc","a1e14347.244a3"]]},{"id":"d4a0b996.5c8ba8","type":"delay","z":"1f49f273.0f37be","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1450,"y":4180,"wires":[["ee4a97cb.8eefb8","b066ff8d.5a8cd"]]},{"id":"f88228cd.6938f8","type":"delay","z":"1f49f273.0f37be","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1090,"y":4180,"wires":[["1e4925e3.8272fa"]]},{"id":"4ee894c6.453ecc","type":"delay","z":"1f49f273.0f37be","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":770,"y":4180,"wires":[["c031b7d5.c392f8"]]},{"id":"8e8db665.eb07e8","type":"switch","z":"1f49f273.0f37be","name":"","property":"ajuda","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":1790,"y":4300,"wires":[["c6a2742b.c72ca8"],["eef20ff2.90bb1"]]},{"id":"62637f50.667d6","type":"debug","z":"1f49f273.0f37be","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2170,"y":4380,"wires":[]},{"id":"d9c4aeaf.4b0b9","type":"delay","z":"1f49f273.0f37be","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1610,"y":4300,"wires":[["8e8db665.eb07e8","468e8af5.99d754"]]},{"id":"468e8af5.99d754","type":"debug","z":"1f49f273.0f37be","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1750,"y":4240,"wires":[]},{"id":"b066ff8d.5a8cd","type":"debug","z":"1f49f273.0f37be","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1630,"y":4120,"wires":[]},{"id":"999851c5.ef851","type":"debug","z":"1f49f273.0f37be","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1410,"y":4240,"wires":[]},{"id":"8db24f4b.97e3b","type":"alexa-remote-list","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","config":{"option":"getListItems","value":{"list":{"type":"str","value":"YW16bjEuYWNjb3VudC5BSEZOR1FIUlgyQ1U0RzZSTERSQ01IT1NQV0lBLVNIT1BQSU5HX0lURU0="}}},"x":1600,"y":4380,"wires":[["f81c4283.f37bb","417d7a2e.f0a0d4"]]},{"id":"417d7a2e.f0a0d4","type":"function","z":"1f49f273.0f37be","name":"","func":"var shoppingListHA = global.get(\"HA-ShoppingList-aux\");\nvar shoppingListAlexa = msg.payload;\nvar newMsg;\nvar noNewItem = true;\nvar newItemPosition = [];\nvar i;\n    for(var j = 0; j <shoppingListAlexa.length; j++){\n        if(shoppingListAlexa[j].completed === true){\n                        newMsg = {payload:{\n                                  id: shoppingListAlexa[j].id,\n                                  item: shoppingListAlexa[j].value,\n                                  list: \"YW16bjEuYWNjb3VudC5BSEZOR1FIUlgyQ1U0RzZSTERSQ01IT1NQV0lBLVNIT1BQSU5HX0lURU0=\"\n                                },\n                                  id: shoppingListAlexa[j].id,\n                                  item: shoppingListAlexa[j].value,\n                                  list: \"YW16bjEuYWNjb3VudC5BSEZOR1FIUlgyQ1U0RzZSTERSQ01IT1NQV0lBLVNIT1BQSU5HX0lURU0=\",\n                                ajuda: true\n                        };\n                        node.send(newMsg);\n        }\n    }","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1790,"y":4380,"wires":[["eef20ff2.90bb1"]]},{"id":"ad75bcc3.c869e","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"432000","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1410,"y":4380,"wires":[["8db24f4b.97e3b"]]},{"id":"f81c4283.f37bb","type":"debug","z":"1f49f273.0f37be","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1770,"y":4440,"wires":[]},{"id":"74c616d4.d076e8","type":"function","z":"1d7ecdc6.68c842","name":"Turn On","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nif(Hour < 7 && Hour < 18)\n{\n    msg.payload =\n    {\"On\":true,     \n        \"Hue\" : 301,\n        \"Saturation\" : 2,\n        \"Brightness\" : 255\n    };\n\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":920,"wires":[["f3df6e14.9083b","4d1da38b.0e63cc"]]},{"id":"f3df6e14.9083b","type":"hb-control","z":"1d7ecdc6.68c842","name":"Fita da Cozinha","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita da Cozinha00000043","conf":"40e0a266.1beb0c","x":1300,"y":920,"wires":[]},{"id":"4d1da38b.0e63cc","type":"delay","z":"1d7ecdc6.68c842","name":"","pauseType":"delay","timeout":"20","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":970,"y":960,"wires":[["31bc51c6.0a6dce"]]},{"id":"31bc51c6.0a6dce","type":"function","z":"1d7ecdc6.68c842","name":"Turn Off","func":"msg.payload =\n{\"On\":false};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1120,"y":960,"wires":[["f3df6e14.9083b"]]},{"id":"2a184fa3.9e988","type":"api-call-service","z":"ecc79e8a.d4a1b","name":"TV da Sala","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"turn_off","entityId":"media_player.tv_da_sala","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2491,"y":720,"wires":[[]]},{"id":"7c08d9e2.100078","type":"function","z":"ecc79e8a.d4a1b","name":"TV da Sala Off","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"media_player\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"media_player.tv_da_sala\"\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"x":2301,"y":720,"wires":[["2a184fa3.9e988"]]},{"id":"290f3555.4dc2e2","type":"function","z":"ecc79e8a.d4a1b","name":"Luz da Sala Off","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"light.luz_da_sala\"\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2300,"y":780,"wires":[["d4eddeb9.da03f"]]},{"id":"d4eddeb9.da03f","type":"api-call-service","z":"ecc79e8a.d4a1b","name":"Luz da Sala","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"","entityId":"light.luz_da_sala","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2490,"y":800,"wires":[[]]},{"id":"43154595.1348ec","type":"function","z":"1aa34a9.7045335","name":"Luz do Escritorio Off","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"light.luz_do_escritorio\"\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2400,"y":920,"wires":[["e75b91a0.a0328"]]},{"id":"e75b91a0.a0328","type":"api-call-service","z":"1aa34a9.7045335","name":"Luz do Escritório On","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.luz_do_escritorio","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2660,"y":920,"wires":[[]]},{"id":"7b5bcce7.bd7f14","type":"function","z":"1f49f273.0f37be","name":"Boa noite Sala","func":"if(\n    msg.payload.name===\"Echo Dot da Sala\" &&(\n    msg.payload.description.summary.includes('boa noite')===true || \n    msg.payload.description.summary.includes('vou dormir')===true\n    )){\n    \n    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"media_player\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"media_player.apple_tv\"\n        }\n    }};\n    node.send(newMsg);\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"light.luz_da_sala\"\n        }\n    }};\n    node.send(newMsg);\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"light.luz_do_escritorio\"\n        }\n    }};\n    node.send(newMsg);\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"light.fita_do_escritorio\"\n        }\n    }};\n    node.send(newMsg);\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"light.luz_da_tv\"\n        }\n    }};\n    node.send(newMsg);\n    newMsg= {payload : {\n        \"domain\": \"media_player\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"media_player.tv_da_sala\"\n        }\n    }};\n    node.send(newMsg);\n    newMsg= {payload : {\n        \"domain\": \"switch\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"switch.tunel\"\n        }\n    }};\n    node.send(newMsg);\n    newMsg= {payload : {\n        \"domain\": \"switch\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"switch.abajur\"\n        }\n    }};\n    node.send(newMsg);\n    newMsg= {payload : {\n        \"domain\": \"switch\",\n        \"service\": \"turn_off\",\n        \"data\":{\n        \"entity_id\": \"switch.sonoff_1000de2b76\"\n        }\n    }};\n    node.send(newMsg);\n    \n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1400,"wires":[["a2caaf7c.629d6","87832d73.f7ad1","51b6c32a.d5521c"]]},{"id":"a6313ad0.8640c8","type":"api-call-service","z":"1f49f273.0f37be","name":"Sala","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"turn_off","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1010,"y":1380,"wires":[[]]},{"id":"c81b50f5.7e9a5","type":"function","z":"1f49f273.0f37be","name":"Boa noite Quarto","func":"if(\n    msg.payload.name===\"Echo Dot do Quarto Nédi\" &&(\n    msg.payload.description.summary.includes('boa noite')===true ||\n    msg.payload.description.summary.includes('vou dormir')===true\n    )){\n    \n    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"media_player\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"media_player.fire_tv\"\n        }\n    }};\n    node.send(newMsg);\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"light.luz_do_quarto_nedi\"\n        }\n    }};\n    node.send(newMsg);\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"light.rgb_strip\"\n        }\n    }};\n    node.send(newMsg);\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"light.fita_do_quarto\"\n        }\n    }};\n    node.send(newMsg);\n    newMsg= {payload : {\n        \"domain\": \"switch\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"switch.flor\"\n        }\n    }};\n    node.send(newMsg);\n    newMsg= {payload : {\n        \"domain\": \"media_player\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"switch.tomada_tv_quarto\"\n        }\n    }};\n    node.send(newMsg);\n    newMsg= {payload : {\n        \"domain\": \"switch\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"switch.lampada\"\n        }\n    }};\n    \n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":1280,"wires":[["873b269b.e992f8","280ae7c2.0539e8"]]},{"id":"e24ea90e.fd212","type":"api-call-service","z":"1f49f273.0f37be","name":"Quarto","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"turn_off","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":930,"y":1260,"wires":[[]]},{"id":"873b269b.e992f8","type":"function","z":"1f49f273.0f37be","name":"Vou dormir","func":"var newMsg;\nnewMsg = {payload : {\"On\":true}};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":730,"y":1320,"wires":[["7efa07a4.fe5de8"]]},{"id":"7efa07a4.fe5de8","type":"link out","z":"1f49f273.0f37be","name":"Vou dormir alexa","links":["e08f909b.252238"],"x":855,"y":1320,"wires":[]},{"id":"c3b6c1c0.6b977","type":"function","z":"1f49f273.0f37be","name":"Faz o café","func":"if(\n    msg.payload.name===\"Echo Dot da Cozinha\" &&(\n    msg.payload.description.summary.includes('café')===true && (\n    msg.payload.description.summary.includes('faça')===true  || \n    msg.payload.description.summary.includes('faz')===true\n\n    ))){\n    global.set(\"alexaCafeAux\", true);\n    var newMsg;\n    newMsg= {payload : {\"On\":true }};\n    node.send(newMsg);\n    \n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":1540,"wires":[["7168b9a6.d1a2e8","83cf498e.cca668","c394c9d6.df16e8"]]},{"id":"3249e2e0.7b002e","type":"delay","z":"1f49f273.0f37be","name":"","pauseType":"rate","timeout":"0.5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":740,"y":2140,"wires":[["d3676c7d.31b83","b75d1c8c.ec37e"]]},{"id":"280ae7c2.0539e8","type":"delay","z":"1f49f273.0f37be","name":"","pauseType":"rate","timeout":"0.5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"0.05","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":750,"y":1260,"wires":[["e24ea90e.fd212"]]},{"id":"74ef912b.9eeb3","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":"                                                                      "},"volume":{"type":"num","value":"30"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":770,"y":1120,"wires":[[]]},{"id":"61d1ae3a.704c3","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":"                                                                      "},"volume":{"type":"num","value":"30"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":750,"y":1960,"wires":[[]]},{"id":"2d28197c.7845c6","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":"                                                                      "},"volume":{"type":"num","value":"30"},"mode":"set","devices":["G090XG0894430B3V"]}},"x":750,"y":780,"wires":[[]]},{"id":"87832d73.f7ad1","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":"                                                                      "},"volume":{"type":"num","value":"30"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":770,"y":1480,"wires":[[]]},{"id":"a2caaf7c.629d6","type":"delay","z":"1f49f273.0f37be","name":"","pauseType":"rate","timeout":"0.5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"0.05","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":870,"y":1380,"wires":[["a6313ad0.8640c8"]]},{"id":"56c949e4.3beea8","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":"                                                                      "},"volume":{"type":"num","value":"30"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":1170,"y":2080,"wires":[[]]},{"id":"48442dec.b35e24","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":"                                                                      "},"volume":{"type":"num","value":"30"},"mode":"set","devices":["G090XG0894430B3V"]}},"x":850,"y":2840,"wires":[[]]},{"id":"7168b9a6.d1a2e8","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":"O café está sendo preparado"},"volume":{"type":"num","value":"30"},"mode":"set","devices":["G090XG0793271TAE"]}},"x":810,"y":1540,"wires":[[]]},{"id":"7e21169a.d2cde8","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":"                                                                      "},"volume":{"type":"num","value":"30"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":810,"y":980,"wires":[[]]},{"id":"d5ea4f5c.04171","type":"api-call-service","z":"1f49f273.0f37be","name":"Alexa fala Olá pelo HA","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"{{payload}}\",\"data\":{\"type\":\"announce\"},\"target\":\"{{target}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3300,"y":1480,"wires":[[]]},{"id":"b9e44feb.102f6","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg= { \"payload\": \"Olá\", \"data\": { \"type\": \"tts\" }, \"target\": \"alexa_media_echo_dot_da_sala\" };\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3090,"y":1480,"wires":[["d5ea4f5c.04171"]]},{"id":"64e35012.75e9c","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2940,"y":1480,"wires":[["b9e44feb.102f6"]]},{"id":"e53ea082.d7249","type":"api-call-service","z":"c6be7449.1c6ce8","name":"Alexa fala Olá pelo HA","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media_echo_dot_da_sala","entityId":"","data":"{ \"message\": \"{{payload}}\", \"data\": { \"type\": \"tts\" }, \"target\": \"{{service}}\" }","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":540,"y":960,"wires":[[]]},{"id":"4c2dbf33.f08ff","type":"function","z":"c6be7449.1c6ce8","name":"","func":"var newMsg;\nnewMsg= { \"payload\": \"Olá\", \"data\": { \"type\": \"tts\" }, \"target\": \"alexa_media_echo_dot_da_sala\" };\nreturn newMsg;","outputs":1,"noerr":0,"x":340,"y":960,"wires":[["e53ea082.d7249"]]},{"id":"8f7d944.c02cf68","type":"inject","z":"c6be7449.1c6ce8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":960,"wires":[["4c2dbf33.f08ff"]]},{"id":"79cd8b3b.693894","type":"api-call-service","z":"c6be7449.1c6ce8","name":"Alexa anuncia Olá pelo HA","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media_echo_dot_da_sala","entityId":"","data":"{ \"message\": \"{{payload}}\", \"data\": { \"type\": \"announce\" }, \"target\": \"{{service}}\" }","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":560,"y":1020,"wires":[[]]},{"id":"853e2702.7346e8","type":"function","z":"c6be7449.1c6ce8","name":"","func":"var newMsg;\nnewMsg= { \"payload\": \"Olá\", \"data\": { \"type\": \"tts\" }, \"target\": \"alexa_media_echo_dot_da_sala\" };\nreturn newMsg;","outputs":1,"noerr":0,"x":340,"y":1020,"wires":[["79cd8b3b.693894"]]},{"id":"4614ff2.20d9d","type":"inject","z":"c6be7449.1c6ce8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":1020,"wires":[["853e2702.7346e8"]]},{"id":"5ded8101.3babb","type":"api-call-service","z":"c6be7449.1c6ce8","name":"Alexa anuncia Olá pelo HA","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media_echo_dot_da_sala","entityId":"","data":"{ \"message\": \"{{payload}}\", \"data\": { \"type\": \"announce\", \"method\":\"speak\" }, \"target\": \"{{service}}\" }","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":560,"y":1080,"wires":[[]]},{"id":"1ac1e012.72d13","type":"function","z":"c6be7449.1c6ce8","name":"","func":"var newMsg;\nnewMsg= {\n\"payload\":\"<amazon:effect name='whispered'>I am whispering this.</amazon:effect>\",\n\"data\":{\"type\":\"announce\", \"method\":\"speak\"},\n\"target\":[\"Guest Room\", \"media_player.kitchen\", \"serialNumber\"]\n};\nreturn newMsg;","outputs":1,"noerr":0,"x":340,"y":1080,"wires":[["5ded8101.3babb"]]},{"id":"bdc41bf6.12eec8","type":"inject","z":"c6be7449.1c6ce8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":1080,"wires":[["1ac1e012.72d13"]]},{"id":"176e5527.341fbb","type":"api-call-service","z":"1f49f273.0f37be","name":"Alexa toca campainha 1","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3310,"y":680,"wires":[[]]},{"id":"b9d57bb5.cc7f68","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg= {payload:{\n  \"domain\": \"media_player\",\n  \"service\": \"play_media\",\n   \"entity_id\": \"media_player.echo_dot_da_sala\",\n  \"data\":{\n      \"entity_id\": \"media_player.echo_dot_da_sala\",\n      \"media_content_id\": \"amzn_sfx_doorbell_01\",\n      \"media_content_type\": \"sound\"\n  }}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3090,"y":680,"wires":[["176e5527.341fbb"]]},{"id":"58cdc3ed.94a64c","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2940,"y":680,"wires":[["b9d57bb5.cc7f68"]]},{"id":"e6de100f.a6d38","type":"api-call-service","z":"1f49f273.0f37be","name":"Alexa toca campainha 2","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3310,"y":740,"wires":[[]]},{"id":"d56a98d7.1cbd68","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg= {payload:{\n  \"domain\": \"media_player\",\n  \"service\": \"play_media\",\n   \"entity_id\": \"media_player.echo_dot_da_sala\",\n  \"data\":{\n      \"entity_id\": \"media_player.echo_dot_da_sala\",\n      \"media_content_id\": \"amzn_sfx_doorbell_chime_01\",\n      \"media_content_type\": \"sound\"\n  }}\n};\nreturn newMsg;","outputs":1,"noerr":0,"x":3090,"y":740,"wires":[["e6de100f.a6d38"]]},{"id":"8cf0837e.fb341","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2940,"y":740,"wires":[["d56a98d7.1cbd68"]]},{"id":"206ef0f4.c9207","type":"api-call-service","z":"1f49f273.0f37be","name":"Alexa toca campainha 3","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3310,"y":800,"wires":[[]]},{"id":"f5225cb3.83d09","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg= {payload:{\n  \"domain\": \"media_player\",\n  \"service\": \"play_media\",\n   \"entity_id\": \"media_player.echo_dot_do_quarto_nedi\",\n  \"data\":{\n      \"entity_id\": \"media_player.echo_dot_do_quarto_nedi\",\n      \"media_content_id\": \"amzn_sfx_doorbell_chime_02\",\n      \"media_content_type\": \"sound\"\n  }}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3090,"y":800,"wires":[["206ef0f4.c9207"]]},{"id":"62a4c570.6d629c","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2940,"y":800,"wires":[["f5225cb3.83d09"]]},{"id":"496a31be.905d4","type":"api-call-service","z":"1f49f273.0f37be","name":"Alexa som de natal","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3290,"y":860,"wires":[[]]},{"id":"40948ed7.744b5","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg= {payload:{\n  \"domain\": \"media_player\",\n  \"service\": \"play_media\",\n   \"entity_id\": \"media_player.echo_dot_da_sala\",\n  \"data\":{\n      \"entity_id\": \"media_player.echo_dot_da_sala\",\n      \"media_content_id\": \"christmas_05\",\n      \"media_content_type\": \"sound\"\n  }}\n};\nreturn newMsg;","outputs":1,"noerr":0,"x":3090,"y":860,"wires":[["496a31be.905d4"]]},{"id":"81b30711.19c618","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2940,"y":860,"wires":[["40948ed7.744b5"]]},{"id":"e82c7a0.3bdb088","type":"api-call-service","z":"1f49f273.0f37be","name":"Alexa barulho de terror","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3300,"y":920,"wires":[[]]},{"id":"d5e648b5.d9b8f8","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg= {payload:{\n  \"domain\": \"media_player\",\n  \"service\": \"play_media\",\n   \"entity_id\": \"media_player.echo_dot_da_sala\",\n  \"data\":{\n      \"entity_id\": \"media_player.echo_dot_da_sala\",\n      \"media_content_id\": \"horror_10\",\n      \"media_content_type\": \"sound\"\n  }}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3090,"y":920,"wires":[["e82c7a0.3bdb088"]]},{"id":"1e98618c.da6dde","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2940,"y":920,"wires":[["d5e648b5.d9b8f8"]]},{"id":"9f62d86.06cbd28","type":"api-call-service","z":"1f49f273.0f37be","name":"Alexa cheer","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3270,"y":980,"wires":[[]]},{"id":"76ffcec3.ac132","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg= {payload:{\n  \"domain\": \"media_player\",\n  \"service\": \"play_media\",\n   \"entity_id\": \"media_player.echo_dot_da_sala\",\n  \"data\":{\n      \"entity_id\": \"media_player.echo_dot_da_sala\",\n      \"media_content_id\": \"amzn_sfx_large_crowd_cheer_01\",\n      \"media_content_type\": \"sound\"\n  }}\n};\nreturn newMsg;","outputs":1,"noerr":0,"x":3090,"y":980,"wires":[["9f62d86.06cbd28"]]},{"id":"2d6a3aa5.9a62b6","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2940,"y":980,"wires":[["76ffcec3.ac132"]]},{"id":"69381865.f24b68","type":"api-call-service","z":"1f49f273.0f37be","name":"Alexa barulho de zap","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3300,"y":1040,"wires":[[]]},{"id":"3d7ed8f3.1c3128","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg= {payload:{\n  \"domain\": \"media_player\",\n  \"service\": \"play_media\",\n   \"entity_id\": \"media_player.echo_dot_da_sala\",\n  \"data\":{\n      \"entity_id\": \"media_player.echo_dot_da_sala\",\n      \"media_content_id\": \"zap_01\",\n      \"media_content_type\": \"sound\"\n  }}\n};\nreturn newMsg;","outputs":1,"noerr":0,"x":3090,"y":1040,"wires":[["69381865.f24b68"]]},{"id":"22d46ad.d52ad96","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2940,"y":1040,"wires":[["3d7ed8f3.1c3128"]]},{"id":"5d6e20c5.1dd44","type":"api-call-service","z":"1f49f273.0f37be","name":"Alexa barulho de relogio","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3310,"y":1100,"wires":[[]]},{"id":"e4623776.5e9b18","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg= {payload:{\n  \"domain\": \"media_player\",\n  \"service\": \"play_media\",\n   \"entity_id\": \"media_player.echo_dot_da_sala\",\n  \"data\":{\n      \"entity_id\": \"media_player.echo_dot_da_sala\",\n      \"media_content_id\": \"clock_01\",\n      \"media_content_type\": \"sound\"\n  }}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3090,"y":1100,"wires":[["5d6e20c5.1dd44"]]},{"id":"25ab513a.28890e","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2940,"y":1100,"wires":[["e4623776.5e9b18"]]},{"id":"91ab60a1.3320a","type":"api-call-service","z":"1f49f273.0f37be","name":"Alexa barulho de galo","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3300,"y":1160,"wires":[[]]},{"id":"c16c94eb.189208","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg= {payload:{\n  \"domain\": \"media_player\",\n  \"service\": \"play_media\",\n   \"entity_id\": \"media_player.echo_dot_da_sala\",\n  \"data\":{\n      \"entity_id\": \"media_player.echo_dot_da_sala\",\n      \"media_content_id\": \"amzn_sfx_rooster_crow_01\",\n      \"media_content_type\": \"sound\"\n  }}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3090,"y":1160,"wires":[["91ab60a1.3320a"]]},{"id":"8d2bd1bc.4aef7","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2940,"y":1160,"wires":[["c16c94eb.189208"]]},{"id":"baeebfed.98cab","type":"api-call-service","z":"1f49f273.0f37be","name":"Alexa conta piada","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3290,"y":1260,"wires":[[]]},{"id":"da6195db.6f5ee8","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg= {payload:{\n  \"domain\": \"media_player\",\n  \"service\": \"play_media\",\n   \"entity_id\": \"media_player.echo_dot_da_sala\",\n  \"data\":{\n      \"entity_id\": \"media_player.echo_dot_da_sala\",\n      \"media_content_id\": \"Alexa.Joke.Play\",\n      \"media_content_type\": \"sequence\"\n  }}\n};\nreturn newMsg;\n\n\n/*\noutras sequencias:\n\nAlexa.Weather.Play\nAlexa.Traffic.Play\nAlexa.FlashBriefing.Play\nAlexa.GoodMorning.Play\nAlexa.GoodNight.Play\nAlexa.SingASong.Play\nAlexa.TellStory.Play\nAlexa.FunFact.Play\nAlexa.Joke.Play\nAlexa.Music.PlaySearchPhrase\nAlexa.Calendar.PlayTomorrow\nAlexa.Calendar.PlayToday\nAlexa.Calendar.PlayNext\nAlexa.CleanUp.Play\nAlexa.ImHome.Play\n*/\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3090,"y":1260,"wires":[["baeebfed.98cab"]]},{"id":"81eec5c3.41d038","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2940,"y":1260,"wires":[["da6195db.6f5ee8"]]},{"id":"d3652512.014ca8","type":"api-call-service","z":"1f49f273.0f37be","name":"Alexa conta piada","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3290,"y":1320,"wires":[[]]},{"id":"22fa82e1.bf9bfe","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg= {payload:{\n  \"domain\": \"media_player\",\n  \"service\": \"play_media\",\n   \"entity_id\": \"media_player.echo_dot_da_sala\",\n  \"data\":{\n      \"entity_id\": \"media_player.echo_dot_da_sala\",\n      \"media_content_id\": \"Alexa.Music.PlaySearchPhrase\",\n      \"media_content_type\": \"sequence\"\n  }}\n};\nreturn newMsg;\n\n\n/*\noutras sequencias:\n\nAlexa.Weather.Play\nAlexa.Traffic.Play\nAlexa.FlashBriefing.Play\nAlexa.GoodMorning.Play\nAlexa.GoodNight.Play\nAlexa.SingASong.Play\nAlexa.TellStory.Play\nAlexa.FunFact.Play\nAlexa.Joke.Play\nAlexa.Music.PlaySearchPhrase\nAlexa.Calendar.PlayTomorrow\nAlexa.Calendar.PlayToday\nAlexa.Calendar.PlayNext\nAlexa.CleanUp.Play\nAlexa.ImHome.Play\n*/\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3090,"y":1320,"wires":[["d3652512.014ca8"]]},{"id":"5ee8115f.90b4c","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2940,"y":1320,"wires":[["22fa82e1.bf9bfe"]]},{"id":"30970299.dac76e","type":"api-call-service","z":"1f49f273.0f37be","name":"Liga rotina da Alexa","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3290,"y":1400,"wires":[[]]},{"id":"1f1818e3.af6007","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg= {payload:{\n  \"domain\": \"media_player\",\n  \"service\": \"play_media\",\n   \"entity_id\": \"media_player.echo_dot_do_quarto\",\n  \"data\":{\n          \"entity_id\": \"media_player.echo_dot_do_quarto\",\n          \"media_content_id\": \"Teste\",\n          \"media_content_type\": \"routine\"\n\n  }}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3090,"y":1400,"wires":[["30970299.dac76e"]]},{"id":"9b65736a.39983","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2940,"y":1400,"wires":[["1f1818e3.af6007"]]},{"id":"2b58aa1f.b0d95e","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"Varias vozes","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"ssml","text":{"type":"str","value":"<speak> Posso ficar mudando <voice name=\"Ricardo\">pra voz do Ricardo</voice> <voice name=\"Camila\">pra voz da Camila, ou </voice>, <lang xml:lang=\"en-US\"> <voice name=\"Joanna\">And change languages mid-sentence, and even change to other voices in these languages like, </voice>   <voice name=\"Ivy\">to Ivy</voice>  <voice name=\"Joanna\">to Joanna</voice>  <voice name=\"Joey\">to Joey</voice>  <voice name=\"Justin\">to Justin</voice>  <voice name=\"Kendra\">to Kendra</voice>  <voice name=\"Kimberly\">to Kimberly</voice>  <voice name=\"Matthew\">to Matthew</voice>  <voice name=\"Salli\">to Salli</voice>  </lang>  </speak>"},"volume":{"type":"num","value":"50"},"mode":"set","devices":["G090XG0894430B3V"]}},"x":2310,"y":1560,"wires":[[]]},{"id":"31eba6f0.0c76b2","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2140,"y":1560,"wires":[["2b58aa1f.b0d95e"]]},{"id":"336caece.4105e2","type":"api-call-service","z":"1f49f273.0f37be","name":"Alexa anuncia Olá pelo HA","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media_echo_dot_do_quarto","entityId":"","data":"{\"message\":\"{{payload}}\",\"data\":{\"type\":\"tts\"},\"target\":\"{{service}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":3320,"y":1560,"wires":[[]]},{"id":"b7a44d83.b3a48","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg= { \"payload\": \"Olá\", \"data\": { \"type\": \"tts\" }, \"target\": \"alexa_media_echo_dot_da_sala\" };\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3090,"y":1560,"wires":[["336caece.4105e2"]]},{"id":"965336f.4cbddc8","type":"inject","z":"1f49f273.0f37be","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2940,"y":1560,"wires":[["b7a44d83.b3a48"]]},{"id":"72246ed7.2613f","type":"switch","z":"cbdfe56c.84c388","name":"","property":"isDay","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":550,"y":360,"wires":[["b8fa3939.5f78d8","cb7a46db.958f7"],["c6b72e13.99555"]]},{"id":"50b93860.552e1","type":"switch","z":"cbdfe56c.84c388","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1550,"y":320,"wires":[["d39ea2f.3d3646"],["e74ef9a.fcb7f88"]]},{"id":"a31e52a5.5ed02","type":"comment","z":"cbdfe56c.84c388","name":"Se for de dia, só checa o aux","info":"","x":780,"y":500,"wires":[]},{"id":"ed04fb09.39fc1","type":"function","z":"1f49f273.0f37be","name":"Almoço","func":"if(msg.payload.description.summary.includes('almoço')===true ||\n    msg.payload.description.summary.includes('hora do almoço')===true\n   ){\n    var newMsg;\n        newMsg = {payload:{}}\n    newMsg.payload = {\n        \"domain\": \"media_player\",\n        \"service\": \"turn_on\",\n        \"entity_id\": \"media_player.tv_da_sala\",\n        \"data\":{\n          \"entity_id\": \"media_player.tv_da_sala\",\n        }\n    }\n    node.send(newMsg);\n\n        newMsg = {payload:{}}\n    newMsg.payload = {\n        \"domain\": \"media_player\",\n        \"service\": \"play_media\",\n        \"entity_id\": \"media_player.tv_da_sala\",\n        \"data\":{\n          \"entity_id\": \"media_player.tv_da_sala\",\n          \"media_content_type\": \"send_key\",\n          \"media_content_id\": \"ST_HDMI1\"\n        }\n    }\n    node.send(newMsg);\n\n    newMsg= {payload : {\n        \"domain\": \"media_player\",\n        \"service\": \"play_media\",\n        \"data\":{\n            \"entity_id\": \"media_player.tv_da_sala\",\n            \"media_content_id\": 512,\n            \"media_content_type\": \"channel\"\n        }\n    }};\n    node.send(newMsg);\n\n    newMsg= {payload : {\n    \"domain\": \"media_player\",\n    \"service\": \"play_media\",\n    \"data\":{\n      \"entity_id\": \"media_player.tv_da_sala\",\n      \"media_content_type\": \"send_key\",\n      \"media_content_id\": \"ST_VOL16\"\n    }   \n    }};\n    node.send(newMsg);\n    \n    newMsg= {payload : {\n        \"domain\": \"notify\",\n        \"service\": \"tv_do_quarto\",\n        \"data\":{\n            \"message\": \"Hora do almoço.\"\n        }\n    }};\n    node.send(newMsg);\n    \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":2360,"wires":[["3249e2e0.7b002e","b5e2111d.07f3b8"]]},{"id":"b5e2111d.07f3b8","type":"delay","z":"1f49f273.0f37be","name":"","pauseType":"rate","timeout":"0.5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"20","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":700,"y":2340,"wires":[["e5b72a67.caa2b8","e8f4a759.1e4678"]]},{"id":"83cf498e.cca668","type":"function","z":"1f49f273.0f37be","name":"","func":"var newMsg;\nnewMsg= {payload:{\n  \"domain\": \"media_player\",\n  \"service\": \"play_media\",\n   \"entity_id\": \"media_player.echo_dot_da_cozinha\",\n  \"data\":{\n          \"entity_id\": \"media_player.echo_dot_da_cozinha\",\n          \"media_content_id\": \"Faz o café\",\n          \"media_content_type\": \"routine\"\n\n  }}\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":760,"y":1600,"wires":[["e2122b62.42631"]]},{"id":"e2122b62.42631","type":"api-call-service","z":"1f49f273.0f37be","name":"Liga rotina da Alexa","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":950,"y":1600,"wires":[[]]},{"id":"9f1ecfc2.3b124","type":"api-call-service","z":"ccb6d071.13253","name":"Flor","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.flor","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3110,"y":1180,"wires":[[]]},{"id":"ba5a3d75.8a0c1","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"var newMsg;\nnewMsg= {payload : {\n    \"domain\": \"switch\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"switch.flor\"\n    }\n}};\n\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2940,"y":1180,"wires":[["9f1ecfc2.3b124"]]},{"id":"c0fde806.82c8f8","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"var newMsg;\nnewMsg= {payload : {\n    \"domain\": \"switch\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"switch.flor\"\n    }\n}};\n\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":2560,"wires":[["2d7ca05b.c609d"]]},{"id":"2d7ca05b.c609d","type":"api-call-service","z":"ccb6d071.13253","name":"Flor","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.flor","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":980,"y":2560,"wires":[[]]},{"id":"bfc705a9.96a698","type":"server-state-changed","z":"9639036b.0a3a6","name":"Cafeteira","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.cafeteira","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":280,"y":1740,"wires":[["4b71ca97.2fed14"],["4b71ca97.2fed14"]]},{"id":"a5328106.3ce12","type":"delay","z":"9639036b.0a3a6","name":"","pauseType":"delay","timeout":"7","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":580,"y":1740,"wires":[["dc667973.ffa2b"]]},{"id":"51f927b1.d4a998","type":"api-call-service","z":"9639036b.0a3a6","name":"Desliga a Cafeteira","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.cafeteira","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1190,"y":1620,"wires":[[]]},{"id":"bf27adfe.24b5f","type":"function","z":"9639036b.0a3a6","name":"Turn off","func":"var newMsg;\n    newMsg = {payload:{\n            \n          \"domain\": \"switch\",\n          \"service\": \"turn_off\",\n          \"data\":{\n          \"entity_id\": \"switch.cafeteira\",\n        }\n    }\n}\n    return newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":1620,"wires":[["51f927b1.d4a998"]]},{"id":"94e53080.028ea","type":"debug","z":"1f49f273.0f37be","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":490,"y":160,"wires":[]},{"id":"57cb1259.e2543c","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"var newMsg;\nnewMsg= {payload : {\n    \"domain\": \"media_player\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"media_player.fire_tv\"\n    }\n}};\nnode.send(newMsg);\n\nnewMsg= {payload : {\n    \"domain\": \"media_player\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"media_player.fire_tv_2\"\n    }\n}};\nnode.send(newMsg);\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":2500,"wires":[["f592143d.38a568"]]},{"id":"f592143d.38a568","type":"api-call-service","z":"ccb6d071.13253","name":"Fire TV","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"turn_off","entityId":"media_player.fire_tv, media_player.fire_tv_2","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":980,"y":2500,"wires":[[]]},{"id":"c870579.05848a8","type":"api-call-service","z":"ccb6d071.13253","name":"Tomada TV","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.tomada_tv_quarto","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":990,"y":2440,"wires":[[]]},{"id":"b30dfa21.a37968","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"var newMsg;\nnewMsg= {payload : {\n    \"domain\": \"switch\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"switch.tomada_tv_quarto\"\n    }\n}};\n\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":2440,"wires":[["c870579.05848a8"]]},{"id":"dcb234b5.378678","type":"function","z":"ccb6d071.13253","name":"Vou dormir?","func":"var newMsg;\nnewMsg = {payload: {}};\nif(msg.payload === true){\n    newMsg.payload = {\"On\": true};\n}\nif(msg.payload === false){\n    newMsg.payload = {\"On\": false};\n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":2720,"wires":[["24f5362b.35f9fa"]]},{"id":"d04664ef.cfb1c8","type":"server-state-changed","z":"ccb6d071.13253","name":"Vou dormir","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.vou_dormir","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":280,"y":2720,"wires":[["dcb234b5.378678"],["dcb234b5.378678"]]},{"id":"dc667973.ffa2b","type":"delay","z":"9639036b.0a3a6","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"8","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":740,"y":1740,"wires":[["bf27adfe.24b5f","45c230b1.41518","d909d257.71427","8eb6249b.db9cf8","80da379e.1edc38","4f4aeb0.e4f8614"]]},{"id":"4b71ca97.2fed14","type":"function","z":"9639036b.0a3a6","name":"if true","func":"var alexaCafeAux = global.get(\"alexaCafeAux\");\nif(msg.payload === true){\n    if(alexaCafeAux === false){\n        return msg;\n    }\n    else{\n        global.set(\"alexaCafeAux\", false);\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":1740,"wires":[["a5328106.3ce12","aef6c737.67adb8"]]},{"id":"9db583b0.8e8d8","type":"function","z":"1f49f273.0f37be","name":"Adicionar à lista do HA","func":"if(\n        msg.payload.description.summary.includes('adiciona')===true || \n        msg.payload.description.summary.includes('lista')===true || \n        msg.payload.description.summary.includes('coloca')===true|| \n        msg.payload.description.summary.includes('colocar')===true|| \n        msg.payload.description.summary.includes('adicionar')===true|| \n        msg.payload.description.summary.includes('poe')===true|| \n        msg.payload.description.summary.includes('põe')===true|| \n        msg.payload.description.summary.includes('põem')===true|| \n        msg.payload.description.summary.includes('poem')===true|| \n        msg.payload.description.summary.includes('bota')===true\n            \n        ){\n    if(typeof msg.payload.domainAttributes !== \"undefined\" && msg.payload.domainAttributes !== null){\n        if(typeof msg.payload.domainAttributes.value !== \"undefined\"){\n                var newMsg;\n                newMsg= {payload : {\n                    \"domain\": \"shopping_list\",\n                    \"service\": \"add_item\",\n                    \"data\":{\n                        \"name\": msg.payload.domainAttributes.value\n                        }\n                    }};\n            \n            return newMsg;\n        }\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":220,"wires":[["dfc3a98d.778ca8"]]},{"id":"dfc3a98d.778ca8","type":"api-call-service","z":"1f49f273.0f37be","name":"Add Item Shopping List","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"shopping_list","service":"add_item","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":810,"y":220,"wires":[[]]},{"id":"8c00ea31.7a21e8","type":"api-current-state","z":"c3bc1a43.254dd","name":"Sala Ocupada","server":"d63d21ef.5e065","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.sala_ocupada","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1000,"y":340,"wires":[["508c6652.488c28","d27e85b0.029a68"],["508c6652.488c28","d27e85b0.029a68"]]},{"id":"ec471f90.c534f","type":"api-current-state","z":"c3bc1a43.254dd","name":"Alguém em Casa","server":"d63d21ef.5e065","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.alguem_em_casa","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1270,"y":680,"wires":[["a0c4580e.a6f4b"],["a0c4580e.a6f4b"]]},{"id":"24ae9286.3aea5e","type":"api-call-service","z":"1f49f273.0f37be","name":"PC","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"mqtt","service":"publish","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":750,"y":280,"wires":[[]]},{"id":"822d92e.5d6567","type":"delay","z":"f02c3977.c1b97","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"30","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":800,"y":240,"wires":[["f338faec.c79e18","a1298208.8a59f"]]},{"id":"ec889c0e.53207","type":"delay","z":"f02c3977.c1b97","name":"","pauseType":"delayv","timeout":"20","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1340,"y":320,"wires":[["673f16ad.36bc08"]]},{"id":"f338faec.c79e18","type":"function","z":"f02c3977.c1b97","name":"Delay + 20 min","func":"msg.delay = 1200000;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1160,"y":320,"wires":[["ec889c0e.53207"]]},{"id":"673f16ad.36bc08","type":"function","z":"f02c3977.c1b97","name":"Turn Off","func":"if(msg.payload === true){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_off\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1500,"y":320,"wires":[["a05a0f51.22997"]]},{"id":"9d13e39a.43504","type":"inject","z":"1aa34a9.7045335","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":220,"y":620,"wires":[["7e014f0.68b00b"]]},{"id":"7cee7409.f9b1fc","type":"debug","z":"1aa34a9.7045335","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1070,"y":540,"wires":[]},{"id":"a1298208.8a59f","type":"delay","z":"f02c3977.c1b97","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":980,"y":240,"wires":[["f5182ffa.11566"]]},{"id":"7eed4e62.45ef1","type":"delay","z":"c3bc1a43.254dd","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":580,"y":420,"wires":[["a3da8df4.ff838"]]},{"id":"ca3b2a10.426b58","type":"delay","z":"c3bc1a43.254dd","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":580,"y":480,"wires":[["fdb9cb48.2926d"]]},{"id":"b2986c0c.ea0bd","type":"delay","z":"c3bc1a43.254dd","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":520,"y":680,"wires":[["b21d98c4.4b92e8"]]},{"id":"ac86ee5.cb6091","type":"delay","z":"c3bc1a43.254dd","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":520,"y":740,"wires":[["82f29eb1.c546a"]]},{"id":"52923f67.2f44c","type":"delay","z":"c3bc1a43.254dd","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":580,"y":360,"wires":[["c9d5e111.03afa","885c460.75ef5b8"]]},{"id":"aec3693f.306ab8","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"var newMsg;\nnewMsg= {payload : {\n    \"domain\": \"switch\",\n    \"service\": \"turn_off\",\n    data:{\n        \"entity_id\": \"switch.lampada\"\n    }\n}};\n\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2940,"y":1860,"wires":[["5e19ad42.e15c14"]]},{"id":"5e19ad42.e15c14","type":"api-call-service","z":"ccb6d071.13253","name":"Lâmpada","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.lampada","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3115,"y":1820,"wires":[[]]},{"id":"1a9ee5d5.6e14ba","type":"function","z":"ccb6d071.13253","name":"Turn On","func":"var newMsg;\nnewMsg= {payload : {\n    \"domain\": \"switch\",\n    \"service\": \"turn_on\",\n    data:{\n        \n        \"entity_id\": \"switch.lampada\"\n    }\n}};\n\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2940,"y":1800,"wires":[["5e19ad42.e15c14"]]},{"id":"6bf98f40.61228","type":"api-call-service","z":"ccb6d071.13253","name":"Lâmpada","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.lampada","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1500,"y":1960,"wires":[[]]},{"id":"42c77644.cb9678","type":"function","z":"ccb6d071.13253","name":"Turn On","func":"var newMsg;\nnewMsg= {payload : {\n    \"domain\": \"switch\",\n    \"service\": \"turn_on\",\n    data:{\n        \"entity_id\": \"switch.lampada\"\n    }\n}};\n\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1340,"y":1960,"wires":[["6bf98f40.61228"]]},{"id":"a86c47ce.1db0f8","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"delay","timeout":"45","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1390,"y":2180,"wires":[["48c6b8cd.0aa1f8","61be1fb7.56c01"]]},{"id":"4f51044a.63080c","type":"mqtt out","z":"ccb6d071.13253","name":"setOff RGB Strip","topic":"QuartoNedi/setOnRGB","qos":"","retain":"","broker":"a03558e.9e50d28","x":1770,"y":2240,"wires":[]},{"id":"61be1fb7.56c01","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"msg = {payload:0};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1580,"y":2240,"wires":[["4f51044a.63080c"]]},{"id":"48c6b8cd.0aa1f8","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"var newMsg;\nnewMsg= {payload : {\n    \"domain\": \"switch\",\n    \"service\": \"turn_off\",\n    data:{\n        \"entity_id\": \"switch.lampada\"\n    }\n}};\n\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1574.4443359375,"y":2179.9998779296875,"wires":[["7c9c1aac.4cb6d4"]]},{"id":"7c9c1aac.4cb6d4","type":"api-call-service","z":"ccb6d071.13253","name":"Lâmpada","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.lampada","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1734.4443359375,"y":2179.9998779296875,"wires":[[]]},{"id":"2d785535.d9822a","type":"api-current-state","z":"1aa34a9.7045335","name":"Abajur","server":"d63d21ef.5e065","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"switch.abajur","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":690,"y":1080,"wires":[["ee67748b.840a58"],["ee67748b.840a58"]]},{"id":"abfce220.1b0de","type":"function","z":"1aa34a9.7045335","name":"Luz do Escritorio On","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_on\",\n        \"data\":{\n            \"entity_id\": \"light.luz_do_escritorio\",\n            \"brightness_pct\": 100,\n            \"kelvin\": 6200\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2400,"y":1400,"wires":[["508e3bde.398304"]]},{"id":"508e3bde.398304","type":"api-call-service","z":"1aa34a9.7045335","name":"Luz do Escritório On","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.luz_do_escritorio","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2660,"y":1400,"wires":[[]]},{"id":"67333be.30c8644","type":"server-state-changed","z":"c3bc1a43.254dd","name":"Apple TV On?","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.apple_tv","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":310,"y":1200,"wires":[["1fbcb698.3f9c79"]]},{"id":"f5182ffa.11566","type":"api-call-service","z":"f02c3977.c1b97","name":"Alguém em Casa","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.alguem_em_casa","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1170,"y":240,"wires":[[]]},{"id":"a05a0f51.22997","type":"api-call-service","z":"f02c3977.c1b97","name":"Alguém em Casa","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.alguem_em_casa","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1690,"y":320,"wires":[[]]},{"id":"c155219f.8be","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"20","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":800,"y":660,"wires":[["33f02a39.732f56"]]},{"id":"7dc4744f.cb9a4c","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"20","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":740,"y":600,"wires":[["1cbb0285.c175dd"]]},{"id":"92594655.132fb8","type":"inject","z":"ecc79e8a.d4a1b","name":"Liga a Luz","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":"","topic":"","payload":"1","payloadType":"str","x":840,"y":120,"wires":[["12e47ae7.d37605"]]},{"id":"65e4ea2f.2e1574","type":"inject","z":"ecc79e8a.d4a1b","name":"Inicializar as variaveis flow","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":1640,"y":480,"wires":[["79ecd31d.95363c"]]},{"id":"79ecd31d.95363c","type":"function","z":"ecc79e8a.d4a1b","name":"","func":"flow.set(\"countBrightness\", 1);\nflow.set(\"increasing\", true);\nflow.set(\"auxCT\", 6100);\nflow.set(\"triggered1\", false);\nflow.set(\"triggered2\", false);\nflow.set(\"triggered3\", false);\n\nvar date = new Date();\nvar hours = date.getHours(); //hourss in 0-23\nvar minutes = \"0\" + date.getMinutes();\nminutes = parseInt(minutes.substr(-2), 10);\nvar seconds = \"0\" + date.getSeconds();\nseconds = parseInt(seconds.substr(-2), 10);\n\nflow.set(\"lastChangeSec\", seconds);\nflow.set(\"lastChangeMinute\", minutes);\nflow.set(\"lastChangeHour\", hours);\n    ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1870,"y":500,"wires":[[]]},{"id":"8152ca95.a4f1d8","type":"api-current-state","z":"ecc79e8a.d4a1b","name":"Tunel","server":"d63d21ef.5e065","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"switch.tunel","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":590,"y":920,"wires":[["6c73045b.dca7fc"],["6c73045b.dca7fc"]]},{"id":"6ac5dcf9.274654","type":"inject","z":"1aa34a9.7045335","name":"Inicializar as variaveis flow","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":1380,"y":1420,"wires":[["b32687bf.525998"]]},{"id":"b32687bf.525998","type":"function","z":"1aa34a9.7045335","name":"","func":"flow.set(\"increasing\", true);\nflow.set(\"countBrightnessLuz\", 1);\nflow.set(\"increasing\", true);\nflow.set(\"auxCT\", 6100);\nflow.set(\"triggered1\", false);\nflow.set(\"triggered2\", false);\nflow.set(\"triggered3\", false);\n    \nvar date = new Date();\nvar hours = date.getHours(); //hourss in 0-23\nvar minutes = \"0\" + date.getMinutes();\nminutes = parseInt(minutes.substr(-2), 10);\nvar seconds = \"0\" + date.getSeconds();\nseconds = parseInt(seconds.substr(-2), 10);\n\nflow.set(\"lastChangeSec\", seconds);\nflow.set(\"lastChangeMinute\", minutes);\nflow.set(\"lastChangeHour\", hours);\n    ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1610,"y":1440,"wires":[[]]},{"id":"772a9272.c5113c","type":"api-current-state","z":"ccb6d071.13253","name":"Lâmpada","server":"d63d21ef.5e065","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"switch.lampada","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1340,"y":1280,"wires":[["4b9b5fc8.18359"],["4b9b5fc8.18359"]]},{"id":"c74690d7.173a08","type":"api-call-service","z":"1f49f273.0f37be","name":"Flor","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.flor","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1410,"y":940,"wires":[[]]},{"id":"c73f0a01.1a0558","type":"function","z":"1f49f273.0f37be","name":"Flor Off","func":"var newMsg;\nnewMsg= {payload : {\n    \"domain\": \"switch\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"switch.flow\"\n    }\n}};\n\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1172,"y":940,"wires":[["c74690d7.173a08"]]},{"id":"d98b6706.f2df28","type":"function","z":"f02c3977.c1b97","name":"Detected?","func":"if(msg.payload === true){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":460,"wires":[["822d92e.5d6567"]]},{"id":"57202f34.0e2c","type":"server-state-changed","z":"f02c3977.c1b97","name":"Banheiro Ocupado","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.banheiro_ocupado","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":330,"y":460,"wires":[["d98b6706.f2df28"]]},{"id":"d0a244bc.41f548","type":"function","z":"f02c3977.c1b97","name":"Detected?","func":"if(msg.payload === true){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":520,"wires":[["822d92e.5d6567"]]},{"id":"535f53aa.67984c","type":"server-state-changed","z":"f02c3977.c1b97","name":"Sala Ocupada","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sala_ocupada","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":350,"y":520,"wires":[["d0a244bc.41f548"]]},{"id":"31173366.a3b3fc","type":"function","z":"f02c3977.c1b97","name":"Detected?","func":"if(msg.payload === \"on\"){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":580,"wires":[["822d92e.5d6567","31c1e5fc.13ebca"]]},{"id":"28c10c2.85f62f4","type":"server-state-changed","z":"f02c3977.c1b97","name":"Movimento Escritório","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.movimento_escritorio","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":320,"y":580,"wires":[["31173366.a3b3fc"]]},{"id":"78b84696.ce41a8","type":"function","z":"f02c3977.c1b97","name":"Detected?","func":"if(msg.payload === \"on\"){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":820,"wires":[["822d92e.5d6567"]]},{"id":"2d550aaf.956ee6","type":"server-state-changed","z":"f02c3977.c1b97","name":"Movimento Corredor","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.movimento_corredor","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":330,"y":820,"wires":[["78b84696.ce41a8"]]},{"id":"b0eaebca.5e2f28","type":"function","z":"f02c3977.c1b97","name":"Detected?","func":"if(msg.payload === \"on\"){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":880,"wires":[["822d92e.5d6567","57e84258.62628c"]]},{"id":"77a73bd4.b98144","type":"server-state-changed","z":"f02c3977.c1b97","name":"Movimento Cozinha","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.movimento_cozinha","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":330,"y":880,"wires":[["b0eaebca.5e2f28"]]},{"id":"3aed7779.872398","type":"function","z":"f02c3977.c1b97","name":"Detected?","func":"if(msg.payload === \"on\"){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":940,"wires":[["822d92e.5d6567","1e90bf6d.5b6ab1"]]},{"id":"9fc6af6c.ea725","type":"server-state-changed","z":"f02c3977.c1b97","name":"Movimento Quarto Nédi","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.movimento_quarto_nedi","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":320,"y":940,"wires":[["3aed7779.872398"]]},{"id":"1c86dee1.22e7d1","type":"delay","z":"f02c3977.c1b97","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":980,"y":760,"wires":[["c6a3bb9d.b45178","97ae3afe.2a2eb8"]]},{"id":"c6a3bb9d.b45178","type":"api-call-service","z":"f02c3977.c1b97","name":"Quarto Nédi Ocupado","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.quarto_nedi_ocupado_switch","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1180,"y":760,"wires":[[]]},{"id":"6cd8c92c.a28948","type":"delay","z":"f02c3977.c1b97","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":980,"y":640,"wires":[["3507a5ae.2b3a6a","f8b4cdeb.5a994"]]},{"id":"3507a5ae.2b3a6a","type":"api-call-service","z":"f02c3977.c1b97","name":"Cozinha Ocupada","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"binary_sensor","service":"turn_on","entityId":"binary_sensor.cozinha_ocupada","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1170,"y":640,"wires":[[]]},{"id":"1f403498.fe174b","type":"delay","z":"f02c3977.c1b97","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":980,"y":400,"wires":[["d32361bb.090e3","5593aa57.58e4f4"]]},{"id":"d32361bb.090e3","type":"api-call-service","z":"f02c3977.c1b97","name":"Sala Ocupada","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"binary_sensor","service":"turn_on","entityId":"binary_sensor.sala_ocupada","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1160,"y":400,"wires":[[]]},{"id":"31c1e5fc.13ebca","type":"function","z":"f02c3977.c1b97","name":"Turn On","func":"var newMsg;\nnewMsg= {payload: {\n      \"domain\": \"input_boolean\",\n      \"service\": \"turn_on\",\n      \"entity_id\": \"input_boolean.sala_ocupada_switch\",\n}};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":400,"wires":[["1f403498.fe174b"]]},{"id":"57e84258.62628c","type":"function","z":"f02c3977.c1b97","name":"Turn On","func":"var newMsg;\nnewMsg= {payload: {\n      \"domain\": \"input_boolean\",\n      \"service\": \"turn_on\",\n      \"entity_id\": \"input_boolean.cozinha_ocupada_switch\",\n}};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":640,"wires":[["6cd8c92c.a28948"]]},{"id":"1e90bf6d.5b6ab1","type":"function","z":"f02c3977.c1b97","name":"Turn On","func":"var newMsg;\nnewMsg= {payload: {\n      \"domain\": \"input_boolean\",\n      \"service\": \"turn_on\",\n      \"entity_id\": \"input_boolean.quarto_nedi_ocupado_switch\",\n}};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":760,"wires":[["1c86dee1.22e7d1"]]},{"id":"c6b72e13.99555","type":"api-current-state","z":"cbdfe56c.84c388","name":"Banheiro Ocupado","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.banheiro_ocupado","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":730,"y":420,"wires":[["bec5ca27.d122f8"]]},{"id":"19d5a607.71d03a","type":"api-call-service","z":"cbdfe56c.84c388","name":"Banheiro Ocupado","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.banheiro_ocupado_switch","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2693,"y":189,"wires":[[]]},{"id":"44ab2751.d6d698","type":"server-state-changed","z":"cbdfe56c.84c388","name":"Banheiro Ocupado","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.banheiro_ocupado","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":1970,"y":420,"wires":[["af81402b.6be26"]]},{"id":"9ec049.26e6efb8","type":"function","z":"cbdfe56c.84c388","name":"Turn Off","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"input_boolean\",\n        \"service\": \"turn_off\",\n        data:{\n            \"entity_id\": \"input_boolean.banheiro_ocupado_switch\",\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2500,"y":220,"wires":[["19d5a607.71d03a"]]},{"id":"17e5ec15.cf49b4","type":"function","z":"cbdfe56c.84c388","name":"Turn On","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"input_boolean\",\n        \"service\": \"turn_on\",\n        data:{\n            \"entity_id\": \"input_boolean.banheiro_ocupado_switch\",\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2500,"y":160,"wires":[["19d5a607.71d03a"]]},{"id":"8abcbb48.12bca8","type":"api-current-state","z":"c3bc1a43.254dd","name":"Quarto Nédi Ocupado","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.quarto_nedi_ocupado","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":920,"y":680,"wires":[["a792999e.fe4598"]]},{"id":"293abd.acd5e544","type":"function","z":"ccb6d071.13253","name":"Turn On","func":"var newMsg;\nnewMsg= {payload : {\n    \"domain\": \"input_boolean\",\n    \"service\": \"turn_on\",\n    data:{\n        \n        \"entity_id\": \"input_boolean.quarto_ocupado\"\n    }\n}};\n\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2940,"y":1440,"wires":[["5c4896e9.12b498"]]},{"id":"2856c6fb.8ab38a","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"var newMsg;\nnewMsg= {payload : {\n    \"domain\": \"input_boolean\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"input_boolean.quarto_ocupado\"\n    }\n}};\n\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2940,"y":1380,"wires":[["5c4896e9.12b498"]]},{"id":"5c4896e9.12b498","type":"api-call-service","z":"ccb6d071.13253","name":"Quarto Ocupado","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"binary_sensor.quarto_ocupado","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3130,"y":1400,"wires":[[]]},{"id":"6a4b42e7.7fb7fc","type":"api-call-service","z":"ecc79e8a.d4a1b","name":"Sala Ocupada","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.sala_ocupada_switch","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2480,"y":1060,"wires":[[]]},{"id":"5b5ec652.24edb8","type":"function","z":"ecc79e8a.d4a1b","name":"Turn Off","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"input_boolean\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"input_boolean.sala_ocupada_switch\"\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2280,"y":1040,"wires":[["6a4b42e7.7fb7fc"]]},{"id":"de7fa9de.f5ec38","type":"function","z":"ecc79e8a.d4a1b","name":"Turn On","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"input_boolean\",\n        \"service\": \"turn_on\",\n        \"data\":{\n            \"entity_id\": \"input_boolean.sala_ocupada_switch\"\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2280,"y":1080,"wires":[["6a4b42e7.7fb7fc"]]},{"id":"e8edd2cd.06edd","type":"api-call-service","z":"1f49f273.0f37be","name":"Apple TV","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"media_player","service":"media_play_pause","entityId":"media_player.apple_tv","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":840,"y":2220,"wires":[[]]},{"id":"18e44a43.d060e6","type":"api-call-service","z":"1aa34a9.7045335","name":"Sala Ocupada","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.sala_ocupada_switch","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2520,"y":1240,"wires":[[]]},{"id":"a70090cc.73e91","type":"function","z":"1aa34a9.7045335","name":"Turn Off","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"input_boolean\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"input_boolean.sala_ocupada_switch\"\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2360,"y":1220,"wires":[["18e44a43.d060e6"]]},{"id":"9303145a.3c1ef8","type":"function","z":"1aa34a9.7045335","name":"Turn On","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"input_boolean\",\n        \"service\": \"turn_on\",\n        \"data\":{\n            \"entity_id\": \"input_boolean.sala_ocupada_switch\"\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2360,"y":1280,"wires":[["18e44a43.d060e6"]]},{"id":"35387340.749d9c","type":"spotify","z":"fb543111.32fbd","name":"Getting New Tracks","auth":"a6321728.b92898","api":"getPlaylistTracks","x":570,"y":180,"wires":[["d1c07e5e.b3aed","4b99cdcd.0f5bb4"]]},{"id":"99b6ecf.f15fe1","type":"spotify","z":"fb543111.32fbd","name":"Adding to playlist","auth":"a6321728.b92898","api":"addTracksToPlaylist","x":2690,"y":180,"wires":[["18e24c57.1eab04"]]},{"id":"b811e3d1.31747","type":"spotify","z":"fb543111.32fbd","name":"Getting Old Playlist","auth":"a6321728.b92898","api":"getPlaylistTracks","x":1270,"y":180,"wires":[["d8583370.721f2"]]},{"id":"d1c07e5e.b3aed","type":"function","z":"fb543111.32fbd","name":"Discover Weekly Archive","func":"flow.set(\"discoverWeeklyTracks\", msg.payload.items)\nvar newMsg;\nnewMsg = {\n    \"params\":[\n        '5Rxn0QVVaFMpp6UmHj53QA',\n        {offset: 0}\n    ]\n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":810,"y":180,"wires":[["b28088a3.da4688"]]},{"id":"d8583370.721f2","type":"function","z":"fb543111.32fbd","name":"Got all tracks?","func":"var oldAux = flow.get(\"discoverWeeklyOldAux\");\nvar oldArrayAux = flow.get(\"discoverWeeklyOldArrayAux\");\nvar newMsg;\nvar newOldArrayAux;\nif (typeof msg.payload !== 'undefined' ){\n    if (typeof msg.payload.items !== 'undefined' ){\n        newOldArrayAux = oldArrayAux.concat(msg.payload.items);\n    }\n    else{\n        newOldArrayAux = [];\n    }\n}\nelse{\n    newOldArrayAux = [];\n}\n\nfor(var i=0; i<newOldArrayAux.length; ++i) {\n    for(var j=i+1; j<newOldArrayAux.length; ++j) {\n        if(newOldArrayAux[i] === newOldArrayAux[j])\n            newOldArrayAux.splice(j--, 1);\n    }\n}\nflow.set(\"discoverWeeklyOldArrayAux\", newOldArrayAux);\nflow.set(\"discoverWeeklyOldAux\", oldAux+msg.payload.limit);\nif(msg.payload.total > oldAux){\n    newMsg = {\"ajuda\":true};\n}\nelse{\n    newMsg = {\"ajuda\":false,\n        \"tracks\": newOldArrayAux\n    };\n    \n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1480,"y":180,"wires":[["f7a08346.c524a"]]},{"id":"48b3f683.0ecaa8","type":"inject","z":"fb543111.32fbd","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"00 12 * * 2,3","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":190,"y":180,"wires":[["6f09d9b2.9463d8"]]},{"id":"6f09d9b2.9463d8","type":"function","z":"fb543111.32fbd","name":"Discover Weekly","func":"var newMsg;\nflow.set(\"discoverWeeklyOldAux\", 0);\nflow.set(\"discoverWeeklyOldArrayAux\", []);\nflow.set(\"discoverWeeklyOffset\",100);\nnewMsg = {\n    \"params\":[\n        '37i9dQZEVXcLnLyPWrETXX'\n    ]\n}\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":180,"wires":[["35387340.749d9c"]]},{"id":"684c1ca5.50a624","type":"switch","z":"fb543111.32fbd","name":"Ajuda?","property":"ajuda","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1880,"y":180,"wires":[["fb77296e.29e668"],["ad58f79a.08cc48","85192fe2.6fdc9"]]},{"id":"fb77296e.29e668","type":"function","z":"fb543111.32fbd","name":"Get Next Array","func":"offsetAux = flow.get(\"discoverWeeklyOffset\");\nflow.set(\"discoverWeeklyOffset\",offsetAux+100);\n\nvar newMsg;\nnewMsg = {\n    \"params\":[\n        '5Rxn0QVVaFMpp6UmHj53QA',\n        {offset: offsetAux}\n    ]\n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1800,"y":100,"wires":[["b811e3d1.31747"]]},{"id":"ad58f79a.08cc48","type":"function","z":"fb543111.32fbd","name":"New playlist is already added?","func":"var newTracks = flow.get(\"discoverWeeklyTracks\");\nvar oldTracks = msg.tracks;\nvar alreadyIn = false;\nvar newMsg;\nvar auxString;\nfor(var i=0; i<newTracks.length; i++) {\n    alreadyIn = false;\n    for(var j=0; j<oldTracks.length; j++) {\n        if(newTracks[i].track.id === oldTracks[j].track.id){\n            alreadyIn = true\n        }\n    }\n    if(alreadyIn === false){\n        auxString = \"['\" + newTracks[i].track.uri + \"']\"\n        newMsg = {\n            \"params\":[\n                \"5Rxn0QVVaFMpp6UmHj53QA\",\n                [newTracks[i].track.uri]\n            ]}\n        node.send(newMsg);\n\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2210,"y":180,"wires":[["a68fbb18.fd4258","d3cc65a8.b6e708"]]},{"id":"f7a08346.c524a","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1680,"y":180,"wires":[["684c1ca5.50a624"]]},{"id":"85192fe2.6fdc9","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2200,"y":260,"wires":[]},{"id":"b28088a3.da4688","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1040,"y":180,"wires":[["b811e3d1.31747"]]},{"id":"a68fbb18.fd4258","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2450,"y":180,"wires":[["99b6ecf.f15fe1"]]},{"id":"4b99cdcd.0f5bb4","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":760,"y":240,"wires":[]},{"id":"d3cc65a8.b6e708","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2490,"y":260,"wires":[]},{"id":"18e24c57.1eab04","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2890,"y":260,"wires":[]},{"id":"f40c4288.0a8e5","type":"api-call-service","z":"9639036b.0a3a6","name":"Luz do Banheiro","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.cafeteira","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1180,"y":1560,"wires":[[]]},{"id":"45c230b1.41518","type":"function","z":"9639036b.0a3a6","name":"Pisca Banheiro","func":"var newMsg;\nnewMsg = {payload:{\n          \"domain\": \"light\",\n          \"service\": \"turn_on\",\n          \"data\":{\n          \"entity_id\": \"light.luz_do_banheiro\",\n            \"effect\": \"Twitter\"\n        }\n    }\n}\n    return newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1000,"y":1560,"wires":[["f40c4288.0a8e5"]]},{"id":"fabe5168.38309","type":"spotify","z":"fb543111.32fbd","name":"Getting New Tracks","auth":"a6321728.b92898","api":"getPlaylistTracks","x":570,"y":440,"wires":[["47e9461b.d67378","ed264ccc.bb11c"]]},{"id":"426bac29.9d2c54","type":"spotify","z":"fb543111.32fbd","name":"Adding to playlist","auth":"a6321728.b92898","api":"addTracksToPlaylist","x":2690,"y":440,"wires":[["cc6ef7cb.0f2608"]]},{"id":"80de162.a872ce8","type":"spotify","z":"fb543111.32fbd","name":"Getting Old Playlist","auth":"a6321728.b92898","api":"getPlaylistTracks","x":1270,"y":440,"wires":[["5c6fe027.ba519"]]},{"id":"47e9461b.d67378","type":"function","z":"fb543111.32fbd","name":"Top Brasil Archive","func":"flow.set(\"topBrasilTracks\", msg.payload.items)\nvar newMsg;\nnewMsg = {\n    \"params\":[\n        '35uWFe4ozJHwjDfrM3yt9X',\n        {offset: 0}\n    ]\n}\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":440,"wires":[["3bcbbba4.4a6074"]]},{"id":"5c6fe027.ba519","type":"function","z":"fb543111.32fbd","name":"Got all tracks?","func":"var oldAux = flow.get(\"topBrasilOldAux\");\nvar oldArrayAux = flow.get(\"topBrasilOldArrayAux\");\nvar newMsg;\nvar newOldArrayAux;\nif (typeof msg.payload !== 'undefined' ){\n    if (typeof msg.payload.items !== 'undefined' ){\n        newOldArrayAux = oldArrayAux.concat(msg.payload.items);\n    }\n    else{\n        newOldArrayAux = [];\n    }\n}\nelse{\n    newOldArrayAux = [];\n}\n\nfor(var i=0; i<newOldArrayAux.length; ++i) {\n    for(var j=i+1; j<newOldArrayAux.length; ++j) {\n        if(newOldArrayAux[i] === newOldArrayAux[j])\n            newOldArrayAux.splice(j--, 1);\n    }\n}\nflow.set(\"topBrasilOldArrayAux\", newOldArrayAux);\nflow.set(\"topBrasilOldAux\", oldAux+msg.payload.limit);\nif(msg.payload.total > oldAux){\n    newMsg = {\"ajuda\":true};\n}\nelse{\n    newMsg = {\"ajuda\":false,\n        \"tracks\": newOldArrayAux\n    };\n    \n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1480,"y":440,"wires":[["1adae7ef.732b08"]]},{"id":"8ba4a320.b86cf","type":"inject","z":"fb543111.32fbd","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"00 14 * * 3,4","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":190,"y":440,"wires":[["bb2be4da.066c48"]]},{"id":"bb2be4da.066c48","type":"function","z":"fb543111.32fbd","name":"Top Brasil","func":"var newMsg;\nflow.set(\"topBrasilOldAux\", 0);\nflow.set(\"topBrasilOldArrayAux\", []);\nflow.set(\"topBrasilOffset\",100);\nnewMsg = {\n    \"params\":[\n        '37i9dQZF1DX0FOF1IUWK1W'\n    ]\n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":340,"y":440,"wires":[["fabe5168.38309"]]},{"id":"c18243e2.58b6a","type":"switch","z":"fb543111.32fbd","name":"Ajuda?","property":"ajuda","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1880,"y":440,"wires":[["b07a9595.f5a4f8"],["5de70658.e1eae8","f0d23f6f.ef284"]]},{"id":"b07a9595.f5a4f8","type":"function","z":"fb543111.32fbd","name":"Get Next Array","func":"offsetAux = flow.get(\"topBrasilOffset\");\nflow.set(\"topBrasilOffset\",offsetAux+100);\n\nvar newMsg;\nnewMsg = {\n    \"params\":[\n        '35uWFe4ozJHwjDfrM3yt9X',\n        {offset: offsetAux}\n    ]\n}\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1800,"y":360,"wires":[["80de162.a872ce8"]]},{"id":"5de70658.e1eae8","type":"function","z":"fb543111.32fbd","name":"New playlist is already added?","func":"var newTracks = flow.get(\"topBrasilTracks\");\nvar oldTracks = msg.tracks;\nvar alreadyIn = false;\nvar newMsg;\nvar auxString;\nfor(var i=0; i<newTracks.length; i++) {\n    alreadyIn = false;\n    for(var j=0; j<oldTracks.length; j++) {\n        if(newTracks[i].track.id === oldTracks[j].track.id){\n            alreadyIn = true\n        }\n    }\n    if(alreadyIn === false){\n        auxString = \"['\" + newTracks[i].track.uri + \"']\"\n        newMsg = {\n            \"params\":[\n                \"35uWFe4ozJHwjDfrM3yt9X\",\n                [newTracks[i].track.uri]\n            ]}\n        node.send(newMsg);\n\n    }\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2210,"y":440,"wires":[["b0b9aef7.8fe5c","c4256533.b12e88"]]},{"id":"1adae7ef.732b08","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1680,"y":440,"wires":[["c18243e2.58b6a"]]},{"id":"f0d23f6f.ef284","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2200,"y":520,"wires":[]},{"id":"3bcbbba4.4a6074","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1040,"y":440,"wires":[["80de162.a872ce8"]]},{"id":"b0b9aef7.8fe5c","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2450,"y":440,"wires":[["426bac29.9d2c54"]]},{"id":"ed264ccc.bb11c","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":760,"y":500,"wires":[]},{"id":"c4256533.b12e88","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2490,"y":520,"wires":[]},{"id":"cc6ef7cb.0f2608","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2890,"y":520,"wires":[]},{"id":"504910b0.b4c3a","type":"spotify","z":"fb543111.32fbd","name":"Getting New Tracks","auth":"a6321728.b92898","api":"getPlaylistTracks","x":570,"y":680,"wires":[["80b0fa26.712fd8","b3f60fa6.e805c"]]},{"id":"e7d298f8.029078","type":"spotify","z":"fb543111.32fbd","name":"Adding to playlist","auth":"a6321728.b92898","api":"addTracksToPlaylist","x":2690,"y":680,"wires":[["2622c4b4.d74dbc"]]},{"id":"759adb84.8c7584","type":"spotify","z":"fb543111.32fbd","name":"Getting Old Playlist","auth":"a6321728.b92898","api":"getPlaylistTracks","x":1270,"y":680,"wires":[["6f01f934.e84248"]]},{"id":"80b0fa26.712fd8","type":"function","z":"fb543111.32fbd","name":"Top Germany Archive","func":"flow.set(\"topGermanyTracks\", msg.payload.items)\nvar newMsg;\nnewMsg = {\n    \"params\":[\n        '76J4h1CN1vbZltoq7lYB4R',\n        {offset: 0}\n    ]\n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":680,"wires":[["738e6649.989e18"]]},{"id":"6f01f934.e84248","type":"function","z":"fb543111.32fbd","name":"Got all tracks?","func":"var oldAux = flow.get(\"topGermanyOldAux\");\nvar oldArrayAux = flow.get(\"topGermanyOldArrayAux\");\nvar newMsg;\nvar newOldArrayAux;\nif (typeof msg.payload !== 'undefined' ){\n    if (typeof msg.payload.items !== 'undefined' ){\n        newOldArrayAux = oldArrayAux.concat(msg.payload.items);\n    }\n    else{\n        newOldArrayAux = [];\n    }\n}\nelse{\n    newOldArrayAux = [];\n}\n\nfor(var i=0; i<newOldArrayAux.length; ++i) {\n    for(var j=i+1; j<newOldArrayAux.length; ++j) {\n        if(newOldArrayAux[i] === newOldArrayAux[j])\n            newOldArrayAux.splice(j--, 1);\n    }\n}\nflow.set(\"topGermanyOldArrayAux\", newOldArrayAux);\nflow.set(\"topGermanyOldAux\", oldAux+msg.payload.limit);\nif(msg.payload.total > oldAux){\n    newMsg = {\"ajuda\":true};\n}\nelse{\n    newMsg = {\"ajuda\":false,\n        \"tracks\": newOldArrayAux\n    };\n    \n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1480,"y":680,"wires":[["824edb47.5d31e8"]]},{"id":"69e3ad0d.3bd004","type":"inject","z":"fb543111.32fbd","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"00 15 * * 3,4","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":190,"y":680,"wires":[["f4a04de4.8f951"]]},{"id":"f4a04de4.8f951","type":"function","z":"fb543111.32fbd","name":"Top Germany","func":"var newMsg;\nflow.set(\"topGermanyOldAux\", 0);\nflow.set(\"topGermanyOldArrayAux\", []);\nflow.set(\"topGermanyOffset\",100);\nnewMsg = {\n    \"params\":[\n        '6HiZDoQlmYliE3RhFm4Fek'\n    ]\n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":680,"wires":[["504910b0.b4c3a"]]},{"id":"561f3997.631088","type":"switch","z":"fb543111.32fbd","name":"Ajuda?","property":"ajuda","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1880,"y":680,"wires":[["8688156.a6e04e8"],["29498aef.52f096","d54680fc.adc36"]]},{"id":"8688156.a6e04e8","type":"function","z":"fb543111.32fbd","name":"Get Next Array","func":"offsetAux = flow.get(\"topGermanyOffset\");\nflow.set(\"topGermanyOffset\",offsetAux+100);\n\nvar newMsg;\nnewMsg = {\n    \"params\":[\n        '76J4h1CN1vbZltoq7lYB4R',\n        {offset: offsetAux}\n    ]\n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1800,"y":600,"wires":[["759adb84.8c7584"]]},{"id":"29498aef.52f096","type":"function","z":"fb543111.32fbd","name":"New playlist is already added?","func":"var newTracks = flow.get(\"topGermanyTracks\");\nvar oldTracks = msg.tracks;\nvar alreadyIn = false;\nvar newMsg;\nvar auxString;\nfor(var i=0; i<newTracks.length; i++) {\n    alreadyIn = false;\n    for(var j=0; j<oldTracks.length; j++) {\n        if(newTracks[i].track.id === oldTracks[j].track.id){\n            alreadyIn = true\n        }\n    }\n    if(alreadyIn === false){\n        auxString = \"['\" + newTracks[i].track.uri + \"']\"\n        newMsg = {\n            \"params\":[\n                \"76J4h1CN1vbZltoq7lYB4R\",\n                [newTracks[i].track.uri]\n            ]}\n        node.send(newMsg);\n\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2210,"y":680,"wires":[["3a5737c8.627f78","cc2a4c8b.4a35d"]]},{"id":"824edb47.5d31e8","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1680,"y":680,"wires":[["561f3997.631088"]]},{"id":"d54680fc.adc36","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2200,"y":760,"wires":[]},{"id":"738e6649.989e18","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1040,"y":680,"wires":[["759adb84.8c7584"]]},{"id":"3a5737c8.627f78","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2450,"y":680,"wires":[["e7d298f8.029078"]]},{"id":"b3f60fa6.e805c","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":760,"y":740,"wires":[]},{"id":"cc2a4c8b.4a35d","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2490,"y":760,"wires":[]},{"id":"2622c4b4.d74dbc","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2890,"y":760,"wires":[]},{"id":"b295a0b1.88256","type":"spotify","z":"fb543111.32fbd","name":"Getting New Tracks","auth":"a6321728.b92898","api":"getPlaylistTracks","x":570,"y":900,"wires":[["fe2b0242.71988","996edec1.218a7"]]},{"id":"f85ca2d9.debcb","type":"spotify","z":"fb543111.32fbd","name":"Adding to playlist","auth":"a6321728.b92898","api":"addTracksToPlaylist","x":2690,"y":900,"wires":[["9fb635d3.af70b8"]]},{"id":"27402edb.ead3a2","type":"spotify","z":"fb543111.32fbd","name":"Getting Old Playlist","auth":"a6321728.b92898","api":"getPlaylistTracks","x":1270,"y":900,"wires":[["893d0ca1.235c5"]]},{"id":"fe2b0242.71988","type":"function","z":"fb543111.32fbd","name":"Top Danmark Archive","func":"flow.set(\"topDanmarkTracks\", msg.payload.items)\nvar newMsg;\nnewMsg = {\n    \"params\":[\n        '1YlehTYisXGTKxCW3Nm32q',\n        {offset: 0}\n    ]\n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":900,"wires":[["21d2cf91.a7d1d"]]},{"id":"893d0ca1.235c5","type":"function","z":"fb543111.32fbd","name":"Got all tracks?","func":"var oldAux = flow.get(\"topDanmarkOldAux\");\nvar oldArrayAux = flow.get(\"topDanmarkOldArrayAux\");\nvar newMsg;\nvar newOldArrayAux;\nif (typeof msg.payload !== 'undefined' ){\n    if (typeof msg.payload.items !== 'undefined' ){\n            newOldArrayAux = oldArrayAux.concat(msg.payload.items);\n    }\n    else{\n        newOldArrayAux = [];\n    }\n}\nelse{\n    newOldArrayAux = [];\n}\n\nfor(var i=0; i<newOldArrayAux.length; ++i) {\n    for(var j=i+1; j<newOldArrayAux.length; ++j) {\n        if(newOldArrayAux[i] === newOldArrayAux[j])\n            newOldArrayAux.splice(j--, 1);\n    }\n}\nflow.set(\"topDanmarkOldArrayAux\", newOldArrayAux);\nflow.set(\"topDanmarkOldAux\", oldAux+msg.payload.limit);\nif(msg.payload.total > oldAux){\n    newMsg = {\"ajuda\":true};\n}\nelse{\n    newMsg = {\"ajuda\":false,\n        \"tracks\": newOldArrayAux\n    };\n    \n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1480,"y":900,"wires":[["ba6958aa.56c528"]]},{"id":"d0786b4f.0c4398","type":"inject","z":"fb543111.32fbd","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"00 15 * * 3,4","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":190,"y":900,"wires":[["13e5ca96.2d1e05"]]},{"id":"13e5ca96.2d1e05","type":"function","z":"fb543111.32fbd","name":"Top Danmark","func":"var newMsg;\nflow.set(\"topDanmarkOldAux\", 0);\nflow.set(\"topDanmarkOldArrayAux\", []);\nflow.set(\"topDanmarkOffset\",100);\nnewMsg = {\n    \"params\":[\n        '3YJe3cIXVuL3Eh3b5QoEu1'\n    ]\n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":900,"wires":[["b295a0b1.88256"]]},{"id":"a6f362cb.36525","type":"switch","z":"fb543111.32fbd","name":"Ajuda?","property":"ajuda","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1880,"y":900,"wires":[["d74242c4.d21e3"],["3823fa93.eda0e6","53df31a3.d7c5f"]]},{"id":"d74242c4.d21e3","type":"function","z":"fb543111.32fbd","name":"Get Next Array","func":"offsetAux = flow.get(\"topDanmarkOffset\");\nflow.set(\"topDanmarkOffset\",offsetAux+100);\n\nvar newMsg;\nnewMsg = {\n    \"params\":[\n        '1YlehTYisXGTKxCW3Nm32q',\n        {offset: offsetAux}\n    ]\n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1800,"y":820,"wires":[["27402edb.ead3a2"]]},{"id":"3823fa93.eda0e6","type":"function","z":"fb543111.32fbd","name":"New playlist is already added?","func":"var newTracks = flow.get(\"topDanmarkTracks\");\nvar oldTracks = msg.tracks;\nvar alreadyIn = false;\nvar newMsg;\nvar auxString;\nfor(var i=0; i<newTracks.length; i++) {\n    alreadyIn = false;\n    for(var j=0; j<oldTracks.length; j++) {\n        if(newTracks[i].track.id === oldTracks[j].track.id){\n            alreadyIn = true\n        }\n    }\n    if(alreadyIn === false){\n        auxString = \"['\" + newTracks[i].track.uri + \"']\"\n        newMsg = {\n            \"params\":[\n                \"1YlehTYisXGTKxCW3Nm32q\",\n                [newTracks[i].track.uri]\n            ]}\n        node.send(newMsg);\n\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2210,"y":900,"wires":[["d8e11156.00cbc","ef7f435d.f1d91"]]},{"id":"ba6958aa.56c528","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1680,"y":900,"wires":[["a6f362cb.36525"]]},{"id":"53df31a3.d7c5f","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2200,"y":980,"wires":[]},{"id":"21d2cf91.a7d1d","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1040,"y":900,"wires":[["27402edb.ead3a2"]]},{"id":"d8e11156.00cbc","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2450,"y":900,"wires":[["f85ca2d9.debcb"]]},{"id":"996edec1.218a7","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":760,"y":960,"wires":[]},{"id":"ef7f435d.f1d91","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2490,"y":980,"wires":[]},{"id":"9fb635d3.af70b8","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2890,"y":980,"wires":[]},{"id":"234ae7bd.80e9d8","type":"spotify","z":"fb543111.32fbd","name":"Getting New Tracks","auth":"a6321728.b92898","api":"getPlaylistTracks","x":570,"y":1100,"wires":[["cfcc3aa9.ba1568","d2575458.c99c78"]]},{"id":"b445e284.948ca","type":"spotify","z":"fb543111.32fbd","name":"Adding to playlist","auth":"a6321728.b92898","api":"addTracksToPlaylist","x":2690,"y":1100,"wires":[["5dc4c408.83d87c"]]},{"id":"2f4d6571.550a5a","type":"spotify","z":"fb543111.32fbd","name":"Getting Old Playlist","auth":"a6321728.b92898","api":"getPlaylistTracks","x":1270,"y":1100,"wires":[["4a165955.e4d798"]]},{"id":"cfcc3aa9.ba1568","type":"function","z":"fb543111.32fbd","name":"Global X Archive","func":"flow.set(\"globalXTracks\", msg.payload.items)\nvar newMsg;\nnewMsg = {\n    \"params\":[\n        '50W5L0TYBG4YG8mWjGFRPl',\n        {offset: 0}\n    ]\n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":1100,"wires":[["416af018.cd715"]]},{"id":"4a165955.e4d798","type":"function","z":"fb543111.32fbd","name":"Got all tracks?","func":"var oldAux = flow.get(\"globalXOldAux\");\nvar oldArrayAux = flow.get(\"globalXOldArrayAux\");\nvar newMsg;\nvar newOldArrayAux;\nif (typeof msg.payload !== 'undefined' ){\n    if (typeof msg.payload.items !== 'undefined' ){\n        newOldArrayAux = oldArrayAux.concat(msg.payload.items);\n    }\n    else{\n        newOldArrayAux = [];\n    }\n}\nelse{\n    newOldArrayAux = [];\n}\n\nfor(var i=0; i<newOldArrayAux.length; ++i) {\n    for(var j=i+1; j<newOldArrayAux.length; ++j) {\n        if(newOldArrayAux[i] === newOldArrayAux[j])\n            newOldArrayAux.splice(j--, 1);\n    }\n}\nflow.set(\"globalXOldArrayAux\", newOldArrayAux);\nflow.set(\"globalXOldAux\", oldAux+msg.payload.limit);\nif(msg.payload.total > oldAux){\n    newMsg = {\"ajuda\":true};\n}\nelse{\n    newMsg = {\"ajuda\":false,\n        \"tracks\": newOldArrayAux\n    };\n    \n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1480,"y":1100,"wires":[["f64b68a2.28b208"]]},{"id":"e188ecc8.c412a","type":"inject","z":"fb543111.32fbd","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"00 16 * * 4","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":190,"y":1100,"wires":[["9b1f1c61.68d8f"]]},{"id":"9b1f1c61.68d8f","type":"function","z":"fb543111.32fbd","name":"Global X","func":"var newMsg;\nflow.set(\"globalXOldAux\", 0);\nflow.set(\"globalXOldArrayAux\", []);\nflow.set(\"globalXOffset\",100);\nnewMsg = {\n    \"params\":[\n        '37i9dQZF1DWUxHPh2rEiHr'\n    ]\n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":340,"y":1100,"wires":[["234ae7bd.80e9d8"]]},{"id":"2e2a2eaa.4d9ca2","type":"switch","z":"fb543111.32fbd","name":"Ajuda?","property":"ajuda","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1880,"y":1100,"wires":[["e8e1a4bb.c0b818"],["4fa5e113.8c6ad","bb26d005.d4e42"]]},{"id":"e8e1a4bb.c0b818","type":"function","z":"fb543111.32fbd","name":"Get Next Array","func":"offsetAux = flow.get(\"globalXOffset\");\nflow.set(\"globalXOffset\",offsetAux+100);\n\nvar newMsg;\nnewMsg = {\n    \"params\":[\n        '50W5L0TYBG4YG8mWjGFRPl',\n        {offset: offsetAux}\n    ]\n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1800,"y":1020,"wires":[["2f4d6571.550a5a"]]},{"id":"4fa5e113.8c6ad","type":"function","z":"fb543111.32fbd","name":"New playlist is already added?","func":"var newTracks = flow.get(\"globalXTracks\");\nvar oldTracks = msg.tracks;\nvar alreadyIn = false;\nvar newMsg;\nvar auxString;\nfor(var i=0; i<newTracks.length; i++) {\n    alreadyIn = false;\n    for(var j=0; j<oldTracks.length; j++) {\n        if(newTracks[i].track.id === oldTracks[j].track.id){\n            alreadyIn = true\n        }\n    }\n    if(alreadyIn === false){\n        auxString = \"['\" + newTracks[i].track.uri + \"']\"\n        newMsg = {\n            \"params\":[\n                \"50W5L0TYBG4YG8mWjGFRPl\",\n                [newTracks[i].track.uri]\n            ]}\n        node.send(newMsg);\n\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2210,"y":1100,"wires":[["bf70228a.b98f2","8c6371c2.fbfff"]]},{"id":"f64b68a2.28b208","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1680,"y":1100,"wires":[["2e2a2eaa.4d9ca2"]]},{"id":"bb26d005.d4e42","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2200,"y":1180,"wires":[]},{"id":"416af018.cd715","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1040,"y":1100,"wires":[["2f4d6571.550a5a"]]},{"id":"bf70228a.b98f2","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2450,"y":1100,"wires":[["b445e284.948ca"]]},{"id":"d2575458.c99c78","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":760,"y":1160,"wires":[]},{"id":"8c6371c2.fbfff","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2490,"y":1180,"wires":[]},{"id":"5dc4c408.83d87c","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2890,"y":1180,"wires":[]},{"id":"e6c78554.156448","type":"spotify","z":"fb543111.32fbd","name":"Getting New Tracks","auth":"a6321728.b92898","api":"getPlaylistTracks","x":570,"y":1320,"wires":[["63b3d9c5.76cda8","eb07cb14.a762d8"]]},{"id":"4a12ad14.51f6a4","type":"spotify","z":"fb543111.32fbd","name":"Adding to playlist","auth":"a6321728.b92898","api":"addTracksToPlaylist","x":2690,"y":1320,"wires":[["30a5ff3d.2e875"]]},{"id":"cbcc74ce.664968","type":"spotify","z":"fb543111.32fbd","name":"Getting Old Playlist","auth":"a6321728.b92898","api":"getPlaylistTracks","x":1270,"y":1320,"wires":[["481c35a.f7f31cc","ad73b169.3a9c5"]]},{"id":"63b3d9c5.76cda8","type":"function","z":"fb543111.32fbd","name":"Top Finland Archive","func":"flow.set(\"topFinlandTracks\", msg.payload.items)\nvar newMsg;\nnewMsg = {\n    \"params\":[\n        '2FbFhJ9br4ACkAzSWQTlte',\n        {offset: 0}\n    ]\n}\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":1320,"wires":[["260c1fbd.e5a9f"]]},{"id":"481c35a.f7f31cc","type":"function","z":"fb543111.32fbd","name":"Got all tracks?","func":"var oldAux = flow.get(\"topFinlandOldAux\");\nvar oldArrayAux = flow.get(\"topFinlandOldArrayAux\");\nvar newMsg;\nvar newOldArrayAux;\nif (typeof msg.payload !== 'undefined' ){\n    if (typeof msg.payload.items !== 'undefined' ){\n        newOldArrayAux = oldArrayAux.concat(msg.payload.items);\n    }\n    else{\n        newOldArrayAux = [];\n    }\n}\nelse{\n    newOldArrayAux = [];\n}\n\nfor(var i=0; i<newOldArrayAux.length; ++i) {\n    for(var j=i+1; j<newOldArrayAux.length; ++j) {\n        if(newOldArrayAux[i] === newOldArrayAux[j])\n            newOldArrayAux.splice(j--, 1);\n    }\n}\nflow.set(\"topFinlandOldArrayAux\", newOldArrayAux);\nflow.set(\"topFinlandOldAux\", oldAux+msg.payload.limit);\nif(msg.payload.total > oldAux){\n    newMsg = {\"ajuda\":true};\n}\nelse{\n    newMsg = {\"ajuda\":false,\n        \"tracks\": newOldArrayAux\n    };\n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1480,"y":1320,"wires":[["3f9be303.24e02c"]]},{"id":"2a03ea9b.398346","type":"inject","z":"fb543111.32fbd","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"00 17 * * 3,4","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":190,"y":1320,"wires":[["36971830.f3b658"]]},{"id":"36971830.f3b658","type":"function","z":"fb543111.32fbd","name":"Top Finland","func":"var newMsg;\nflow.set(\"topFinlandOldAux\", 0);\nflow.set(\"topFinlandOldArrayAux\", []);\nflow.set(\"topFinlandOffset\",100);\nnewMsg = {\n    \"params\":[\n        '37i9dQZEVXbMxcczTSoGwZ'\n    ]\n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":1320,"wires":[["e6c78554.156448"]]},{"id":"c8bdc1a8.89bcc","type":"switch","z":"fb543111.32fbd","name":"Ajuda?","property":"ajuda","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":1880,"y":1320,"wires":[["a55baab7.3cbc68"],["1bf228ed.0cf827","c7125bc7.2ff1c8"]]},{"id":"a55baab7.3cbc68","type":"function","z":"fb543111.32fbd","name":"Get Next Array","func":"discoverWeeklyOffset = flow.get(\"topFinlandOffset\");\nflow.set(\"topFinlandOffset\",discoverWeeklyOffset+100);\n\nvar newMsg;\nnewMsg = {\n    \"params\":[\n        '2FbFhJ9br4ACkAzSWQTlte',\n        {offset: discoverWeeklyOffset}\n    ]\n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1800,"y":1240,"wires":[["cbcc74ce.664968"]]},{"id":"1bf228ed.0cf827","type":"function","z":"fb543111.32fbd","name":"New playlist is already added?","func":"var newTracks = flow.get(\"topFinlandTracks\");\nvar oldTracks = msg.tracks;\nvar alreadyIn = false;\nvar newMsg;\nvar auxString;\nvar i;\n        for(i=0; i<newTracks.length; i++) {\n            alreadyIn = false;\n            for(var j=0; j<oldTracks.length; j++) {\n                if(newTracks[i].track.id === oldTracks[j].track.id){\n                    alreadyIn = true\n                }\n            }\n            if(alreadyIn === false){\n                auxString = \"['\" + newTracks[i].track.uri + \"']\"\n                newMsg = {\n                    \"params\":[\n                        \"2FbFhJ9br4ACkAzSWQTlte\",\n                        [newTracks[i].track.uri]\n                    ]}\n                node.send(newMsg);\n        \n            }\n        }","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2210,"y":1320,"wires":[["4742d14d.72889","458df5d4.4be52c"]]},{"id":"3f9be303.24e02c","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1680,"y":1320,"wires":[["c8bdc1a8.89bcc"]]},{"id":"c7125bc7.2ff1c8","type":"debug","z":"fb543111.32fbd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2200,"y":1400,"wires":[]},{"id":"260c1fbd.e5a9f","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1040,"y":1320,"wires":[["cbcc74ce.664968"]]},{"id":"4742d14d.72889","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2450,"y":1320,"wires":[["4a12ad14.51f6a4"]]},{"id":"eb07cb14.a762d8","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":760,"y":1380,"wires":[]},{"id":"458df5d4.4be52c","type":"debug","z":"fb543111.32fbd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2490,"y":1400,"wires":[]},{"id":"30a5ff3d.2e875","type":"debug","z":"fb543111.32fbd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2890,"y":1400,"wires":[]},{"id":"ad73b169.3a9c5","type":"debug","z":"fb543111.32fbd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1450,"y":1380,"wires":[]},{"id":"d27e85b0.029a68","type":"delay","z":"c3bc1a43.254dd","name":"","pauseType":"delay","timeout":"20","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1330,"y":340,"wires":[["7af1ac1.13d72d4"]]},{"id":"d9294359.c0af3","type":"debug","z":"1f49f273.0f37be","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1050,"y":4120,"wires":[]},{"id":"a1e14347.244a3","type":"debug","z":"1f49f273.0f37be","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":770,"y":4120,"wires":[]},{"id":"c394c9d6.df16e8","type":"delay","z":"1f49f273.0f37be","name":"","pauseType":"delay","timeout":"7","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":780,"y":1680,"wires":[["892505d6.c923a8","995baada.564918","4f8cbd04.9da104","6ca58497.6becec"]]},{"id":"892505d6.c923a8","type":"function","z":"1f49f273.0f37be","name":"Notificação","func":"\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"mqtt\",\n    \"service\": \"publish\",\n    data:{\n        \n          topic: \"iotlink/workgroup/soft-pc/commands/notify\",\n          payload: '{ \"title\": \"Café pronto\", \"message\": \"O café está pronto\"}'\n  \n\n    }\n    }};\n    \n    return newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1050,"y":1700,"wires":[["f833ed40.d9ca"]]},{"id":"f833ed40.d9ca","type":"api-call-service","z":"1f49f273.0f37be","name":"PC","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"mqtt","service":"publish","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1210,"y":1700,"wires":[[]]},{"id":"d909d257.71427","type":"function","z":"9639036b.0a3a6","name":"Notificação","func":"\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"mqtt\",\n    \"service\": \"publish\",\n    data:{\n        \n          topic: \"iotlink/workgroup/soft-pc/commands/notify\",\n          payload: '{ \"title\": \"Café pronto\", \"message\": \"O café está pronto\"}'\n  \n\n    }\n    }};\n    \n    return newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":990,"y":1740,"wires":[["2a29255d.d1202a"]]},{"id":"2a29255d.d1202a","type":"api-call-service","z":"9639036b.0a3a6","name":"PC","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"mqtt","service":"publish","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1170,"y":1740,"wires":[[]]},{"id":"4862eabb.f4ee24","type":"function","z":"1f49f273.0f37be","name":"Notificação","func":"if(msg.payload === \"home\"){\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_nedis_iphone\",\n    data:{\n        \n         message: `{{ [\n             \"O Café está pronto.\",\n             \"O Café está prontinho.\",\n             \"Tem café quentinho na cozinha.\",\n             \"Tem café na cozinha.\",\n             \"Corre pra cozinha, o café está pronto.\",\n             \"O Café está pronto na cozinha.\",\n             \"O Café está quentinho te esperando.\"\n         ]|random }}`\n  \n\n    }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1250,"y":1760,"wires":[["76cbf4ed.20f59c"]]},{"id":"76cbf4ed.20f59c","type":"api-call-service","z":"1f49f273.0f37be","name":"Notify Nédi's iPhone","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_nedis_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1460,"y":1760,"wires":[[]]},{"id":"57eeaeff.7b12d","type":"api-current-state","z":"c3bc1a43.254dd","name":"Vou Dormir","server":"d63d21ef.5e065","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.vou_dormir","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":890,"y":800,"wires":[["1e22b7e.5f64ec8","b33b0b20.79d868"],["1e22b7e.5f64ec8","b33b0b20.79d868"]]},{"id":"2871b458.b74b9c","type":"link in","z":"ccb6d071.13253","name":"Botao Quarto","links":["26b4a3b2.dc164c","7f6d2d52.017e94"],"x":215,"y":1400,"wires":[["c088a6a2.afb6e8","4e494f43.429e78"]]},{"id":"aa28b066.cd5a8","type":"debug","z":"ccb6d071.13253","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":870,"y":1420,"wires":[]},{"id":"2b003b97.c1ab64","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1520,"y":1220,"wires":[["4b9b5fc8.18359"]]},{"id":"449a7aae.d2eba4","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1520,"y":1340,"wires":[["8ae02b9f.1599d8"]]},{"id":"ad7b4188.54dda","type":"function","z":"ccb6d071.13253","name":"In Case of Error","func":"var newMsg;\nnewMsg = {payload:{\"On\":true}}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1360,"y":1340,"wires":[["449a7aae.d2eba4"]]},{"id":"b59eb7ec.167468","type":"function","z":"ccb6d071.13253","name":"In Case of Error","func":"var newMsg;\nnewMsg = {payload:true}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1360,"y":1220,"wires":[["2b003b97.c1ab64"]]},{"id":"bd727ec8.7b86c","type":"inject","z":"1aa34a9.7045335","name":"Liga a Luz","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":"","topic":"","payload":"1","payloadType":"str","x":720,"y":140,"wires":[["8fa5a15c.bd41a"]]},{"id":"2384b6c0.c0682a","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":880,"y":1020,"wires":[["ee67748b.840a58"]]},{"id":"426d0485.4cc6dc","type":"function","z":"1aa34a9.7045335","name":"In Case of Error","func":"var newMsg;\nnewMsg = {payload:true}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":1020,"wires":[["2384b6c0.c0682a"]]},{"id":"20cec006.5f69f","type":"function","z":"1aa34a9.7045335","name":"In Case of Error","func":"var newMsg;\nnewMsg = {payload:{\"On\":true}}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":1140,"wires":[["45ef6754.7711e8"]]},{"id":"45ef6754.7711e8","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":880,"y":1140,"wires":[["eb8ff5bd.7a0938"]]},{"id":"d5617b3a.5bb628","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"rate","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1280,"y":1060,"wires":[["690a6dbe.bc1064"]]},{"id":"dd51985a.ecb848","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"rate","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1280,"y":1180,"wires":[["690a6dbe.bc1064"]]},{"id":"ee393f5d.b8373","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1280,"y":960,"wires":[["690a6dbe.bc1064"]]},{"id":"6c512738.7e02e8","type":"function","z":"ecc79e8a.d4a1b","name":"In Case of Error","func":"var newMsg;\nnewMsg = {payload:true}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":860,"wires":[["908655d0.8ecf68"]]},{"id":"908655d0.8ecf68","type":"delay","z":"ecc79e8a.d4a1b","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":780,"y":860,"wires":[["6c73045b.dca7fc"]]},{"id":"8a76eced.b9499","type":"delay","z":"ecc79e8a.d4a1b","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1280,"y":920,"wires":[["2d78271d.1500a8"]]},{"id":"92dd7dd.20ea28","type":"delay","z":"ecc79e8a.d4a1b","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1280,"y":800,"wires":[["2d78271d.1500a8"]]},{"id":"85534b31.5bf4c8","type":"comment","z":"1aa34a9.7045335","name":"Ajuda do Sensor de Movimento","info":"","x":310,"y":1480,"wires":[]},{"id":"e8673b66.1a9ce8","type":"inject","z":"9639036b.0a3a6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"30 00 * * 1,2,3,4,0","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":310,"y":1520,"wires":[["e1f5d911.80a018"]]},{"id":"eb63eb21.571e68","type":"inject","z":"9639036b.0a3a6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 00 * * 1,2,3,4,0","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":310,"y":1460,"wires":[["47e4f705.067828"]]},{"id":"2ea0505c.1a62f","type":"inject","z":"9639036b.0a3a6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 01 * * 1,2,3,4,0","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":310,"y":1580,"wires":[["2cff6b16.af2cf4"]]},{"id":"47e4f705.067828","type":"function","z":"9639036b.0a3a6","name":"Volume 12","func":"if(global.get(\"horaDoFilme\") === false){\n    var newMsg;\n    newMsg = {payload:{}}\n    newMsg.payload = {\n        \"domain\": \"media_player\",\n        \"service\": \"play_media\",\n        \"entity_id\": \"media_player.tv_da_sala\",\n        \"data\":{\n          \"entity_id\": \"media_player.tv_da_sala\",\n          \"media_content_type\": \"send_key\",\n          \"media_content_id\": \"ST_VOL12\"\n        }\n    }\n        return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":1460,"wires":[["a164cfa2.127c1"]]},{"id":"e1f5d911.80a018","type":"function","z":"9639036b.0a3a6","name":"Volume 10","func":"if(global.get(\"horaDoFilme\") === false){\n    var newMsg;\n    newMsg = {payload:{}}\n    newMsg.payload = {\n        \"domain\": \"media_player\",\n        \"service\": \"play_media\",\n        \"entity_id\": \"media_player.tv_da_sala\",\n        \"data\":{\n          \"entity_id\": \"media_player.tv_da_sala\",\n          \"media_content_type\": \"send_key\",\n          \"media_content_id\": \"ST_VOL10\"\n        }\n    }\n        return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":1520,"wires":[["a164cfa2.127c1"]]},{"id":"2cff6b16.af2cf4","type":"function","z":"9639036b.0a3a6","name":"Volume 8","func":"if(global.get(\"horaDoFilme\") === false){\n    var newMsg;\n    newMsg = {payload:{}}\n    newMsg.payload = {\n        \"domain\": \"media_player\",\n        \"service\": \"play_media\",\n        \"entity_id\": \"media_player.tv_da_sala\",\n        \"data\":{\n          \"entity_id\": \"media_player.tv_da_sala\",\n          \"media_content_type\": \"send_key\",\n          \"media_content_id\": \"ST_VOL8\"\n        }\n    }\n        return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":1580,"wires":[["a164cfa2.127c1"]]},{"id":"aef6c737.67adb8","type":"alexa-remote-routine","z":"9639036b.0a3a6","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":"O café está sendo preparado"},"volume":{"type":"num","value":"30"},"mode":"set","devices":["G090XG0793271TAE"]}},"x":630,"y":1840,"wires":[[]]},{"id":"a7400577.7e50e8","type":"function","z":"ecc79e8a.d4a1b","name":"Luz da Sala On","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_on\",\n        \"data\":{\n            \"entity_id\": \"light.luz_da_sala\",\n            \"brightness_pct\": 100,\n            \"kelvin\": 6200\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2300,"y":820,"wires":[["d4eddeb9.da03f"]]},{"id":"129bf791.cece58","type":"catch","z":"1d7ecdc6.68c842","name":"","scope":null,"uncaught":false,"x":240,"y":2480,"wires":[["ba3d3dd4.55421","e02329fe.56ef88"]]},{"id":"a8bdf1d.5e1d01","type":"alexa-remote-routine","z":"1d7ecdc6.68c842","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"announcement","text":{"type":"str","value":"Erro na automação do Aqara Sensores"},"volume":{"type":"num","value":"30"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":1450,"y":2340,"wires":[[]]},{"id":"c2a35fb5.a453","type":"pushbullet","z":"1d7ecdc6.68c842","config":"8e6fc0d2.d9006","pushtype":"note","title":"Erro em uma automação no Aqara Sensores Automation","chan":"","name":"","x":1430,"y":2460,"wires":[]},{"id":"6d1f834b.01affc","type":"e-mail","z":"1d7ecdc6.68c842","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"nedisonn@me.com","dname":"","x":1310,"y":2520,"wires":[]},{"id":"3d252925.f61f06","type":"function","z":"1d7ecdc6.68c842","name":"Create Error Message","func":"if(global.get(\"CatchErrors\") === false || global.get(\"ContCatchErrors\") > 4){\n    global.set(\"CatchErrors\", true);\n    msg = Object.assign({}, msg, {topic:\"Erro em uma automação no Aqara Sensores.\"});\n\n    if(Array.isArray(msg.error) === true){\n        msg.payload = \" \";  \n     \n        for(var i = 0; i < 5; i++){\n            msg.payload = msg.payload + \"Erro numero \"+ i +\n            \"id: \" + msg.error[i].source.id+\". \"+\n            msg.error[i].source.name+ \". Tipo de erro:\" + \n            msg.error[i].source.type + \". Mensagem: \" +\n            msg.error[i].message + \"\\n\\n\";\n            \n        }\n    }\n    else{\n        msg.payload = \"Erro \"+ msg.error.source.id+\" \"+\n        msg.error.source.name+ \". Tipo de erro:\" + \n        msg.error.source.type + \". Mensagem: \" +\n        msg.error.message;\n    }\n   \n        return msg;\n}\n\nglobal.set(\"ContCatchErrors\", 0);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1060,"y":2460,"wires":[["c2a35fb5.a453","6d1f834b.01affc","ea62959f.60dda8"]]},{"id":"ba3d3dd4.55421","type":"delay","z":"1d7ecdc6.68c842","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":310,"y":2600,"wires":[["5bbeb9b9.f21f18"]]},{"id":"5bbeb9b9.f21f18","type":"function","z":"1d7ecdc6.68c842","name":"Reset Aux Variables","func":"global.set(\"CatchErrors\",false);\nglobal.set(\"ContCatchErrors\", 0);\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":2600,"wires":[[]]},{"id":"cc115c5b.59406","type":"join","z":"1d7ecdc6.68c842","name":"","mode":"custom","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n\\n","joinerType":"str","accumulate":false,"timeout":"","count":"5","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":890,"y":2520,"wires":[["3d252925.f61f06"]]},{"id":"83e88229.0a6fd","type":"switch","z":"1d7ecdc6.68c842","name":"","property":"ajuda","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":750,"y":2480,"wires":[["3d252925.f61f06"],["cc115c5b.59406"]]},{"id":"2d376ec6.ed2e52","type":"function","z":"1d7ecdc6.68c842","name":"Cont++","func":"if(global.get(\"ContCatchErrors\") === 0){\n\n    global.set(\"ContCatchErrors\", 1);\n    msg.ajuda = 1;    \n    return msg;\n}\nif(global.get(\"ContCatchErrors\") > 0){\n    global.set(\"ContCatchErrors\",global.get(\"ContCatchErrors\")+1);\n    msg.ajuda = 2;\n    return msg;\n    \n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":2480,"wires":[["83e88229.0a6fd"]]},{"id":"ea62959f.60dda8","type":"function","z":"1d7ecdc6.68c842","name":"Check if it's day","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nif(Hour < 23 && Hour > 10){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1250,"y":2420,"wires":[["a8bdf1d.5e1d01","a56205eb.0ec368"]]},{"id":"ba5aaafa.6409b8","type":"comment","z":"1d7ecdc6.68c842","name":"Catching Errors and notifying","info":"","x":280,"y":2420,"wires":[]},{"id":"a56205eb.0ec368","type":"delay","z":"1d7ecdc6.68c842","name":"","pauseType":"delay","timeout":"8","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1440,"y":2420,"wires":[["ee479356.1ef42"]]},{"id":"e02329fe.56ef88","type":"switch","z":"1d7ecdc6.68c842","name":"","property":"error.message","propertyType":"msg","rules":[{"t":"cont","v":"unexpected response","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":390,"y":2480,"wires":[[],["2d376ec6.ed2e52"]]},{"id":"ee479356.1ef42","type":"alexa-remote-routine","z":"1d7ecdc6.68c842","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":""},"volume":{"type":"num","value":"40"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":1650,"y":2400,"wires":[[]]},{"id":"c4161cee.34234","type":"catch","z":"9639036b.0a3a6","name":"","scope":null,"uncaught":false,"x":240,"y":4000,"wires":[["d50bf25f.7814c","2ab9e88e.23fd88"]]},{"id":"d11f3af7.13d898","type":"alexa-remote-routine","z":"9639036b.0a3a6","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"announcement","text":{"type":"str","value":"Erro na automação do Home Assistant Automações"},"volume":{"type":"num","value":"30"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":1450,"y":3860,"wires":[[]]},{"id":"3983c659.dc521a","type":"pushbullet","z":"9639036b.0a3a6","config":"8e6fc0d2.d9006","pushtype":"note","title":"Erro em uma automação no Home Assistant Automation","chan":"","name":"","x":1430,"y":3980,"wires":[]},{"id":"8e271acd.e8fd28","type":"e-mail","z":"9639036b.0a3a6","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"nedisonn@me.com","dname":"","x":1310,"y":4040,"wires":[]},{"id":"748a0586.e87bbc","type":"function","z":"9639036b.0a3a6","name":"Create Error Message","func":"if(global.get(\"CatchErrors\") === false || global.get(\"ContCatchErrors\") > 4){\n    global.set(\"CatchErrors\", true);\n    msg = Object.assign({}, msg, {topic:\"Erro em uma automação no Home Assistant Automation.\"});\n\n    if(Array.isArray(msg.error) === true){\n        msg.payload = \" \";  \n     \n        for(var i = 0; i < 5; i++){\n            msg.payload = msg.payload + \"Erro numero \"+ i +\n            \"id: \" + msg.error[i].source.id+\". \"+\n            msg.error[i].source.name+ \". Tipo de erro:\" + \n            msg.error[i].source.type + \". Mensagem: \" +\n            msg.error[i].message + \"\\n\\n\";\n            \n        }\n    }\n    else{\n        msg.payload = \"Erro \"+ msg.error.source.id+\" \"+\n        msg.error.source.name+ \". Tipo de erro:\" + \n        msg.error.source.type + \". Mensagem: \" +\n        msg.error.message;\n    }\n   \n        return msg;\n}\n\nglobal.set(\"ContCatchErrors\", 0);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1060,"y":3980,"wires":[["3983c659.dc521a","8e271acd.e8fd28","1f6a02d3.f17abd"]]},{"id":"d50bf25f.7814c","type":"delay","z":"9639036b.0a3a6","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":310,"y":4120,"wires":[["dc1c80fb.5e332"]]},{"id":"dc1c80fb.5e332","type":"function","z":"9639036b.0a3a6","name":"Reset Aux Variables","func":"global.set(\"CatchErrors\",false);\nglobal.set(\"ContCatchErrors\", 0);\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":4120,"wires":[[]]},{"id":"d78ed7bd.5bb468","type":"join","z":"9639036b.0a3a6","name":"","mode":"custom","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n\\n","joinerType":"str","accumulate":false,"timeout":"","count":"5","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":890,"y":4040,"wires":[["748a0586.e87bbc"]]},{"id":"4c7da090.9366c","type":"switch","z":"9639036b.0a3a6","name":"","property":"ajuda","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":750,"y":4000,"wires":[["748a0586.e87bbc"],["d78ed7bd.5bb468"]]},{"id":"3a9feb43.9f0344","type":"function","z":"9639036b.0a3a6","name":"Cont++","func":"if(!msg.error[i].message.includes('Conflict'))\n{\n    if(global.get(\"ContCatchErrors\") === 0){\n\n        global.set(\"ContCatchErrors\", 1);\n        msg.ajuda = 1;    \n        return msg;\n    }\n    if(global.get(\"ContCatchErrors\") > 0){\n        global.set(\"ContCatchErrors\",global.get(\"ContCatchErrors\")+1);\n        msg.ajuda = 2;\n        return msg;\n        \n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":4000,"wires":[["4c7da090.9366c"]]},{"id":"1f6a02d3.f17abd","type":"function","z":"9639036b.0a3a6","name":"Check if it's day","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nif(Hour < 23 && Hour > 10){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1250,"y":3940,"wires":[["d11f3af7.13d898","b2fc46e7.36d218"]]},{"id":"dee2c3f6.4f8e7","type":"comment","z":"9639036b.0a3a6","name":"Catching Errors and notifying","info":"","x":280,"y":3940,"wires":[]},{"id":"b2fc46e7.36d218","type":"delay","z":"9639036b.0a3a6","name":"","pauseType":"delay","timeout":"8","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1440,"y":3940,"wires":[["9413323.00618d"]]},{"id":"2ab9e88e.23fd88","type":"switch","z":"9639036b.0a3a6","name":"","property":"error.message","propertyType":"msg","rules":[{"t":"cont","v":"unexpected response","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":390,"y":4000,"wires":[[],["3a9feb43.9f0344"]]},{"id":"9413323.00618d","type":"alexa-remote-routine","z":"9639036b.0a3a6","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":""},"volume":{"type":"num","value":"40"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":1650,"y":3920,"wires":[[]]},{"id":"428f33d1.ce1b1c","type":"catch","z":"fb543111.32fbd","name":"","scope":null,"uncaught":false,"x":220,"y":2360,"wires":[["3cb82494.4507ec","49b598d5.e56178"]]},{"id":"e7e81e7.19aa6e","type":"alexa-remote-routine","z":"fb543111.32fbd","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"announcement","text":{"type":"str","value":"Erro na automação do Spotify Helpers"},"volume":{"type":"num","value":"30"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":1430,"y":2220,"wires":[[]]},{"id":"5a0228fd.662a98","type":"pushbullet","z":"fb543111.32fbd","config":"8e6fc0d2.d9006","pushtype":"note","title":"Erro em uma automação no Spotify Helpers","chan":"","name":"","x":1370,"y":2340,"wires":[]},{"id":"3495461.d7484ba","type":"e-mail","z":"fb543111.32fbd","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"nedisonn@me.com","dname":"","x":1290,"y":2400,"wires":[]},{"id":"7631aa5f.7fc314","type":"function","z":"fb543111.32fbd","name":"Create Error Message","func":"if(global.get(\"CatchErrors\") === false || global.get(\"ContCatchErrors\") > 4){\n    global.set(\"CatchErrors\", true);\n    msg = Object.assign({}, msg, {topic:\"Erro em uma automação no Spotify Helpers.\"});\n\n    if(Array.isArray(msg.error) === true){\n        msg.payload = \" \";  \n     \n        for(var i = 0; i < 5; i++){\n            msg.payload = msg.payload + \"Erro numero \"+ i +\n            \"id: \" + msg.error[i].source.id+\". \"+\n            msg.error[i].source.name+ \". Tipo de erro:\" + \n            msg.error[i].source.type + \". Mensagem: \" +\n            msg.error[i].message + \"\\n\\n\";\n            \n        }\n    }\n    else{\n        msg.payload = \"Erro \"+ msg.error.source.id+\" \"+\n        msg.error.source.name+ \". Tipo de erro:\" + \n        msg.error.source.type + \". Mensagem: \" +\n        msg.error.message;\n    }\n   \n        return msg;\n}\n\nglobal.set(\"ContCatchErrors\", 0);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1040,"y":2340,"wires":[["5a0228fd.662a98","3495461.d7484ba","def9008.53164"]]},{"id":"3cb82494.4507ec","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":290,"y":2480,"wires":[["24e354dd.b11b5c"]]},{"id":"24e354dd.b11b5c","type":"function","z":"fb543111.32fbd","name":"Reset Aux Variables","func":"global.set(\"CatchErrors\",false);\nglobal.set(\"ContCatchErrors\", 0);\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":2480,"wires":[[]]},{"id":"b129d353.3434a","type":"join","z":"fb543111.32fbd","name":"","mode":"custom","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n\\n","joinerType":"str","accumulate":false,"timeout":"","count":"5","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":870,"y":2400,"wires":[["7631aa5f.7fc314"]]},{"id":"d152b689.5fa4d8","type":"switch","z":"fb543111.32fbd","name":"","property":"ajuda","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":730,"y":2360,"wires":[["7631aa5f.7fc314"],["b129d353.3434a"]]},{"id":"df0da37f.0edfb","type":"function","z":"fb543111.32fbd","name":"Cont++","func":"if(global.get(\"ContCatchErrors\") === 0){\n\n    global.set(\"ContCatchErrors\", 1);\n    msg.ajuda = 1;    \n    return msg;\n}\nif(global.get(\"ContCatchErrors\") > 0){\n    global.set(\"ContCatchErrors\",global.get(\"ContCatchErrors\")+1);\n    msg.ajuda = 2;\n    return msg;\n    \n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":2360,"wires":[["d152b689.5fa4d8"]]},{"id":"def9008.53164","type":"function","z":"fb543111.32fbd","name":"Check if it's day","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nif(Hour < 23 && Hour > 10){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1230,"y":2300,"wires":[["e7e81e7.19aa6e","ad025c5d.eea3e"]]},{"id":"8e205eb9.f5e9","type":"comment","z":"fb543111.32fbd","name":"Catching Errors and notifying","info":"","x":260,"y":2300,"wires":[]},{"id":"ad025c5d.eea3e","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"delay","timeout":"8","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1420,"y":2300,"wires":[["7f16ad37.c32134"]]},{"id":"49b598d5.e56178","type":"switch","z":"fb543111.32fbd","name":"","property":"error.message","propertyType":"msg","rules":[{"t":"cont","v":"unexpected response","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":2360,"wires":[[],["df0da37f.0edfb"]]},{"id":"7f16ad37.c32134","type":"alexa-remote-routine","z":"fb543111.32fbd","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":""},"volume":{"type":"num","value":"40"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":1630,"y":2280,"wires":[[]]},{"id":"a71b4063.5b225","type":"catch","z":"1f49f273.0f37be","name":"","scope":null,"uncaught":false,"x":260,"y":4780,"wires":[["bbaf80d4.1b799","dd1b81ea.ddcb7"]]},{"id":"f6c09238.fe5c1","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"announcement","text":{"type":"str","value":"Erro na automação do Alexa Automações"},"volume":{"type":"num","value":"20"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":1470,"y":4640,"wires":[[]]},{"id":"e015ac0.a73f058","type":"pushbullet","z":"1f49f273.0f37be","config":"8e6fc0d2.d9006","pushtype":"note","title":"Erro em uma automação no Alexa Automation.","chan":"","name":"","x":1420,"y":4760,"wires":[]},{"id":"91fac8d2.e4fd98","type":"e-mail","z":"1f49f273.0f37be","server":"smtp.gmail.com","port":"465","secure":true,"tls":false,"name":"nedisonn@me.com","dname":"","x":1330,"y":4820,"wires":[]},{"id":"43beb5b9.47115c","type":"function","z":"1f49f273.0f37be","name":"Create Error Message","func":"if(global.get(\"CatchErrors\") === false || global.get(\"ContCatchErrors\") > 4){\n    global.set(\"CatchErrors\", true);\n    msg = Object.assign({}, msg, {topic:\"Erro em uma automação no Alexa Automation.\"});\n\n    if(Array.isArray(msg.error) === true){\n        msg.payload = \" \";  \n     \n        for(var i = 0; i < 5; i++){\n            msg.payload = msg.payload + \"Erro numero \"+ i +\n            \"id: \" + msg.error[i].source.id+\". \"+\n            msg.error[i].source.name+ \". Tipo de erro:\" + \n            msg.error[i].source.type + \". Mensagem: \" +\n            msg.error[i].message + \"\\n\\n\";\n            \n        }\n    }\n    else{\n        msg.payload = \"Erro \"+ msg.error.source.id+\" \"+\n        msg.error.source.name+ \". Tipo de erro:\" + \n        msg.error.source.type + \". Mensagem: \" +\n        msg.error.message;\n    }\n   \n        return msg;\n}\n\nglobal.set(\"ContCatchErrors\", 0);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":4760,"wires":[["e015ac0.a73f058","91fac8d2.e4fd98","5373a638.d81388"]]},{"id":"bbaf80d4.1b799","type":"delay","z":"1f49f273.0f37be","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":330,"y":4900,"wires":[["b2795695.1dc658"]]},{"id":"b2795695.1dc658","type":"function","z":"1f49f273.0f37be","name":"Reset Aux Variables","func":"global.set(\"CatchErrors\",false);\nglobal.set(\"ContCatchErrors\", 0);\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":4900,"wires":[[]]},{"id":"97e5933c.ce9de","type":"join","z":"1f49f273.0f37be","name":"","mode":"custom","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n\\n","joinerType":"str","accumulate":false,"timeout":"","count":"5","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":910,"y":4820,"wires":[["43beb5b9.47115c"]]},{"id":"e1edab89.010be8","type":"switch","z":"1f49f273.0f37be","name":"","property":"ajuda","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":770,"y":4780,"wires":[["43beb5b9.47115c"],["97e5933c.ce9de"]]},{"id":"ae8be9b1.594888","type":"function","z":"1f49f273.0f37be","name":"Cont++","func":"if(global.get(\"ContCatchErrors\") === 0){\n\n    global.set(\"ContCatchErrors\", 1);\n    msg.ajuda = 1;    \n    return msg;\n}\nif(global.get(\"ContCatchErrors\") > 0){\n    global.set(\"ContCatchErrors\",global.get(\"ContCatchErrors\")+1);\n    msg.ajuda = 2;\n    return msg;\n    \n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":4780,"wires":[["e1edab89.010be8"]]},{"id":"5373a638.d81388","type":"function","z":"1f49f273.0f37be","name":"Check if it's day","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nif(Hour < 23 && Hour > 10){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1270,"y":4720,"wires":[["f6c09238.fe5c1","eb9ad2f6.7e76d"]]},{"id":"c3dc347c.842df8","type":"comment","z":"1f49f273.0f37be","name":"Catching Errors and notifying","info":"","x":300,"y":4720,"wires":[]},{"id":"eb9ad2f6.7e76d","type":"delay","z":"1f49f273.0f37be","name":"","pauseType":"delay","timeout":"8","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1460,"y":4720,"wires":[["adfdd937.4b24d8"]]},{"id":"dd1b81ea.ddcb7","type":"switch","z":"1f49f273.0f37be","name":"","property":"error.message","propertyType":"msg","rules":[{"t":"cont","v":"unexpected response","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":410,"y":4780,"wires":[[],["ae8be9b1.594888"]]},{"id":"adfdd937.4b24d8","type":"alexa-remote-routine","z":"1f49f273.0f37be","name":"","account":"d04673cf.2f08f","routineNode":{"type":"speakAtVolume","payload":{"type":"regular","text":{"type":"str","value":""},"volume":{"type":"num","value":"30"},"mode":"set","devices":["G090XG0793643C6P"]}},"x":1670,"y":4700,"wires":[[]]},{"id":"65e9d4c.d55d82c","type":"delay","z":"f02c3977.c1b97","name":"","pauseType":"delayv","timeout":"20","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1340,"y":460,"wires":[["71def244.b5fa5c"]]},{"id":"5593aa57.58e4f4","type":"function","z":"f02c3977.c1b97","name":"Delay + 20 min","func":"msg.delay = 1200000;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1160,"y":460,"wires":[["65e9d4c.d55d82c"]]},{"id":"71def244.b5fa5c","type":"function","z":"f02c3977.c1b97","name":"Turn Off","func":"if(msg.payload === true){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_off\",\n          \"entity_id\": \"input_boolean.sala_ocupada_switch\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1500,"y":460,"wires":[["afee9beb.a5c9e8"]]},{"id":"6d9262fa.199a9c","type":"delay","z":"f02c3977.c1b97","name":"","pauseType":"delayv","timeout":"20","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1340,"y":700,"wires":[["a019a26a.de76"]]},{"id":"f8b4cdeb.5a994","type":"function","z":"f02c3977.c1b97","name":"Delay + 20 min","func":"msg.delay = 1200000;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1160,"y":700,"wires":[["6d9262fa.199a9c"]]},{"id":"a019a26a.de76","type":"function","z":"f02c3977.c1b97","name":"Turn Off","func":"if(msg.payload === true){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_off\",\n          \"entity_id\": \"input_boolean.cozinha_ocupada_switch\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1500,"y":700,"wires":[["c99abd85.b7122"]]},{"id":"f471c892.ba47f8","type":"delay","z":"f02c3977.c1b97","name":"","pauseType":"delayv","timeout":"20","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1340,"y":820,"wires":[["fef01f3a.60c91"]]},{"id":"97ae3afe.2a2eb8","type":"function","z":"f02c3977.c1b97","name":"Delay + 20 min","func":"msg.delay = 1200000;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1160,"y":820,"wires":[["f471c892.ba47f8"]]},{"id":"fef01f3a.60c91","type":"function","z":"f02c3977.c1b97","name":"Turn Off","func":"if(msg.payload === true){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_off\",\n          \"entity_id\": \"input_boolean.quarto_nedi_ocupado_switch\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1500,"y":820,"wires":[["c37e514a.510a"]]},{"id":"afee9beb.a5c9e8","type":"api-call-service","z":"f02c3977.c1b97","name":"Sala Ocupada","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"binary_sensor","service":"turn_on","entityId":"binary_sensor.sala_ocupada","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1680,"y":460,"wires":[[]]},{"id":"c99abd85.b7122","type":"api-call-service","z":"f02c3977.c1b97","name":"Cozinha Ocupada","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"binary_sensor","service":"turn_on","entityId":"binary_sensor.cozinha_ocupada","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1690,"y":700,"wires":[[]]},{"id":"c37e514a.510a","type":"api-call-service","z":"f02c3977.c1b97","name":"Quarto Nédi Ocupado","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.quarto_nedi_ocupado_switch","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1700,"y":820,"wires":[[]]},{"id":"fddfdb76.4b6388","type":"api-current-state","z":"f02c3977.c1b97","name":"Vó Em Casa","server":"d63d21ef.5e065","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.vo_em_casa","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":350,"y":220,"wires":[["294139fb.8b6546"],["294139fb.8b6546"]]},{"id":"6a2d886.6ecae78","type":"inject","z":"f02c3977.c1b97","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1200","crontab":"","once":true,"onceDelay":"50","topic":"","payload":"true","payloadType":"bool","x":190,"y":220,"wires":[["fddfdb76.4b6388","d3f89b73.ac80c8","9660c.5c9409f48","d047b608.793898"]]},{"id":"d1e6d2a9.b6ab4","type":"server-state-changed","z":"9639036b.0a3a6","name":"Updater","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.updater","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"true","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":450,"y":2020,"wires":[["24ebcdd0.552f12"],["24ebcdd0.552f12"]]},{"id":"c94a4c4b.0a754","type":"api-call-service","z":"9639036b.0a3a6","name":"Notifica","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"","service":"","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":807,"y":2020,"wires":[[]]},{"id":"24ebcdd0.552f12","type":"function","z":"9639036b.0a3a6","name":"Notificação","func":"if(msg.payload === \"on\"){\n    var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"mqtt\",\n    \"service\": \"publish\",\n    data:{\n        \n          topic: \"iotlink/workgroup/soft-pc/commands/notify\",\n          payload: '{ \"title\": \"Update\", \"message\": \"Há uma nova atualização do Home Assistant\"}'\n  \n\n    }\n    }};\n    node.send(newMsg);\n    \n    \n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_nedis_iphone\",\n    data:{\n        \"title\": \"Update\",\n        \"message\": \"Há uma nova atualização do Home Assistant\"\n\n    }\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":637,"y":2020,"wires":[["c94a4c4b.0a754"]]},{"id":"2ba6a608.dfed1a","type":"hb-control","z":"ccb6d071.13253","name":"Fita do Quarto","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita do Quarto00000043","conf":"40e0a266.1beb0c","x":2440,"y":420,"wires":[]},{"id":"baf21a55.bb7c68","type":"function","z":"ccb6d071.13253","name":"Turn On","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nvar i = parseInt(flow.get(\"iterFitaDoQuartoInc\"));\nif(Hour > 10 && Hour < 21){\n    aux = 255;\n    auxInc = 30;\n}\nif(Hour <= 10 || Hour >= 21){\n    aux = 150;\n    auxInc = 20;\n}\n\nif (i > aux) { \n    return {reset: true} ;\n}\nvar newMsg;\n//var timerId = setInterval(function check() {\n//    newMsg= {payload : {\"On\":true,\n//            \"Brightness\": i,     \n//            \"Hue\": 174,\n//            \"Saturation\": 100 }};\n//    node.send(newMsg);\n//    i = i + auxInc; \n//    if (i > aux) { \n//        clearInterval(check);\n//        return;\n//    }\n//} , 250);\n\nnewMsg= {payload : {\"On\":true,\n            \"Brightness\": i,     \n            \"Hue\": 174,\n            \"Saturation\": 100 }};\n    i = i + auxInc; \n    \nflow.set(\"iterFitaDoQuartoInc\", i);\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1920,"y":420,"wires":[["e0b5f84d.a14688"]]},{"id":"69d4d5ff.fdd7ac","type":"hb-control","z":"ccb6d071.13253","name":"Fita do Quarto","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita do Quarto00000043","conf":"40e0a266.1beb0c","x":2360,"y":720,"wires":[]},{"id":"f6c00da8.7cf79","type":"hb-status","z":"ccb6d071.13253","name":"Fita do Quarto","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita do Quarto00000043","conf":"40e0a266.1beb0c","x":2960,"y":1240,"wires":[["bf1e0b5c.cabbd8"]]},{"id":"e2f23827.30c848","type":"hb-status","z":"ccb6d071.13253","name":"Fita do Quarto","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita do Quarto00000043","conf":"40e0a266.1beb0c","x":870,"y":2800,"wires":[["1547d13f.a58e1f"]]},{"id":"21a17194.8be5c6","type":"link out","z":"ccb6d071.13253","name":"LampadaOff","links":["431f74ce.609c8c"],"x":975,"y":2320,"wires":[]},{"id":"84039976.096518","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"2","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3840,"y":1300,"wires":[["f0abdd53.5d1cc8"]]},{"id":"94d3fde3.fb5ea","type":"api-current-state","z":"ccb6d071.13253","name":"Luz do Quarto Nédi","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.luz_do_quarto_nedi","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":2975,"y":1620,"wires":[["8b344234.162a5"]]},{"id":"a38d1885.3c1858","type":"api-current-state","z":"ccb6d071.13253","name":"Luz do Quarto Nédi","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.luz_do_quarto_nedi","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":870,"y":2620,"wires":[["f09d9b88.85d928"]]},{"id":"5afc7cd1.f5dda4","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"msg.payload = {\"On\": false}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":2320,"wires":[["21a17194.8be5c6"]]},{"id":"d7c55862.ef7bc8","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"2","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1830,"y":2640,"wires":[["c22678a9.036de8"]]},{"id":"c40ecad3.184548","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"2","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1810,"y":2800,"wires":[["567dd73b.7289a"]]},{"id":"7e23fe7c.01532","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"2","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2410,"y":1540,"wires":[["4a54ae9d.c91e58"]]},{"id":"3a126595.9f5d8a","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"2","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2270,"y":420,"wires":[["2ba6a608.dfed1a"]]},{"id":"ac700b3d.139798","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"2","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2510,"y":260,"wires":[["27197993.685266","cde058e7.e04038"]]},{"id":"bef3aea.10df75","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"2","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2170,"y":820,"wires":[["f8099a5e.4621d8"]]},{"id":"8352f84.fa0a508","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"2","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2170,"y":720,"wires":[["69d4d5ff.fdd7ac"]]},{"id":"d916af81.c8cfc","type":"server-state-changed","z":"f02c3977.c1b97","name":"Movimento Sala Aux","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.movimento_sala_aux","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":330,"y":700,"wires":[["d8f4e54a.ef44f8"]]},{"id":"6b464eca.50bf1","type":"server-state-changed","z":"f02c3977.c1b97","name":"TV da Sala","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.tv_da_sala","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":360,"y":760,"wires":[["1aa22e8b.a7d1e1"]]},{"id":"d8f4e54a.ef44f8","type":"function","z":"f02c3977.c1b97","name":"Detected?","func":"if(msg.payload === \"on\"){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":700,"wires":[["822d92e.5d6567","31c1e5fc.13ebca"]]},{"id":"1aa22e8b.a7d1e1","type":"function","z":"f02c3977.c1b97","name":"Is it on?","func":"if(msg.payload === \"on\"){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":529,"y":760,"wires":[["822d92e.5d6567","31c1e5fc.13ebca"]]},{"id":"56beb9e2.538d28","type":"function","z":"1d7ecdc6.68c842","name":"Botão Quarto Maria Click","func":"if(msg.payload.entity_id === \"binary_sensor.botao_quarto_maria\" && msg.payload.event.click_type === \"single\"){\n\n    return msg;\n}\n//sensor_switch.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":280,"wires":[["6309629a.4f066c"]]},{"id":"6309629a.4f066c","type":"link out","z":"1d7ecdc6.68c842","name":"Botao Clique Quarto Maria","links":[],"x":715,"y":280,"wires":[]},{"id":"a9fca138.ecc46","type":"function","z":"1d7ecdc6.68c842","name":"Botão Quarto Maria Double","func":"if(msg.payload.entity_id === \"binary_sensor.botao_quarto_maria\" && msg.payload.event.click_type === \"double\"){\n\n    \n    return msg;\n}\n//sensor_switch.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":320,"wires":[["27d5e9db.18c866"]]},{"id":"27d5e9db.18c866","type":"link out","z":"1d7ecdc6.68c842","name":"Botao Duplo Clique Quarto Maria","links":[],"x":715,"y":320,"wires":[]},{"id":"c868e2b0.ece49","type":"function","z":"f02c3977.c1b97","name":"At home?","func":"if(msg.payload === \"home\"){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1180,"wires":[["822d92e.5d6567"]]},{"id":"7979d459.82a04c","type":"server-state-changed","z":"f02c3977.c1b97","name":"Nedi's iPhone","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"device_tracker.life360_nedison_neto_faria_velloso","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":350,"y":1180,"wires":[["c868e2b0.ece49"]]},{"id":"15c538f3.00a4f7","type":"function","z":"f02c3977.c1b97","name":"At home?","func":"if(msg.payload === \"home\"){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1240,"wires":[["822d92e.5d6567"]]},{"id":"c4119cad.caf51","type":"server-state-changed","z":"f02c3977.c1b97","name":"Maria's iPhone","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"device_tracker.life360_maria_luisa_faria_velloso","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":340,"y":1240,"wires":[["15c538f3.00a4f7"]]},{"id":"ec9a915f.43e98","type":"function","z":"f02c3977.c1b97","name":"At home?","func":"if(msg.payload === \"home\"){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1360,"wires":[["822d92e.5d6567"]]},{"id":"d20ee9f5.39d208","type":"server-state-changed","z":"f02c3977.c1b97","name":"Mariana","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"device_tracker.life360_mariana_velloso","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":360,"y":1360,"wires":[["ec9a915f.43e98"]]},{"id":"e08fbdbc.57251","type":"function","z":"f02c3977.c1b97","name":"At home?","func":"if(msg.payload === \"home\"){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1420,"wires":[["822d92e.5d6567"]]},{"id":"4e6b9cfa.8737f4","type":"server-state-changed","z":"f02c3977.c1b97","name":"Leonardo","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"device_tracker.life360_leonardo_almeida_velloso","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":360,"y":1420,"wires":[["e08fbdbc.57251"]]},{"id":"999e3757.cae2b8","type":"function","z":"f02c3977.c1b97","name":"At home?","func":"if(msg.payload === \"home\"){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1300,"wires":[["822d92e.5d6567"]]},{"id":"f81080a8.b920b","type":"server-state-changed","z":"f02c3977.c1b97","name":"Cristofer","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"device_tracker.life360_cristofer_velloso","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":360,"y":1300,"wires":[["999e3757.cae2b8"]]},{"id":"bec5ca27.d122f8","type":"function","z":"cbdfe56c.84c388","name":"Triggered?","func":"if(flow.get(\"triggered1\")===true){\n    flow.set(\"triggered1\", false);\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1010,"y":420,"wires":[["d192402d.f75fa8"]]},{"id":"e4781632.951f28","type":"hb-control","z":"c3bc1a43.254dd","name":"Fita do Escritorio","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita do Escritorio00000043","conf":"40e0a266.1beb0c","x":990,"y":1380,"wires":[]},{"id":"26862a10.27c436","type":"function","z":"c3bc1a43.254dd","name":"Turn On Dim","func":"msg.payload = { On: true, Hue: 240, Saturation: 100, Brightness: 50 };\n\n    node.send(msg);\n    node.status({text:\"Ligou\"});\n    setTimeout(function(){\n    node.status({text:\"\"});\n    }, 3000);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":1380,"wires":[["e4781632.951f28"]]},{"id":"43eb4637.32ae4","type":"api-call-service","z":"1f49f273.0f37be","name":"Fita do Quarto ","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.fita_do_quarto_ha","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1440,"y":760,"wires":[[]]},{"id":"46ab8d9f.5019e4","type":"function","z":"1f49f273.0f37be","d":true,"name":"Menos Brilho & Turquesa","func":"var newMsg;\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_on\",\n    data:{\n        \n        \"entity_id\": \"light.fita_do_quarto\",\n        \"brightness\": 10,\n        \"rgb_color\": [0,216,255]\n    }\n}};\n\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1220,"y":760,"wires":[["43eb4637.32ae4"]]},{"id":"180e9813.2d6ac8","type":"function","z":"1f49f273.0f37be","name":"Atividade na Sala","func":"if(msg.payload.name===\"Echo Dot da Sala\"){\n    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"input_boolean\",\n        \"service\": \"turn_on\",\n        \"data\":{\n            \"entity_id\": \"input_boolean.sala_ocupada_switch\"\n        }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":340,"wires":[["7862462a.16aed8"]]},{"id":"1b53b9fc.ae43e6","type":"function","z":"1f49f273.0f37be","name":"Atividade no Quarto Nédi","func":"if(msg.payload.name===\"Echo Dot do Quarto Nédi\"){\n    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"input_boolean\",\n        \"service\": \"turn_on\",\n        \"data\":{\n            \"entity_id\": \"input_boolean.quarto_nedi_ocupado_swtich\"\n        }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":400,"wires":[["3cd852c1.77496e"]]},{"id":"e92e4e26.8e848","type":"function","z":"1f49f273.0f37be","name":"Atividade na Cozinha","func":"if(msg.payload.name===\"Echo Dot da Cozinha\"){\n    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"input_boolean\",\n        \"service\": \"turn_on\",\n        \"data\":{\n            \"entity_id\": \"input_boolean.cozinha_ocupada_switch\"\n        }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":520,"wires":[["3eb9cdae.3d7d42"]]},{"id":"7862462a.16aed8","type":"api-call-service","z":"1f49f273.0f37be","name":"Sala Ocupada","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"input_boolean.sala_ocupada_switch","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":780,"y":340,"wires":[[]]},{"id":"3cd852c1.77496e","type":"api-call-service","z":"1f49f273.0f37be","name":"Quarto Nédi Ocupado","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"input_boolean.quarto_nedi_ocupado_switch","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":800,"y":400,"wires":[[]]},{"id":"3eb9cdae.3d7d42","type":"api-call-service","z":"1f49f273.0f37be","name":"Cozinha Ocupada","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"input_boolean.cozinha_ocupada_switch","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":790,"y":520,"wires":[[]]},{"id":"2db06ff8.808af","type":"debug","z":"c3bc1a43.254dd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":890,"y":760,"wires":[]},{"id":"b33b0b20.79d868","type":"debug","z":"c3bc1a43.254dd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1090,"y":840,"wires":[]},{"id":"91a33746.bfc5e8","type":"debug","z":"c3bc1a43.254dd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1250,"y":840,"wires":[]},{"id":"8487354c.b9a948","type":"debug","z":"c3bc1a43.254dd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1430,"y":840,"wires":[]},{"id":"2c55436d.1a112c","type":"debug","z":"c3bc1a43.254dd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1370,"y":720,"wires":[]},{"id":"336832f8.523fae","type":"delay","z":"c6be7449.1c6ce8","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1220,"y":340,"wires":[["728816.e7d6a7ec"]]},{"id":"e7cad77a.eed628","type":"inject","z":"1d7ecdc6.68c842","name":"","props":[{"p":"payload.entity_id","v":"binary_sensor.movimento_quarto_nedi","vt":"str"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":280,"y":800,"wires":[["c3aafca7.63d3a8"]]},{"id":"2173cab8.b160c6","type":"inject","z":"ccb6d071.13253","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1200,"y":80,"wires":[["405d19e7.4c9ed8"]]},{"id":"cde058e7.e04038","type":"debug","z":"ccb6d071.13253","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2630,"y":320,"wires":[]},{"id":"bf80d75b.3135d8","type":"debug","z":"ccb6d071.13253","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1530,"y":160,"wires":[]},{"id":"2f8ed9ee.760226","type":"api-current-state","z":"ccb6d071.13253","name":"Luz do Quarto Nédi","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.luz_do_quarto_nedi","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":910,"y":220,"wires":[["2b4d6dfc.5e5862","86d62377.0a3ae8"]]},{"id":"2b4d6dfc.5e5862","type":"function","z":"ccb6d071.13253","name":"Check if it's already On","func":"if(msg.payload === \"off\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":220,"wires":[["405d19e7.4c9ed8"]]},{"id":"97e821e1.5f205","type":"server-events","z":"9639036b.0a3a6","name":"iOS Action","server":"d63d21ef.5e065","event_type":"ios.action_fired","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"x":300,"y":2120,"wires":[["e764821e.2b18b","e6d191e3.7d693","86d9ebc8.57c7d8","49263064.0efa1"]]},{"id":"e764821e.2b18b","type":"function","z":"9639036b.0a3a6","name":"Boa Noite Casa?","func":"if(\n    msg.payload.event.actionName === \"Sala Off\"\n    ){\n    return {\"payload\": {\"On\": false, \"on\": false}};\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":2300,"wires":[["78abb2d6.80b25c","1664be01.8b5632","ef7277ed.0a8688"]]},{"id":"e6d191e3.7d693","type":"function","z":"9639036b.0a3a6","name":"Cozy Time?","func":"if(\n    msg.payload.event.actionName === \"Cozy Time\"\n    ){\n    return {\"payload\": {\"On\": true}};\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":2120,"wires":[["4b903524.21b4ec"]]},{"id":"4b903524.21b4ec","type":"link out","z":"9639036b.0a3a6","name":"Cozy Time Action","links":["3e2f636f.8b63b4"],"x":689,"y":2120,"wires":[]},{"id":"86d9ebc8.57c7d8","type":"function","z":"9639036b.0a3a6","name":"Vou dormir?","func":"if(\n    msg.payload.event.actionName === \"Vou Dormir\"\n    ){\n    return {\"payload\": {\"On\": true}};\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":2180,"wires":[["cb3db0de.e21d5"]]},{"id":"cb3db0de.e21d5","type":"link out","z":"9639036b.0a3a6","name":"Vou dormir Action","links":["e08f909b.252238"],"x":689,"y":2180,"wires":[]},{"id":"49263064.0efa1","type":"function","z":"9639036b.0a3a6","name":"Movie Night?","func":"if(\n    msg.payload.event.actionName === \"Movie Night\"\n    ){\n    return {\"payload\": {\"horaDoFilme\": true}};\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":2240,"wires":[["d20321f.f5ce5e"]]},{"id":"d20321f.f5ce5e","type":"link out","z":"9639036b.0a3a6","name":"Movie Night Action","links":["79e2642d.93bbbc"],"x":689,"y":2240,"wires":[]},{"id":"4dff8bca.66d414","type":"yeelight-compat-hue-out","z":"9639036b.0a3a6","name":"","server":"bbfd267.ea4ee58","x":990,"y":2300,"wires":[]},{"id":"af182835.1a3858","type":"yeelight-compat-hue-out","z":"9639036b.0a3a6","name":"","server":"eeeccf7f.6c0df8","x":1010,"y":2360,"wires":[]},{"id":"c3ae1eee.998da","type":"hb-control","z":"9639036b.0a3a6","name":"Fita do Escritorio","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita do Escritorio00000043","conf":"40e0a266.1beb0c","x":1010,"y":2420,"wires":[]},{"id":"bc4c9e6e.d281f","type":"hb-control","z":"9639036b.0a3a6","name":"Luz da TV","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeLuz da TV00000043","conf":"40e0a266.1beb0c","x":990,"y":2480,"wires":[]},{"id":"f444fdd3.1c719","type":"api-call-service","z":"9639036b.0a3a6","name":"Home Assistant","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1140,"y":2540,"wires":[[]]},{"id":"78abb2d6.80b25c","type":"function","z":"9639036b.0a3a6","name":"Turn Off Sala","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"media_player\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"media_player.tv_da_sala\"\n        }\n    }};\n    node.send(newMsg);\n\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"light.luz_da_sala\"\n        }\n    }};\n    node.send(newMsg);   \n\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"light.fita_do_escritorio\"\n        }\n    }};\n    node.send(newMsg);    \n\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"light.fita_do_escritorio_ha\"\n        }\n    }};\n    node.send(newMsg);    \n\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"light.luz_da_tv\"\n        }\n    }};\n    node.send(newMsg);   \n\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"light.luz_da_tv_ha\"\n        }\n    }};\n    node.send(newMsg);   \n\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"light.fita_da_cozinha\"\n        }\n    }};\n    node.send(newMsg);   \n\n    newMsg= {payload : {\n        \"domain\": \"switch\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"switch.abajur\"\n        }\n    }};\n    node.send(newMsg);      \n\n    newMsg= {payload : {\n        \"domain\": \"switch\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"switch.tunel\"\n        }\n    }};\n    node.send(newMsg);    \n    \n    newMsg= {payload : {\n        \"domain\": \"input_boolean\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"input_boolean.sala_ocupada_switch\"\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":810,"y":2540,"wires":[["2fd7168e.78e51a"]]},{"id":"46ee101f.c9b82","type":"link in","z":"9639036b.0a3a6","name":"Boa Noite Casa","links":["82c6986.62e2968","8ad92ac8.7b7018"],"x":615,"y":2400,"wires":[["1664be01.8b5632","ef7277ed.0a8688","78abb2d6.80b25c"]]},{"id":"1664be01.8b5632","type":"function","z":"9639036b.0a3a6","name":"Turn Off","func":"global.set(\"SalaOn\", false);\nreturn {payload : {\"on\": false}};\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":2300,"wires":[["4dff8bca.66d414","af182835.1a3858"]]},{"id":"ef7277ed.0a8688","type":"function","z":"9639036b.0a3a6","name":"Turn Off","func":"global.set(\"SalaOn\", false);\nreturn {payload : {\"On\": false}};\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":2440,"wires":[["c3ae1eee.998da","bc4c9e6e.d281f"]]},{"id":"fee87ad1.10f418","type":"api-current-state","z":"ccb6d071.13253","name":"Luz do Quarto Nédi","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.luz_do_quarto_nedi","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":930,"y":820,"wires":[["affccce5.adf92"]]},{"id":"affccce5.adf92","type":"function","z":"ccb6d071.13253","name":"Check if it's already On","func":"if(msg.payload === \"off\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":820,"wires":[["baadc359.0f772","c294d9c3.5f5768"]]},{"id":"22777fd6.0b42b","type":"inject","z":"c3bc1a43.254dd","name":"","props":[{"p":"payload.horaDoFilme","v":"true","vt":"bool"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":310,"y":1340,"wires":[["1fbcb698.3f9c79"]]},{"id":"e8fde565.f161c8","type":"inject","z":"c3bc1a43.254dd","name":"Passou das 19:30","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"30 19 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":550,"y":80,"wires":[["43b689d4.7f99a8"]]},{"id":"f21ccfee.032c3","type":"inject","z":"c3bc1a43.254dd","name":"Passou das 19:30","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"30 19 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":1190,"y":260,"wires":[["bf1332fa.076e2"]]},{"id":"bf1332fa.076e2","type":"api-current-state","z":"c3bc1a43.254dd","name":"Sala Ocupada","server":"d63d21ef.5e065","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.sala_ocupada","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1380,"y":260,"wires":[["7af1ac1.13d72d4"],["7af1ac1.13d72d4"]]},{"id":"1dfd8dbd.a942e2","type":"function","z":"ecc79e8a.d4a1b","name":"Luz da Sala On","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_on\",\n        \"data\":{\n            \"entity_id\": \"light.luz_da_sala\",\n            \"brightness\": parseInt((msg.payload.bri/2.55)+1),\n            \"kelvin\": msg.payload.ct\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3280,"y":120,"wires":[["84e25731.3fe8f8"]]},{"id":"84e25731.3fe8f8","type":"api-call-service","z":"ecc79e8a.d4a1b","name":"Luz da Sala","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.luz_da_sala","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3490,"y":120,"wires":[[]]},{"id":"daf3f5ef.ff2778","type":"api-call-service","z":"1aa34a9.7045335","name":"Luz do Escritório","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.luz_do_escritorio","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3370,"y":220,"wires":[[]]},{"id":"eb6f474e.97bfa8","type":"function","z":"1aa34a9.7045335","name":"Luz do Escritório On","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_on\",\n        \"data\":{\n            \"entity_id\": \"light.luz_do_escritorio\",\n            \"brightness\": parseInt((msg.payload.bri/2.55)+1),\n            \"kelvin\": msg.payload.ct\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3160,"y":220,"wires":[["daf3f5ef.ff2778"]]},{"id":"1556def6.c40b81","type":"api-current-state","z":"ecc79e8a.d4a1b","name":"Luz da Sala","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.luz_da_sala","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1470,"y":200,"wires":[["a1a4c2bf.2f06e","bd18f6fb.a9c098"]]},{"id":"a1a4c2bf.2f06e","type":"function","z":"ecc79e8a.d4a1b","name":"In case of Error","func":"var newMsg;\nvar ctAux\nctAux = msg.data.attributes.color_temp\nctAux = parseInt(ctAux * -12.5+8059)\nif(msg.payload === \"on\"){\n        newMsg = {payload:{state:{bri:msg.data.attributes.brightness,\n            ct: ctAux\n                                  }\n                            },\n                            came: \"HomeAssistant\"\n        };\n        return newMsg;\n}\nif(msg.payload === \"off\"){\n        newMsg = {payload:{resetar: true}};\n        return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1647,"y":200,"wires":[["d1c34b23.7ee708"]]},{"id":"84aaf3a6.e7653","type":"function","z":"1aa34a9.7045335","name":"In case of Error","func":"var newMsg;\nvar ctAux\nctAux = msg.data.attributes.color_temp\nctAux = parseInt(ctAux * -12.5+8059)\nif(msg.payload === \"on\"){\n        newMsg = {payload:{state:{bri:msg.data.attributes.brightness,\n            ct: ctAux\n                                  }\n                            },\n                            came: \"HomeAssistant\"\n        };\n        return newMsg;\n}\nif(msg.payload === \"off\"){\n        newMsg = {payload:{resetar: true}};\n        return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1480,"y":220,"wires":[["1eead01b.4b617"]]},{"id":"35098841.1463e8","type":"api-current-state","z":"1aa34a9.7045335","name":"Luz do Escritório","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.luz_do_escritorio","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1290,"y":220,"wires":[["84aaf3a6.e7653","597b35e3.42b60c"]]},{"id":"bd18f6fb.a9c098","type":"debug","z":"ecc79e8a.d4a1b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1640,"y":140,"wires":[]},{"id":"b75d1c8c.ec37e","type":"delay","z":"1f49f273.0f37be","name":"","pauseType":"rate","timeout":"0.5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"30","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":940,"y":2080,"wires":[["56c949e4.3beea8"]]},{"id":"5c48d219.457dac","type":"server-state-changed","z":"1d7ecdc6.68c842","name":"Sensor de Luz Escritório Aqara","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.sensor_de_luz_escritorio_aqara","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":990,"y":720,"wires":[["c0e7838d.ed0f9"]]},{"id":"c0e7838d.ed0f9","type":"function","z":"1d7ecdc6.68c842","name":"Aux Escritório Escuro","func":"if(msg.payload < 100){\n    global.set(\"escritorioEscuro\", true);\n}\nif(msg.payload < 60){\n    global.set(\"escritorioEscuro\", true);\n    return {\"payload\": {\"On\": true}};\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1260,"y":720,"wires":[["16045565.be2dab"]]},{"id":"7a56f188.a8e3f","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"rate","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"15","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1800,"y":240,"wires":[["f13340b.0470dc"]]},{"id":"96a9d03f.5ed93","type":"delay","z":"ecc79e8a.d4a1b","name":"","pauseType":"rate","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"15","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":2000,"y":240,"wires":[["a8071585.a36a6"]]},{"id":"597b35e3.42b60c","type":"debug","z":"1aa34a9.7045335","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1470,"y":120,"wires":[]},{"id":"1eead01b.4b617","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1640,"y":220,"wires":[["7a56f188.a8e3f"]]},{"id":"d1c34b23.7ee708","type":"delay","z":"ecc79e8a.d4a1b","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1820,"y":200,"wires":[["96a9d03f.5ed93"]]},{"id":"4503b984.e94a48","type":"switch","z":"1aa34a9.7045335","name":"","property":"auxEmissor","propertyType":"flow","rules":[{"t":"eq","v":"Yeelight","vt":"str"},{"t":"eq","v":"HomeAssistant","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":2900,"y":160,"wires":[["3fc1da86.2c49de"],["eb6f474e.97bfa8"]]},{"id":"5d3ae424.096d8c","type":"function","z":"1aa34a9.7045335","name":"Came From","func":"flow.set(\"auxEmissor\", msg.came);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2130,"y":240,"wires":[["8c72052c.5a4de8"]]},{"id":"64cb3312.15531c","type":"change","z":"ecc79e8a.d4a1b","name":"","rules":[{"t":"delete","p":"reset","pt":"msg"},{"t":"delete","p":"came","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2460,"y":220,"wires":[["aff8e940.e8c4c8"]]},{"id":"acbae851.ed8808","type":"function","z":"ecc79e8a.d4a1b","name":"Came From","func":"flow.set(\"auxEmissor\", msg.came);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2290,"y":220,"wires":[["64cb3312.15531c"]]},{"id":"afec18cf.8b6318","type":"switch","z":"ecc79e8a.d4a1b","name":"","property":"auxEmissor","propertyType":"flow","rules":[{"t":"eq","v":"HomeAssistant","vt":"str"},{"t":"eq","v":"Yeelight","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":3110,"y":140,"wires":[["1dfd8dbd.a942e2","dc194357.62e"],["17262251.0ab2ce","20c2f4e6.55be9c"]]},{"id":"9e05923e.f02ee","type":"inject","z":"ecc79e8a.d4a1b","name":"Set bright","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":1680,"y":560,"wires":[["3159556f.63d28a"]]},{"id":"3159556f.63d28a","type":"function","z":"ecc79e8a.d4a1b","name":"Bright","func":"flow.set(\"countBrightness\", 255);\nflow.set(\"auxCT\", 6100);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1830,"y":580,"wires":[[]]},{"id":"b12f6413.d6db08","type":"inject","z":"1aa34a9.7045335","name":"Set bright","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":1440,"y":1480,"wires":[["99cd170e.2a4ff8"]]},{"id":"99cd170e.2a4ff8","type":"function","z":"1aa34a9.7045335","name":"Bright","func":"flow.set(\"countBrightnessLuz\", 255);\nflow.set(\"auxCT\", 6100);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1600,"y":1500,"wires":[[]]},{"id":"2fd7168e.78e51a","type":"delay","z":"9639036b.0a3a6","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"3","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":970,"y":2540,"wires":[["f444fdd3.1c719"]]},{"id":"e3bdb4c9.195048","type":"function","z":"ecc79e8a.d4a1b","name":"Reset","func":"msg.reset = 1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2270,"y":340,"wires":[["dc27703a.ce8f3"]]},{"id":"50379460.3fa18c","type":"function","z":"1aa34a9.7045335","name":"Reset","func":"msg.reset = 1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2110,"y":360,"wires":[["447ea5fb.c68a2c"]]},{"id":"3f90c169.ab307e","type":"inject","z":"ccb6d071.13253","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":280,"wires":[["1d4d24f9.85c70b"]]},{"id":"16045565.be2dab","type":"link out","z":"1d7ecdc6.68c842","name":"","links":["d65131b7.ff6058"],"x":1425,"y":720,"wires":[]},{"id":"a21c70d7.8155","type":"function","z":"f02c3977.c1b97","name":"Detected?","func":"if(msg.payload === \"on\"){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":1000,"wires":[["822d92e.5d6567","1e90bf6d.5b6ab1"]]},{"id":"a15c74ed.6bfdc8","type":"server-state-changed","z":"f02c3977.c1b97","name":"Movimento Quarto Nédi Aux","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.movimento_quarto_nedi_aux","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":300,"y":1000,"wires":[["a21c70d7.8155"]]},{"id":"43b689d4.7f99a8","type":"function","z":"c3bc1a43.254dd","name":"Escuro?","func":"global.set(\"salaEscura\", true);\nglobal.set(\"escritorioEscuro\", true);\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":740,"y":80,"wires":[["8c00ea31.7a21e8"]]},{"id":"462996e5.a50ef8","type":"api-call-service","z":"1f49f273.0f37be","name":"Quarto Maria Ocupado","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"input_boolean.quarto_maria_ocupado_switch","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":800,"y":460,"wires":[[]]},{"id":"2771e2e9.3d183e","type":"function","z":"1f49f273.0f37be","name":"Atividade no Quarto Maria","func":"if(msg.payload.name===\"Echo Dot do Quarto Maria\"){\n    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"input_boolean\",\n        \"service\": \"turn_on\",\n        \"data\":{\n            \"entity_id\": \"input_boolean.quarto_maria_ocupado_swtich\"\n        }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":460,"wires":[["462996e5.a50ef8"]]},{"id":"82fe3c92.0a8e4","type":"function","z":"c3bc1a43.254dd","name":"Escuro?","func":"if(msg.payload < 80 && msg.payload > 0){\n                global.set(\"salaEscura\", true);\n                node.status({fill:\"green\",shape:\"dot\",text:\"SalaEscura true\"});\n                flow.set(\"triggered\", true);\n                node.send(msg);\n}\nelse if(msg.payload > 400){\n                global.set(\"salaEscura\", false);\n                node.status({fill:\"yellow\",shape:\"dot\",text:\"SalaEscura false\"});\n}\nif(msg.payload < 140 && msg.payload > 0){\n                global.set(\"escritorioEscuro\", true);\n                node.status({fill:\"green\",shape:\"dot\",text:\"EscritorioEscuro true\"});\n                flow.set(\"triggered\", true);\n                node.send(msg);\n}\nelse if(msg.payload > 400){\n                global.set(\"escritorioEscuro\", false);\n                node.status({fill:\"yellow\",shape:\"dot\",text:\"EscritorioEscuro false\"});\n}\n\n    setTimeout(function(){\n    node.status({text:\"\"});\n    }, 15000);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":740,"y":160,"wires":[["8c00ea31.7a21e8"]]},{"id":"7635a13.f4ab86","type":"delay","z":"c3bc1a43.254dd","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":580,"y":160,"wires":[["82fe3c92.0a8e4","52c14111.c2391"]]},{"id":"1cda1d33.7198d3","type":"delay","z":"c3bc1a43.254dd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":400,"y":160,"wires":[["7635a13.f4ab86"]]},{"id":"875030af.e548b","type":"server-state-changed","z":"c3bc1a43.254dd","name":"Sensor de Luz Escritório Aqara","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.sensor_de_luz_escritorio_aqara","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":170,"y":160,"wires":[["1cda1d33.7198d3"]]},{"id":"450deff2.10333","type":"alexa-remote-smarthome","z":"c3bc1a43.254dd","name":"Luz da Mesa 25%","account":"d04673cf.2f08f","config":{"option":"action","value":[{"entity":"4f6607ff-a4dc-4bd7-baa2-81c1dd310d8d","action":"setBrightness","value":{"type":"num","value":"25"}}]},"outputs":1,"x":970,"y":1560,"wires":[[]]},{"id":"9dd3ebd7.9f9608","type":"alexa-remote-smarthome","z":"ecc79e8a.d4a1b","name":"Luz da Mesa Off","account":"d04673cf.2f08f","config":{"option":"action","value":[{"entity":"4f6607ff-a4dc-4bd7-baa2-81c1dd310d8d","action":"turnOff"}]},"outputs":1,"x":2311,"y":600,"wires":[[]]},{"id":"8957f83f.304298","type":"alexa-remote-smarthome","z":"ecc79e8a.d4a1b","name":"","account":"d04673cf.2f08f","config":{"option":"action","value":[]},"outputs":1,"x":550,"y":440,"wires":[[]]},{"id":"37effc1c.9c4f34","type":"delay","z":"ecc79e8a.d4a1b","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":360,"y":500,"wires":[["b0e7b249.723c"]]},{"id":"839849bb.719b58","type":"alexa-remote-smarthome","z":"ecc79e8a.d4a1b","name":"","account":"d04673cf.2f08f","config":{"option":"action","value":[]},"outputs":1,"x":670,"y":500,"wires":[[]]},{"id":"2aa20ebc.e47eb2","type":"function","z":"ecc79e8a.d4a1b","name":"Turn On","func":"var luzDaMesaOn = global.get(\"luzDaMesaOn\")\nif(luzDaMesaOn === false){\n    global.set(\"luzDaMesaOn\", true);\n    var aux = [{}, {}]\n    \n    aux[0].entity = \"Luz da Mesa\";\n    aux[0].action = \"setBrightness\";\n    aux[0].value = 25;\n    \n    aux[1].entity = \"Luz da Mesa\";\n    aux[1].action = \"turnOn\";\n    \n    msg.payload = aux;\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":440,"wires":[["8957f83f.304298"]]},{"id":"b0e7b249.723c","type":"function","z":"ecc79e8a.d4a1b","name":"Turn On","func":"var luzDaMesaOn = global.get(\"luzDaMesaOn\")\nif(luzDaMesaOn === true){\n    \n    return {payload: [{\n        entity:  \"Luz da Mesa\",\n        action: \"setBrightness\",\n        value: 95\n    }]};\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":500,"wires":[["839849bb.719b58"]]},{"id":"89b2df54.9d8d1","type":"function","z":"c3bc1a43.254dd","name":"Turn On","func":"var luzDaMesaOn = global.get(\"luzDaMesaOn\")\nif(luzDaMesaOn === true){\n    \n    return {payload: [{\n        entity:  \"Luz da Mesa\",\n        action: \"setBrightness\",\n        value: 25\n    }]};\n}\nelse{\n        \n    return {payload: [{\n        entity:  \"Luz da Mesa\",\n        action: \"setBrightness\",\n        value: 15\n    }]};\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":1560,"wires":[["450deff2.10333"]]},{"id":"38f74926.b39b6e","type":"alexa-remote-smarthome","z":"ecc79e8a.d4a1b","name":"Luz da Mesa 100%","account":"d04673cf.2f08f","config":{"option":"action","value":[{"entity":"4f6607ff-a4dc-4bd7-baa2-81c1dd310d8d","action":"setBrightness","value":{"type":"num","value":"95"}},{"entity":"4f6607ff-a4dc-4bd7-baa2-81c1dd310d8d","action":"turnOn"}]},"outputs":1,"x":2310,"y":1140,"wires":[[]]},{"id":"5be4701d.0c28e","type":"api-call-service","z":"1f49f273.0f37be","name":"Rainbow Slow","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.rainbow_slow","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1440,"y":640,"wires":[[]]},{"id":"770b5f2c.b4f96","type":"function","z":"1f49f273.0f37be","name":"Turn On","func":"var newMsg;\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_on\",\n    data:{\n        \n        \"entity_id\": \"light.rainbow_slow\"\n    }\n}};\n\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1170,"y":640,"wires":[["5be4701d.0c28e"]]},{"id":"e9f88dd7.f2c0c8","type":"api-call-service","z":"ccb6d071.13253","name":"All effects","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.3_cores, light.chase, light.chase_2, light.dark_cloud, light.hollywood, light.holofote, light.loading_bar, light.oliver, light.palette, light.purple_green_palette, light.rainbow, light.rainbow_slow, light.rainbow_stripes, light.random, light.sparkles, light.sparkles_colorido, light.unicornio","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1140,"y":2380,"wires":[[]]},{"id":"88df21e9.b51f9","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"var newMsg;\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.rainbow_slow\"\n    }\n}};\nnode.send(newMsg);\n\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.3_cores\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.chase\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.chase_2\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.dark_cloud\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.hollywood\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.holofote\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.loading_bar\"\n    }\n}};\nnode.send(newMsg); \nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.oliver\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.palette\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.purple_green_palette\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.rainbow\"\n    }\n}};\nnode.send(newMsg); \nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.rainbow_stripes\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.random\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.sparkles\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.sparkles_colorido\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.unicornio\"\n    }\n}};\nnode.send(newMsg); \nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.rainbow_slow\"\n    }\n}};\n\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":2380,"wires":[["cc4629ed.05b368"]]},{"id":"cc4629ed.05b368","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"3","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":990,"y":2380,"wires":[["e9f88dd7.f2c0c8"]]},{"id":"e5b72a67.caa2b8","type":"alexa-remote-smarthome","z":"1f49f273.0f37be","name":"Luz da Mesa 100%","account":"d04673cf.2f08f","config":{"option":"action","value":[{"entity":"4f6607ff-a4dc-4bd7-baa2-81c1dd310d8d","action":"turnOn"},{"entity":"4f6607ff-a4dc-4bd7-baa2-81c1dd310d8d","action":"setBrightness","value":{"type":"num","value":"95"}}]},"outputs":1,"x":910,"y":2280,"wires":[[]]},{"id":"e261619b.6ba368","type":"api-call-service","z":"ccb6d071.13253","name":"RGB Strip","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.rgb_strip","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3130,"y":1120,"wires":[[]]},{"id":"4ef9d787.1aa0d","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"var newMsg;\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.rgb_strip\"\n    }\n}};\n\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2940,"y":1120,"wires":[["e261619b.6ba368"]]},{"id":"48bae635.fc923","type":"api-call-service","z":"ccb6d071.13253","name":"All effects","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.3_cores, light.chase, light.chase_2, light.dark_cloud, light.hollywood, light.holofote, light.loading_bar, light.oliver, light.palette, light.purple_green_palette, light.rainbow, light.rainbow_slow, light.rainbow_stripes, light.random, light.sparkles, light.sparkles_colorido, light.unicornio","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":3240,"y":1000,"wires":[[]]},{"id":"e167010a.aa6498","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"2","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3090,"y":1000,"wires":[["48bae635.fc923"]]},{"id":"fc91a28a.e2609","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"var newMsg;\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.rainbow_slow\"\n    }\n}};\nnode.send(newMsg);\n\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.3_cores\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.chase\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.chase_2\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.dark_cloud\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.hollywood\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.holofote\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.loading_bar\"\n    }\n}};\nnode.send(newMsg); \nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.oliver\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.palette\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.purple_green_palette\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.rainbow\"\n    }\n}};\nnode.send(newMsg); \nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.rainbow_stripes\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.random\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.sparkles\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.sparkles_colorido\"\n    }\n}};\nnode.send(newMsg);\nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.unicornio\"\n    }\n}};\nnode.send(newMsg); \nnewMsg= {payload : {\n    \"domain\": \"light\",\n    \"service\": \"turn_off\",\n    data:{\n        \n        \"entity_id\": \"light.rainbow_slow\"\n    }\n}};\n\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2940,"y":1000,"wires":[["e167010a.aa6498"]]},{"id":"6308754c.58fecc","type":"hb-status","z":"ccb6d071.13253","name":"Fita do Quarto","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita do Quarto00000043","conf":"40e0a266.1beb0c","x":960,"y":720,"wires":[["1e5c31bd.e4102e"]]},{"id":"1e5c31bd.e4102e","type":"function","z":"ccb6d071.13253","name":"Check if it's already On","func":"if(msg.payload.On === false){\n    flow.set(\"iterFitaDoQuartoInc\", 1);\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1210,"y":720,"wires":[["e9fdf3cd.b5a0b"]]},{"id":"9101e642.4439c8","type":"exec","z":"c6be7449.1c6ce8","command":"journalctl -u nodered -all","addpay":false,"append":"","useSpawn":"true","timer":"","oldrc":false,"name":"last","x":410,"y":1300,"wires":[["ab738001.ea8e4"],[],[]]},{"id":"ab738001.ea8e4","type":"function","z":"c6be7449.1c6ce8","name":"prepare filename","func":"\nvar d = new Date();\nvar t = d.getTime();\nvar year = d.getFullYear();\nvar month = d.getMonth()+1; \nvar day = d.getDate();\nvar hour  = d.getHours();\nvar minute  = d.getMinutes();\n\nif(month.toString().length == 1) \n{\n    month = '0'+month;\n}\n\nmsg.filename = \"/home/pi/nodeRedLogFiles/nodeRedLog_\"+day+\"-\"+month+\"-\"+year+\"-\"+hour+\":\"+minute+\".csv\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":610,"y":1300,"wires":[["d7add80d.393628"]]},{"id":"7a564280.ce1d5c","type":"inject","z":"c6be7449.1c6ce8","name":"save last nodered-journal","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":210,"y":1300,"wires":[["9101e642.4439c8"]]},{"id":"d7add80d.393628","type":"file","z":"c6be7449.1c6ce8","name":"","filename":"","appendNewline":true,"createDir":true,"overwriteFile":"false","encoding":"none","x":810,"y":1300,"wires":[[]]},{"id":"4c8a6dc3.96b894","type":"comment","z":"c6be7449.1c6ce8","name":"Save last journal nodered","info":"","x":170,"y":1240,"wires":[]},{"id":"629ead8d.9d0f8c","type":"api-call-service","z":"ecc79e8a.d4a1b","name":"Tunel","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.tunel","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2450,"y":960,"wires":[[]]},{"id":"bd69cab5.7e114","type":"function","z":"ecc79e8a.d4a1b","name":"Turn Off","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"switch\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"switch.tunel\"\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2280,"y":940,"wires":[["629ead8d.9d0f8c"]]},{"id":"83aec2a2.d1e7c8","type":"function","z":"ecc79e8a.d4a1b","name":"Turn On","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"switch\",\n        \"service\": \"turn_on\",\n        \"data\":{\n            \"entity_id\": \"switch.tunel\"\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2280,"y":980,"wires":[["629ead8d.9d0f8c"]]},{"id":"974d380a.c90508","type":"api-call-service","z":"1aa34a9.7045335","name":"Abajur","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.abajur","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2510,"y":1060,"wires":[[]]},{"id":"3ad219c1.14088e","type":"function","z":"1aa34a9.7045335","name":"Turn Off","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"switch\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"switch.abajur\"\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2360,"y":1040,"wires":[["974d380a.c90508"]]},{"id":"34026fe6.2b91b8","type":"function","z":"1aa34a9.7045335","name":"Turn On","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"switch\",\n        \"service\": \"turn_on\",\n        \"data\":{\n            \"entity_id\": \"switch.abajur\"\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2360,"y":1100,"wires":[["974d380a.c90508"]]},{"id":"52c14111.c2391","type":"function","z":"c3bc1a43.254dd","name":"Escuro?","func":"if(msg.payload < 200 && msg.payload > 0){\n                node.send(msg);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":740,"y":120,"wires":[["211250e1.8ccec"]]},{"id":"885c460.75ef5b8","type":"function","z":"c3bc1a43.254dd","name":"Escuro?","func":"if(msg.payload < 250 && msg.payload > 0){\n                node.send(msg);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":740,"y":320,"wires":[["211250e1.8ccec"]]},{"id":"351f8cdf.8129d4","type":"alexa-remote-smarthome","z":"c3bc1a43.254dd","name":"Luz da Mesa 60%","account":"d04673cf.2f08f","config":{"option":"action","value":[{"entity":"4f6607ff-a4dc-4bd7-baa2-81c1dd310d8d","action":"turnOn"},{"entity":"4f6607ff-a4dc-4bd7-baa2-81c1dd310d8d","action":"setBrightness","value":{"type":"num","value":"60"}}]},"outputs":1,"x":1390,"y":120,"wires":[[]]},{"id":"211250e1.8ccec","type":"api-current-state","z":"c3bc1a43.254dd","name":"Sala Ocupada","server":"d63d21ef.5e065","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.sala_ocupada","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1000,"y":120,"wires":[["3908050e.04b33a"],["3908050e.04b33a"]]},{"id":"3908050e.04b33a","type":"function","z":"c3bc1a43.254dd","name":"Sala On","func":"if(msg.payload === true){\n    var date = new Date();\n    var Hour = date.getHours(); //hours in 0-23\n    var minutes = \"0\" + date.getMinutes();\n    minutes = parseInt(minutes.substr(-2), 10);\n    var seconds = \"0\" + date.getSeconds();\n    seconds = parseInt(seconds.substr(-2), 10);\n    global.set(\"lastChangeSec\", seconds);\n    global.set(\"lastChangeMinute\", minutes);\n    if(Hour > 16 && Hour < 20){\n        return msg;\n            \n    }\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1200,"y":120,"wires":[["351f8cdf.8129d4"]]},{"id":"995baada.564918","type":"api-current-state","z":"1f49f273.0f37be","name":"Nédi home?","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"person.nedi_2","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1050,"y":1760,"wires":[["4862eabb.f4ee24","bc303b7.4976dc8"]]},{"id":"2f7a8e5c.96d0c2","type":"api-call-service","z":"1f49f273.0f37be","name":"Notify MacBook","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_macbook_pro_de_nedison","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1440,"y":1820,"wires":[[]]},{"id":"bc303b7.4976dc8","type":"function","z":"1f49f273.0f37be","name":"Notificação","func":"if(msg.payload === \"home\"){\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_macbook_pro_de_nedison\",\n    data:{\n        \n        message: `{{ [\n             \"O Café está pronto.\",\n             \"O Café está prontinho.\",\n             \"Tem café quentinho na cozinha.\",\n             \"Tem café na cozinha.\",\n             \"Corre pra cozinha, o café está pronto.\",\n             \"O Café está pronto na cozinha.\",\n             \"O Café está quentinho te esperando.\"\n         ]|random }}`\n  \n\n    }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1250,"y":1820,"wires":[["2f7a8e5c.96d0c2"]]},{"id":"7bfcc7ba.250be8","type":"api-call-service","z":"9639036b.0a3a6","name":"Notify MacBook","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_nedis_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1380,"y":1880,"wires":[[]]},{"id":"cb93c2c3.092d","type":"function","z":"9639036b.0a3a6","name":"Notificação","func":"if(msg.payload === \"home\"){\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_macbook_pro_de_nedison\",\n    data:{\n        \n        message: `{{ [\n             \"O Café está pronto.\",\n             \"O Café está prontinho.\",\n             \"Tem café quentinho na cozinha.\",\n             \"Tem café na cozinha.\",\n             \"Corre pra cozinha, o café está pronto.\",\n             \"O Café está pronto na cozinha.\",\n             \"O Café está quentinho te esperando.\"\n         ]|random }}`\n  \n\n    }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1190,"y":1880,"wires":[["7bfcc7ba.250be8"]]},{"id":"fa759e94.3b123","type":"api-call-service","z":"9639036b.0a3a6","name":"Notify Nédi's iPhone","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_nedis_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1400,"y":1820,"wires":[[]]},{"id":"3976f211.e7f61e","type":"function","z":"9639036b.0a3a6","name":"Notificação","func":"if(msg.payload === \"home\"){\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_nedis_iphone\",\n    data:{\n        \n        message: `{{ [\n             \"O Café está pronto.\",\n             \"O Café está prontinho.\",\n             \"Tem café quentinho na cozinha.\",\n             \"Tem café na cozinha.\",\n             \"Corre pra cozinha, o café está pronto.\",\n             \"O Café está pronto na cozinha.\",\n             \"O Café está quentinho te esperando.\"\n         ]|random }}`\n  \n\n    }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1190,"y":1820,"wires":[["fa759e94.3b123"]]},{"id":"8eb6249b.db9cf8","type":"api-current-state","z":"9639036b.0a3a6","name":"Nédi home?","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"person.nedi_2","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":990,"y":1820,"wires":[["3976f211.e7f61e","cb93c2c3.092d"]]},{"id":"cd47ed0f.892bc","type":"api-current-state","z":"ccb6d071.13253","name":"Nédi home?","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"person.nedi_2","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":930,"y":2040,"wires":[["b0be53ac.66296"]]},{"id":"7a0346f4.f230f8","type":"inject","z":"9639036b.0a3a6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"10 14 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":297,"y":1960,"wires":[["c8bf0798.262fa8"]]},{"id":"c8bf0798.262fa8","type":"api-current-state","z":"9639036b.0a3a6","name":"Updater?","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.updater","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":437,"y":1960,"wires":[["24ebcdd0.552f12"]]},{"id":"d5e062fa.499ce","type":"function","z":"1f49f273.0f37be","name":"Notificação","func":"if(msg.payload === \"home\"){\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_softcelular\",\n    data:{\n        \n        message: `{{ [\n             \"O Café está pronto.\",\n             \"O Café está prontinho.\",\n             \"Tem café quentinho na cozinha.\",\n             \"Tem café na cozinha.\",\n             \"Corre pra cozinha, o café está pronto.\",\n             \"O Café está pronto na cozinha.\",\n             \"O Café está quentinho te esperando.\"\n         ]|random }}`\n  \n\n    }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1250,"y":1880,"wires":[["1b9a2e22.609112"]]},{"id":"1b9a2e22.609112","type":"api-call-service","z":"1f49f273.0f37be","name":"Notify Pai","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_softcelular","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1420,"y":1880,"wires":[[]]},{"id":"4f8cbd04.9da104","type":"api-current-state","z":"1f49f273.0f37be","name":"Papai home?","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"person.papai","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1050,"y":1880,"wires":[["d5e062fa.499ce"]]},{"id":"e6b2f336.fc5bb","type":"function","z":"9639036b.0a3a6","name":"Notificação","func":"if(msg.payload === \"home\"){\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_softcelular\",\n    data:{\n        \n         message: `{{ [\n             \"O Café está pronto.\",\n             \"O Café está prontinho.\",\n             \"Tem café quentinho na cozinha.\",\n             \"Tem café na cozinha.\",\n             \"Corre pra cozinha, o café está pronto.\",\n             \"O Café está pronto na cozinha.\",\n             \"O Café está quentinho te esperando.\"\n         ]|random }}`\n  \n\n    }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1190,"y":1940,"wires":[["9162fa6c.0be358"]]},{"id":"9162fa6c.0be358","type":"api-call-service","z":"9639036b.0a3a6","name":"Notify Pai","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_softcelular","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1360,"y":1940,"wires":[[]]},{"id":"80da379e.1edc38","type":"api-current-state","z":"9639036b.0a3a6","name":"Papai home?","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"person.papai","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":990,"y":1940,"wires":[["e6b2f336.fc5bb"]]},{"id":"c20186ba.4c54d8","type":"inject","z":"1f49f273.0f37be","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":750,"y":2400,"wires":[["e8f4a759.1e4678"]]},{"id":"e8f4a759.1e4678","type":"api-call-service","z":"1f49f273.0f37be","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"{{ [\\\"O almoço está pronto.\\\", \\\"O almoço está prontinho.\\\",\\\"Tem almoço quentinho na mesa.\\\",\\\"O almoço está na mesa.\\\",\\\"Corre pra mesa, o almoço está pronto.\\\",\\\"O almoço está pronto na mesa.\\\",\\\"O almoço está quentinho te esperando.\\\"]|random }}\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_do_quarto_nedi\",\"media_player.echo_dot_do_quarto_maria\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":930,"y":2340,"wires":[[]]},{"id":"6ca58497.6becec","type":"api-call-service","z":"1f49f273.0f37be","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"{{ [\\\"O Café está pronto.\\\",\\\"O Café está prontinho.\\\",\\\"Tem café quentinho na cozinha.\\\",\\\"Tem café na cozinha.\\\",\\\"Corre pra cozinha, o café está pronto.\\\",\\\"O Café está pronto na cozinha.\\\",\\\"O Café está quentinho te esperando.\\\"]|random }}\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_do_quarto_nedi\",\"media_player.echo_dot_do_quarto_maria\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1050,"y":1640,"wires":[[]]},{"id":"4f4aeb0.e4f8614","type":"api-call-service","z":"9639036b.0a3a6","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"{{ [\\\"O Café está pronto.\\\",\\\"O Café está prontinho.\\\",\\\"Tem café quentinho na cozinha.\\\",\\\"Tem café na cozinha.\\\",\\\"Corre pra cozinha, o café está pronto.\\\",\\\"O Café está pronto na cozinha.\\\",\\\"O Café está quentinho te esperando.\\\"]|random }}\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_do_quarto_nedi\",\"media_player.echo_dot_do_quarto_maria\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":990,"y":1680,"wires":[[]]},{"id":"16139daa.e8e5a2","type":"function","z":"f02c3977.c1b97","name":"Detected?","func":"if(msg.payload === \"on\"){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":1060,"wires":[["822d92e.5d6567","12b531b3.70d89e"]]},{"id":"464c1e52.95dde","type":"server-state-changed","z":"f02c3977.c1b97","name":"Movimento Quarto Maria","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.movimento_quarto_maria","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":310,"y":1060,"wires":[["16139daa.e8e5a2"]]},{"id":"4bce3037.d769b","type":"function","z":"f02c3977.c1b97","name":"Detected?","func":"if(msg.payload === \"on\"){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":1120,"wires":[["822d92e.5d6567","12b531b3.70d89e"]]},{"id":"8cdd8d03.326dd","type":"server-state-changed","z":"f02c3977.c1b97","name":"Movimento Quarto Maria Aux","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.movimento_quarto_maria_aux","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":300,"y":1120,"wires":[["4bce3037.d769b"]]},{"id":"2fd85866.2c1028","type":"server-state-changed","z":"f02c3977.c1b97","name":"Movimento Sala","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.movimento_sala","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":340,"y":640,"wires":[["27a8ffd1.585c4"]]},{"id":"27a8ffd1.585c4","type":"function","z":"f02c3977.c1b97","name":"Detected?","func":"if(msg.payload === \"on\"){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":640,"wires":[["822d92e.5d6567","31c1e5fc.13ebca"]]},{"id":"bba4f6b7.16c6a8","type":"delay","z":"f02c3977.c1b97","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":980,"y":900,"wires":[["3fb13a00.d80b16","efc5ae5a.49724"]]},{"id":"3fb13a00.d80b16","type":"api-call-service","z":"f02c3977.c1b97","name":"Quarto Maria Ocupado","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.quarto_maria_ocupado_switch","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1180,"y":900,"wires":[[]]},{"id":"fd686ef2.fe581","type":"delay","z":"f02c3977.c1b97","name":"","pauseType":"delayv","timeout":"20","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1340,"y":960,"wires":[["720a76c1.dd7388"]]},{"id":"efc5ae5a.49724","type":"function","z":"f02c3977.c1b97","name":"Delay + 20 min","func":"msg.delay = 1200000;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1160,"y":960,"wires":[["fd686ef2.fe581"]]},{"id":"720a76c1.dd7388","type":"function","z":"f02c3977.c1b97","name":"Turn Off","func":"if(msg.payload === true){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_off\",\n          \"entity_id\": \"input_boolean.quarto_maria_ocupado_switch\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1500,"y":960,"wires":[["b9fee448.a8e568"]]},{"id":"b9fee448.a8e568","type":"api-call-service","z":"f02c3977.c1b97","name":"Quarto Nédi Ocupado","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.quarto_maria_ocupado_switch","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1700,"y":960,"wires":[[]]},{"id":"12b531b3.70d89e","type":"function","z":"f02c3977.c1b97","name":"Turn On","func":"var newMsg;\nnewMsg= {payload: {\n      \"domain\": \"input_boolean\",\n      \"service\": \"turn_on\",\n      \"entity_id\": \"input_boolean.quarto_maria_ocupado_switch\",\n}};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":900,"wires":[["bba4f6b7.16c6a8"]]},{"id":"51b6c32a.d5521c","type":"alexa-remote-smarthome","z":"1f49f273.0f37be","name":"Luz da Mesa Off","account":"d04673cf.2f08f","config":{"option":"action","value":[{"entity":"4f6607ff-a4dc-4bd7-baa2-81c1dd310d8d","action":"turnOff"}]},"outputs":1,"x":740,"y":1420,"wires":[[]]},{"id":"6eb3c8d0.4b38b8","type":"debug","z":"ecc79e8a.d4a1b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2920,"y":260,"wires":[]},{"id":"8e60de77.ca5cf","type":"debug","z":"ecc79e8a.d4a1b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3070,"y":80,"wires":[]},{"id":"dc194357.62e","type":"debug","z":"ecc79e8a.d4a1b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3270,"y":60,"wires":[]},{"id":"20c2f4e6.55be9c","type":"debug","z":"ecc79e8a.d4a1b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3250,"y":240,"wires":[]},{"id":"1607f1ae.8e4bee","type":"delay","z":"ecc79e8a.d4a1b","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":820,"y":440,"wires":[["e4a162ad.6e232"]]},{"id":"a40fa869.31f998","type":"alexa-remote-smarthome","z":"ecc79e8a.d4a1b","name":"","account":"d04673cf.2f08f","config":{"option":"action","value":[]},"outputs":1,"x":1130,"y":440,"wires":[[]]},{"id":"e4a162ad.6e232","type":"function","z":"ecc79e8a.d4a1b","name":"Turn On","func":"var luzDaMesaOn = global.get(\"luzDaMesaOn\")\nif(luzDaMesaOn === true){\n    \n    return {payload: [{\n        entity:  \"Luz da Mesa\",\n        action: \"setBrightness\",\n        value: 50\n    }]};\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":960,"y":440,"wires":[["a40fa869.31f998"]]},{"id":"372f0aef.cc9176","type":"alexa-remote-smarthome","z":"ecc79e8a.d4a1b","name":"","account":"d04673cf.2f08f","config":{"option":"action","value":[]},"outputs":1,"x":990,"y":380,"wires":[[]]},{"id":"f4909512.ed5718","type":"function","z":"ecc79e8a.d4a1b","name":"Turn On","func":"var luzDaMesaOn = global.get(\"luzDaMesaOn\")\nif(luzDaMesaOn === true){\n    \n    return {payload: [{\n        entity:  \"Luz da Mesa\",\n        action: \"setBrightness\",\n        value: 80\n    }]};\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":380,"wires":[["372f0aef.cc9176"]]},{"id":"c9c02172.c1718","type":"inject","z":"9639036b.0a3a6","name":"7 AM","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 07 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"false","payloadType":"bool","x":330,"y":2620,"wires":[["678a746f.46bb7c","4c4ae25d.784d3c"]]},{"id":"29bc7243.e773be","type":"api-call-service","z":"9639036b.0a3a6","name":"Boa noite","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":610,"y":2620,"wires":[[]]},{"id":"678a746f.46bb7c","type":"function","z":"9639036b.0a3a6","name":"Turn Off","func":"    var newMsg;\n    \n    newMsg= {payload : {\n        \"domain\": \"input_boolean\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"input_boolean.boa_noite\"\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":2620,"wires":[["29bc7243.e773be"]]},{"id":"4fd61fdc.51529","type":"api-call-service","z":"9639036b.0a3a6","name":"Vou Dormir","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":620,"y":2680,"wires":[[]]},{"id":"4c4ae25d.784d3c","type":"function","z":"9639036b.0a3a6","name":"Turn Off","func":"    var newMsg;\n    \n    newMsg= {payload : {\n        \"domain\": \"input_boolean\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"input_boolean.vou_dormir\"\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":2680,"wires":[["4fd61fdc.51529"]]},{"id":"a1152fc9.01c27","type":"function","z":"1d7ecdc6.68c842","name":"Janela Fechada","func":"if(msg.topic === \"binary_sensor.janela_quarto_maria\"){\n    if(msg.payload === false){\n        global.set(\"janelaQuartoMaria\",false);\n    }\n}\n//sensor_magnet.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1720,"wires":[[]]},{"id":"c21c40ab.eafc4","type":"function","z":"1d7ecdc6.68c842","name":"Janela Aberta","func":"if(msg.topic === \"binary_sensor.janela_quarto_maria\"){\n    if(msg.payload === true){\n        global.set(\"janelaQuartoMaria\",true);\n    }\n}\n//sensor_magnet.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1660,"wires":[[]]},{"id":"486a3b1f.7ad624","type":"server-state-changed","z":"1d7ecdc6.68c842","name":"Janela Quarto Maria","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.janela_quarto_maria","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":310,"y":1700,"wires":[["c21c40ab.eafc4"],["a1152fc9.01c27"]]},{"id":"a4777a6d.93aaf8","type":"function","z":"1d7ecdc6.68c842","name":"Janela Fechada","func":"if(msg.topic === \"binary_sensor.janela_quarto_nedi\"){\n    if(msg.payload === false){\n        global.set(\"janelaQuartoNedi\",false);\n    }\n}\n//sensor_magnet.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1840,"wires":[[]]},{"id":"1f9f88aa.8b66f7","type":"function","z":"1d7ecdc6.68c842","name":"Janela Aberta","func":"if(msg.topic === \"binary_sensor.janela_quarto_nedi\"){\n    if(msg.payload === true){\n        global.set(\"janelaQuartoNedi\",true);\n    }\n}\n//sensor_magnet.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1780,"wires":[[]]},{"id":"719ac195.73428","type":"server-state-changed","z":"1d7ecdc6.68c842","name":"Janela Quarto Nédi","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.janela_quarto_nedi","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":310,"y":1820,"wires":[["1f9f88aa.8b66f7"],["a4777a6d.93aaf8"]]},{"id":"e4f20316.0a086","type":"function","z":"1d7ecdc6.68c842","name":"Janela Fechada","func":"if(msg.topic === \"binary_sensor.janela_quarto_pai\"){\n    if(msg.payload === false){\n        global.set(\"janelaQuartoPai\",false);\n    }\n}\n//sensor_magnet.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1960,"wires":[[]]},{"id":"e68498e7.f19d38","type":"function","z":"1d7ecdc6.68c842","name":"Janela Aberta","func":"if(msg.topic === \"binary_sensor.janela_quarto_pai\"){\n    if(msg.payload === true){\n        global.set(\"janelaQuartoPai\",true);\n    }\n}\n//sensor_magnet.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1900,"wires":[[]]},{"id":"1dfd808.50a608","type":"server-state-changed","z":"1d7ecdc6.68c842","name":"Janela Quarto Pai","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.janela_quarto_pai","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":310,"y":1940,"wires":[["e68498e7.f19d38"],["e4f20316.0a086"]]},{"id":"63138909.2e60f8","type":"function","z":"1d7ecdc6.68c842","name":"Janela Fechada","func":"if(msg.topic === \"binary_sensor.janela_sala\"){\n    if(msg.payload === false){\n        global.set(\"janelaSala\",false);\n    }\n}\n//sensor_magnet.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":2080,"wires":[[]]},{"id":"b50575af.dd2638","type":"function","z":"1d7ecdc6.68c842","name":"Janela Aberta","func":"if(msg.topic === \"binary_sensor.janela_sala\"){\n    if(msg.payload === true){\n        global.set(\"janelaSala\",true);\n    }\n}\n//sensor_magnet.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":2020,"wires":[[]]},{"id":"a0fb76ee.3ac758","type":"server-state-changed","z":"1d7ecdc6.68c842","name":"Janela Sala","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.janela_sala","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":290,"y":2060,"wires":[["b50575af.dd2638"],["63138909.2e60f8"]]},{"id":"f031a663.c67068","type":"inject","z":"1d7ecdc6.68c842","d":true,"name":"Check Windows","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"*/30 8-22 * * *","once":true,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":830,"y":1760,"wires":[["8dad362.407e6c8","a67f9d11.67b34","327ee42f.310bfc","2fa462c9.4afd7e","23668df8.dd4ee2"]]},{"id":"327ee42f.310bfc","type":"api-current-state","z":"1d7ecdc6.68c842","name":"Janela Quarto Maria","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.janela_quarto_maria","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1090,"y":1660,"wires":[["2d6cf46e.3bcd8c"]]},{"id":"2d6cf46e.3bcd8c","type":"function","z":"1d7ecdc6.68c842","name":"janela aux","func":"global.set(\"janelaQuartoMaria\",msg.payload);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1290,"y":1660,"wires":[[]]},{"id":"8dad362.407e6c8","type":"api-current-state","z":"1d7ecdc6.68c842","name":"Janela Quarto Nédi","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.janela_quarto_nedi","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1080,"y":1720,"wires":[["26224075.43298"]]},{"id":"26224075.43298","type":"function","z":"1d7ecdc6.68c842","name":"janela aux","func":"global.set(\"janelaQuartoNedi\",msg.payload);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1290,"y":1720,"wires":[[]]},{"id":"a67f9d11.67b34","type":"api-current-state","z":"1d7ecdc6.68c842","name":"Janela Quarto Pai","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.janela_quarto_pai","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1080,"y":1780,"wires":[["ede68adb.8848e8"]]},{"id":"ede68adb.8848e8","type":"function","z":"1d7ecdc6.68c842","name":"janela aux","func":"global.set(\"janelaQuartoPai\",msg.payload);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1290,"y":1780,"wires":[[]]},{"id":"2fa462c9.4afd7e","type":"api-current-state","z":"1d7ecdc6.68c842","name":"Janela Sala","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.janela_sala","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1060,"y":1840,"wires":[["e065cc44.6e252"]]},{"id":"e065cc44.6e252","type":"function","z":"1d7ecdc6.68c842","name":"janela aux","func":"global.set(\"janelaSala\",msg.payload);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1290,"y":1840,"wires":[[]]},{"id":"9d57528a.67f28","type":"darksky in","z":"1d7ecdc6.68c842","darksky":"fa56686d.1df858","name":"","key":"","lon":"-51.18650436","lat":"-30.01009828","date":"","time":"","lang":"en","units":"ca","x":990,"y":1960,"wires":[["306e3085.33389"]]},{"id":"ef08887e.173488","type":"function","z":"1d7ecdc6.68c842","name":"Chuva?","func":"if( msg.data.currently.summary.includes(\"rain\")=== true ||\n    msg.data.currently.summary.includes(\"Rain\")=== true  ||\n    msg.payload.detail.includes(\"Rain\")=== true  ||\n    msg.payload.detail.includes(\"Rain\")=== true  ||\n    msg.payload.precipitation > 1 ||\n    msg.data.currently.precipProbability > 0.5 ||\n    msg.payload.clouds === 1){\n    \n    global.set(\"chuvaAux\",true);\n    return {payload:1};\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1300,"y":1960,"wires":[["29d6b67.fa1f24a"]]},{"id":"306e3085.33389","type":"delay","z":"1d7ecdc6.68c842","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1140,"y":1960,"wires":[["ef08887e.173488"]]},{"id":"23668df8.dd4ee2","type":"api-current-state","z":"1d7ecdc6.68c842","name":"Chuva?","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"weather.home","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1040,"y":1900,"wires":[["4442d0af.5085e"]]},{"id":"4442d0af.5085e","type":"function","z":"1d7ecdc6.68c842","name":"Chuva aux","func":"if(msg.payload.includes(\"rain\")===true || msg.data.attributes.precipitation > 0.5){\n    global.set(\"chuvaAux\", true);\n    return {payload:1};\n}\nelse{\n    global.set(\"chuvaAux\", false);\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1290,"y":1900,"wires":[["29d6b67.fa1f24a"]]},{"id":"29d6b67.fa1f24a","type":"function","z":"1d7ecdc6.68c842","d":true,"name":"","func":"return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1480,"y":1920,"wires":[["307d73a0.f7936c","6b742a1a.1cd044","ef086521.6fa0d8","f8163c6a.ba462","f5cebc7c.7e47e"]]},{"id":"6b742a1a.1cd044","type":"function","z":"1d7ecdc6.68c842","name":"Notificação","func":"\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"mqtt\",\n    \"service\": \"publish\",\n    data:{\n        \n          topic: \"iotlink/workgroup/soft-pc/commands/notify\",\n          payload: '{ \"title\": \"Café pronto\", \"message\": \"Há chance de chover agora e há janelas abertas.\"}'\n  \n\n    }\n    }};\n    \n    return newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1750,"y":1900,"wires":[["c08645aa.e5a048"]]},{"id":"c08645aa.e5a048","type":"api-call-service","z":"1d7ecdc6.68c842","name":"PC","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"mqtt","service":"publish","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1910,"y":1900,"wires":[[]]},{"id":"35861d3d.b2c862","type":"function","z":"1d7ecdc6.68c842","name":"Notificação","func":"if(msg.payload === \"home\"){\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_nedis_iphone\",\n    data:{\n        \n         message: `Há chance de chover agora e a(s) janela(s) {% if is_state(\"binary_sensor.janela_quarto_maria\", \"on\") -%} do Quarto Maria, {%- endif %} {% if is_state(\"binary_sensor.janela_quarto_nedi\", \"on\") -%} do Quarto Nédi,{%- endif %} {% if is_state(\"binary_sensor.janela_quarto_pai\", \"on\") -%} do Quarto Pai,{%- endif %} {% if is_state(\"binary_sensor.janela_sala\", \"on\") -%} da Sala {%- endif %} está/estão aberta(s)`\n  \n\n    }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1950,"y":1960,"wires":[["4a21137e.f841ac"]]},{"id":"4a21137e.f841ac","type":"api-call-service","z":"1d7ecdc6.68c842","name":"Notify Nédi's iPhone","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_nedis_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2160,"y":1960,"wires":[[]]},{"id":"ef086521.6fa0d8","type":"api-current-state","z":"1d7ecdc6.68c842","name":"Nédi home?","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"person.nedi_2","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1750,"y":1960,"wires":[["35861d3d.b2c862","1785c13c.851b7f"]]},{"id":"6543b181.6fe73","type":"api-call-service","z":"1d7ecdc6.68c842","name":"Notify MacBook","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_macbook_pro_de_nedison","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2140,"y":2020,"wires":[[]]},{"id":"1785c13c.851b7f","type":"function","z":"1d7ecdc6.68c842","name":"Notificação","func":"if(msg.payload === \"home\"){\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_macbook_pro_de_nedison\",\n    data:{\n        \n           \n         message: `Há chance de chover agora e a(s) janela(s) {% if is_state(\"binary_sensor.janela_quarto_maria\", \"on\") -%} do Quarto Maria, {%- endif %} {% if is_state(\"binary_sensor.janela_quarto_nedi\", \"on\") -%} do Quarto Nédi,{%- endif %} {% if is_state(\"binary_sensor.janela_quarto_pai\", \"on\") -%} do Quarto Pai,{%- endif %} {% if is_state(\"binary_sensor.janela_sala\", \"on\") -%} da Sala {%- endif %} está/estão aberta(s)`\n  \n  \n\n    }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1950,"y":2020,"wires":[["6543b181.6fe73"]]},{"id":"d5304350.16e4e","type":"function","z":"1d7ecdc6.68c842","name":"Notificação","func":"if(msg.payload === \"home\"){\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_softcelular\",\n    data:{\n        \n           \n         message: `Há chance de chover agora e a(s) janela(s) {% if is_state(\"binary_sensor.janela_quarto_maria\", \"on\") -%} do Quarto Maria, {%- endif %} {% if is_state(\"binary_sensor.janela_quarto_nedi\", \"on\") -%} do Quarto Nédi,{%- endif %} {% if is_state(\"binary_sensor.janela_quarto_pai\", \"on\") -%} do Quarto Pai,{%- endif %} {% if is_state(\"binary_sensor.janela_sala\", \"on\") -%} da Sala {%- endif %} está/estão aberta(s)`\n  \n  \n\n    }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1950,"y":2080,"wires":[["187f37b6.7d2a18"]]},{"id":"187f37b6.7d2a18","type":"api-call-service","z":"1d7ecdc6.68c842","name":"Notify Pai","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_softcelular","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2120,"y":2080,"wires":[[]]},{"id":"f8163c6a.ba462","type":"api-current-state","z":"1d7ecdc6.68c842","name":"Papai home?","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"person.papai","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1750,"y":2080,"wires":[["d5304350.16e4e"]]},{"id":"307d73a0.f7936c","type":"api-call-service","z":"1d7ecdc6.68c842","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Há chance de chover agora e as janelas: {% if is_state(\\\"binary_sensor.janela_quarto_maria\\\", \\\"on\\\") -%} do Quarto Maria, {%- endif %} {% if is_state(\\\"binary_sensor.janela_quarto_nedi\\\", \\\"on\\\") -%} do Quarto Nédi,{%- endif %} {% if is_state(\\\"binary_sensor.janela_quarto_pai\\\", \\\"on\\\") -%} do Quarto Pai,{%- endif %} {% if is_state(\\\"binary_sensor.janela_sala\\\", \\\"on\\\") -%} da Sala {%- endif %} estão aberta\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_do_quarto_nedi\",\"media_player.echo_dot_do_quarto_maria\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1750,"y":1840,"wires":[[]]},{"id":"4b899f08.79e04","type":"function","z":"1d7ecdc6.68c842","name":"Notificação","func":"if(msg.payload === \"home\"){\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_maria_s_iphone\",\n    data:{\n        \n      \n         message: `Há chance de chover agora e a(s) janela(s) {% if is_state(\"binary_sensor.janela_quarto_maria\", \"on\") -%} do Quarto Maria, {%- endif %} {% if is_state(\"binary_sensor.janela_quarto_nedi\", \"on\") -%} do Quarto Nédi,{%- endif %} {% if is_state(\"binary_sensor.janela_quarto_pai\", \"on\") -%} do Quarto Pai,{%- endif %} {% if is_state(\"binary_sensor.janela_sala\", \"on\") -%} da Sala {%- endif %} está/estão aberta(s)`\n  \n\n    }\n    }};\n    \n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1950,"y":2140,"wires":[["807d4df7.92bc2"]]},{"id":"807d4df7.92bc2","type":"api-call-service","z":"1d7ecdc6.68c842","name":"Notify Maria","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_maria_s_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2130,"y":2140,"wires":[[]]},{"id":"f5cebc7c.7e47e","type":"api-current-state","z":"1d7ecdc6.68c842","name":"Maria home?","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"person.maria","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1750,"y":2140,"wires":[["4b899f08.79e04"]]},{"id":"641129e9.5a2c28","type":"inject","z":"1aa34a9.7045335","name":"Turn lights warmer and dimmer","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"*/20 20 * * *","once":false,"onceDelay":"","topic":"","payload":"true","payloadType":"bool","x":310,"y":700,"wires":[["d88874bd.e7a0e8","c086950b.9460b8"]]},{"id":"c086950b.9460b8","type":"hb-status","z":"1aa34a9.7045335","name":"Fita do Escritorio","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita do Escritorio00000043","conf":"40e0a266.1beb0c","x":570,"y":740,"wires":[["4db027d3.cd57f8"]]},{"id":"4db027d3.cd57f8","type":"function","z":"1aa34a9.7045335","name":"aux","func":"flow.set(\"countBrightnessFita\",msg.payload.Brightness);\n    ","outputs":0,"noerr":0,"initialize":"","finalize":"","x":750,"y":740,"wires":[]},{"id":"bc9cec75.ce133","type":"inject","z":"1aa34a9.7045335","name":"Reset","props":[{"p":"payload"},{"p":"reset","v":"1","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":"","topic":"","payload":"reset","payloadType":"str","x":370,"y":660,"wires":[["d88874bd.e7a0e8"]]},{"id":"9fa1285d.2bdb3","type":"inject","z":"ccb6d071.13253","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1130,"y":1580,"wires":[["e00993ec.a26b38"]]},{"id":"6bed6cbc.d1bb54","type":"link in","z":"ccb6d071.13253","name":"Botao Quarto","links":["26b4a3b2.dc164c","7f6d2d52.017e94"],"x":1115,"y":900,"wires":[["95262068.e2cee"]]},{"id":"95262068.e2cee","type":"function","z":"ccb6d071.13253","name":"Reset","func":"\nreturn {reset: 1};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1200,"y":920,"wires":[["baadc359.0f772"]]},{"id":"86d62377.0a3ae8","type":"debug","z":"ccb6d071.13253","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1120,"y":300,"wires":[]},{"id":"b1b59a55.b66bb8","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":580,"y":1620,"wires":[["238ed80.34b9228"]]},{"id":"47254480.0f118c","type":"change","z":"1aa34a9.7045335","name":"","rules":[{"t":"delete","p":"reset","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":1540,"wires":[["aa9ce6f7.87db78"]]},{"id":"f5c38047.2c2a98","type":"inject","z":"fb543111.32fbd","d":true,"name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"04 10 * * 1,2,3,4,5,6","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":130,"y":1640,"wires":[["4cd02ee.43777d"]]},{"id":"94a9e623.5b3ee","type":"function","z":"fb543111.32fbd","name":"Play in Echo Dot","func":"for(var i = 0; i < msg.payload.devices.length; i++){\n    if(msg.payload.devices[i].name === \"Echo Dot do Quarto Nédi\"){\n        msg.params = [ {deviceIds: [msg.payload.devices[i].id], play: 'true'} ]; \n        return msg;\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1130,"y":1700,"wires":[["5f7144d.a0bd13c"]]},{"id":"5f7144d.a0bd13c","type":"spotify","z":"fb543111.32fbd","name":"","auth":"c674df2a.9ad11","api":"transferMyPlayback","x":1360,"y":1740,"wires":[[]]},{"id":"ccaaa13e.9945c","type":"spotify","z":"fb543111.32fbd","name":"","auth":"c674df2a.9ad11","api":"play","x":1080,"y":1820,"wires":[[]]},{"id":"4dbbc5f8.a7ef9c","type":"function","z":"fb543111.32fbd","name":"Play 2020/2","func":"msg.params = [ {context_uri: \"spotify:playlist:77qxmDyc6q8jfFSR99BSKz\"} ]; \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":900,"y":1780,"wires":[["ccaaa13e.9945c"]]},{"id":"781e47dd.071ca","type":"spotify","z":"fb543111.32fbd","name":"Shuffle","auth":"c674df2a.9ad11","api":"setShuffle","x":880,"y":1860,"wires":[[]]},{"id":"8e467486.27704","type":"function","z":"fb543111.32fbd","name":"Set Shuffle","func":"msg = {params: [ {state: \"true\"} ]}; \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":1820,"wires":[["781e47dd.071ca"]]},{"id":"d52e2c6b.6441b8","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":710,"y":1740,"wires":[["4dbbc5f8.a7ef9c"]]},{"id":"f7fb55ec.ec156","type":"delay","z":"fb543111.32fbd","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":710,"y":1660,"wires":[["a981da00.9ea0c"]]},{"id":"4cd02ee.43777d","type":"api-current-state","z":"fb543111.32fbd","name":"Nédi home?","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"person.nedi_2","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":290,"y":1640,"wires":[["d1c4adb0.0c3e5"]]},{"id":"d1c4adb0.0c3e5","type":"function","z":"fb543111.32fbd","name":"Notificação","func":"if(msg.payload === \"home\"){\n    return {payload:1};\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":1660,"wires":[["8e467486.27704","d52e2c6b.6441b8","f7fb55ec.ec156"]]},{"id":"4b1f6e19.ebaf4","type":"function","z":"f02c3977.c1b97","name":"True?","func":"if(msg.data.attributes.media_title === \"Netflix\" || \nmsg.data.attributes.media_title === \"PrimeVideo\"|| \nmsg.data.attributes.media_title === \"YouTube\"){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":280,"wires":[["31c1e5fc.13ebca","822d92e.5d6567"]]},{"id":"d3f89b73.ac80c8","type":"api-current-state","z":"f02c3977.c1b97","name":"TV da Sala","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"media_player.tv_da_sala","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":350,"y":280,"wires":[["4b1f6e19.ebaf4"]]},{"id":"e6a4f49b.8487e8","type":"function","z":"f02c3977.c1b97","name":"True?","func":"if(msg.payload === \"playing\"){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":400,"wires":[["822d92e.5d6567","1e90bf6d.5b6ab1"]]},{"id":"9660c.5c9409f48","type":"api-current-state","z":"f02c3977.c1b97","name":"Fire TV","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"media_player.fire_tv","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":360,"y":400,"wires":[["e6a4f49b.8487e8"]]},{"id":"d047b608.793898","type":"api-current-state","z":"f02c3977.c1b97","name":"Apple TV","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"media_player.apple_tv","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":360,"y":340,"wires":[["818c7fb3.7dbf2"]]},{"id":"818c7fb3.7dbf2","type":"function","z":"f02c3977.c1b97","name":"True?","func":"if(msg.pauload === \"playing\"){\n    var newMsg;\n    newMsg= {payload: {\n          \"domain\": \"input_boolean\",\n          \"service\": \"turn_on\",\n          \"entity_id\": \"input_boolean.alguem_em_casa\",\n\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":340,"wires":[["822d92e.5d6567","31c1e5fc.13ebca"]]},{"id":"229f66a5.1fb0aa","type":"server-state-changed","z":"9639036b.0a3a6","name":"Alguém em Casa","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.alguem_em_casa","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"true","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":320,"y":2920,"wires":[["b223b9f.46c9048","9d23fbe3.b3fe18"],["b223b9f.46c9048","9d23fbe3.b3fe18"]]},{"id":"b223b9f.46c9048","type":"function","z":"9639036b.0a3a6","name":"Alguém chegou","func":"if(msg.payload === \"on\" || msg.payload === true){\n    var date = new Date();\n    var Hour = date.getHours();\n    if(Hour > 18){\n        return msg;\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":2920,"wires":[["f4a1100a.f4aa1","242cb59.0082f4a","b9a70ac5.c7ba18"]]},{"id":"f4a1100a.f4aa1","type":"function","z":"9639036b.0a3a6","name":"Turn On","func":"msg.payload =\n    {\n    \"on\": true,\n    \"bri\": 190,\n    \"ct\": 6100\n};    \nglobal.set(\"SalaOnFirstTime\", false);\nglobal.set(\"SalaOn\", true);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":2960,"wires":[["6bc5379a.e948c8","dc0e5445.2f7258"]]},{"id":"dc0e5445.2f7258","type":"yeelight-compat-hue-out","z":"9639036b.0a3a6","name":"Luz da Sala","server":"bbfd267.ea4ee58","x":990,"y":2980,"wires":[]},{"id":"242cb59.0082f4a","type":"function","z":"9639036b.0a3a6","name":"Turn On","func":"var luzDaMesaOn = global.get(\"luzDaMesaOn\")\nif(luzDaMesaOn === false){\n    global.set(\"luzDaMesaOn\", true);\n    var aux = [{}, {}]\n    \n    aux[0].entity = \"Luz da Mesa\";\n    aux[0].action = \"setBrightness\";\n    aux[0].value = 75;\n    \n    aux[1].entity = \"Luz da Mesa\";\n    aux[1].action = \"turnOn\";\n    \n    msg.payload = aux;\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":3100,"wires":[["ebd87c5d.749aa"]]},{"id":"ebd87c5d.749aa","type":"alexa-remote-smarthome","z":"9639036b.0a3a6","name":"","account":"d04673cf.2f08f","config":{"option":"action","value":[]},"outputs":1,"x":1010,"y":3100,"wires":[[]]},{"id":"30bfabb3.1a10d4","type":"link out","z":"9639036b.0a3a6","name":"TunelOnOff","links":["d42bb3e8.fdb408"],"x":935,"y":3040,"wires":[]},{"id":"b9a70ac5.c7ba18","type":"change","z":"9639036b.0a3a6","name":"Turn On","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"On\": true} ","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":820,"y":3040,"wires":[["30bfabb3.1a10d4"]]},{"id":"6bc5379a.e948c8","type":"yeelight-compat-hue-out","z":"9639036b.0a3a6","name":"Luz da Sala","server":"eeeccf7f.6c0df8","x":1010,"y":2920,"wires":[]},{"id":"9d23fbe3.b3fe18","type":"function","z":"9639036b.0a3a6","name":"Alguém chegou","func":"if(msg.payload === \"on\" || msg.payload === true){\n    var date = new Date();\n    var Hour = date.getHours();\n    if(Hour < 8){\n        return msg;\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":3180,"wires":[["a09529e.292c9d8","3b6eba66.043b96","7ab15a0e.5a8734"]]},{"id":"a09529e.292c9d8","type":"function","z":"9639036b.0a3a6","name":"Turn On","func":"msg.payload =\n    {\n    \"on\": true,\n    \"bri\": 50,\n    \"ct\": 6100\n};    \nglobal.set(\"SalaOnFirstTime\", false);\nglobal.set(\"SalaOn\", true);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":3220,"wires":[["9889a81.0fa9158","3f8392a.a1bf46e"]]},{"id":"3f8392a.a1bf46e","type":"yeelight-compat-hue-out","z":"9639036b.0a3a6","name":"Luz da Sala","server":"bbfd267.ea4ee58","x":1000,"y":3240,"wires":[]},{"id":"3b6eba66.043b96","type":"function","z":"9639036b.0a3a6","name":"Turn On","func":"var luzDaMesaOn = global.get(\"luzDaMesaOn\")\nif(luzDaMesaOn === false){\n    global.set(\"luzDaMesaOn\", true);\n    var aux = [{}, {}]\n    \n    aux[0].entity = \"Luz da Mesa\";\n    aux[0].action = \"setBrightness\";\n    aux[0].value = 20;\n    \n    aux[1].entity = \"Luz da Mesa\";\n    aux[1].action = \"turnOn\";\n    \n    msg.payload = aux;\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":3360,"wires":[["4f6e84f0.a0c93c"]]},{"id":"4f6e84f0.a0c93c","type":"alexa-remote-smarthome","z":"9639036b.0a3a6","name":"","account":"d04673cf.2f08f","config":{"option":"action","value":[]},"outputs":1,"x":1020,"y":3360,"wires":[[]]},{"id":"33357c8f.37baa4","type":"link out","z":"9639036b.0a3a6","name":"TunelOnOff","links":["d42bb3e8.fdb408"],"x":945,"y":3300,"wires":[]},{"id":"7ab15a0e.5a8734","type":"change","z":"9639036b.0a3a6","name":"Turn On","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"On\": true} ","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":3300,"wires":[["33357c8f.37baa4"]]},{"id":"9889a81.0fa9158","type":"yeelight-compat-hue-out","z":"9639036b.0a3a6","name":"Luz da Sala","server":"eeeccf7f.6c0df8","x":1020,"y":3180,"wires":[]},{"id":"a981da00.9ea0c","type":"spotify","z":"fb543111.32fbd","name":"","auth":"c674df2a.9ad11","api":"getMyDevices","x":900,"y":1680,"wires":[["94a9e623.5b3ee"]]},{"id":"13bef5ed.680ada","type":"delay","z":"1aa34a9.7045335","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":360,"y":400,"wires":[["55f2c076.57273"]]},{"id":"339689aa.88cc56","type":"function","z":"c3bc1a43.254dd","name":"Escuro?","func":"if(msg.payload < 35 && msg.payload > 0){\n                global.set(\"salaEscura\", true);\n                node.status({fill:\"green\",shape:\"dot\",text:\"SalaEscura true\"});\n                flow.set(\"triggered\", true);\n                node.send(msg);\n}\nelse if(msg.payload > 250){\n                global.set(\"salaEscura\", false);\n                node.status({fill:\"yellow\",shape:\"dot\",text:\"SalaEscura false\"});\n}\nif(msg.payload < 60 && msg.payload > 0){\n                global.set(\"escritorioEscuro\", true);\n                node.status({fill:\"green\",shape:\"dot\",text:\"EscritorioEscuro true\"});\n                flow.set(\"triggered\", true);\n                node.send(msg);\n}\nelse if(msg.payload > 250){\n                global.set(\"escritorioEscuro\", false);\n                node.status({fill:\"yellow\",shape:\"dot\",text:\"EscritorioEscuro false\"});\n}\n\n    setTimeout(function(){\n    node.status({text:\"\"});\n    }, 15000);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":740,"y":260,"wires":[["8c00ea31.7a21e8"]]},{"id":"2de02f7c.8742a","type":"delay","z":"c3bc1a43.254dd","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":580,"y":260,"wires":[["339689aa.88cc56","a2c42c09.a478e"]]},{"id":"5293749a.79277c","type":"delay","z":"c3bc1a43.254dd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":400,"y":260,"wires":[["2de02f7c.8742a"]]},{"id":"f4f49517.1aee18","type":"server-state-changed","z":"c3bc1a43.254dd","name":"Sensor de Luz Sala","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.sensor_de_luz_sala","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":210,"y":260,"wires":[["5293749a.79277c"]]},{"id":"a2c42c09.a478e","type":"function","z":"c3bc1a43.254dd","name":"Escuro?","func":"if(msg.payload < 250 && msg.payload > 0){\n                node.send(msg);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":740,"y":220,"wires":[["211250e1.8ccec"]]},{"id":"d7742a06.d7b0f8","type":"inject","z":"29d165fe.c5376a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"15 13 * * 2,4,6,0","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":450,"y":280,"wires":[["c0bc8317.599bb"]]},{"id":"c0bc8317.599bb","type":"api-current-state","z":"29d165fe.c5376a","name":"Quem Lava a Louça","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_select.quem_lava_a_louca","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":680,"y":280,"wires":[["c2e58a9b.c6d898","b4cbd884.c83b78","63f07fd3.87564","78bbef24.209cb","5564f13f.0baa7"]]},{"id":"c2e58a9b.c6d898","type":"function","z":"29d165fe.c5376a","name":"Maria?","func":"if(msg.payload === \"Maria\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":280,"wires":[["b07d15d1.d6f0f8","27f967b.e4ee798"]]},{"id":"b4cbd884.c83b78","type":"function","z":"29d165fe.c5376a","name":"Nédi?","func":"if(msg.payload === \"Nédi\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":500,"wires":[["64b10f7d.e1063","312179b7.6cfb26","c53d4593.79db68","986dcc6.d34f33"]]},{"id":"63f07fd3.87564","type":"function","z":"29d165fe.c5376a","name":"Pai?","func":"if(msg.payload === \"Cristofer\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":340,"wires":[["4325281b.1ec928","759e04f0.49930c"]]},{"id":"c53d4593.79db68","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"mqtt\",\n    \"service\": \"publish\",\n    data:{\n        \n          topic: \"iotlink/workgroup/soft-pc/commands/notify\",\n          payload: '{ \"title\": \"Louça\", \"message\": \"Hoje é seu dia de lavar a louça\"}'\n  \n\n    }\n    }};\n    \n    return newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":460,"wires":[["42c3e941.8901d8"]]},{"id":"42c3e941.8901d8","type":"api-call-service","z":"29d165fe.c5376a","name":"PC","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"mqtt","service":"publish","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1310,"y":460,"wires":[[]]},{"id":"f4e420ed.988bd","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify MacBook","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_nedis_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1340,"y":580,"wires":[[]]},{"id":"312179b7.6cfb26","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_macbook_pro_de_nedison\",\n    data:{\n        \n\n         message: 'Hoje é seu dia de lavar a louça'\n  \n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":580,"wires":[["f4e420ed.988bd"]]},{"id":"eb32c05e.04c51","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Nédi's iPhone","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_nedis_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1360,"y":520,"wires":[[]]},{"id":"64b10f7d.e1063","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_nedis_iphone\",\n    data:{\n        \n  \n         message: 'Hoje é seu dia de lavar a louça'\n  \n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":520,"wires":[["eb32c05e.04c51"]]},{"id":"4325281b.1ec928","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_softcelular\",\n    data:{\n        \n         message: 'Hoje é seu dia de lavar a louça'\n  \n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":340,"wires":[["65cd2619.33ce08"]]},{"id":"65cd2619.33ce08","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Pai","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_softcelular","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1320,"y":340,"wires":[[]]},{"id":"27f967b.e4ee798","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Maria. Hoje é seu dia de lavar a louça\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_maria\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1150,"y":220,"wires":[[]]},{"id":"b07d15d1.d6f0f8","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\nnewMsg= {payload : {\n\"domain\": \"notify\",\n\"service\": \"mobile_app_maria_s_iphone\",\ndata:{\n        \n         message: 'Hoje é seu dia de lavar a louça'\n  }\n}};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":280,"wires":[["6d6b19bf.661b58"]]},{"id":"6d6b19bf.661b58","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Maria","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_maria_s_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1330,"y":280,"wires":[[]]},{"id":"759e04f0.49930c","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Cristófer. Hoje é seu dia de lavar a louça\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1150,"y":400,"wires":[[]]},{"id":"986dcc6.d34f33","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Nédi. Hoje é seu dia de lavar a louça\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_nedi\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1150,"y":640,"wires":[[]]},{"id":"6fd78f8a.9fa8","type":"inject","z":"29d165fe.c5376a","d":true,"name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 18 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":550,"y":2960,"wires":[["4eda3d44.1cb214"]]},{"id":"4eda3d44.1cb214","type":"api-current-state","z":"29d165fe.c5376a","name":"Dias Sem Lavar a Roupa","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.dias_sem_lavar_a_roupa","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":770,"y":2960,"wires":[["440b55b1.a47b7c"]]},{"id":"440b55b1.a47b7c","type":"function","z":"29d165fe.c5376a","name":"Quantos dias?","func":"if(msg.payload != \"0.0\" && msg.payload != \"1.0\" && msg.payload != \"2.0\"){\n    global.set(\"diasSemLavarARoupa\", msg.payload);\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1000,"y":2960,"wires":[["e807c42.1797e38"]]},{"id":"e807c42.1797e38","type":"api-current-state","z":"29d165fe.c5376a","name":"Quem Lava a Roupa","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_select.quem_lava_a_roupa","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1240,"y":2960,"wires":[["1b2c6aeb.c82865","cb78a9bd.ddf2d8","c0ddb221.51552"]]},{"id":"1b2c6aeb.c82865","type":"function","z":"29d165fe.c5376a","name":"Maria?","func":"if(msg.payload === \"Maria\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1470,"y":2960,"wires":[["7fcd30ef.1cf12","d181a7e2.125b38"]]},{"id":"cb78a9bd.ddf2d8","type":"function","z":"29d165fe.c5376a","name":"Nédi?","func":"if(msg.payload === \"Nédi\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1470,"y":3180,"wires":[["9bdd50b.de0f0b","d9f4fdbb.a066","82e99b13.162138","2bbb1683.5a5f4a"]]},{"id":"c0ddb221.51552","type":"function","z":"29d165fe.c5376a","name":"Pai?","func":"if(msg.payload === \"Cristofer\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1470,"y":3020,"wires":[["f8729549.f35ac8","a2cff42a.c7bb88"]]},{"id":"82e99b13.162138","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"mqtt\",\n    \"service\": \"publish\",\n    data:{\n        \n          topic: \"iotlink/workgroup/soft-pc/commands/notify\",\n          payload: '{ \"title\": \"Louça\", \"message\": \"Hoje é seu dia de lavar a roupa. Já fazem mais de três dias que não são lavadas.\"}'\n  \n\n    }\n    }};\n    \n    return newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":3140,"wires":[["d008a524.a951a8"]]},{"id":"d008a524.a951a8","type":"api-call-service","z":"29d165fe.c5376a","name":"PC","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"mqtt","service":"publish","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1870,"y":3140,"wires":[[]]},{"id":"d441770d.6c7f78","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify MacBook","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_nedis_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1900,"y":3260,"wires":[[]]},{"id":"d9f4fdbb.a066","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_macbook_pro_de_nedison\",\n    data:{\n        \n\n         message: 'Hoje é seu dia de lavar a roupa. Já fazem mais de '+ String(parseInt(global.get(\"diasSemLavarARoupa\")))+ ' dias que não são lavadas.'\n  \n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":3260,"wires":[["d441770d.6c7f78"]]},{"id":"553a88b1.c8cf48","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Nédi's iPhone","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_nedis_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1920,"y":3200,"wires":[[]]},{"id":"9bdd50b.de0f0b","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_nedis_iphone\",\n    data:{\n        \n  \n         message: 'Hoje é seu dia de lavar a roupa. Já fazem mais de '+ String(parseInt(global.get(\"diasSemLavarARoupa\")))+ ' dias que não são lavadas.'\n  \n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":3200,"wires":[["553a88b1.c8cf48"]]},{"id":"f8729549.f35ac8","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_softcelular\",\n    data:{\n        \n         message: 'Hoje é seu dia de lavar a roupa. Já fazem mais de'+ String(parseInt(global.get(\"diasSemLavarARoupa\")))+ ' dias que não são lavadas.'\n  \n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":3020,"wires":[["d902cc51.c2e6c"]]},{"id":"d902cc51.c2e6c","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Pai","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_softcelular","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1880,"y":3020,"wires":[[]]},{"id":"d181a7e2.125b38","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Maria. Hoje é seu dia de lavar a roupa\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_maria\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1710,"y":2900,"wires":[[]]},{"id":"7fcd30ef.1cf12","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\nnewMsg= {payload : {\n\"domain\": \"notify\",\n\"service\": \"mobile_app_maria_s_iphone\",\ndata:{\n        \n         message: 'Hoje é seu dia de lavar a roupa. Já fazem mais de '+ String(parseInt(global.get(\"diasSemLavarARoupa\")))+ ' dias que não são lavadas.'\n  }\n}};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":2960,"wires":[["c837dacd.2dfe18"]]},{"id":"c837dacd.2dfe18","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Maria","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_maria_s_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1890,"y":2960,"wires":[[]]},{"id":"a2cff42a.c7bb88","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Cristófer. Hoje é seu dia de lavar a roupa\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1710,"y":3080,"wires":[[]]},{"id":"2bbb1683.5a5f4a","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Nédi. Hoje é seu dia de lavar a roupa\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_nedi\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1710,"y":3320,"wires":[[]]},{"id":"5a0a126e.7f7f2c","type":"inject","z":"29d165fe.c5376a","d":true,"name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 19 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":550,"y":3500,"wires":[["d52d609e.82fcc"]]},{"id":"d52d609e.82fcc","type":"api-current-state","z":"29d165fe.c5376a","name":"Dias Sem Levar o Lixo","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.dias_sem_levar_o_lixo","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":760,"y":3500,"wires":[["5ecb5da4.7a0684"]]},{"id":"5ecb5da4.7a0684","type":"function","z":"29d165fe.c5376a","name":"Quantos dias?","func":"if(msg.payload != \"0.0\" && msg.payload != \"1.0\" && msg.payload != \"2.0\"){\n    global.set(\"diasSemLevarOLixo\", msg.payload);\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1000,"y":3500,"wires":[["ecdb58ce.8d64c8"]]},{"id":"ecdb58ce.8d64c8","type":"api-current-state","z":"29d165fe.c5376a","name":"Quem Leva o Lixo","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_select.quem_leva_o_lixo","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1230,"y":3500,"wires":[["b619a808.5dcef8","6fcd5e6a.af3a6","dbe9e204.9f074"]]},{"id":"b619a808.5dcef8","type":"function","z":"29d165fe.c5376a","name":"Maria?","func":"if(msg.payload === \"Maria\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1470,"y":3500,"wires":[["ff3d7077.8864c","3c065e22.c56302"]]},{"id":"6fcd5e6a.af3a6","type":"function","z":"29d165fe.c5376a","name":"Nédi?","func":"if(msg.payload === \"Nédi\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1470,"y":3720,"wires":[["b3dbba9e.906f38","10706242.047ebe","572b73c6.c7ff9c","c9e599b9.cb0508"]]},{"id":"dbe9e204.9f074","type":"function","z":"29d165fe.c5376a","name":"Pai?","func":"if(msg.payload === \"Cristofer\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1470,"y":3560,"wires":[["d5fe6115.82f17","b4dfd5.2511d028"]]},{"id":"572b73c6.c7ff9c","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"mqtt\",\n    \"service\": \"publish\",\n    data:{\n        \n          topic: \"iotlink/workgroup/soft-pc/commands/notify\",\n          payload: '{ \"title\": \"Louça\", \"message\": \"Hoje é seu dia de levar o lixo. Já fazem mais de três dias que não são lavadas.\"}'\n  \n\n    }\n    }};\n    \n    return newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":3680,"wires":[["3ec73964.cd1666"]]},{"id":"3ec73964.cd1666","type":"api-call-service","z":"29d165fe.c5376a","name":"PC","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"mqtt","service":"publish","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1870,"y":3680,"wires":[[]]},{"id":"e3d34d0.9457eb","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify MacBook","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_nedis_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1900,"y":3800,"wires":[[]]},{"id":"10706242.047ebe","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_macbook_pro_de_nedison\",\n    data:{\n        \n\n          message: 'Hoje é seu dia de levar o lixo. Já fazem mais de '+ String(parseInt(global.get(\"diasSemLevarOLixo\")))+ ' dias que o lixo não é levado.'\n \n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":3800,"wires":[["e3d34d0.9457eb"]]},{"id":"ec8983e5.9d2b1","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Nédi's iPhone","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_nedis_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1920,"y":3740,"wires":[[]]},{"id":"b3dbba9e.906f38","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_nedis_iphone\",\n    data:{\n        \n  \n         message: 'Hoje é seu dia de levar o lixo. Já fazem mais de '+ String(parseInt(global.get(\"diasSemLevarOLixo\")))+ ' dias que o lixo não é levado.'\n  \n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":3740,"wires":[["ec8983e5.9d2b1"]]},{"id":"d5fe6115.82f17","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_softcelular\",\n    data:{\n        \n         message: 'Hoje é seu dia de levar o lixo. Já fazem mais de '+ String(parseInt(global.get(\"diasSemLevarOLixo\")))+ ' dias que o lixo não é levado.'\n  \n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":3560,"wires":[["f8f89d3d.c1f28"]]},{"id":"f8f89d3d.c1f28","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Pai","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_softcelular","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1880,"y":3560,"wires":[[]]},{"id":"3c065e22.c56302","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Maria. Hoje é seu dia de levar o lixo\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_maria\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1710,"y":3440,"wires":[[]]},{"id":"ff3d7077.8864c","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\nnewMsg= {payload : {\n\"domain\": \"notify\",\n\"service\": \"mobile_app_maria_s_iphone\",\ndata:{\n        \n         message: 'Hoje é seu dia de levar o lixo. Já fazem mais de '+ String(parseInt(global.get(\"diasSemLevarOLixo\")))+ ' dias que o lixo não é levado.'\n  }\n}};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":3500,"wires":[["159b39ae.2b5176"]]},{"id":"159b39ae.2b5176","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Maria","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_maria_s_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1890,"y":3500,"wires":[[]]},{"id":"b4dfd5.2511d028","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Cristófer. Hoje é seu dia de levar o lixo\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1710,"y":3620,"wires":[[]]},{"id":"c9e599b9.cb0508","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Nédi. Hoje é seu dia de levar o lixo\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_nedi\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1710,"y":3860,"wires":[[]]},{"id":"893aaedb.34afd","type":"server-state-changed","z":"29d165fe.c5376a","d":true,"name":"Roupa está Seca","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.esta_seca","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":580,"y":4020,"wires":[["2c45a2c5.62179e"]]},{"id":"7dfa81ce.a4d2c","type":"api-current-state","z":"29d165fe.c5376a","name":"Quem Lava a Roupa","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_select.quem_lava_a_roupa","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1060,"y":4020,"wires":[["5c606820.62b828","2d8f9c18.fd3a84","10e8e4.fe37471c"]]},{"id":"5c606820.62b828","type":"function","z":"29d165fe.c5376a","name":"Maria?","func":"if(msg.payload === \"Maria\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1290,"y":4020,"wires":[["510ae8e4.d1aa08","4c1541f1.48213"]]},{"id":"2d8f9c18.fd3a84","type":"function","z":"29d165fe.c5376a","name":"Nédi?","func":"if(msg.payload === \"Nédi\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1290,"y":4240,"wires":[["ccfc45a2.9e3998","e11a314.b0ef4d","b03af33b.9ae72","1a0ae455.25493c"]]},{"id":"10e8e4.fe37471c","type":"function","z":"29d165fe.c5376a","name":"Pai?","func":"if(msg.payload === \"Cristofer\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1290,"y":4080,"wires":[["db51e209.10237","54084f32.fb785"]]},{"id":"b03af33b.9ae72","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"mqtt\",\n    \"service\": \"publish\",\n    data:{\n        \n          topic: \"iotlink/workgroup/soft-pc/commands/notify\",\n          payload: '{ \"title\": \"Louça\", \"message\": \"A roupa já deve estar seca.\"}'\n  \n\n    }\n    }};\n    \n    return newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1530,"y":4200,"wires":[["cbf550f7.f230d"]]},{"id":"cbf550f7.f230d","type":"api-call-service","z":"29d165fe.c5376a","name":"PC","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"mqtt","service":"publish","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1690,"y":4200,"wires":[[]]},{"id":"4c3b3070.9d21b","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify MacBook","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_nedis_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1720,"y":4320,"wires":[[]]},{"id":"e11a314.b0ef4d","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_macbook_pro_de_nedison\",\n    data:{\n        \n\n        \n         message: 'A roupa já deve estar seca'\n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1530,"y":4320,"wires":[["4c3b3070.9d21b"]]},{"id":"13d872a4.d1a91d","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Nédi's iPhone","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_nedis_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1740,"y":4260,"wires":[[]]},{"id":"ccfc45a2.9e3998","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_nedis_iphone\",\n    data:{\n        \n  \n         \n         message: 'A roupa já deve estar seca'\n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1530,"y":4260,"wires":[["13d872a4.d1a91d"]]},{"id":"db51e209.10237","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_softcelular\",\n    data:{\n        \n         \n         message: 'A roupa já deve estar seca'\n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1530,"y":4080,"wires":[["6f0ee2f1.d78e8c"]]},{"id":"6f0ee2f1.d78e8c","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Pai","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_softcelular","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1700,"y":4080,"wires":[[]]},{"id":"4c1541f1.48213","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Maria. A roupa já deve estar seca\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_maria\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1530,"y":3960,"wires":[[]]},{"id":"510ae8e4.d1aa08","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\nnewMsg= {payload : {\n\"domain\": \"notify\",\n\"service\": \"mobile_app_maria_s_iphone\",\ndata:{\n        \n         message: 'A roupa já deve estar seca'\n  }\n}};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1530,"y":4020,"wires":[["641d196f.e548f8"]]},{"id":"641d196f.e548f8","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Maria","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_maria_s_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1710,"y":4020,"wires":[[]]},{"id":"54084f32.fb785","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Cristófer. A roupa já deve estar seca\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1530,"y":4140,"wires":[[]]},{"id":"1a0ae455.25493c","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Nédi. A roupa já deve estar seca\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_nedi\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1530,"y":4380,"wires":[[]]},{"id":"2c45a2c5.62179e","type":"function","z":"29d165fe.c5376a","name":"Seca?","func":"if(msg.payload === true){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":4020,"wires":[["7dfa81ce.a4d2c"]]},{"id":"8c078b9c.24f388","type":"server-state-changed","z":"29d165fe.c5376a","name":"Máquina de Lavar Roupas","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_select.maquina_de_lavar_roupa","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":610,"y":4600,"wires":[["98a0a48a.13d788"]]},{"id":"cad3f3ae.68a9d","type":"api-current-state","z":"29d165fe.c5376a","name":"Quem Lava a Roupa","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_select.quem_lava_a_roupa","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":1080,"y":4600,"wires":[["dc0e3d35.d8be7","369daa41.4a4156","9742d2fc.0b1ec"]]},{"id":"dc0e3d35.d8be7","type":"function","z":"29d165fe.c5376a","name":"Maria?","func":"if(msg.payload === \"Maria\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1310,"y":4600,"wires":[["c1c32bc7.f6a148","a2f57bdb.3aa4c8"]]},{"id":"369daa41.4a4156","type":"function","z":"29d165fe.c5376a","name":"Nédi?","func":"if(msg.payload === \"Nédi\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1310,"y":4820,"wires":[["cca33e4d.dc9d","e2eb07a7.93c338","3e037140.7aaf1e","8722e323.55b4e"]]},{"id":"9742d2fc.0b1ec","type":"function","z":"29d165fe.c5376a","name":"Pai?","func":"if(msg.payload === \"Cristofer\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1310,"y":4660,"wires":[["cf71e216.cd332","5b5415af.c4887c"]]},{"id":"3e037140.7aaf1e","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"mqtt\",\n    \"service\": \"publish\",\n    data:{\n        \n          topic: \"iotlink/workgroup/soft-pc/commands/notify\",\n          payload: '{ \"title\": \"Louça\", \"message\": \"A roupa já deve estar seca.\"}'\n  \n\n    }\n    }};\n    \n    return newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1550,"y":4780,"wires":[["a132aa11.458848"]]},{"id":"a132aa11.458848","type":"api-call-service","z":"29d165fe.c5376a","name":"PC","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"mqtt","service":"publish","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1710,"y":4780,"wires":[[]]},{"id":"9062e21f.168a2","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify MacBook","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_nedis_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1740,"y":4900,"wires":[[]]},{"id":"e2eb07a7.93c338","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_macbook_pro_de_nedison\",\n    data:{\n        \n\n        \n         message: 'As roupas estão prontas na máquina.'\n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1550,"y":4900,"wires":[["9062e21f.168a2"]]},{"id":"89cecf5.21c373","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Nédi's iPhone","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_nedis_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1760,"y":4840,"wires":[[]]},{"id":"cca33e4d.dc9d","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_nedis_iphone\",\n    data:{\n        \n  \n         \n         message: 'As roupas estão prontas na máquina.'\n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1550,"y":4840,"wires":[["89cecf5.21c373"]]},{"id":"cf71e216.cd332","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_softcelular\",\n    data:{\n        \n         \n         message: 'As roupas estão prontas na máquina.'\n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1550,"y":4660,"wires":[["80ea7306.f0729"]]},{"id":"80ea7306.f0729","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Pai","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_softcelular","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1720,"y":4660,"wires":[[]]},{"id":"a2f57bdb.3aa4c8","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Maria. As roupas estão prontas na máquina.\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_maria\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1550,"y":4520,"wires":[[]]},{"id":"c1c32bc7.f6a148","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\nnewMsg= {payload : {\n\"domain\": \"notify\",\n\"service\": \"mobile_app_maria_s_iphone\",\ndata:{\n        \n         message: 'As roupas estão prontas na máquina.'\n  }\n}};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1550,"y":4600,"wires":[["4d18965d.10d738"]]},{"id":"4d18965d.10d738","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Maria","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_maria_s_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1730,"y":4600,"wires":[[]]},{"id":"5b5415af.c4887c","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Cristófer. As roupas estão prontas na máquina.\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1550,"y":4720,"wires":[[]]},{"id":"8722e323.55b4e","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Nédi. As roupas estão prontas na máquina.\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_nedi\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1550,"y":4960,"wires":[[]]},{"id":"98a0a48a.13d788","type":"function","z":"29d165fe.c5376a","name":"Pronto?","func":"if(msg.payload === \"Pronto\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":4600,"wires":[["cad3f3ae.68a9d"]]},{"id":"39ec3ca5.d405f4","type":"inject","z":"ccb6d071.13253","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 23 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":330,"y":3040,"wires":[["9f10006c.ad4cb"]]},{"id":"125b52c7.758bfd","type":"function","z":"ccb6d071.13253","name":"Hot?","func":"if(msg.payload > 25){\n    var newMsg= {payload : {\n        \"domain\": \"switch\",\n        \"service\": \"turn_off\",\n        data:{\n            \"entity_id\": \"switch.flor\"\n        }\n    }};\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1010,"y":3040,"wires":[["f7049dd5.bfe12"]]},{"id":"58718cd3.41cb64","type":"api-current-state","z":"ccb6d071.13253","name":"Temperatura","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.temperatura_quarto_nedi","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":840,"y":3040,"wires":[["125b52c7.758bfd"]]},{"id":"f7049dd5.bfe12","type":"api-call-service","z":"ccb6d071.13253","name":"Ventilador","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.ventilador","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1160,"y":3040,"wires":[[]]},{"id":"af8436e5.49b228","type":"function","z":"ccb6d071.13253","name":"Home?","func":"if(msg.payload === \"home\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":3040,"wires":[["58718cd3.41cb64"]]},{"id":"9f10006c.ad4cb","type":"api-current-state","z":"ccb6d071.13253","name":"Nédi home?","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"person.nedi_2","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":500,"y":3040,"wires":[["af8436e5.49b228"]]},{"id":"a1abcaa6.849b68","type":"comment","z":"ccb6d071.13253","name":"Liga o ventilador antes de ir dormir se tiver em casa e quente","info":"","x":450,"y":2960,"wires":[]},{"id":"2c98fd4c.b481f2","type":"function","z":"1d7ecdc6.68c842","name":"Botão Cozinha Click","func":"if(msg.topic === \"sensor.botao_cozinha_action_2\" && msg.payload === \"single\"){\n    return msg;\n}\n//sensor_switch.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":2200,"wires":[[]]},{"id":"28b887eb.86ab68","type":"function","z":"1d7ecdc6.68c842","name":"Botão Cozinha Double","func":"if(msg.topic === \"sensor.botao_cozinha_action_2\" && msg.payload === \"double\"){\n    return msg;\n}\n//sensor_switch.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":2240,"wires":[[]]},{"id":"4b3fce51.9fda3","type":"server-state-changed","z":"1d7ecdc6.68c842","name":"Botão Cozinha","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.botao_cozinha_action_2","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":300,"y":2220,"wires":[["2c98fd4c.b481f2","28b887eb.86ab68","c789b884.705008"]]},{"id":"889d9242.9d9ce","type":"server-state-changed","z":"1d7ecdc6.68c842","name":"Botão Cozinha","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.botao_cozinha_battery_2","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":300,"y":2280,"wires":[["94ba67f2.132438"]]},{"id":"c789b884.705008","type":"debug","z":"1d7ecdc6.68c842","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":500,"y":2160,"wires":[]},{"id":"94ba67f2.132438","type":"function","z":"1d7ecdc6.68c842","name":"Botão Cozinha","func":"if(msg.topic === \"sensor.botao_cozinha_battery_2\"){\n    return msg;\n}\n//sensor_switch.aq2\n//nao funciona direito, manda o estado da bateria em vez do click","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":2280,"wires":[[]]},{"id":"aed81995.1dd2a8","type":"inject","z":"ccb6d071.13253","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1200,"y":760,"wires":[[]]},{"id":"b8bfe96a.429098","type":"trigger","z":"ccb6d071.13253","name":"","op1":"1","op2":"0","op1type":"num","op2type":"str","duration":"-250","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1940,"y":240,"wires":[["770423da.25729c"]]},{"id":"6bfee78c.963388","type":"function","z":"ccb6d071.13253","name":"Aux Function","func":"flow.set(\"iterLuzDoQuartoInc\", 20);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1730,"y":240,"wires":[["b8bfe96a.429098"]]},{"id":"8ad887fd.0fc8c8","type":"function","z":"ccb6d071.13253","name":"Aux Function","func":"flow.set(\"iterLuzDoQuartoInc\", 200);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1730,"y":320,"wires":[["c5ed72fa.46dc8"]]},{"id":"c5ed72fa.46dc8","type":"trigger","z":"ccb6d071.13253","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-250","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1940,"y":320,"wires":[["799b7bb.f2e0e84"]]},{"id":"10e9f60f.49c23a","type":"trigger","z":"ccb6d071.13253","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-250","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1540,"y":420,"wires":[["a0c1119b.cd4a1"]]},{"id":"a0c1119b.cd4a1","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"4","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1750,"y":420,"wires":[["baf21a55.bb7c68"]]},{"id":"11baa81c.8c2e88","type":"debug","z":"ccb6d071.13253","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2290,"y":180,"wires":[]},{"id":"be9dc368.8dcd3","type":"function","z":"ccb6d071.13253","name":"Turn On 100%","func":"var i = parseInt(flow.get(\"iterLuzDoQuartoInc\"));\nif (i > 255) {\n        return {reset: 1};\n}\nvar newMsg;\nnewMsg= {payload : {\n            \"domain\": \"light\",\n            \"service\": \"turn_on\",\n            data:{\n                \n                \"entity_id\": \"light.luz_do_quarto_nedi\",\n                \"brightness\": i,\n                \"rgb_color\": [i, i, i]\n            }\n}};    \ni += 50\nflow.set(\"iterLuzDoQuartoInc\", i);\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2088,"y":1780,"wires":[["71c15fec.9d80d"]]},{"id":"b61a1088.e8cab","type":"trigger","z":"ccb6d071.13253","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-250","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1888,"y":1780,"wires":[["be9dc368.8dcd3"]]},{"id":"9c6b712a.3ce1d","type":"function","z":"ccb6d071.13253","name":"Aux Function","func":"flow.set(\"iterLuzDoQuartoInc\", 20);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1678,"y":1780,"wires":[["b61a1088.e8cab"]]},{"id":"d91661e6.f5145","type":"api-call-service","z":"ccb6d071.13253","name":"Luz do Quarto","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.luz_do_quarto","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2600,"y":1780,"wires":[[]]},{"id":"7e285c77.2cb404","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"4","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2420,"y":1780,"wires":[["d91661e6.f5145"]]},{"id":"9947383b.5c79b8","type":"function","z":"ccb6d071.13253","name":"Turn On 100%","func":"var i = parseInt(flow.get(\"iterLuzDoQuartoInc\"));\nif (i > 255) {\n        return {reset: true};\n}\nvar newMsg;\nnewMsg= {payload : {\n            \"domain\": \"light\",\n            \"service\": \"turn_on\",\n            data:{\n                \n                \"entity_id\": \"light.luz_do_quarto_nedi\",\n                \"brightness\": i,\n                \"rgb_color\": [i, i, i]\n            }\n}};    \ni += 30\nflow.set(\"iterLuzDoQuartoInc\", i);\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3360,"y":1700,"wires":[["c82dfcb2.30609"]]},{"id":"249bed8.5cde712","type":"trigger","z":"ccb6d071.13253","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-250","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3160,"y":1700,"wires":[["9947383b.5c79b8"]]},{"id":"b816d246.781b8","type":"function","z":"ccb6d071.13253","name":"Aux Function","func":"flow.set(\"iterLuzDoQuartoInc\", 20);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2950,"y":1700,"wires":[["249bed8.5cde712"]]},{"id":"d26c42d0.947a4","type":"api-call-service","z":"ccb6d071.13253","name":"Luz do Quarto","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.luz_do_quarto","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":4080,"y":1700,"wires":[[]]},{"id":"4d2ee04f.5b5cc","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"4","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3900,"y":1700,"wires":[["d26c42d0.947a4"]]},{"id":"b4b1977.85dff68","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"var i = parseInt(flow.get(\"iterLuzDoQuartoDec\"));\nif (i <= 0) {      \n        newMsg= {payload : {        \n            \"domain\": \"light\",\n            \"service\": \"turn_off\",\n            data:{\n                \"entity_id\": \"light.luz_do_quarto_nedi\"\n            }},reset: true };\n        return newMsg;\n}\nelse{\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_on\",\n        data:{\n                    \n            \"entity_id\": \"light.luz_do_quarto_nedi\",\n            \"brightness\": i,\n            \"rgb_color\": [i, i, i]\n        }\n        }};\n    if(i < 60){ \n            \n            newMsg= {payload : {\n                \"domain\": \"light\",\n            \"service\": \"turn_on\",\n            data:{\n                \"entity_id\": \"light.luz_do_quarto_nedi\",\n                \"brightness\": 0,\n                \"rgb_color\": [0, 0, 0]\n            }\n        }};\n        node.send(newMsg);          \n        newMsg= {payload : {        \n            \"domain\": \"light\",\n            \"service\": \"turn_off\",\n            data:{\n                \"entity_id\": \"light.luz_do_quarto_nedi\"\n            }}};\n    }\n}\ni-= 50\n        \nflow.set(\"iterLuzDoQuartoDec\", i);\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3560,"y":1620,"wires":[["4feb4196.b6dd8"]]},{"id":"99afbd5a.d776e","type":"trigger","z":"ccb6d071.13253","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-250","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3380,"y":1620,"wires":[["b4b1977.85dff68"]]},{"id":"8b344234.162a5","type":"function","z":"ccb6d071.13253","name":"Aux Function","func":"if(msg.payload === \"on\"){\n    flow.set(\"iterLuzDoQuartoDec\", parseInt(msg.data.attributes.brightness));\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3170,"y":1620,"wires":[["99afbd5a.d776e"]]},{"id":"455ab336.0d2e9c","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"var i = parseInt(flow.get(\"iterLuzDoQuartoDec\"));\nif (i <= 0) {    \n        newMsg= {payload : {        \n            \"domain\": \"light\",\n            \"service\": \"turn_off\",\n            data:{\n                \"entity_id\": \"light.luz_do_quarto_nedi\"\n            }},reset: true };\n        return newMsg;\n}\nelse{\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_on\",\n        data:{\n                    \n            \"entity_id\": \"light.luz_do_quarto_nedi\",\n            \"brightness\": i,\n            \"rgb_color\": [i, i, i]\n        }\n        }};\n    if(i < 40){ \n            \n            newMsg= {payload : {\n                \"domain\": \"light\",\n            \"service\": \"turn_on\",\n            data:{\n                \"entity_id\": \"light.luz_do_quarto_nedi\",\n                \"brightness\": 0,\n                \"rgb_color\": [0, 0, 0]\n            }\n        }};\n        node.send(newMsg);          \n        newMsg= {payload : {        \n            \"domain\": \"light\",\n            \"service\": \"turn_off\",\n            data:{\n                \"entity_id\": \"light.luz_do_quarto_nedi\"\n            }}};\n    }\n}\ni-= 30\n        \nflow.set(\"iterLuzDoQuartoDec\", i);\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1460,"y":2620,"wires":[["183b076.0fd81f9"]]},{"id":"71fc0997.c90f48","type":"trigger","z":"ccb6d071.13253","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-500","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1280,"y":2620,"wires":[["455ab336.0d2e9c"]]},{"id":"f09d9b88.85d928","type":"function","z":"ccb6d071.13253","name":"Aux Function","func":"if(msg.payload === \"on\"){\n    flow.set(\"iterLuzDoQuartoDec\", parseInt(msg.data.attributes.brightness));\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1070,"y":2620,"wires":[["71fc0997.c90f48"]]},{"id":"55df9f49.b37c9","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"var i = parseInt(flow.get(\"iterFitaDoQuartoDec\"));\nif (i <= 0) {    \n        newMsg= {payload : {\"On\":false},reset: true };\n        return newMsg;\n}\nelse{\n            newMsg= {payload : {\"On\":true,\n                    \"Brightness\": i,     \n                    \"Hue\": 174,\n                    \"Saturation\": 100 }};\n            if(i < 30){ \n                newMsg= {payload : {\"On\":true,\n                    \"Brightness\": 0,     \n                    \"Hue\": 174,\n                    \"Saturation\": 100 }};\n                node.send(newMsg);   \n                \n                newMsg= {payload : {\"On\":false}};\n            }\n}\ni-= 20\n        \nflow.set(\"iterFitaDoQuartoDec\", i);\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1460,"y":2800,"wires":[["7024bc77.6ac7c4"]]},{"id":"dfc561b4.36ed1","type":"trigger","z":"ccb6d071.13253","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-500","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1280,"y":2800,"wires":[["55df9f49.b37c9"]]},{"id":"1547d13f.a58e1f","type":"function","z":"ccb6d071.13253","name":"Aux Function","func":"if(msg.payload.On === true){\n    flow.set(\"iterFitaDoQuartoDec\", parseInt(msg.payload.Brightness));\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1070,"y":2800,"wires":[["dfc561b4.36ed1"]]},{"id":"bf1e0b5c.cabbd8","type":"function","z":"ccb6d071.13253","name":"Aux Function","func":"if(msg.payload.On === true){\n    flow.set(\"iterFitaDoQuartoDec\", parseInt(msg.payload.Brightness));\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3130,"y":1240,"wires":[["c65399c1.7ec788"]]},{"id":"c65399c1.7ec788","type":"trigger","z":"ccb6d071.13253","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-500","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3340,"y":1240,"wires":[["2377ef7.f36a71"]]},{"id":"2377ef7.f36a71","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"var i = parseInt(flow.get(\"iterFitaDoQuartoDec\"));\nif (i <= 0) {    \n        newMsg= {payload : {\"On\":false},reset: true };\n        return newMsg;\n}\nelse{\n            newMsg= {payload : {\"On\":true,\n                    \"Brightness\": i,     \n                    \"Hue\": i,\n                    \"Saturation\": 0 }};\n            if(i < 30){ \n                newMsg= {payload : {\"On\":true,\n                    \"Brightness\": 0,     \n                    \"Hue\": 0,\n                    \"Saturation\": 0 }};\n                node.send(newMsg);   \n                \n                newMsg= {payload : {\"On\":false}};\n            }\n}\ni-= 50\n        \nflow.set(\"iterFitaDoQuartoDec\", i);\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3520,"y":1240,"wires":[["df3ab214.99afe"]]},{"id":"44053648.80fec8","type":"function","z":"ccb6d071.13253","name":"Aux Function","func":"if(msg.payload.On === true){\n    flow.set(\"iterFitaDoQuartoDec\", 20);\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1650,"y":1000,"wires":[["5c4fd2c8.83e04c"]]},{"id":"5c4fd2c8.83e04c","type":"trigger","z":"ccb6d071.13253","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-250","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1860,"y":1000,"wires":[["2c72a469.44270c"]]},{"id":"2c72a469.44270c","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"var i = parseInt(flow.get(\"iterFitaDoQuartoDec\"));\nif (i <= 0) {    \n        newMsg= {payload : {\"On\":false},reset: true};\n        return newMsg;\n}\nelse{\n            newMsg= {payload : {\"On\":true,\n                    \"Brightness\": i,     \n                    \"Hue\": 174,\n                    \"Saturation\": 100 }};\n            if(i < 30){ \n                newMsg= {payload : {\"On\":true,\n                    \"Brightness\": 0,     \n                    \"Hue\": 174,\n                    \"Saturation\": 100 }};\n                node.send(newMsg);   \n                \n                flow.set(\"iterFitaDoQuartoDec\", 0);    \n                newMsg= {payload : {\"On\":false},reset: 1 };\n            }\n}\ni--\n        \nflow.set(\"iterFitaDoQuartoDec\", i);\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2040,"y":1000,"wires":[["7bedf35.7511a0c"]]},{"id":"c900d626.1bc7f8","type":"hb-control","z":"ccb6d071.13253","name":"Fita do Quarto","Homebridge":"homebridge","Manufacturer":"MagicHome","Service":"Lightbulb","device":"homebridge0E:E6:D8:A7:98:38MagicHomeFita do Quarto00000043","conf":"40e0a266.1beb0c","x":2580,"y":1000,"wires":[]},{"id":"20b0e9b1.368d86","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"2","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2390,"y":1000,"wires":[["c900d626.1bc7f8"]]},{"id":"2b90b7fe.2aac18","type":"function","z":"ccb6d071.13253","name":"Turn Off","func":"var i = parseInt(flow.get(\"iterLuzDoQuartoDec\"));\nif (i <= 0) {    \n        newMsg= {payload : {        \n            \"domain\": \"light\",\n            \"service\": \"turn_off\",\n            data:{\n                \"entity_id\": \"light.luz_do_quarto_nedi\"\n            }},reset: true };\n        return newMsg;\n}\nelse{\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_on\",\n        data:{\n            \n            \"entity_id\": \"light.luz_do_quarto_nedi\",\n            \"brightness\": parseInt(i/13),\n            \"rgb_color\": [i, parseInt(i/2), 0]\n        }\n    }};\n    if(i < 25){ \n        \n        newMsg= {payload : {\n            \"domain\": \"light\",\n            \"service\": \"turn_on\",\n            data:{\n                \n                \"entity_id\": \"light.luz_do_quarto_nedi\",\n                \"brightness\": 0,\n                \"rgb_color\": [0, 0, 0]\n            }\n        }};\n        node.send(newMsg);          \n        flow.set(\"iterLuzDoQuartoDec\", 0);    \n        newMsg= {payload : {        \n            \"domain\": \"light\",\n            \"service\": \"turn_off\",\n            data:{\n                \"entity_id\": \"light.luz_do_quarto_nedi\"\n            }},reset: 1 };\n    }\n}\n\ni-= 30\n        \nflow.set(\"iterLuzDoQuartoDec\", i);\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2040,"y":920,"wires":[["b7f5b532.1f82a8"]]},{"id":"240da74b.aeddf8","type":"trigger","z":"ccb6d071.13253","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-500","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1860,"y":920,"wires":[["2b90b7fe.2aac18"]]},{"id":"1e871423.157f8c","type":"function","z":"ccb6d071.13253","name":"Aux Function","func":"if(msg.payload === \"on\"){\n    flow.set(\"iterLuzDoQuartoDec\",255);\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1650,"y":920,"wires":[["240da74b.aeddf8"]]},{"id":"6d52f0b0.436a1","type":"api-call-service","z":"ccb6d071.13253","name":"Luz do Quarto Nédi","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.luz_do_quarto_nedi","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2590,"y":920,"wires":[[]]},{"id":"ab2ac1b2.530ed","type":"delay","z":"ccb6d071.13253","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"2","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2390,"y":920,"wires":[["6d52f0b0.436a1"]]},{"id":"2d935265.4a437e","type":"function","z":"ccb6d071.13253","name":"Aux Function","func":"flow.set(\"iterFitaDoQuartoInc\", 1);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1630,"y":1540,"wires":[["ade29806.cd7cd8"]]},{"id":"ade29806.cd7cd8","type":"trigger","z":"ccb6d071.13253","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-250","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1840,"y":1540,"wires":[["667f41cc.b7183"]]},{"id":"667f41cc.b7183","type":"function","z":"ccb6d071.13253","name":"Turn On","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nvar i = parseInt(flow.get(\"iterFitaDoQuartoInc\"));\n\nif (i > 255) { \n    return {reset: 1} ;\n}\nvar newMsg;\n//var timerId = setInterval(function check() {\n//    newMsg= {payload : {\"On\":true,\n//            \"Brightness\": i,     \n//            \"Hue\": 174,\n//            \"Saturation\": 100 }};\n//    node.send(newMsg);\n//    i = i + auxInc; \n//    if (i > aux) { \n//        clearInterval(check);\n//        return;\n//    }\n//} , 250);\n\nnewMsg= {payload : {\"On\":true,\n            \"Brightness\": i,     \n            \"Hue\": i,\n            \"Saturation\": 0 }};\ni = i + 50; \n    \nflow.set(\"iterFitaDoQuartoInc\", i);\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2020,"y":1540,"wires":[["4aca5fe7.02764"]]},{"id":"e9fdf3cd.b5a0b","type":"trigger","z":"ccb6d071.13253","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-250","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1620,"y":720,"wires":[["9bd0e155.0ba7e"]]},{"id":"9bd0e155.0ba7e","type":"function","z":"ccb6d071.13253","name":"Turn On","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nvar i = parseInt(flow.get(\"iterFitaDoQuartoInc\"));\nif(Hour > 10 && Hour < 21){\n    aux = 255;\n    auxInc = 30;\n}\nif(Hour <= 10 || Hour >= 21){\n    aux = 150;\n    auxInc = 20;\n}\n\nif (i > 20) { \n    return {reset: true} ;\n}\nvar newMsg;\n//var timerId = setInterval(function check() {\n//    newMsg= {payload : {\"On\":true,\n//            \"Brightness\": i,     \n//            \"Hue\": 174,\n//            \"Saturation\": 100 }};\n//    node.send(newMsg);\n//    i = i + auxInc; \n//    if (i > aux) { \n//        clearInterval(check);\n//        return;\n//    }\n//} , 250);\n\nnewMsg= {payload : {\"On\":true,\n        \"Brightness\": i,     \n        \"Hue\": 174,\n        \"Saturation\": 100 }};\ni += 5\n    \nflow.set(\"iterFitaDoQuartoInc\", i);\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1820,"y":720,"wires":[["56b522e.4d695dc"]]},{"id":"e1eda244.387e3","type":"function","z":"ccb6d071.13253","name":"Turn On Bright","func":"var i = parseInt(flow.get(\"iterLuzDoQuartoInc\"));\nif (i > 255) {\n        return {reset: true};\n}\nvar newMsg;\n    newMsg= {payload : {\n        \"domain\": \"light\",\n        \"service\": \"turn_on\",\n        data:{\n            \n            \"entity_id\": \"light.luz_do_quarto_nedi\",\n            \"brightness\": parseInt(i/15),\n            \"rgb_color\": [255, 150, 0]\n        }\n    }};\ni += 30\nflow.set(\"iterLuzDoQuartoInc\", i);\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1840,"y":820,"wires":[["2a754cae.e68744"]]},{"id":"c2e99c17.17a7","type":"trigger","z":"ccb6d071.13253","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-250","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1640,"y":820,"wires":[["e1eda244.387e3"]]},{"id":"c294d9c3.5f5768","type":"function","z":"ccb6d071.13253","name":"Aux Function","func":"flow.set(\"iterLuzDoQuartoInc\", 35);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1430,"y":820,"wires":[["c2e99c17.17a7"]]},{"id":"414516c9.c09818","type":"function","z":"ecc79e8a.d4a1b","name":"Add Topic","func":"var newMsg;\nif(msg.payload === true)\n{\n    newMsg = {\"topic\":\"LuzDaTV\", \"payload\": true};\n    flow.set(\"tunelLigado\",true);\n    return newMsg;\n}\nif(msg.payload === false)\n{\n    newMsg = {\"topic\":\"LuzDaTV\",\"payload\": false};\n    flow.set(\"tunelLigado\",false);\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1120,"y":1040,"wires":[["7864c065.6dfc1"]]},{"id":"86f0ecba.57dc9","type":"api-current-state","z":"ecc79e8a.d4a1b","name":"Luz da TV","server":"d63d21ef.5e065","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"light.luz_da_tv","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":610,"y":1040,"wires":[["414516c9.c09818"],["414516c9.c09818"]]},{"id":"91e26ead.1e0bd","type":"function","z":"ecc79e8a.d4a1b","name":"In Case of Error","func":"var newMsg;\nnewMsg = {payload:true}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":980,"wires":[["dbf5bb99.f26e88"]]},{"id":"dbf5bb99.f26e88","type":"delay","z":"ecc79e8a.d4a1b","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":780,"y":980,"wires":[["414516c9.c09818"]]},{"id":"7864c065.6dfc1","type":"delay","z":"ecc79e8a.d4a1b","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"3","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1280,"y":1040,"wires":[["2d78271d.1500a8"]]},{"id":"1d4d24f9.85c70b","type":"api-current-state","z":"ccb6d071.13253","name":"Movimento Aux","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.movimento_quarto_nedi_aux","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":300,"y":240,"wires":[["f579e637.984458"]]},{"id":"f579e637.984458","type":"function","z":"ccb6d071.13253","name":"Movimento dentro?","func":"if(msg.payload === \"off\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":240,"wires":[["7fb428b4.d3b778"]]},{"id":"e5b5f643.bd60a8","type":"api-current-state","z":"ccb6d071.13253","name":"Movimento Aux","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.movimento_quarto_nedi_aux","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":320,"y":760,"wires":[["309c9e05.f9a192"]]},{"id":"309c9e05.f9a192","type":"function","z":"ccb6d071.13253","name":"Movimento dentro?","func":"if(msg.payload === \"off\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":760,"wires":[["8a60af65.3a01c8"]]},{"id":"f640d317.4cb78","type":"function","z":"ccb6d071.13253","name":"Turn On","func":"var date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nvar i = parseInt(flow.get(\"iterFitaDoQuartoDec\"));\n\n\nif (i > 255) { \n    return {reset: true} ;\n}\nvar newMsg;\n//var timerId = setInterval(function check() {\n//    newMsg= {payload : {\"On\":true,\n//            \"Brightness\": i,     \n//            \"Hue\": 174,\n//            \"Saturation\": 100 }};\n//    node.send(newMsg);\n//    i = i + auxInc; \n//    if (i > aux) { \n//        clearInterval(check);\n//        return;\n//    }\n//} , 250);\n\nnewMsg= {payload : {\"On\":true,\n            \"Brightness\": i,     \n            \"Hue\": i,\n            \"Saturation\": 0 }};\ni = i + 30; \n    \nflow.set(\"iterFitaDoQuartoDec\", i);\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3520,"y":1300,"wires":[["5bd2d5a7.cda3bc"]]},{"id":"79d21fb5.fa1f9","type":"trigger","z":"ccb6d071.13253","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-250","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3340,"y":1300,"wires":[["f640d317.4cb78"]]},{"id":"148a1137.1caa6f","type":"function","z":"ccb6d071.13253","name":"Aux Function","func":"flow.set(\"iterFitaDoQuartoInc\", 2);\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2950,"y":1300,"wires":[["79d21fb5.fa1f9"]]},{"id":"fbe1624a.cd6a4","type":"switch","z":"ccb6d071.13253","name":"Reset?","property":"reset","propertyType":"msg","rules":[{"t":"null"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":2300,"y":360,"wires":[["ac700b3d.139798"],["c5ed72fa.46dc8"]]},{"id":"160214ce.874fab","type":"switch","z":"ccb6d071.13253","name":"Reset?","property":"reset","propertyType":"msg","rules":[{"t":"null"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":2300,"y":280,"wires":[["ac700b3d.139798"],["b8bfe96a.429098"]]},{"id":"ab2134f4.a3c558","type":"function","z":"1d7ecdc6.68c842","name":"Movimento Quarto Maria","func":"if(msg.payload.entity_id === \"binary_sensor.movimento_quarto_maria\"){\n        var newMsg;\n        newMsg = {payload:{On : true}};\n        return newMsg;\n}\n//sensor_motion.aq2\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":1140,"wires":[["15886d2e.368513"]]},{"id":"e9a26f15.a324a","type":"function","z":"1d7ecdc6.68c842","name":"Movimento Sala","func":"if(msg.payload.entity_id === \"binary_sensor.movimento_sala\"){\n    var newMsg = {payload: {MotionDetected: true}}\n    return msg;\n}\n//sensor_motion.aq2","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":1200,"wires":[["cd063de1.1968a"]]},{"id":"cd063de1.1968a","type":"link out","z":"1d7ecdc6.68c842","name":"Movimento Sala","links":[],"x":655,"y":1200,"wires":[]},{"id":"15886d2e.368513","type":"link out","z":"1d7ecdc6.68c842","name":"Movimento Quarto Maria","links":["ae6ba06e.9323b"],"x":715,"y":1140,"wires":[]},{"id":"ae6ba06e.9323b","type":"link in","z":"cbdfe56c.84c388","name":"Movimento Banheiro","links":["15886d2e.368513"],"x":155,"y":800,"wires":[["6fe6cdbd.f5f3f4"]]},{"id":"96ebe161.133e6","type":"yeelight-compat-hue-out","z":"cbdfe56c.84c388","name":"Luz do Banheiro","server":"ea75f443.ed079","x":480,"y":740,"wires":[]},{"id":"6fe6cdbd.f5f3f4","type":"function","z":"cbdfe56c.84c388","name":"Turn On","func":"//diferentes brightness dependendo da hora\nvar date = new Date();\nvar Hour = date.getHours(); //hours in 0-23\nvar newMsg;\nnewMsg = {payload:{}};\nif(Hour === 23){\n        newMsg.payload =\n        {\n        \"on\": true,\n        \"bri\": 50,\n        \"ct\": 5000\n        };\n        global.set(\"isOnBanheiro\", true);\n        \n        node.status({fill:\"green\",shape:\"dot\",text:\"Liga\"});\n        node.send(newMsg);\n        \n}\nif(Hour >= 0 && Hour < 8){\n        newMsg.payload =\n        {\n        \"on\": true,\n        \"bri\": 30,\n        \"ct\": 2500\n        };\n        global.set(\"isOnBanheiro\", true);\n        \n        node.status({fill:\"green\",shape:\"dot\",text:\"Liga\"});\n        node.send(newMsg);\n        \n}\nif((Hour > 17 && Hour < 22) || \n        global.get(\"botaoBanheiro\") === true){\n        global.set(\"botaoBanheiro\", false);\n        global.set(\"isOnBanheiro\", true);\n        newMsg.payload = \n            {\n            \"on\": true,\n            \"bri\": 255,\n            \"ct\": 6200\n            \n};\nnode.status({fill:\"green\",shape:\"dot\",text:\"Liga\"});\nnode.send(newMsg);\n\nsetTimeout(function(){\n            node.status({text:\"\"});\n            }, 15000);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":800,"wires":[["96ebe161.133e6","ecd4d8a2.c064c8","433539f4.21e1a8"]]},{"id":"ecd4d8a2.c064c8","type":"function","z":"cbdfe56c.84c388","name":"Delay + 20 min","func":"msg.delay = 1200000;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":880,"wires":[["26116117.912b7e"]]},{"id":"26116117.912b7e","type":"delay","z":"cbdfe56c.84c388","name":"","pauseType":"delayv","timeout":"20","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":640,"y":880,"wires":[["36fc7775.b23da8"]]},{"id":"8ea4585.56486a8","type":"function","z":"cbdfe56c.84c388","name":"Turn Off","func":"if(msg.payload === \"off\"){\n    var newMsg;\n    newMsg = { payload : {\"on\":false}, ajuda : false};\n    return newMsg;   \n}\nelse{\n    return {ajuda: true};\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1060,"y":880,"wires":[["ec18f305.d9584"]]},{"id":"75a943fe.4618dc","type":"yeelight-compat-hue-out","z":"cbdfe56c.84c388","name":"Luz do Banheiro","server":"ea75f443.ed079","x":1400,"y":860,"wires":[]},{"id":"e0b5f84d.a14688","type":"switch","z":"ccb6d071.13253","name":"Reset?","property":"reset","propertyType":"msg","rules":[{"t":"null"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":2080,"y":460,"wires":[["3a126595.9f5d8a"],["10e9f60f.49c23a"]]},{"id":"56b522e.4d695dc","type":"switch","z":"ccb6d071.13253","name":"Reset?","property":"reset","propertyType":"msg","rules":[{"t":"null"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":1980,"y":760,"wires":[["8352f84.fa0a508"],["e9fdf3cd.b5a0b"]]},{"id":"2a754cae.e68744","type":"switch","z":"ccb6d071.13253","name":"Reset?","property":"reset","propertyType":"msg","rules":[{"t":"null"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":2000,"y":860,"wires":[["bef3aea.10df75"],["c2e99c17.17a7"]]},{"id":"b7f5b532.1f82a8","type":"switch","z":"ccb6d071.13253","name":"Reset?","property":"reset","propertyType":"msg","rules":[{"t":"null"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":2200,"y":960,"wires":[["ab2ac1b2.530ed"],["240da74b.aeddf8"]]},{"id":"7bedf35.7511a0c","type":"switch","z":"ccb6d071.13253","name":"Reset?","property":"reset","propertyType":"msg","rules":[{"t":"null"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":2200,"y":1040,"wires":[["20b0e9b1.368d86"],["5c4fd2c8.83e04c"]]},{"id":"5bd2d5a7.cda3bc","type":"switch","z":"ccb6d071.13253","name":"Reset?","property":"reset","propertyType":"msg","rules":[{"t":"null"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":3660,"y":1360,"wires":[["84039976.096518"],["79d21fb5.fa1f9"]]},{"id":"df3ab214.99afe","type":"switch","z":"ccb6d071.13253","name":"Reset?","property":"reset","propertyType":"msg","rules":[{"t":"null"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":3660,"y":1280,"wires":[["84039976.096518"],["c65399c1.7ec788"]]},{"id":"4feb4196.b6dd8","type":"switch","z":"ccb6d071.13253","name":"Reset?","property":"reset","propertyType":"msg","rules":[{"t":"null"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":3700,"y":1660,"wires":[["4d2ee04f.5b5cc"],["99afbd5a.d776e"]]},{"id":"c82dfcb2.30609","type":"switch","z":"ccb6d071.13253","name":"Reset?","property":"reset","propertyType":"msg","rules":[{"t":"null"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":3520,"y":1760,"wires":[["4d2ee04f.5b5cc"],["249bed8.5cde712"]]},{"id":"71c15fec.9d80d","type":"switch","z":"ccb6d071.13253","name":"Reset?","property":"reset","propertyType":"msg","rules":[{"t":"null"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":2260,"y":1820,"wires":[["7e285c77.2cb404"],["b61a1088.e8cab"]]},{"id":"4aca5fe7.02764","type":"switch","z":"ccb6d071.13253","name":"Reset?","property":"reset","propertyType":"msg","rules":[{"t":"null"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":2200,"y":1580,"wires":[["7e23fe7c.01532"],["ade29806.cd7cd8"]]},{"id":"183b076.0fd81f9","type":"switch","z":"ccb6d071.13253","name":"Reset?","property":"reset","propertyType":"msg","rules":[{"t":"null"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":1620,"y":2660,"wires":[["d7c55862.ef7bc8"],["71fc0997.c90f48"]]},{"id":"7024bc77.6ac7c4","type":"switch","z":"ccb6d071.13253","name":"Reset?","property":"reset","propertyType":"msg","rules":[{"t":"null"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":1620,"y":2860,"wires":[["c40ecad3.184548"],["dfc561b4.36ed1"]]},{"id":"36fc7775.b23da8","type":"api-current-state","z":"cbdfe56c.84c388","name":"Movimento Quarto Maria","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.movimento_quarto_maria","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":850,"y":880,"wires":[["8ea4585.56486a8"]]},{"id":"ec18f305.d9584","type":"switch","z":"cbdfe56c.84c388","name":"","property":"ajuda","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":1190,"y":820,"wires":[["75a943fe.4618dc","4e5e1bfb.6e0cd4"],["ecd4d8a2.c064c8"]]},{"id":"d88eecec.a298b","type":"server-state-changed","z":"c3bc1a43.254dd","name":"Netflix?","server":"d63d21ef.5e065","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.tv_da_sala","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":290,"y":1140,"wires":[["ecbc44bc.68bea8"]]},{"id":"ecbc44bc.68bea8","type":"function","z":"c3bc1a43.254dd","name":"Netflix or Prime Video?","func":"var ocupado = global.get(\"tvAuxFilme\");\nif(ocupado === false){\n    if(msg.data.new_state.attributes.media_title === \"Netflix\" || \n    msg.data.new_state.attributes.media_title ===\"Prime Video\"|| \n    msg.data.new_state.attributes.media_title ===\"Apple TV\"){\n        return {payload: \"playing\"};\n        global.set(\"tvAuxFilme\", true);\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":1140,"wires":[["1fbcb698.3f9c79"]]},{"id":"f4d9f42b.2c6008","type":"api-call-service","z":"cbdfe56c.84c388","name":"Banheiro Ocupado","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.banheiro_ocupado_switch","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1550,"y":780,"wires":[[]]},{"id":"4e5e1bfb.6e0cd4","type":"function","z":"cbdfe56c.84c388","name":"Turn Off","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"input_boolean\",\n        \"service\": \"turn_off\",\n        data:{\n            \"entity_id\": \"input_boolean.banheiro_ocupado_switch\",\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1380,"y":820,"wires":[["f4d9f42b.2c6008"]]},{"id":"433539f4.21e1a8","type":"function","z":"cbdfe56c.84c388","name":"Turn On","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"input_boolean\",\n        \"service\": \"turn_on\",\n        data:{\n            \"entity_id\": \"input_boolean.banheiro_ocupado_switch\",\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1380,"y":760,"wires":[["f4d9f42b.2c6008"]]},{"id":"1aab9a5a.59c1ae","type":"function","z":"1aa34a9.7045335","name":"Ventilador do Escritorio Off","func":"    var newMsg;\n    newMsg= {payload : {\n        \"domain\": \"switch\",\n        \"service\": \"turn_off\",\n        \"data\":{\n            \"entity_id\": \"switch.sonoff_1000de2b76\"\n        }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2420,"y":860,"wires":[["eb0c2659.6dfc58"]]},{"id":"eb0c2659.6dfc58","type":"api-call-service","z":"1aa34a9.7045335","name":"Ventilador do Escritorio Off","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.sonoff_1000de2b76","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":2680,"y":860,"wires":[[]]},{"id":"508446cd.af50f8","type":"function","z":"c3bc1a43.254dd","name":"Turn Off","func":"msg.payload = {\"on\": false};\n\n    node.send(msg);\n    node.status({text:\"Ligou\"});\n    setTimeout(function(){\n    node.status({text:\"\"});\n    }, 3000);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":1260,"wires":[["e0af3522.c6b608"]]},{"id":"11e8c054.32bc18","type":"function","z":"1f49f273.0f37be","name":"Turn On","func":"var newMsg;\n        newMsg= {payload : {\n            \"domain\": \"switch\",\n            \"service\": \"turn_on\",\n            \"data\":{\n                \"entity_id\": \"switch.tomada_tv_quarto_nedi\"\n            }\n        }};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":2480,"wires":[["98d8c4d.e4564b8"]]},{"id":"98d8c4d.e4564b8","type":"api-call-service","z":"1f49f273.0f37be","name":"Tomada TV Quarto Nédi","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"swich","service":"turn_on","entityId":"switch.tomada_tv_quarto_nedi","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":930,"y":2480,"wires":[[]]},{"id":"78bbef24.209cb","type":"function","z":"29d165fe.c5376a","name":"Mariana?","func":"if(msg.payload === \"Mariana\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":660,"wires":[["7a430aa0.5cd174"]]},{"id":"7a430aa0.5cd174","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Mariana. Hoje é seu dia de lavar a louça\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_nedi\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1150,"y":700,"wires":[[]]},{"id":"5564f13f.0baa7","type":"function","z":"29d165fe.c5376a","name":"Cleusa?","func":"if(msg.payload === \"Cleusa\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":740,"wires":[["aaafec37.a95af8"]]},{"id":"aaafec37.a95af8","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Cleusa. Hoje é seu dia de lavar a louça\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_nedi\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1150,"y":780,"wires":[[]]},{"id":"f05f1150.a0335","type":"function","z":"1f49f273.0f37be","name":"Quem lava a roupa","func":"if(\n        (msg.payload.description.summary.includes('lavar')=== true ||\n        msg.payload.description.summary.includes('lava')=== true\n        )\n        &&\n        (msg.payload.description.summary.includes('roupa')===true ||\n        msg.payload.description.summary.includes('roupas')===true)\n    ){\n        if(msg.payload.name === \"Echo Dot da Cozinha\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_da_cozinha\") \n        }\n        if(msg.payload.name === \"Echo Dot da Sala\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_da_sala\")       \n        }\n        if(msg.payload.name === \"Echo Dot do Quarto Nédi\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_do_quarto_nedi\")\n        }\n        \n        if(msg.payload.name === \"Echo Dot do Quarto Maria\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_do_quarto_maria\")\n        }\n        return {payload:true};\n        \n    }","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":3180,"wires":[["3218b035.cfa58"]]},{"id":"3218b035.cfa58","type":"api-current-state","z":"1f49f273.0f37be","name":"Quem Lava a Roupa","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_select.quem_lava_a_roupa","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":760,"y":3180,"wires":[["e440f139.017e8"]]},{"id":"e440f139.017e8","type":"function","z":"1f49f273.0f37be","name":"Construct Message","func":"const entity = flow.get(\"alexaDeviceHelper\");\nvar message;\nif(msg.payload === \"Nédi\"){\n    message =  \"Hoje é o Nédi que lava a roupa\";\n}\nif(msg.payload === \"Maria\"){\n    message =  \"Hoje é a Maria que lava a roupa\";\n}\nif(msg.payload === \"Mariana\"){\n    message =  \"Hoje é a Mariana que lava a roupa\";\n}\nif(msg.payload === \"Cristofer\"){\n    message =  \"Hoje é o Cristófer que lava a roupa\";\n}\nreturn {\n    payload:{\n        data: {\n            message: message,\n            data: { type: \"tts\" },\n            target: [entity]\n        }\n    }\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1010,"y":3180,"wires":[["16ef65fd.6c238a"]]},{"id":"16ef65fd.6c238a","type":"api-call-service","z":"1f49f273.0f37be","name":"Notify Alexa","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1230,"y":3180,"wires":[[]]},{"id":"40c4def6.1fcb4","type":"function","z":"1f49f273.0f37be","name":"Quem lava a louça","func":"if(\n        (msg.payload.description.summary.includes('lavar')=== true ||\n        msg.payload.description.summary.includes('lava')=== true\n        )\n        &&\n        (msg.payload.description.summary.includes('louça')===true)\n    ){\n        if(msg.payload.name === \"Echo Dot da Cozinha\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_da_cozinha\") \n        }\n        if(msg.payload.name === \"Echo Dot da Sala\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_da_sala\")       \n        }\n        if(msg.payload.name === \"Echo Dot do Quarto Nédi\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_do_quarto_nedi\")\n        }\n        \n        if(msg.payload.name === \"Echo Dot do Quarto Maria\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_do_quarto_maria\")\n        }\n        return {payload:true};\n        \n    }","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":3240,"wires":[["d5844904.e20268"]]},{"id":"d5844904.e20268","type":"api-current-state","z":"1f49f273.0f37be","name":"Quem Lava a Louça","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_select.quem_lava_a_louca","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":760,"y":3240,"wires":[["8a56063e.a360a8"]]},{"id":"8a56063e.a360a8","type":"function","z":"1f49f273.0f37be","name":"Construct Message","func":"const entity = flow.get(\"alexaDeviceHelper\");\nvar message;\nif(msg.payload === \"Nédi\"){\n    message =  \"Hoje é o Nédi que lava a louça\";\n}\nif(msg.payload === \"Maria\"){\n    message =  \"Hoje é a Maria que lava a louça\";\n}\nif(msg.payload === \"Mariana\"){\n    message =  \"Hoje é a Mariana que lava a louça\";\n}\nif(msg.payload === \"Cristofer\"){\n    message =  \"Hoje é o Cristófer que lava a louça\";\n}\nif(msg.payload === \"Cleusa\"){\n    message =  \"Hoje é a Cleusa que lava a louça\";\n}\nreturn {\n    payload:{\n        data: {\n            message: message,\n            data: { type: \"tts\" },\n            target: [entity]\n        }\n    }\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1010,"y":3240,"wires":[["60b4847f.6d148c"]]},{"id":"60b4847f.6d148c","type":"api-call-service","z":"1f49f273.0f37be","name":"Notify Alexa","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1230,"y":3240,"wires":[[]]},{"id":"d0994fe7.b9f8f","type":"function","z":"1f49f273.0f37be","name":"Quem faz o almoço","func":"if(\n        (msg.payload.description.summary.includes('faz')=== true)\n        &&\n        (msg.payload.description.summary.includes('almoço')===true)\n    ){\n        if(msg.payload.name === \"Echo Dot da Cozinha\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_da_cozinha\") \n        }\n        if(msg.payload.name === \"Echo Dot da Sala\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_da_sala\")       \n        }\n        if(msg.payload.name === \"Echo Dot do Quarto Nédi\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_do_quarto_nedi\")\n        }\n        \n        if(msg.payload.name === \"Echo Dot do Quarto Maria\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_do_quarto_maria\")\n        }\n        return {payload:true};\n        \n    }","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":3300,"wires":[["99727777.5e0de8"]]},{"id":"99727777.5e0de8","type":"api-current-state","z":"1f49f273.0f37be","name":"Quem Faz o Almoço","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_select.quem_faz_o_almoco","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":760,"y":3300,"wires":[["c3864b15.172858"]]},{"id":"c3864b15.172858","type":"function","z":"1f49f273.0f37be","name":"Construct Message","func":"const entity = flow.get(\"alexaDeviceHelper\");\nvar message;\nif(msg.payload === \"Nédi\"){\n    message =  \"Hoje é o Nédi que faz o almoço\";\n}\nif(msg.payload === \"Maria\"){\n    message =  \"Hoje é a Maria que faz o almoço\";\n}\nif(msg.payload === \"Mariana\"){\n    message =  \"Hoje é a Mariana que faz o almoço\";\n}\nif(msg.payload === \"Cristofer\"){\n    message =  \"Hoje é o Cristófer que faz o almoço\";\n}\nreturn {\n    payload:{\n        data: {\n            message: message,\n            data: { type: \"tts\" },\n            target: [entity]\n        }\n    }\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1010,"y":3300,"wires":[["d7a3051a.d68558"]]},{"id":"d7a3051a.d68558","type":"api-call-service","z":"1f49f273.0f37be","name":"Notify Alexa","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1230,"y":3300,"wires":[[]]},{"id":"904736f9.26deb8","type":"function","z":"1f49f273.0f37be","name":"Quem lava a cozinha","func":"if(\n        (msg.payload.description.summary.includes('lava')=== true)\n        &&\n        (msg.payload.description.summary.includes('cozinha')===true)\n    ){\n        if(msg.payload.name === \"Echo Dot da Cozinha\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_da_cozinha\") \n        }\n        if(msg.payload.name === \"Echo Dot da Sala\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_da_sala\")       \n        }\n        if(msg.payload.name === \"Echo Dot do Quarto Nédi\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_do_quarto_nedi\")\n        }\n        \n        if(msg.payload.name === \"Echo Dot do Quarto Maria\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_do_quarto_maria\")\n        }\n        return {payload:true};\n        \n    }","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":3360,"wires":[["fc87548.b9341a8"]]},{"id":"fc87548.b9341a8","type":"api-current-state","z":"1f49f273.0f37be","name":"Quem Lava a Cozinha","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_select.quem_lava_a_cozinha","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":760,"y":3360,"wires":[["cd0c30a5.396d8"]]},{"id":"cd0c30a5.396d8","type":"function","z":"1f49f273.0f37be","name":"Construct Message","func":"const entity = flow.get(\"alexaDeviceHelper\");\nvar message;\nif(msg.payload === \"Nédi\"){\n    message =  \"Hoje é o Nédi que lava a cozinha\";\n}\nif(msg.payload === \"Maria\"){\n    message =  \"Hoje é a Maria que lava a cozinha\";\n}\nif(msg.payload === \"Mariana\"){\n    message =  \"Hoje é a Mariana que lava a cozinha\";\n}\nif(msg.payload === \"Cristofer\"){\n    message =  \"Hoje é o Cristófer que lava a cozinha\";\n}\nreturn {\n    payload:{\n        data: {\n            message: message,\n            data: { type: \"tts\" },\n            target: [entity]\n        }\n    }\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1010,"y":3360,"wires":[["aaf30cd0.c35db"]]},{"id":"aaf30cd0.c35db","type":"api-call-service","z":"1f49f273.0f37be","name":"Notify Alexa","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1230,"y":3360,"wires":[[]]},{"id":"78f29ba6.590484","type":"function","z":"1f49f273.0f37be","name":"Quem leva o lixo","func":"if(\n        (msg.payload.description.summary.includes('leva')=== true)\n        &&\n        (msg.payload.description.summary.includes('lixo')===true)\n    ){\n        if(msg.payload.name === \"Echo Dot da Cozinha\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_da_cozinha\") \n        }\n        if(msg.payload.name === \"Echo Dot da Sala\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_da_sala\")       \n        }\n        if(msg.payload.name === \"Echo Dot do Quarto Nédi\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_do_quarto_nedi\")\n        }\n        \n        if(msg.payload.name === \"Echo Dot do Quarto Maria\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_do_quarto_maria\")\n        }\n        return {payload:true};\n        \n    }","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":3420,"wires":[["ada03de9.3df1c"]]},{"id":"ada03de9.3df1c","type":"api-current-state","z":"1f49f273.0f37be","name":"Quem Leva o Lixo","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_select.quem_leva_o_lixo","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":750,"y":3420,"wires":[["c3120a2c.be7bb8"]]},{"id":"c3120a2c.be7bb8","type":"function","z":"1f49f273.0f37be","name":"Construct Message","func":"const entity = flow.get(\"alexaDeviceHelper\");\nvar message;\nif(msg.payload === \"Nédi\"){\n    message =  \"Hoje é o Nédi que leva o lixo\";\n}\nif(msg.payload === \"Maria\"){\n    message =  \"Hoje é a Maria que leva o lixo\";\n}\nif(msg.payload === \"Mariana\"){\n    message =  \"Hoje é a Mariana que leva o lixo\";\n}\nif(msg.payload === \"Cristofer\"){\n    message =  \"Hoje é o Cristófer que leva o lixo\";\n}\nreturn {\n    payload:{\n        data: {\n            message: message,\n            data: { type: \"tts\" },\n            target: [entity]\n        }\n    }\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1010,"y":3420,"wires":[["decea561.1a7ce8"]]},{"id":"decea561.1a7ce8","type":"api-call-service","z":"1f49f273.0f37be","name":"Notify Alexa","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1230,"y":3420,"wires":[[]]},{"id":"98571aaa.955cb8","type":"function","z":"1f49f273.0f37be","name":"Quem arruma a mesa","func":"if(\n        (msg.payload.description.summary.includes('arruma')=== true)\n        &&\n        (msg.payload.description.summary.includes('mesa')===true)\n    ){\n        if(msg.payload.name === \"Echo Dot da Cozinha\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_da_cozinha\") \n        }\n        if(msg.payload.name === \"Echo Dot da Sala\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_da_sala\")       \n        }\n        if(msg.payload.name === \"Echo Dot do Quarto Nédi\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_do_quarto_nedi\")\n        }\n        \n        if(msg.payload.name === \"Echo Dot do Quarto Maria\"){\n            flow.set(\"alexaDeviceHelper\", \"media_player.echo_dot_do_quarto_maria\")\n        }\n        return {payload:true};\n        \n    }","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":3480,"wires":[["3bbf2fda.816fb"]]},{"id":"3bbf2fda.816fb","type":"api-current-state","z":"1f49f273.0f37be","name":"Quem Arruma a Mesa","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_select.quem_arruma_a_mesa","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":760,"y":3480,"wires":[["7c466dbf.dfcbf4"]]},{"id":"7c466dbf.dfcbf4","type":"function","z":"1f49f273.0f37be","name":"Construct Message","func":"const entity = flow.get(\"alexaDeviceHelper\");\nvar message;\nif(msg.payload === \"Nédi\"){\n    message =  \"Hoje é o Nédi que arruma a mesa\";\n}\nif(msg.payload === \"Maria\"){\n    message =  \"Hoje é a Maria que arruma a mesa\";\n}\nif(msg.payload === \"Mariana\"){\n    message =  \"Hoje é a Mariana que arruma a mesa\";\n}\nif(msg.payload === \"Cristofer\"){\n    message =  \"Hoje é o Cristófer que arruma a mesa\";\n}\nreturn {\n    payload:{\n        data: {\n            message: message,\n            data: { type: \"tts\" },\n            target: [entity]\n        }\n    }\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1010,"y":3480,"wires":[["d6315323.ba33f"]]},{"id":"d6315323.ba33f","type":"api-call-service","z":"1f49f273.0f37be","name":"Notify Alexa","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1230,"y":3480,"wires":[[]]},{"id":"ece70233.dbb6f","type":"inject","z":"29d165fe.c5376a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"15 12 * * 2,4,6,0","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":450,"y":900,"wires":[["22c15c80.30a8b4"]]},{"id":"22c15c80.30a8b4","type":"api-current-state","z":"29d165fe.c5376a","name":"Quem Arruma a Mesa","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_select.quem_arruma_a_mesa","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":680,"y":900,"wires":[["bd52fce7.2c386","51d99f9d.43082","5998596a.cd0028","337a6ffe.ba33b","c364f19b"]]},{"id":"bd52fce7.2c386","type":"function","z":"29d165fe.c5376a","name":"Maria?","func":"if(msg.payload === \"Maria\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":900,"wires":[["816ecaa8.70d6c8","8d50fdeb.a3d2b"]]},{"id":"51d99f9d.43082","type":"function","z":"29d165fe.c5376a","name":"Nédi?","func":"if(msg.payload === \"Nédi\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":1120,"wires":[["fc8b3e2.b573ec","83c1300e.d4454","a94dc542.6ec138","85592651.46c578"]]},{"id":"5998596a.cd0028","type":"function","z":"29d165fe.c5376a","name":"Pai?","func":"if(msg.payload === \"Cristofer\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":960,"wires":[["270f2ca9.327aa4","48d5f859.5a38a8"]]},{"id":"a94dc542.6ec138","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"mqtt\",\n    \"service\": \"publish\",\n    data:{\n        \n          topic: \"iotlink/workgroup/soft-pc/commands/notify\",\n          payload: '{ \"title\": \"Louça\", \"message\": \"Hoje é seu dia de arrumar a mesa\"}'\n  \n\n    }\n    }};\n    \n    return newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":1080,"wires":[["6284cd25.3fcdc4"]]},{"id":"6284cd25.3fcdc4","type":"api-call-service","z":"29d165fe.c5376a","name":"PC","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"mqtt","service":"publish","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1310,"y":1080,"wires":[[]]},{"id":"e669bc5b.5b39c","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify MacBook","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_nedis_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1340,"y":1200,"wires":[[]]},{"id":"83c1300e.d4454","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_macbook_pro_de_nedison\",\n    data:{\n        \n\n         message: 'Hoje é seu dia de arrumar a mesa'\n  \n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":1200,"wires":[["e669bc5b.5b39c"]]},{"id":"7ceb6233.0acdbc","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Nédi's iPhone","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_nedis_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1360,"y":1140,"wires":[[]]},{"id":"fc8b3e2.b573ec","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_nedis_iphone\",\n    data:{\n        \n  \n         message: 'Hoje é seu dia de arrumar a mesa'\n  \n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":1140,"wires":[["7ceb6233.0acdbc"]]},{"id":"270f2ca9.327aa4","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_softcelular\",\n    data:{\n        \n         message: 'Hoje é seu dia de arrumar a mesa'\n  \n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":960,"wires":[["5fc77cee.a22814"]]},{"id":"5fc77cee.a22814","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Pai","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_softcelular","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1320,"y":960,"wires":[[]]},{"id":"8d50fdeb.a3d2b","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Maria. Hoje é seu dia de arrumar a mesa\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_maria\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1150,"y":840,"wires":[[]]},{"id":"816ecaa8.70d6c8","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\nnewMsg= {payload : {\n\"domain\": \"notify\",\n\"service\": \"mobile_app_maria_s_iphone\",\ndata:{\n        \n         message: 'Hoje é seu dia de arrumar a mesa'\n  }\n}};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":900,"wires":[["e5ea87d3.c382b8"]]},{"id":"e5ea87d3.c382b8","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Maria","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_maria_s_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1330,"y":900,"wires":[[]]},{"id":"48d5f859.5a38a8","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Cristófer. Hoje é seu dia de arrumar a mesa\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1150,"y":1020,"wires":[[]]},{"id":"85592651.46c578","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Nédi. Hoje é seu dia de arrumar a mesa\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_nedi\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1150,"y":1260,"wires":[[]]},{"id":"337a6ffe.ba33b","type":"function","z":"29d165fe.c5376a","name":"Mariana?","func":"if(msg.payload === \"Mariana\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":1280,"wires":[["3d7f2b17.7af414"]]},{"id":"3d7f2b17.7af414","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Mariana. Hoje é seu dia de arrumar a mesa\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_nedi\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1150,"y":1320,"wires":[[]]},{"id":"c364f19b","type":"function","z":"29d165fe.c5376a","name":"Cleusa?","func":"if(msg.payload === \"Cleusa\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":1360,"wires":[["fc42dc04.b6b08"]]},{"id":"fc42dc04.b6b08","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Cleusa. Hoje é seu dia de arrumar a mesa\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_nedi\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1150,"y":1400,"wires":[[]]},{"id":"9980b246.7d53b","type":"inject","z":"29d165fe.c5376a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"30 19 * * 2,4,6,0","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":450,"y":220,"wires":[["c0bc8317.599bb"]]},{"id":"3abcc16.625913e","type":"inject","z":"29d165fe.c5376a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"35 13 * * 2,4,6,0","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":450,"y":1560,"wires":[["f3b89022.9681f"]]},{"id":"f3b89022.9681f","type":"api-current-state","z":"29d165fe.c5376a","name":"Quem Lava a Cozinha","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_select.quem_lava_a_cozinha","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":680,"y":1560,"wires":[["3aa2e996.28f836","28abddc4.3ad602","c482ddad.533f","ce8b0f6c.6cfb2","163d08f1.cad577"]]},{"id":"3aa2e996.28f836","type":"function","z":"29d165fe.c5376a","name":"Maria?","func":"if(msg.payload === \"Maria\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":1560,"wires":[["8bf6aab4.f523b8","8be50c47.28755"]]},{"id":"28abddc4.3ad602","type":"function","z":"29d165fe.c5376a","name":"Nédi?","func":"if(msg.payload === \"Nédi\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":1780,"wires":[["34957677.0cef3a","ca68b384.bf4be","6fb25f07.c6a03","861b633b.c115"]]},{"id":"c482ddad.533f","type":"function","z":"29d165fe.c5376a","name":"Pai?","func":"if(msg.payload === \"Cristofer\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":1620,"wires":[["f2ec3607.5584f8","fe8d9320.9e487"]]},{"id":"6fb25f07.c6a03","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"mqtt\",\n    \"service\": \"publish\",\n    data:{\n        \n          topic: \"iotlink/workgroup/soft-pc/commands/notify\",\n          payload: '{ \"title\": \"Louça\", \"message\": \"Hoje é seu dia de arrumar e limpar a cozinha\"}'\n  \n\n    }\n    }};\n    \n    return newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":1740,"wires":[["27ffdf1a.76108"]]},{"id":"27ffdf1a.76108","type":"api-call-service","z":"29d165fe.c5376a","name":"PC","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"mqtt","service":"publish","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1310,"y":1740,"wires":[[]]},{"id":"2fd3b2d0.0c5a3e","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify MacBook","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_nedis_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1340,"y":1860,"wires":[[]]},{"id":"ca68b384.bf4be","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_macbook_pro_de_nedison\",\n    data:{\n        \n\n         message: 'Hoje é seu dia de arrumar e limpar a cozinha'\n  \n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":1860,"wires":[["2fd3b2d0.0c5a3e"]]},{"id":"c5dd0041.070ac","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Nédi's iPhone","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_nedis_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1360,"y":1800,"wires":[[]]},{"id":"34957677.0cef3a","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_nedis_iphone\",\n    data:{\n        \n  \n         message: 'Hoje é seu dia de arrumar e limpar a cozinha'\n  \n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":1800,"wires":[["c5dd0041.070ac"]]},{"id":"f2ec3607.5584f8","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_softcelular\",\n    data:{\n        \n         message: 'Hoje é seu dia de arrumar e limpar a cozinha'\n  \n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":1620,"wires":[["5a534338.fa6d4c"]]},{"id":"5a534338.fa6d4c","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Pai","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_softcelular","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1320,"y":1620,"wires":[[]]},{"id":"8be50c47.28755","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Maria. Hoje é seu dia de arrumar e limpar a cozinha\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_maria\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1150,"y":1500,"wires":[[]]},{"id":"8bf6aab4.f523b8","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\nnewMsg= {payload : {\n\"domain\": \"notify\",\n\"service\": \"mobile_app_maria_s_iphone\",\ndata:{\n        \n         message: 'Hoje é seu dia de arrumar e limpar a cozinha'\n  }\n}};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":1560,"wires":[["e53565ca.6850b8"]]},{"id":"e53565ca.6850b8","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Maria","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_maria_s_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1330,"y":1560,"wires":[[]]},{"id":"fe8d9320.9e487","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Cristófer. Hoje é seu dia de arrumar e limpar a cozinha\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1150,"y":1680,"wires":[[]]},{"id":"861b633b.c115","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Nédi. Hoje é seu dia de arrumar e limpar a cozinha\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_nedi\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1150,"y":1920,"wires":[[]]},{"id":"ce8b0f6c.6cfb2","type":"function","z":"29d165fe.c5376a","name":"Mariana?","func":"if(msg.payload === \"Mariana\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":1940,"wires":[["a0c6b9d1.0d1d38"]]},{"id":"a0c6b9d1.0d1d38","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Mariana. Hoje é seu dia de arrumar e limpar a cozinha\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_maria\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1150,"y":1980,"wires":[[]]},{"id":"163d08f1.cad577","type":"function","z":"29d165fe.c5376a","name":"Cleusa?","func":"if(msg.payload === \"Cleusa\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":2020,"wires":[["4c55a5f6.1049ac"]]},{"id":"4c55a5f6.1049ac","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Cleusa. Hoje é seu dia de arrumar e limpar a cozinha\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_nedi\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1150,"y":2060,"wires":[[]]},{"id":"82b815d.a4d50e8","type":"inject","z":"29d165fe.c5376a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"30 11 * * 2,4,6,0","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":450,"y":2200,"wires":[["b2824cb.29c3bb"]]},{"id":"b2824cb.29c3bb","type":"api-current-state","z":"29d165fe.c5376a","name":"Quem Faz o Almoço","server":"d63d21ef.5e065","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_select.quem_faz_o_almoco","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":680,"y":2200,"wires":[["281b5057.09cd3","8de28d5e.15ee1","174a7766.50a6e9","13df04d6.fedb5b"]]},{"id":"281b5057.09cd3","type":"function","z":"29d165fe.c5376a","name":"Maria?","func":"if(msg.payload === \"Maria\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":2200,"wires":[["cbc46239.89696","974dc750.119d28"]]},{"id":"8de28d5e.15ee1","type":"function","z":"29d165fe.c5376a","name":"Nédi?","func":"if(msg.payload === \"Nédi\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":2420,"wires":[["8d7e250b.2d3828","464224d5.507ddc","557336.fb333ccc","fa57797.e0a1088"]]},{"id":"174a7766.50a6e9","type":"function","z":"29d165fe.c5376a","name":"Pai?","func":"if(msg.payload === \"Cristofer\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":2260,"wires":[["4dc5891e.676108","7773121e.bb5dec"]]},{"id":"557336.fb333ccc","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"\n        var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"mqtt\",\n    \"service\": \"publish\",\n    data:{\n        \n          topic: \"iotlink/workgroup/soft-pc/commands/notify\",\n          payload: '{ \"title\": \"Louça\", \"message\": \"Hoje é seu dia de fazer o almoço\"}'\n  \n\n    }\n    }};\n    \n    return newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":2380,"wires":[["5ce0aa98.a269e4"]]},{"id":"5ce0aa98.a269e4","type":"api-call-service","z":"29d165fe.c5376a","name":"PC","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"mqtt","service":"publish","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1310,"y":2380,"wires":[[]]},{"id":"70e9f859.473568","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify MacBook","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_nedis_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1340,"y":2500,"wires":[[]]},{"id":"464224d5.507ddc","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_macbook_pro_de_nedison\",\n    data:{\n        \n\n         message: 'Hoje é seu dia de fazer o almoço'\n  \n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":2500,"wires":[["70e9f859.473568"]]},{"id":"4e615ef2.46d11","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Nédi's iPhone","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_nedis_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1360,"y":2440,"wires":[[]]},{"id":"8d7e250b.2d3828","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_nedis_iphone\",\n    data:{\n        \n  \n         message: 'Hoje é seu dia de fazer o almoço'\n  \n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":2440,"wires":[["4e615ef2.46d11"]]},{"id":"4dc5891e.676108","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\n    newMsg= {payload : {\n    \"domain\": \"notify\",\n    \"service\": \"mobile_app_softcelular\",\n    data:{\n        \n         message: 'Hoje é seu dia de fazer o almoço'\n  \n\n    }\n    }};\n    \n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":2260,"wires":[["7d5c237c.52821c"]]},{"id":"7d5c237c.52821c","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Pai","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_softcelular","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1320,"y":2260,"wires":[[]]},{"id":"974dc750.119d28","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Maria. Hoje é seu dia de fazer o almoço\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_maria\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1150,"y":2140,"wires":[[]]},{"id":"cbc46239.89696","type":"function","z":"29d165fe.c5376a","name":"Notificação","func":"var newMsg;\nnewMsg= {payload : {\n\"domain\": \"notify\",\n\"service\": \"mobile_app_maria_s_iphone\",\ndata:{\n        \n         message: 'Hoje é seu dia de fazer o almoço'\n  }\n}};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":2200,"wires":[["b3ae24be.750c88"]]},{"id":"b3ae24be.750c88","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Maria","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_maria_s_iphone","entityId":"","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1330,"y":2200,"wires":[[]]},{"id":"7773121e.bb5dec","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Cristófer. Hoje é seu dia de fazer o almoço\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1150,"y":2320,"wires":[[]]},{"id":"fa57797.e0a1088","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Mariana. Hoje é seu dia de fazer o almoço\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_maria\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1150,"y":2560,"wires":[[]]},{"id":"13df04d6.fedb5b","type":"function","z":"29d165fe.c5376a","name":"Mariana?","func":"if(msg.payload === \"Mariana\"){\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":2580,"wires":[["f13a3dda.8f47"]]},{"id":"f13a3dda.8f47","type":"api-call-service","z":"29d165fe.c5376a","name":"Notify Alexas","server":"d63d21ef.5e065","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"data\":{\"type\":\"announce\",\"method\":\"all\"},\"message\":\"Mariana. Hoje é seu dia de arrumar a mesa\",\"target\":[\"media_player.echo_dot_da_sala\",\"media_player.echo_dot_da_cozinha\",\"media_player.echo_dot_do_quarto_nedi\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":1150,"y":2620,"wires":[[]]}]