<script type="text/javascript">var ha={nodeColors:{action:"#46B1EF",alpha:"#E78BB9",api:"#7CDFFD",beta:"#77DD77",data:"#5BCBF7",event:"#399CDF"}};</script>
<script type="text/javascript">var exposeNode=function(e){let t;function n(){const t=e("#node-input-server").val();if(t&&"_ADD_"!==t)return t}function o(){if(!e("#integrationAlert").length){const t='<div id="integrationAlert" class="ui-state-error ha-alert-box"><strong>Attention:</strong> This node requires <a href="https://github.com/zachowj/hass-node-red" target="_blank">Node-RED custom integration <i class="fa fa-external-link external-link"></i></a> to be installed in Home Assistant for it to function.</strong></div>';e("#dialog-form").prepend(t)}e("#integrationAlert").toggle(0===t.integrationVersion)}function i(){0===t.integrationVersion&&e("#node-input-exposeToHomeAssistant").prop("checked",!1).trigger("change"),e("#exposeToHa").toggle(0!==t.integrationVersion)}return{init:function(a){t=a,function(){switch(t.type){case"ha-webhook":case"ha-entity":o();break;default:!function(){const n=e("<div />",{id:"exposeToHa",class:"form-row checkbox-option"+("trigger-state"===t.type?"-left":"")});e("<input />",{type:"checkbox",id:"node-input-exposeToHomeAssistant",checked:t.exposeToHomeAssistant}).on("change",(function(){e("#haConfigRow").toggle(!0===e("#node-input-exposeToHomeAssistant").is(":checked"))})).appendTo(n),e("<label />",{for:"node-input-exposeToHomeAssistant",text:"Expose to Home Assistant"}).appendTo(n);const o=e("<div />",{class:"form-row",id:"haConfigRow"}),i=e("<ol />",{id:"haConfig"}).appendTo(o),a=t.haConfig||[{property:"name",value:""},{property:"icon",value:""}];i.editableList({addButton:!1,header:e("<div>Home Assistant Config (optional)</div>"),addItem:function(t,n,o){const i=e("<div />").appendTo(t);e("<input />",{type:"text",name:"property",value:o.property,style:"width: 40%;",readonly:!0}).appendTo(i),e("<input />",{type:"text",name:"value",value:o.value,style:"margin-left: 10px;width: 55%;"}).attr("autocomplete","disable").appendTo(i)}}).editableList("addItems",a),e("#dialog-form").append(n).append(o),e("#node-input-exposeToHomeAssistant").trigger("change")}()}}();const s=function(){switch(t.type){case"ha-webhook":case"ha-entity":return o;default:return i}}();e("#node-input-server").on("change",(()=>function(o){n()?e.getJSON(`homeassistant/${n()}/version?_=${Date.now()}`).done((e=>{t.integrationVersion=e.version,o&&o(t)})):o(t)}(s)))},getValues:function(){const t=[];return e("#haConfig").editableList("items").each((function(n){const o=e(this);t.push({property:o.find("input[name=property]").val(),value:o.find("input[name=value]").val()})})),t}}}(jQuery);</script>
<script type="text/javascript">var haServer=function(e,n){let o,t,r;function a(r,a){"_ADD_"!==t&&e.getJSON(`homeassistant/${t}/${r}`).done((e=>{a(e)})).fail((e=>{const t=n.nodes.node(o.val());t&&!0===t.dirty&&n.notify(`You probably haven't deployed since adding a server. Do that for autocomplete to work.\n${e.responseText}`,"error")}))}return{init:function(t,a){o=e(a),r=t,r.server||function(){let e;n.nodes.eachConfig((n=>{"server"!==n.type||e||(e=n.id)})),e&&o.val(e)}()},autocomplete:function(e,n){const i=o.val();(r.server||i&&"_ADD_"!==i)&&(t=r.server||i,a(e,n)),o.change((()=>{t=o.val(),a(e,n)}))}}}(jQuery,RED);</script>
<script type="text/javascript">var ifState=function(e){let t;return{init:function(a,n,s){t=e(a);const c=e(n),l={value:"entity",label:"entity."},r=["str","num","bool","re","jsonata","msg","flow","global",l];"currentState"!==s&&r.splice(5,1),t.after(' <a id="clearIfState" class="editor-button"><i class="fa fa-remove"></i></a>');const o=e("#clearIfState");t.typedInput({default:"str",types:r,typeField:"#node-input-halt_if_type"}),c.on("change",(e=>{let a=r,n=["flow","global",l];switch(r.includes("msg")&&(n=["msg",...n]),e.target.value){case"is":case"is_not":break;case"lt":case"lte":case"gt":case"gte":a=["num","jsonata",...n];break;case"includes":case"does_not_include":a=["str","jsonata",...n];break;case"jsonata":a=["jsonata"]}t.typedInput("types",a)})),c.trigger("change"),t.on("change",(e=>{e.currentTarget.value&&o.show()})),o.on("click",(a=>{t.typedInput("type","str"),t.typedInput("value",""),e(a.currentTarget).hide()})),t.val()||o.hide()}}}(jQuery);</script>
<script type="text/javascript">var nodeVersion=function(e){return{check:function(t){t.version=void 0===t.version?0:Number(t.version);const r=`<div id="version-update" class="ui-state-error ha-alert-box"><p><strong>Alert:</strong>This node will be updated to version ${t._def.defaults.version.value} from ${t.version} (<a href="${function(e){let t="";switch(e){case"api-current-state":t="current-state";break;case"api-call-service":t="call-service";break;case"poll-state":t="poll-state";break;case"server-state-changed":t="events-state"}return`https://zachowj.github.io/node-red-contrib-home-assistant-websocket/node/${t}.html#changelog`}(t.type)}#version" target="_blank" rel="noreferrer">changes</a>)</p></div>`;t.version<t._def.defaults.version.value&&e("#dialog-form").prepend(r)},ifStateLabels:function(e){if(this.halt_if||this.haltifstate){if(0===Number(this.version)||void 0===this.version){if(0===e)return"'If State' is false";if(1===e)return"'If State' is true"}if(0===e)return"'If State' is true";if(1===e)return"'If State' is false"}},labelStyle:function(){return`${this._def.defaults.version&&Number(this.version)!==this._def.defaults.version.value?"ha-node-label-legacy ":""}${this.name?"node_label_italic":""}`},update:function(t){t.version<t._def.defaults.version.value&&e("#node-input-version").val(t._def.defaults.version.value)}}}(jQuery);</script>
<script type="text/javascript">RED.nodes.registerType("ha-time",{category:"home_assistant",color:ha.nodeColors.alpha,outputs:1,icon:"font-awesome/fa-clock-o",paletteLabel:"time",label:function(){return this.name||(this.entityId?`${this.entityId}.${this.property||"state"}`:"time")},labelStyle:nodeVersion.labelStyle,defaults:{server:{value:"",type:"server",required:!0},name:{value:""},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},entityId:{value:"",required:!0},property:{value:""},offset:{value:0},offsetType:{value:"num"},offsetUnits:{value:"minutes"},randomOffset:{value:!1},repeatDaily:{value:!1},payload:{value:"$entity().state"},payloadType:{value:"jsonata"},debugenabled:{value:!0}},oneditprepare:function(){haServer.init(this,"#node-input-server"),haServer.autocomplete("entities",(e=>{$("#node-input-entityId").autocomplete({source:e,minLength:2})})),haServer.autocomplete("properties",(e=>{$("#node-input-property").autocomplete({source:e,minLength:2})})),exposeNode.init(this),$("#node-input-offset").typedInput({types:["num","jsonata"],typeField:"#node-input-offsetType"}),$("#node-input-payload").typedInput({types:["str","num","bool","jsonata","date"],typeField:"#node-input-payloadType"})},oneditsave:function(){this.haConfig=exposeNode.getValues()}});</script>
<script type="text/x-red" data-template-name="ha-time"><div class="ui-state-error ha-alert-box">Alpha version: At this point anything could change or not work.<br>Found an issue? Post it in <a href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/issues" target="_blank" rel="noreferrer">issues</a>. Have questions or comments? Post them <a href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/discussions/313" target="_blank" rel="noreferrer">here</a>.</div><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="ha-time.label.name"></span></label> <input type="text" id="node-input-name" data-i18n="[placeholder]ha-time.label.name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> <span data-i18n="ha-time.label.server"></span></label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-entityId"><i class="fa fa-cube"></i> <span data-i18n="ha-time.label.entity_id"></span></label> <input type="text" id="node-input-entityId"></div><div class="form-row"><label for="node-input-property"><i class="fa fa-edit"></i> <span data-i18n="ha-time.label.property"></span></label> <input type="text" id="node-input-property" placeholder="state"></div><div class="form-row"><label for="node-input-offset"><i class="fa fa-clock-o"></i> <span data-i18n="ha-time.label.offset"></span></label> <input type="text" id="node-input-offset" style="width:43%"> <input type="hidden" id="node-input-offsetType"> <select id="node-input-offsetUnits" style="width:27%"><option value="seconds" data-i18n="ha-time.label.seconds"></option><option value="minutes" data-i18n="ha-time.label.minutes"></option><option value="hours" data-i18n="ha-time.label.hours"></option></select></div><div class="form-row checkbox-option"><label><input type="checkbox" id="node-input-randomOffset"> <span data-i18n="ha-time.label.randomize_offset"></span></label></div><div class="form-row" id="entitiesFound"></div><div class="form-row"><label for="node-input-payload"><i class="fa fa-cube"></i> <span data-i18n="ha-time.label.payload"></span></label> <input type="text" id="node-input-payload"> <input type="hidden" id="node-input-payloadType"></div><div class="form-row checkbox-option"><label><input type="checkbox" id="node-input-repeatDaily"> <span data-i18n="ha-time.label.repeat_daily"></span></label></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-debugenabled"> <label for="node-input-debugenabled">Show Debug Information</label></div></script>
<script type="text/x-red" data-help-name="ha-time"><p>A node that can be scheduled to trigger at a future date and time from a Home Assistant entity.</p><h3>Configuration</h3><dl class="message-properties"><dt>Entity Id<span class="property-type">string</span></dt><dd>A Home Assistant entity to be used when scheduling the node.</dd><dt>Property<span class="property-type">string</span></dt><dd>Which property of the entity to use to schedule the node.</dd><dd>The node will accept any date string that the javascript object accepts as a valid date. It will also accept a 24-hour time format with the seconds place optional.</dd><dd>examples:</dd><ul><li><code>2020-12-31T02:47:54.837Z</code></li><li><code>1609382842709</code></li><li><code>13:40</code></li><li><code>23:59:02</code></li></ul><dt>Offset<span class="property-type">number</span></dt><dd>A negative or positive number that will be added to the scheduled time.</dd><dt>Randomize time within the offset<span class="property-type">boolean</span></dt><dd>When selected the time to trigger will be random selected from the scheduled time to the +/- offset.</dd><dt>Payload<span class="property-type">string | number | boolean | object</span></dt><dd>The payload is fully customizable. The default will be a JSONata expression that outputs the entity state.</dd><dt>Repeat Daily<span class="property-type">boolean</span></dt><dd>If selected the node will only use the time portion of the date string to schedule the node and will trigger at that time each day. Otherwise, the node will only trigger once at the given day and time.</dd></dl><h3>Outputs</h3><dl class="message-properties"><dt>topic<span class="property-type">string</span></dt><dd>The entity id in the configuration.</dd><dt>payload<span class="property-type">string | number | boolean | object</span></dt><dt>data<span class="property-type">object</span></dt><dd>The entity object of the entity in the configuration.</dd></dl></script>
<style>#version-update{padding:.5em;margin-bottom:1em}#version-update p{margin:0}#version-update strong{padding-right:5px}#version-update a,#version-update a:hover{color:#555}.form-row.checkbox-option input{margin-left:105px;margin-right:5px;display:inline-block;width:auto;vertical-align:top}.form-row.checkbox-option label{width:auto}.form-row.checkbox-option-left input{display:inline-block;margin-right:5px;width:auto;vertical-align:top}.form-row.checkbox-option-left label{width:auto;margin-right:20px}.editable-list-row{margin-bottom:4px}#constraint-list{min-width:446px}#constraint-list input{width:65%}#output-list input{width:62%}#clearIfState{position:absolute;margin-left:2px}.ha-node-label-legacy{fill:#fdfd96;stroke-width:0;font-size:14px;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}li span.property-type{font-family:Helvetica Neue,Arial,Helvetica,sans-serif;color:#666;font-style:italic;font-size:11px;float:right}.ha-alert-box{padding:10px;margin-bottom:10px}.custom-block .custom-block-title{font-weight:600}.custom-block.danger,.custom-block.tip,.custom-block.warning{padding:.1rem 1.5rem;border-left-width:.5rem;border-left-style:solid;margin:1rem 0}.custom-block.tip{background-color:#f3f5f7;border-color:#42b983;color:#2c3e50}.custom-block.tip a{color:#3eaf7c}.custom-block.warning{background-color:#fff6c6;border-color:#e7c000;color:#6b5900}.custom-block.warning .custom-block-title{color:#b29400}.custom-block.warning a{color:#2c3e50}.custom-block.danger{background-color:#ffe6e6;border-color:#c00;color:#4d0000}.custom-block.danger .custom-block-title{color:#900}.custom-block.danger a{color:#2c3e50}.button-box div.text-box{display:inline-block;position:relative;width:70%;height:20px}.button-box div.text-box div{position:absolute;left:0;right:40px}.button-box div.text-box div input{width:100%}.button-box div.text-box a{position:absolute;right:0;top:0}.badge{display:inline-block;font-size:12px;height:16px;line-height:16px;border-radius:3px;padding:0 6px;color:#fff}.badge,.badge.green,.badge.tip{background-color:#42b983}.badge.error{background-color:#da5961}.badge.warn,.badge.warning,.badge.yellow{background-color:#e7c000}.badge+.badge{margin-left:5px}</style>