<script type="text/javascript">/*! Select2 4.1.0-rc.0 | https://github.com/select2/select2/blob/master/LICENSE.md */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(n),n}:e(jQuery)}((function(e){var t,n,s,i,o,r,a,l,c,u,d,p,h,f,g;function m(e,t){return p.call(e,t)}function v(e,t){var n,s,i,o,r,a,l,c,d,p,h=t&&t.split("/"),g=u.map,m=g&&g["*"]||{};if(e){for(t=(e=e.split("/")).length-1,u.nodeIdCompat&&f.test(e[t])&&(e[t]=e[t].replace(f,"")),"."===e[0].charAt(0)&&h&&(e=h.slice(0,h.length-1).concat(e)),c=0;c<e.length;c++)"."===(p=e[c])?(e.splice(c,1),--c):".."===p&&(0===c||1===c&&".."===e[2]||".."===e[c-1]||0<c&&(e.splice(c-1,2),c-=2));e=e.join("/")}if((h||m)&&g){for(c=(n=e.split("/")).length;0<c;--c){if(s=n.slice(0,c).join("/"),h)for(d=h.length;0<d;--d)if(i=(i=g[h.slice(0,d).join("/")])&&i[s]){o=i,r=c;break}if(o)break;!a&&m&&m[s]&&(a=m[s],l=c)}!o&&a&&(o=a,r=l),o&&(n.splice(0,r,o),e=n.join("/"))}return e}function y(e,t){return function(){var n=h.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),o.apply(s,n.concat([e,t]))}}function _(e){var t;if(m(c,e)&&(t=c[e],delete c[e],d[e]=!0,i.apply(s,t)),!m(l,e)&&!m(d,e))throw new Error("No "+e);return l[e]}function b(e){var t,n=e?e.indexOf("!"):-1;return-1<n&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function w(e){return e?b(e):[]}var x=(g=(e&&e.fn&&e.fn.select2&&e.fn.select2.amd&&(x=e.fn.select2.amd),x&&x.requirejs||(x?n=x:x={},l={},c={},u={},d={},p=Object.prototype.hasOwnProperty,h=[].slice,f=/\.js$/,r=function(e,t){var n,s,i=b(e),o=i[0];t=t[1];return e=i[1],o&&(n=_(o=v(o,t))),o?e=n&&n.normalize?n.normalize(e,(s=t,function(e){return v(e,s)})):v(e,t):(o=(i=b(e=v(e,t)))[0],e=i[1],o&&(n=_(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},a={require:function(e){return y(e)},exports:function(e){var t=l[e];return void 0!==t?t:l[e]={}},module:function(e){return{id:e,uri:"",exports:l[e],config:(t=e,function(){return u&&u.config&&u.config[t]||{}})};var t}},i=function(e,t,n,i){var o,u,p,h,f,g=[],v=typeof n,b=w(i=i||e);if("undefined"==v||"function"==v){for(t=!t.length&&n.length?["require","exports","module"]:t,h=0;h<t.length;h+=1)if("require"===(u=(p=r(t[h],b)).f))g[h]=a.require(e);else if("exports"===u)g[h]=a.exports(e),f=!0;else if("module"===u)o=g[h]=a.module(e);else if(m(l,u)||m(c,u)||m(d,u))g[h]=_(u);else{if(!p.p)throw new Error(e+" missing "+u);p.p.load(p.n,y(i,!0),function(e){return function(t){l[e]=t}}(u),{}),g[h]=l[u]}v=n?n.apply(l[e],g):void 0,e&&(o&&o.exports!==s&&o.exports!==l[e]?l[e]=o.exports:v===s&&f||(l[e]=v))}else e&&(l[e]=n)},t=n=o=function(e,t,n,l,c){if("string"==typeof e)return a[e]?a[e](t):_(r(e,w(t)).f);if(!e.splice){if((u=e).deps&&o(u.deps,u.callback),!t)return;t.splice?(e=t,t=n,n=null):e=s}return t=t||function(){},"function"==typeof n&&(n=l,l=c),l?i(s,e,t,n):setTimeout((function(){i(s,e,t,n)}),4),o},o.config=function(e){return o(e)},t._defined=l,(g=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),m(l,e)||m(c,e)||(c[e]=[e,t,n])}).amd={jQuery:!0},x.requirejs=t,x.require=n,x.define=g),x.define("almond",(function(){})),x.define("jquery",[],(function(){var t=e||$;return null==t&&console&&console.error&&console.error("Select2: An instance of jQuery or a jQuery-compatible library was not found. Make sure that you are including jQuery before Select2 on your web page."),t})),x.define("select2/utils",["jquery"],(function(e){var t={};function n(e){var t,n=e.prototype,s=[];for(t in n)"function"==typeof n[t]&&"constructor"!==t&&s.push(t);return s}function s(){this.listeners={}}t.Extend=function(e,t){var n,s={}.hasOwnProperty;function i(){this.constructor=e}for(n in t)s.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},t.Decorate=function(e,t){var s=n(t),i=n(e);function o(){var n=Array.prototype.unshift,s=t.prototype.constructor.length,i=e.prototype.constructor;0<s&&(n.call(arguments,e.prototype.constructor),i=t.prototype.constructor),i.apply(this,arguments)}t.displayName=e.displayName,o.prototype=new function(){this.constructor=o};for(var r=0;r<i.length;r++){var a=i[r];o.prototype[a]=e.prototype[a]}for(var l=0;l<s.length;l++){var c=s[l];o.prototype[c]=function(e){var n=function(){};e in o.prototype&&(n=o.prototype[e]);var s=t.prototype[e];return function(){return Array.prototype.unshift.call(arguments,n),s.apply(this,arguments)}}(c)}return o},s.prototype.on=function(e,t){this.listeners=this.listeners||{},e in this.listeners?this.listeners[e].push(t):this.listeners[e]=[t]},s.prototype.trigger=function(e){var t=Array.prototype.slice,n=t.call(arguments,1);this.listeners=this.listeners||{},null==n&&(n=[]),0===n.length&&n.push({}),(n[0]._type=e)in this.listeners&&this.invoke(this.listeners[e],t.call(arguments,1)),"*"in this.listeners&&this.invoke(this.listeners["*"],arguments)},s.prototype.invoke=function(e,t){for(var n=0,s=e.length;n<s;n++)e[n].apply(this,t)},t.Observable=s,t.generateChars=function(e){for(var t="",n=0;n<e;n++)t+=Math.floor(36*Math.random()).toString(36);return t},t.bind=function(e,t){return function(){e.apply(t,arguments)}},t._convertData=function(e){for(var t in e){var n=t.split("-"),s=e;if(1!==n.length){for(var i=0;i<n.length;i++){var o=n[i];(o=o.substring(0,1).toLowerCase()+o.substring(1))in s||(s[o]={}),i==n.length-1&&(s[o]=e[t]),s=s[o]}delete e[t]}}return e},t.hasScroll=function(t,n){var s=e(n),i=n.style.overflowX,o=n.style.overflowY;return(i!==o||"hidden"!==o&&"visible"!==o)&&("scroll"===i||"scroll"===o||s.innerHeight()<n.scrollHeight||s.innerWidth()<n.scrollWidth)},t.escapeMarkup=function(e){var t={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return"string"!=typeof e?e:String(e).replace(/[&<>"'\/\\]/g,(function(e){return t[e]}))},t.__cache={};var i=0;return t.GetUniqueElementId=function(e){var n=e.getAttribute("data-select2-id");return null!=n||(n=e.id?"select2-data-"+e.id:"select2-data-"+(++i).toString()+"-"+t.generateChars(4),e.setAttribute("data-select2-id",n)),n},t.StoreData=function(e,n,s){e=t.GetUniqueElementId(e),t.__cache[e]||(t.__cache[e]={}),t.__cache[e][n]=s},t.GetData=function(n,s){var i=t.GetUniqueElementId(n);return s?t.__cache[i]&&null!=t.__cache[i][s]?t.__cache[i][s]:e(n).data(s):t.__cache[i]},t.RemoveData=function(e){var n=t.GetUniqueElementId(e);null!=t.__cache[n]&&delete t.__cache[n],e.removeAttribute("data-select2-id")},t.copyNonInternalCssClasses=function(e,t){var n=(n=e.getAttribute("class").trim().split(/\s+/)).filter((function(e){return 0===e.indexOf("select2-")}));t=(t=t.getAttribute("class").trim().split(/\s+/)).filter((function(e){return 0!==e.indexOf("select2-")})),t=n.concat(t);e.setAttribute("class",t.join(" "))},t})),x.define("select2/results",["jquery","./utils"],(function(e,t){function n(e,t,s){this.$element=e,this.data=s,this.options=t,n.__super__.constructor.call(this)}return t.Extend(n,t.Observable),n.prototype.render=function(){var t=e('<ul class="select2-results__options" role="listbox"></ul>');return this.options.get("multiple")&&t.attr("aria-multiselectable","true"),this.$results=t},n.prototype.clear=function(){this.$results.empty()},n.prototype.displayMessage=function(t){var n=this.options.get("escapeMarkup");this.clear(),this.hideLoading();var s=e('<li role="alert" aria-live="assertive" class="select2-results__option"></li>'),i=this.options.get("translations").get(t.message);s.append(n(i(t.args))),s[0].className+=" select2-results__message",this.$results.append(s)},n.prototype.hideMessages=function(){this.$results.find(".select2-results__message").remove()},n.prototype.append=function(e){this.hideLoading();var t=[];if(null!=e.results&&0!==e.results.length){e.results=this.sort(e.results);for(var n=0;n<e.results.length;n++){var s=e.results[n];s=this.option(s);t.push(s)}this.$results.append(t)}else 0===this.$results.children().length&&this.trigger("results:message",{message:"noResults"})},n.prototype.position=function(e,t){t.find(".select2-results").append(e)},n.prototype.sort=function(e){return this.options.get("sorter")(e)},n.prototype.highlightFirstItem=function(){var e=this.$results.find(".select2-results__option--selectable"),t=e.filter(".select2-results__option--selected");(0<t.length?t:e).first().trigger("mouseenter"),this.ensureHighlightVisible()},n.prototype.setClasses=function(){var n=this;this.data.current((function(s){var i=s.map((function(e){return e.id.toString()}));n.$results.find(".select2-results__option--selectable").each((function(){var n=e(this),s=t.GetData(this,"data"),o=""+s.id;null!=s.element&&s.element.selected||null==s.element&&-1<i.indexOf(o)?(this.classList.add("select2-results__option--selected"),n.attr("aria-selected","true")):(this.classList.remove("select2-results__option--selected"),n.attr("aria-selected","false"))}))}))},n.prototype.showLoading=function(e){this.hideLoading(),e={disabled:!0,loading:!0,text:this.options.get("translations").get("searching")(e)},(e=this.option(e)).className+=" loading-results",this.$results.prepend(e)},n.prototype.hideLoading=function(){this.$results.find(".loading-results").remove()},n.prototype.option=function(n){var s=document.createElement("li");s.classList.add("select2-results__option"),s.classList.add("select2-results__option--selectable");var i,o={role:"option"},r=window.Element.prototype.matches||window.Element.prototype.msMatchesSelector||window.Element.prototype.webkitMatchesSelector;for(i in(null!=n.element&&r.call(n.element,":disabled")||null==n.element&&n.disabled)&&(o["aria-disabled"]="true",s.classList.remove("select2-results__option--selectable"),s.classList.add("select2-results__option--disabled")),null==n.id&&s.classList.remove("select2-results__option--selectable"),null!=n._resultId&&(s.id=n._resultId),n.title&&(s.title=n.title),n.children&&(o.role="group",o["aria-label"]=n.text,s.classList.remove("select2-results__option--selectable"),s.classList.add("select2-results__option--group")),o){var a=o[i];s.setAttribute(i,a)}if(n.children){var l=e(s),c=document.createElement("strong");c.className="select2-results__group",this.template(n,c);for(var u=[],d=0;d<n.children.length;d++){var p=n.children[d];p=this.option(p);u.push(p)}(r=e("<ul></ul>",{class:"select2-results__options select2-results__options--nested",role:"none"})).append(u),l.append(c),l.append(r)}else this.template(n,s);return t.StoreData(s,"data",n),s},n.prototype.bind=function(n,s){var i=this,o=n.id+"-results";this.$results.attr("id",o),n.on("results:all",(function(e){i.clear(),i.append(e.data),n.isOpen()&&(i.setClasses(),i.highlightFirstItem())})),n.on("results:append",(function(e){i.append(e.data),n.isOpen()&&i.setClasses()})),n.on("query",(function(e){i.hideMessages(),i.showLoading(e)})),n.on("select",(function(){n.isOpen()&&(i.setClasses(),i.options.get("scrollAfterSelect")&&i.highlightFirstItem())})),n.on("unselect",(function(){n.isOpen()&&(i.setClasses(),i.options.get("scrollAfterSelect")&&i.highlightFirstItem())})),n.on("open",(function(){i.$results.attr("aria-expanded","true"),i.$results.attr("aria-hidden","false"),i.setClasses(),i.ensureHighlightVisible()})),n.on("close",(function(){i.$results.attr("aria-expanded","false"),i.$results.attr("aria-hidden","true"),i.$results.removeAttr("aria-activedescendant")})),n.on("results:toggle",(function(){var e=i.getHighlightedResults();0!==e.length&&e.trigger("mouseup")})),n.on("results:select",(function(){var e,n=i.getHighlightedResults();0!==n.length&&(e=t.GetData(n[0],"data"),n.hasClass("select2-results__option--selected")?i.trigger("close",{}):i.trigger("select",{data:e}))})),n.on("results:previous",(function(){var e,t=i.getHighlightedResults(),n=i.$results.find(".select2-results__option--selectable"),s=n.index(t);s<=0||(e=s-1,0===t.length&&(e=0),(s=n.eq(e)).trigger("mouseenter"),t=i.$results.offset().top,n=s.offset().top,s=i.$results.scrollTop()+(n-t),0===e?i.$results.scrollTop(0):n-t<0&&i.$results.scrollTop(s))})),n.on("results:next",(function(){var e,t=i.getHighlightedResults(),n=i.$results.find(".select2-results__option--selectable"),s=n.index(t)+1;s>=n.length||((e=n.eq(s)).trigger("mouseenter"),t=i.$results.offset().top+i.$results.outerHeight(!1),n=e.offset().top+e.outerHeight(!1),e=i.$results.scrollTop()+n-t,0===s?i.$results.scrollTop(0):t<n&&i.$results.scrollTop(e))})),n.on("results:focus",(function(e){e.element[0].classList.add("select2-results__option--highlighted"),e.element[0].setAttribute("aria-selected","true")})),n.on("results:message",(function(e){i.displayMessage(e)})),e.fn.mousewheel&&this.$results.on("mousewheel",(function(e){var t=i.$results.scrollTop(),n=i.$results.get(0).scrollHeight-t+e.deltaY;t=0<e.deltaY&&t-e.deltaY<=0,n=e.deltaY<0&&n<=i.$results.height();t?(i.$results.scrollTop(0),e.preventDefault(),e.stopPropagation()):n&&(i.$results.scrollTop(i.$results.get(0).scrollHeight-i.$results.height()),e.preventDefault(),e.stopPropagation())})),this.$results.on("mouseup",".select2-results__option--selectable",(function(n){var s=e(this),o=t.GetData(this,"data");s.hasClass("select2-results__option--selected")?i.options.get("multiple")?i.trigger("unselect",{originalEvent:n,data:o}):i.trigger("close",{}):i.trigger("select",{originalEvent:n,data:o})})),this.$results.on("mouseenter",".select2-results__option--selectable",(function(n){var s=t.GetData(this,"data");i.getHighlightedResults().removeClass("select2-results__option--highlighted").attr("aria-selected","false"),i.trigger("results:focus",{data:s,element:e(this)})}))},n.prototype.getHighlightedResults=function(){return this.$results.find(".select2-results__option--highlighted")},n.prototype.destroy=function(){this.$results.remove()},n.prototype.ensureHighlightVisible=function(){var e,t,n,s,i=this.getHighlightedResults();0!==i.length&&(e=this.$results.find(".select2-results__option--selectable").index(i),s=this.$results.offset().top,t=i.offset().top,n=this.$results.scrollTop()+(t-s),s=t-s,n-=2*i.outerHeight(!1),e<=2?this.$results.scrollTop(0):(s>this.$results.outerHeight()||s<0)&&this.$results.scrollTop(n))},n.prototype.template=function(t,n){var s=this.options.get("templateResult"),i=this.options.get("escapeMarkup");null==(t=s(t,n))?n.style.display="none":"string"==typeof t?n.innerHTML=i(t):e(n).append(t)},n})),x.define("select2/keys",[],(function(){return{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46}})),x.define("select2/selection/base",["jquery","../utils","../keys"],(function(e,t,n){function s(e,t){this.$element=e,this.options=t,s.__super__.constructor.call(this)}return t.Extend(s,t.Observable),s.prototype.render=function(){var n=e('<span class="select2-selection" role="combobox"  aria-haspopup="true" aria-expanded="false"></span>');return this._tabindex=0,null!=t.GetData(this.$element[0],"old-tabindex")?this._tabindex=t.GetData(this.$element[0],"old-tabindex"):null!=this.$element.attr("tabindex")&&(this._tabindex=this.$element.attr("tabindex")),n.attr("title",this.$element.attr("title")),n.attr("tabindex",this._tabindex),n.attr("aria-disabled","false"),this.$selection=n},s.prototype.bind=function(e,t){var s=this,i=e.id+"-results";this.container=e,this.$selection.on("focus",(function(e){s.trigger("focus",e)})),this.$selection.on("blur",(function(e){s._handleBlur(e)})),this.$selection.on("keydown",(function(e){s.trigger("keypress",e),e.which===n.SPACE&&e.preventDefault()})),e.on("results:focus",(function(e){s.$selection.attr("aria-activedescendant",e.data._resultId)})),e.on("selection:update",(function(e){s.update(e.data)})),e.on("open",(function(){s.$selection.attr("aria-expanded","true"),s.$selection.attr("aria-owns",i),s._attachCloseHandler(e)})),e.on("close",(function(){s.$selection.attr("aria-expanded","false"),s.$selection.removeAttr("aria-activedescendant"),s.$selection.removeAttr("aria-owns"),s.$selection.trigger("focus"),s._detachCloseHandler(e)})),e.on("enable",(function(){s.$selection.attr("tabindex",s._tabindex),s.$selection.attr("aria-disabled","false")})),e.on("disable",(function(){s.$selection.attr("tabindex","-1"),s.$selection.attr("aria-disabled","true")}))},s.prototype._handleBlur=function(t){var n=this;window.setTimeout((function(){document.activeElement==n.$selection[0]||e.contains(n.$selection[0],document.activeElement)||n.trigger("blur",t)}),1)},s.prototype._attachCloseHandler=function(n){e(document.body).on("mousedown.select2."+n.id,(function(n){var s=e(n.target).closest(".select2");e(".select2.select2-container--open").each((function(){this!=s[0]&&t.GetData(this,"element").select2("close")}))}))},s.prototype._detachCloseHandler=function(t){e(document.body).off("mousedown.select2."+t.id)},s.prototype.position=function(e,t){t.find(".selection").append(e)},s.prototype.destroy=function(){this._detachCloseHandler(this.container)},s.prototype.update=function(e){throw new Error("The `update` method must be defined in child classes.")},s.prototype.isEnabled=function(){return!this.isDisabled()},s.prototype.isDisabled=function(){return this.options.get("disabled")},s})),x.define("select2/selection/single",["jquery","./base","../utils","../keys"],(function(e,t,n,s){function i(){i.__super__.constructor.apply(this,arguments)}return n.Extend(i,t),i.prototype.render=function(){var e=i.__super__.render.call(this);return e[0].classList.add("select2-selection--single"),e.html('<span class="select2-selection__rendered"></span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span>'),e},i.prototype.bind=function(e,t){var n=this;i.__super__.bind.apply(this,arguments);var s=e.id+"-container";this.$selection.find(".select2-selection__rendered").attr("id",s).attr("role","textbox").attr("aria-readonly","true"),this.$selection.attr("aria-labelledby",s),this.$selection.attr("aria-controls",s),this.$selection.on("mousedown",(function(e){1===e.which&&n.trigger("toggle",{originalEvent:e})})),this.$selection.on("focus",(function(e){})),this.$selection.on("blur",(function(e){})),e.on("focus",(function(t){e.isOpen()||n.$selection.trigger("focus")}))},i.prototype.clear=function(){var e=this.$selection.find(".select2-selection__rendered");e.empty(),e.removeAttr("title")},i.prototype.display=function(e,t){var n=this.options.get("templateSelection");return this.options.get("escapeMarkup")(n(e,t))},i.prototype.selectionContainer=function(){return e("<span></span>")},i.prototype.update=function(e){var t,n;0!==e.length?(n=e[0],t=this.$selection.find(".select2-selection__rendered"),e=this.display(n,t),t.empty().append(e),(n=n.title||n.text)?t.attr("title",n):t.removeAttr("title")):this.clear()},i})),x.define("select2/selection/multiple",["jquery","./base","../utils"],(function(e,t,n){function s(e,t){s.__super__.constructor.apply(this,arguments)}return n.Extend(s,t),s.prototype.render=function(){var e=s.__super__.render.call(this);return e[0].classList.add("select2-selection--multiple"),e.html('<ul class="select2-selection__rendered"></ul>'),e},s.prototype.bind=function(t,i){var o=this;s.__super__.bind.apply(this,arguments);var r=t.id+"-container";this.$selection.find(".select2-selection__rendered").attr("id",r),this.$selection.on("click",(function(e){o.trigger("toggle",{originalEvent:e})})),this.$selection.on("click",".select2-selection__choice__remove",(function(t){var s;o.isDisabled()||(s=e(this).parent(),s=n.GetData(s[0],"data"),o.trigger("unselect",{originalEvent:t,data:s}))})),this.$selection.on("keydown",".select2-selection__choice__remove",(function(e){o.isDisabled()||e.stopPropagation()}))},s.prototype.clear=function(){var e=this.$selection.find(".select2-selection__rendered");e.empty(),e.removeAttr("title")},s.prototype.display=function(e,t){var n=this.options.get("templateSelection");return this.options.get("escapeMarkup")(n(e,t))},s.prototype.selectionContainer=function(){return e('<li class="select2-selection__choice"><button type="button" class="select2-selection__choice__remove" tabindex="-1"><span aria-hidden="true">&times;</span></button><span class="select2-selection__choice__display"></span></li>')},s.prototype.update=function(e){if(this.clear(),0!==e.length){for(var t=[],s=this.$selection.find(".select2-selection__rendered").attr("id")+"-choice-",i=0;i<e.length;i++){var o=e[i],r=this.selectionContainer(),a=this.display(o,r),l=s+n.generateChars(4)+"-";o.id?l+=o.id:l+=n.generateChars(4),r.find(".select2-selection__choice__display").append(a).attr("id",l);var c=o.title||o.text;c&&r.attr("title",c),a=this.options.get("translations").get("removeItem"),(c=r.find(".select2-selection__choice__remove")).attr("title",a()),c.attr("aria-label",a()),c.attr("aria-describedby",l),n.StoreData(r[0],"data",o),t.push(r)}this.$selection.find(".select2-selection__rendered").append(t)}},s})),x.define("select2/selection/placeholder",[],(function(){function e(e,t,n){this.placeholder=this.normalizePlaceholder(n.get("placeholder")),e.call(this,t,n)}return e.prototype.normalizePlaceholder=function(e,t){return"string"==typeof t&&(t={id:"",text:t}),t},e.prototype.createPlaceholder=function(e,t){var n=this.selectionContainer();return n.html(this.display(t)),n[0].classList.add("select2-selection__placeholder"),n[0].classList.remove("select2-selection__choice"),t=t.title||t.text||n.text(),this.$selection.find(".select2-selection__rendered").attr("title",t),n},e.prototype.update=function(e,t){var n=1==t.length&&t[0].id!=this.placeholder.id;if(1<t.length||n)return e.call(this,t);this.clear(),t=this.createPlaceholder(this.placeholder),this.$selection.find(".select2-selection__rendered").append(t)},e})),x.define("select2/selection/allowClear",["jquery","../keys","../utils"],(function(e,t,n){function s(){}return s.prototype.bind=function(e,t,n){var s=this;e.call(this,t,n),null==this.placeholder&&this.options.get("debug")&&window.console&&console.error&&console.error("Select2: The `allowClear` option should be used in combination with the `placeholder` option."),this.$selection.on("mousedown",".select2-selection__clear",(function(e){s._handleClear(e)})),t.on("keypress",(function(e){s._handleKeyboardClear(e,t)}))},s.prototype._handleClear=function(e,t){if(!this.isDisabled()){var s=this.$selection.find(".select2-selection__clear");if(0!==s.length){t.stopPropagation();var i=n.GetData(s[0],"data"),o=this.$element.val();this.$element.val(this.placeholder.id);var r={data:i};if(this.trigger("clear",r),r.prevented)this.$element.val(o);else{for(var a=0;a<i.length;a++)if(r={data:i[a]},this.trigger("unselect",r),r.prevented)return void this.$element.val(o);this.$element.trigger("input").trigger("change"),this.trigger("toggle",{})}}}},s.prototype._handleKeyboardClear=function(e,n,s){s.isOpen()||n.which!=t.DELETE&&n.which!=t.BACKSPACE||this._handleClear(n)},s.prototype.update=function(t,s){var i,o;t.call(this,s),this.$selection.find(".select2-selection__clear").remove(),this.$selection[0].classList.remove("select2-selection--clearable"),0<this.$selection.find(".select2-selection__placeholder").length||0===s.length||(i=this.$selection.find(".select2-selection__rendered").attr("id"),o=this.options.get("translations").get("removeAllItems"),(t=e('<button type="button" class="select2-selection__clear" tabindex="-1"><span aria-hidden="true">&times;</span></button>')).attr("title",o()),t.attr("aria-label",o()),t.attr("aria-describedby",i),n.StoreData(t[0],"data",s),this.$selection.prepend(t),this.$selection[0].classList.add("select2-selection--clearable"))},s})),x.define("select2/selection/search",["jquery","../utils","../keys"],(function(e,t,n){function s(e,t,n){e.call(this,t,n)}return s.prototype.render=function(t){var n=this.options.get("translations").get("search"),s=e('<span class="select2-search select2-search--inline"><textarea class="select2-search__field" type="search" tabindex="-1" autocorrect="off" autocapitalize="none" spellcheck="false" role="searchbox" aria-autocomplete="list" ></textarea></span>');return this.$searchContainer=s,this.$search=s.find("textarea"),this.$search.prop("autocomplete",this.options.get("autocomplete")),this.$search.attr("aria-label",n()),t=t.call(this),this._transferTabIndex(),t.append(this.$searchContainer),t},s.prototype.bind=function(e,s,i){var o=this,r=s.id+"-results",a=s.id+"-container";e.call(this,s,i),o.$search.attr("aria-describedby",a),s.on("open",(function(){o.$search.attr("aria-controls",r),o.$search.trigger("focus")})),s.on("close",(function(){o.$search.val(""),o.resizeSearch(),o.$search.removeAttr("aria-controls"),o.$search.removeAttr("aria-activedescendant"),o.$search.trigger("focus")})),s.on("enable",(function(){o.$search.prop("disabled",!1),o._transferTabIndex()})),s.on("disable",(function(){o.$search.prop("disabled",!0)})),s.on("focus",(function(e){o.$search.trigger("focus")})),s.on("results:focus",(function(e){e.data._resultId?o.$search.attr("aria-activedescendant",e.data._resultId):o.$search.removeAttr("aria-activedescendant")})),this.$selection.on("focusin",".select2-search--inline",(function(e){o.trigger("focus",e)})),this.$selection.on("focusout",".select2-search--inline",(function(e){o._handleBlur(e)})),this.$selection.on("keydown",".select2-search--inline",(function(e){var s;e.stopPropagation(),o.trigger("keypress",e),o._keyUpPrevented=e.isDefaultPrevented(),e.which!==n.BACKSPACE||""!==o.$search.val()||0<(s=o.$selection.find(".select2-selection__choice").last()).length&&(s=t.GetData(s[0],"data"),o.searchRemoveChoice(s),e.preventDefault())})),this.$selection.on("click",".select2-search--inline",(function(e){o.$search.val()&&e.stopPropagation()}));var l=(s=document.documentMode)&&s<=11;this.$selection.on("input.searchcheck",".select2-search--inline",(function(e){l?o.$selection.off("input.search input.searchcheck"):o.$selection.off("keyup.search")})),this.$selection.on("keyup.search input.search",".select2-search--inline",(function(e){var t;l&&"input"===e.type?o.$selection.off("input.search input.searchcheck"):(t=e.which)!=n.SHIFT&&t!=n.CTRL&&t!=n.ALT&&t!=n.TAB&&o.handleSearch(e)}))},s.prototype._transferTabIndex=function(e){this.$search.attr("tabindex",this.$selection.attr("tabindex")),this.$selection.attr("tabindex","-1")},s.prototype.createPlaceholder=function(e,t){this.$search.attr("placeholder",t.text)},s.prototype.update=function(e,t){var n=this.$search[0]==document.activeElement;this.$search.attr("placeholder",""),e.call(this,t),this.resizeSearch(),n&&this.$search.trigger("focus")},s.prototype.handleSearch=function(){var e;this.resizeSearch(),this._keyUpPrevented||(e=this.$search.val(),this.trigger("query",{term:e})),this._keyUpPrevented=!1},s.prototype.searchRemoveChoice=function(e,t){this.trigger("unselect",{data:t}),this.$search.val(t.text),this.handleSearch()},s.prototype.resizeSearch=function(){this.$search.css("width","25px");var e="100%";""===this.$search.attr("placeholder")&&(e=.75*(this.$search.val().length+1)+"em"),this.$search.css("width",e)},s})),x.define("select2/selection/selectionCss",["../utils"],(function(e){function t(){}return t.prototype.render=function(t){var n=t.call(this);return-1!==(t=this.options.get("selectionCssClass")||"").indexOf(":all:")&&(t=t.replace(":all:",""),e.copyNonInternalCssClasses(n[0],this.$element[0])),n.addClass(t),n},t})),x.define("select2/selection/eventRelay",["jquery"],(function(e){function t(){}return t.prototype.bind=function(t,n,s){var i=this,o=["open","opening","close","closing","select","selecting","unselect","unselecting","clear","clearing"],r=["opening","closing","selecting","unselecting","clearing"];t.call(this,n,s),n.on("*",(function(t,n){var s;-1!==o.indexOf(t)&&(n=n||{},s=e.Event("select2:"+t,{params:n}),i.$element.trigger(s),-1!==r.indexOf(t)&&(n.prevented=s.isDefaultPrevented()))}))},t})),x.define("select2/translation",["jquery","require"],(function(e,t){function n(e){this.dict=e||{}}return n.prototype.all=function(){return this.dict},n.prototype.get=function(e){return this.dict[e]},n.prototype.extend=function(t){this.dict=e.extend({},t.all(),this.dict)},n._cache={},n.loadPath=function(e){var s;return e in n._cache||(s=t(e),n._cache[e]=s),new n(n._cache[e])},n})),x.define("select2/diacritics",[],(function(){return{"Ⓐ":"A","Ａ":"A","À":"A","Á":"A","Â":"A","Ầ":"A","Ấ":"A","Ẫ":"A","Ẩ":"A","Ã":"A","Ā":"A","Ă":"A","Ằ":"A","Ắ":"A","Ẵ":"A","Ẳ":"A","Ȧ":"A","Ǡ":"A","Ä":"A","Ǟ":"A","Ả":"A","Å":"A","Ǻ":"A","Ǎ":"A","Ȁ":"A","Ȃ":"A","Ạ":"A","Ậ":"A","Ặ":"A","Ḁ":"A","Ą":"A","Ⱥ":"A","Ɐ":"A","Ꜳ":"AA","Æ":"AE","Ǽ":"AE","Ǣ":"AE","Ꜵ":"AO","Ꜷ":"AU","Ꜹ":"AV","Ꜻ":"AV","Ꜽ":"AY","Ⓑ":"B","Ｂ":"B","Ḃ":"B","Ḅ":"B","Ḇ":"B","Ƀ":"B","Ƃ":"B","Ɓ":"B","Ⓒ":"C","Ｃ":"C","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","Ç":"C","Ḉ":"C","Ƈ":"C","Ȼ":"C","Ꜿ":"C","Ⓓ":"D","Ｄ":"D","Ḋ":"D","Ď":"D","Ḍ":"D","Ḑ":"D","Ḓ":"D","Ḏ":"D","Đ":"D","Ƌ":"D","Ɗ":"D","Ɖ":"D","Ꝺ":"D","Ǳ":"DZ","Ǆ":"DZ","ǲ":"Dz","ǅ":"Dz","Ⓔ":"E","Ｅ":"E","È":"E","É":"E","Ê":"E","Ề":"E","Ế":"E","Ễ":"E","Ể":"E","Ẽ":"E","Ē":"E","Ḕ":"E","Ḗ":"E","Ĕ":"E","Ė":"E","Ë":"E","Ẻ":"E","Ě":"E","Ȅ":"E","Ȇ":"E","Ẹ":"E","Ệ":"E","Ȩ":"E","Ḝ":"E","Ę":"E","Ḙ":"E","Ḛ":"E","Ɛ":"E","Ǝ":"E","Ⓕ":"F","Ｆ":"F","Ḟ":"F","Ƒ":"F","Ꝼ":"F","Ⓖ":"G","Ｇ":"G","Ǵ":"G","Ĝ":"G","Ḡ":"G","Ğ":"G","Ġ":"G","Ǧ":"G","Ģ":"G","Ǥ":"G","Ɠ":"G","Ꞡ":"G","Ᵹ":"G","Ꝿ":"G","Ⓗ":"H","Ｈ":"H","Ĥ":"H","Ḣ":"H","Ḧ":"H","Ȟ":"H","Ḥ":"H","Ḩ":"H","Ḫ":"H","Ħ":"H","Ⱨ":"H","Ⱶ":"H","Ɥ":"H","Ⓘ":"I","Ｉ":"I","Ì":"I","Í":"I","Î":"I","Ĩ":"I","Ī":"I","Ĭ":"I","İ":"I","Ï":"I","Ḯ":"I","Ỉ":"I","Ǐ":"I","Ȉ":"I","Ȋ":"I","Ị":"I","Į":"I","Ḭ":"I","Ɨ":"I","Ⓙ":"J","Ｊ":"J","Ĵ":"J","Ɉ":"J","Ⓚ":"K","Ｋ":"K","Ḱ":"K","Ǩ":"K","Ḳ":"K","Ķ":"K","Ḵ":"K","Ƙ":"K","Ⱪ":"K","Ꝁ":"K","Ꝃ":"K","Ꝅ":"K","Ꞣ":"K","Ⓛ":"L","Ｌ":"L","Ŀ":"L","Ĺ":"L","Ľ":"L","Ḷ":"L","Ḹ":"L","Ļ":"L","Ḽ":"L","Ḻ":"L","Ł":"L","Ƚ":"L","Ɫ":"L","Ⱡ":"L","Ꝉ":"L","Ꝇ":"L","Ꞁ":"L","Ǉ":"LJ","ǈ":"Lj","Ⓜ":"M","Ｍ":"M","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ɱ":"M","Ɯ":"M","Ⓝ":"N","Ｎ":"N","Ǹ":"N","Ń":"N","Ñ":"N","Ṅ":"N","Ň":"N","Ṇ":"N","Ņ":"N","Ṋ":"N","Ṉ":"N","Ƞ":"N","Ɲ":"N","Ꞑ":"N","Ꞥ":"N","Ǌ":"NJ","ǋ":"Nj","Ⓞ":"O","Ｏ":"O","Ò":"O","Ó":"O","Ô":"O","Ồ":"O","Ố":"O","Ỗ":"O","Ổ":"O","Õ":"O","Ṍ":"O","Ȭ":"O","Ṏ":"O","Ō":"O","Ṑ":"O","Ṓ":"O","Ŏ":"O","Ȯ":"O","Ȱ":"O","Ö":"O","Ȫ":"O","Ỏ":"O","Ő":"O","Ǒ":"O","Ȍ":"O","Ȏ":"O","Ơ":"O","Ờ":"O","Ớ":"O","Ỡ":"O","Ở":"O","Ợ":"O","Ọ":"O","Ộ":"O","Ǫ":"O","Ǭ":"O","Ø":"O","Ǿ":"O","Ɔ":"O","Ɵ":"O","Ꝋ":"O","Ꝍ":"O","Œ":"OE","Ƣ":"OI","Ꝏ":"OO","Ȣ":"OU","Ⓟ":"P","Ｐ":"P","Ṕ":"P","Ṗ":"P","Ƥ":"P","Ᵽ":"P","Ꝑ":"P","Ꝓ":"P","Ꝕ":"P","Ⓠ":"Q","Ｑ":"Q","Ꝗ":"Q","Ꝙ":"Q","Ɋ":"Q","Ⓡ":"R","Ｒ":"R","Ŕ":"R","Ṙ":"R","Ř":"R","Ȑ":"R","Ȓ":"R","Ṛ":"R","Ṝ":"R","Ŗ":"R","Ṟ":"R","Ɍ":"R","Ɽ":"R","Ꝛ":"R","Ꞧ":"R","Ꞃ":"R","Ⓢ":"S","Ｓ":"S","ẞ":"S","Ś":"S","Ṥ":"S","Ŝ":"S","Ṡ":"S","Š":"S","Ṧ":"S","Ṣ":"S","Ṩ":"S","Ș":"S","Ş":"S","Ȿ":"S","Ꞩ":"S","Ꞅ":"S","Ⓣ":"T","Ｔ":"T","Ṫ":"T","Ť":"T","Ṭ":"T","Ț":"T","Ţ":"T","Ṱ":"T","Ṯ":"T","Ŧ":"T","Ƭ":"T","Ʈ":"T","Ⱦ":"T","Ꞇ":"T","Ꜩ":"TZ","Ⓤ":"U","Ｕ":"U","Ù":"U","Ú":"U","Û":"U","Ũ":"U","Ṹ":"U","Ū":"U","Ṻ":"U","Ŭ":"U","Ü":"U","Ǜ":"U","Ǘ":"U","Ǖ":"U","Ǚ":"U","Ủ":"U","Ů":"U","Ű":"U","Ǔ":"U","Ȕ":"U","Ȗ":"U","Ư":"U","Ừ":"U","Ứ":"U","Ữ":"U","Ử":"U","Ự":"U","Ụ":"U","Ṳ":"U","Ų":"U","Ṷ":"U","Ṵ":"U","Ʉ":"U","Ⓥ":"V","Ｖ":"V","Ṽ":"V","Ṿ":"V","Ʋ":"V","Ꝟ":"V","Ʌ":"V","Ꝡ":"VY","Ⓦ":"W","Ｗ":"W","Ẁ":"W","Ẃ":"W","Ŵ":"W","Ẇ":"W","Ẅ":"W","Ẉ":"W","Ⱳ":"W","Ⓧ":"X","Ｘ":"X","Ẋ":"X","Ẍ":"X","Ⓨ":"Y","Ｙ":"Y","Ỳ":"Y","Ý":"Y","Ŷ":"Y","Ỹ":"Y","Ȳ":"Y","Ẏ":"Y","Ÿ":"Y","Ỷ":"Y","Ỵ":"Y","Ƴ":"Y","Ɏ":"Y","Ỿ":"Y","Ⓩ":"Z","Ｚ":"Z","Ź":"Z","Ẑ":"Z","Ż":"Z","Ž":"Z","Ẓ":"Z","Ẕ":"Z","Ƶ":"Z","Ȥ":"Z","Ɀ":"Z","Ⱬ":"Z","Ꝣ":"Z","ⓐ":"a","ａ":"a","ẚ":"a","à":"a","á":"a","â":"a","ầ":"a","ấ":"a","ẫ":"a","ẩ":"a","ã":"a","ā":"a","ă":"a","ằ":"a","ắ":"a","ẵ":"a","ẳ":"a","ȧ":"a","ǡ":"a","ä":"a","ǟ":"a","ả":"a","å":"a","ǻ":"a","ǎ":"a","ȁ":"a","ȃ":"a","ạ":"a","ậ":"a","ặ":"a","ḁ":"a","ą":"a","ⱥ":"a","ɐ":"a","ꜳ":"aa","æ":"ae","ǽ":"ae","ǣ":"ae","ꜵ":"ao","ꜷ":"au","ꜹ":"av","ꜻ":"av","ꜽ":"ay","ⓑ":"b","ｂ":"b","ḃ":"b","ḅ":"b","ḇ":"b","ƀ":"b","ƃ":"b","ɓ":"b","ⓒ":"c","ｃ":"c","ć":"c","ĉ":"c","ċ":"c","č":"c","ç":"c","ḉ":"c","ƈ":"c","ȼ":"c","ꜿ":"c","ↄ":"c","ⓓ":"d","ｄ":"d","ḋ":"d","ď":"d","ḍ":"d","ḑ":"d","ḓ":"d","ḏ":"d","đ":"d","ƌ":"d","ɖ":"d","ɗ":"d","ꝺ":"d","ǳ":"dz","ǆ":"dz","ⓔ":"e","ｅ":"e","è":"e","é":"e","ê":"e","ề":"e","ế":"e","ễ":"e","ể":"e","ẽ":"e","ē":"e","ḕ":"e","ḗ":"e","ĕ":"e","ė":"e","ë":"e","ẻ":"e","ě":"e","ȅ":"e","ȇ":"e","ẹ":"e","ệ":"e","ȩ":"e","ḝ":"e","ę":"e","ḙ":"e","ḛ":"e","ɇ":"e","ɛ":"e","ǝ":"e","ⓕ":"f","ｆ":"f","ḟ":"f","ƒ":"f","ꝼ":"f","ⓖ":"g","ｇ":"g","ǵ":"g","ĝ":"g","ḡ":"g","ğ":"g","ġ":"g","ǧ":"g","ģ":"g","ǥ":"g","ɠ":"g","ꞡ":"g","ᵹ":"g","ꝿ":"g","ⓗ":"h","ｈ":"h","ĥ":"h","ḣ":"h","ḧ":"h","ȟ":"h","ḥ":"h","ḩ":"h","ḫ":"h","ẖ":"h","ħ":"h","ⱨ":"h","ⱶ":"h","ɥ":"h","ƕ":"hv","ⓘ":"i","ｉ":"i","ì":"i","í":"i","î":"i","ĩ":"i","ī":"i","ĭ":"i","ï":"i","ḯ":"i","ỉ":"i","ǐ":"i","ȉ":"i","ȋ":"i","ị":"i","į":"i","ḭ":"i","ɨ":"i","ı":"i","ⓙ":"j","ｊ":"j","ĵ":"j","ǰ":"j","ɉ":"j","ⓚ":"k","ｋ":"k","ḱ":"k","ǩ":"k","ḳ":"k","ķ":"k","ḵ":"k","ƙ":"k","ⱪ":"k","ꝁ":"k","ꝃ":"k","ꝅ":"k","ꞣ":"k","ⓛ":"l","ｌ":"l","ŀ":"l","ĺ":"l","ľ":"l","ḷ":"l","ḹ":"l","ļ":"l","ḽ":"l","ḻ":"l","ſ":"l","ł":"l","ƚ":"l","ɫ":"l","ⱡ":"l","ꝉ":"l","ꞁ":"l","ꝇ":"l","ǉ":"lj","ⓜ":"m","ｍ":"m","ḿ":"m","ṁ":"m","ṃ":"m","ɱ":"m","ɯ":"m","ⓝ":"n","ｎ":"n","ǹ":"n","ń":"n","ñ":"n","ṅ":"n","ň":"n","ṇ":"n","ņ":"n","ṋ":"n","ṉ":"n","ƞ":"n","ɲ":"n","ŉ":"n","ꞑ":"n","ꞥ":"n","ǌ":"nj","ⓞ":"o","ｏ":"o","ò":"o","ó":"o","ô":"o","ồ":"o","ố":"o","ỗ":"o","ổ":"o","õ":"o","ṍ":"o","ȭ":"o","ṏ":"o","ō":"o","ṑ":"o","ṓ":"o","ŏ":"o","ȯ":"o","ȱ":"o","ö":"o","ȫ":"o","ỏ":"o","ő":"o","ǒ":"o","ȍ":"o","ȏ":"o","ơ":"o","ờ":"o","ớ":"o","ỡ":"o","ở":"o","ợ":"o","ọ":"o","ộ":"o","ǫ":"o","ǭ":"o","ø":"o","ǿ":"o","ɔ":"o","ꝋ":"o","ꝍ":"o","ɵ":"o","œ":"oe","ƣ":"oi","ȣ":"ou","ꝏ":"oo","ⓟ":"p","ｐ":"p","ṕ":"p","ṗ":"p","ƥ":"p","ᵽ":"p","ꝑ":"p","ꝓ":"p","ꝕ":"p","ⓠ":"q","ｑ":"q","ɋ":"q","ꝗ":"q","ꝙ":"q","ⓡ":"r","ｒ":"r","ŕ":"r","ṙ":"r","ř":"r","ȑ":"r","ȓ":"r","ṛ":"r","ṝ":"r","ŗ":"r","ṟ":"r","ɍ":"r","ɽ":"r","ꝛ":"r","ꞧ":"r","ꞃ":"r","ⓢ":"s","ｓ":"s","ß":"s","ś":"s","ṥ":"s","ŝ":"s","ṡ":"s","š":"s","ṧ":"s","ṣ":"s","ṩ":"s","ș":"s","ş":"s","ȿ":"s","ꞩ":"s","ꞅ":"s","ẛ":"s","ⓣ":"t","ｔ":"t","ṫ":"t","ẗ":"t","ť":"t","ṭ":"t","ț":"t","ţ":"t","ṱ":"t","ṯ":"t","ŧ":"t","ƭ":"t","ʈ":"t","ⱦ":"t","ꞇ":"t","ꜩ":"tz","ⓤ":"u","ｕ":"u","ù":"u","ú":"u","û":"u","ũ":"u","ṹ":"u","ū":"u","ṻ":"u","ŭ":"u","ü":"u","ǜ":"u","ǘ":"u","ǖ":"u","ǚ":"u","ủ":"u","ů":"u","ű":"u","ǔ":"u","ȕ":"u","ȗ":"u","ư":"u","ừ":"u","ứ":"u","ữ":"u","ử":"u","ự":"u","ụ":"u","ṳ":"u","ų":"u","ṷ":"u","ṵ":"u","ʉ":"u","ⓥ":"v","ｖ":"v","ṽ":"v","ṿ":"v","ʋ":"v","ꝟ":"v","ʌ":"v","ꝡ":"vy","ⓦ":"w","ｗ":"w","ẁ":"w","ẃ":"w","ŵ":"w","ẇ":"w","ẅ":"w","ẘ":"w","ẉ":"w","ⱳ":"w","ⓧ":"x","ｘ":"x","ẋ":"x","ẍ":"x","ⓨ":"y","ｙ":"y","ỳ":"y","ý":"y","ŷ":"y","ỹ":"y","ȳ":"y","ẏ":"y","ÿ":"y","ỷ":"y","ẙ":"y","ỵ":"y","ƴ":"y","ɏ":"y","ỿ":"y","ⓩ":"z","ｚ":"z","ź":"z","ẑ":"z","ż":"z","ž":"z","ẓ":"z","ẕ":"z","ƶ":"z","ȥ":"z","ɀ":"z","ⱬ":"z","ꝣ":"z","Ά":"Α","Έ":"Ε","Ή":"Η","Ί":"Ι","Ϊ":"Ι","Ό":"Ο","Ύ":"Υ","Ϋ":"Υ","Ώ":"Ω","ά":"α","έ":"ε","ή":"η","ί":"ι","ϊ":"ι","ΐ":"ι","ό":"ο","ύ":"υ","ϋ":"υ","ΰ":"υ","ώ":"ω","ς":"σ","’":"'"}})),x.define("select2/data/base",["../utils"],(function(e){function t(e,n){t.__super__.constructor.call(this)}return e.Extend(t,e.Observable),t.prototype.current=function(e){throw new Error("The `current` method must be defined in child classes.")},t.prototype.query=function(e,t){throw new Error("The `query` method must be defined in child classes.")},t.prototype.bind=function(e,t){},t.prototype.destroy=function(){},t.prototype.generateResultId=function(t,n){return t=t.id+"-result-",t+=e.generateChars(4),null!=n.id?t+="-"+n.id.toString():t+="-"+e.generateChars(4),t},t})),x.define("select2/data/select",["./base","../utils","jquery"],(function(e,t,n){function s(e,t){this.$element=e,this.options=t,s.__super__.constructor.call(this)}return t.Extend(s,e),s.prototype.current=function(e){var t=this;e(Array.prototype.map.call(this.$element[0].querySelectorAll(":checked"),(function(e){return t.item(n(e))})))},s.prototype.select=function(e){var t,n=this;if(e.selected=!0,null!=e.element&&"option"===e.element.tagName.toLowerCase())return e.element.selected=!0,void this.$element.trigger("input").trigger("change");this.$element.prop("multiple")?this.current((function(t){var s=[];(e=[e]).push.apply(e,t);for(var i=0;i<e.length;i++){var o=e[i].id;-1===s.indexOf(o)&&s.push(o)}n.$element.val(s),n.$element.trigger("input").trigger("change")})):(t=e.id,this.$element.val(t),this.$element.trigger("input").trigger("change"))},s.prototype.unselect=function(e){var t=this;if(this.$element.prop("multiple")){if(e.selected=!1,null!=e.element&&"option"===e.element.tagName.toLowerCase())return e.element.selected=!1,void this.$element.trigger("input").trigger("change");this.current((function(n){for(var s=[],i=0;i<n.length;i++){var o=n[i].id;o!==e.id&&-1===s.indexOf(o)&&s.push(o)}t.$element.val(s),t.$element.trigger("input").trigger("change")}))}},s.prototype.bind=function(e,t){var n=this;(this.container=e).on("select",(function(e){n.select(e.data)})),e.on("unselect",(function(e){n.unselect(e.data)}))},s.prototype.destroy=function(){this.$element.find("*").each((function(){t.RemoveData(this)}))},s.prototype.query=function(e,t){var s=[],i=this;this.$element.children().each((function(){var t;"option"!==this.tagName.toLowerCase()&&"optgroup"!==this.tagName.toLowerCase()||(t=n(this),t=i.item(t),null!==(t=i.matches(e,t))&&s.push(t))})),t({results:s})},s.prototype.addOptions=function(e){this.$element.append(e)},s.prototype.option=function(e){var s;return e.children?(s=document.createElement("optgroup")).label=e.text:void 0!==(s=document.createElement("option")).textContent?s.textContent=e.text:s.innerText=e.text,void 0!==e.id&&(s.value=e.id),e.disabled&&(s.disabled=!0),e.selected&&(s.selected=!0),e.title&&(s.title=e.title),(e=this._normalizeItem(e)).element=s,t.StoreData(s,"data",e),n(s)},s.prototype.item=function(e){var s={};if(null!=(s=t.GetData(e[0],"data")))return s;var i=e[0];if("option"===i.tagName.toLowerCase())s={id:e.val(),text:e.text(),disabled:e.prop("disabled"),selected:e.prop("selected"),title:e.prop("title")};else if("optgroup"===i.tagName.toLowerCase()){s={text:e.prop("label"),children:[],title:e.prop("title")};for(var o=e.children("option"),r=[],a=0;a<o.length;a++){var l=n(o[a]);l=this.item(l);r.push(l)}s.children=r}return(s=this._normalizeItem(s)).element=e[0],t.StoreData(e[0],"data",s),s},s.prototype._normalizeItem=function(e){return e!==Object(e)&&(e={id:e,text:e}),null!=(e=n.extend({},{text:""},e)).id&&(e.id=e.id.toString()),null!=e.text&&(e.text=e.text.toString()),null==e._resultId&&e.id&&null!=this.container&&(e._resultId=this.generateResultId(this.container,e)),n.extend({},{selected:!1,disabled:!1},e)},s.prototype.matches=function(e,t){return this.options.get("matcher")(e,t)},s})),x.define("select2/data/array",["./select","../utils","jquery"],(function(e,t,n){function s(e,t){this._dataToConvert=t.get("data")||[],s.__super__.constructor.call(this,e,t)}return t.Extend(s,e),s.prototype.bind=function(e,t){s.__super__.bind.call(this,e,t),this.addOptions(this.convertToOptions(this._dataToConvert))},s.prototype.select=function(e){var t=this.$element.find("option").filter((function(t,n){return n.value==e.id.toString()}));0===t.length&&(t=this.option(e),this.addOptions(t)),s.__super__.select.call(this,e)},s.prototype.convertToOptions=function(e){for(var t=this,s=this.$element.find("option"),i=s.map((function(){return t.item(n(this)).id})).get(),o=[],r=0;r<e.length;r++){var a,l,c=this._normalizeItem(e[r]);0<=i.indexOf(c.id)?(a=s.filter(function(e){return function(){return n(this).val()==e.id}}(c)),l=this.item(a),l=n.extend(!0,{},c,l),l=this.option(l),a.replaceWith(l)):(l=this.option(c),c.children&&(c=this.convertToOptions(c.children),l.append(c)),o.push(l))}return o},s})),x.define("select2/data/ajax",["./array","../utils","jquery"],(function(e,t,n){function s(e,t){this.ajaxOptions=this._applyDefaults(t.get("ajax")),null!=this.ajaxOptions.processResults&&(this.processResults=this.ajaxOptions.processResults),s.__super__.constructor.call(this,e,t)}return t.Extend(s,e),s.prototype._applyDefaults=function(e){var t={data:function(e){return n.extend({},e,{q:e.term})},transport:function(e,t,s){return(e=n.ajax(e)).then(t),e.fail(s),e}};return n.extend({},t,e,!0)},s.prototype.processResults=function(e){return e},s.prototype.query=function(e,t){var s=this;null!=this._request&&("function"==typeof this._request.abort&&this._request.abort(),this._request=null);var i=n.extend({type:"GET"},this.ajaxOptions);function o(){var n=i.transport(i,(function(n){n=s.processResults(n,e),s.options.get("debug")&&window.console&&console.error&&(n&&n.results&&Array.isArray(n.results)||console.error("Select2: The AJAX results did not return an array in the `results` key of the response.")),t(n)}),(function(){"status"in n&&(0===n.status||"0"===n.status)||s.trigger("results:message",{message:"errorLoading"})}));s._request=n}"function"==typeof i.url&&(i.url=i.url.call(this.$element,e)),"function"==typeof i.data&&(i.data=i.data.call(this.$element,e)),this.ajaxOptions.delay&&null!=e.term?(this._queryTimeout&&window.clearTimeout(this._queryTimeout),this._queryTimeout=window.setTimeout(o,this.ajaxOptions.delay)):o()},s})),x.define("select2/data/tags",["jquery"],(function(e){function t(e,t,n){var s=n.get("tags"),i=n.get("createTag");if(void 0!==i&&(this.createTag=i),void 0!==(i=n.get("insertTag"))&&(this.insertTag=i),e.call(this,t,n),Array.isArray(s))for(var o=0;o<s.length;o++){var r=s[o];r=this._normalizeItem(r),r=this.option(r);this.$element.append(r)}}return t.prototype.query=function(e,t,n){var s=this;this._removeOldTags(),null!=t.term&&null==t.page?e.call(this,t,(function e(i,o){for(var r=i.results,a=0;a<r.length;a++){var l=r[a],c=null!=l.children&&!e({results:l.children},!0);if((l.text||"").toUpperCase()===(t.term||"").toUpperCase()||c)return!o&&(i.data=r,void n(i))}if(o)return!0;var u,d=s.createTag(t);null!=d&&((u=s.option(d)).attr("data-select2-tag","true"),s.addOptions([u]),s.insertTag(r,d)),i.results=r,n(i)})):e.call(this,t,n)},t.prototype.createTag=function(e,t){return null==t.term||""===(t=t.term.trim())?null:{id:t,text:t}},t.prototype.insertTag=function(e,t,n){t.unshift(n)},t.prototype._removeOldTags=function(t){this.$element.find("option[data-select2-tag]").each((function(){this.selected||e(this).remove()}))},t})),x.define("select2/data/tokenizer",["jquery"],(function(e){function t(e,t,n){var s=n.get("tokenizer");void 0!==s&&(this.tokenizer=s),e.call(this,t,n)}return t.prototype.bind=function(e,t,n){e.call(this,t,n),this.$search=t.dropdown.$search||t.selection.$search||n.find(".select2-search__field")},t.prototype.query=function(t,n,s){var i=this;n.term=n.term||"";var o=this.tokenizer(n,this.options,(function(t){var n,s=i._normalizeItem(t);i.$element.find("option").filter((function(){return e(this).val()===s.id})).length||((n=i.option(s)).attr("data-select2-tag",!0),i._removeOldTags(),i.addOptions([n])),n=s,i.trigger("select",{data:n})}));o.term!==n.term&&(this.$search.length&&(this.$search.val(o.term),this.$search.trigger("focus")),n.term=o.term),t.call(this,n,s)},t.prototype.tokenizer=function(t,n,s,i){for(var o=s.get("tokenSeparators")||[],r=n.term,a=0,l=this.createTag||function(e){return{id:e.term,text:e.term}};a<r.length;){var c=r[a];-1!==o.indexOf(c)?(c=r.substr(0,a),null!=(c=l(e.extend({},n,{term:c})))?(i(c),r=r.substr(a+1)||"",a=0):a++):a++}return{term:r}},t})),x.define("select2/data/minimumInputLength",[],(function(){function e(e,t,n){this.minimumInputLength=n.get("minimumInputLength"),e.call(this,t,n)}return e.prototype.query=function(e,t,n){t.term=t.term||"",t.term.length<this.minimumInputLength?this.trigger("results:message",{message:"inputTooShort",args:{minimum:this.minimumInputLength,input:t.term,params:t}}):e.call(this,t,n)},e})),x.define("select2/data/maximumInputLength",[],(function(){function e(e,t,n){this.maximumInputLength=n.get("maximumInputLength"),e.call(this,t,n)}return e.prototype.query=function(e,t,n){t.term=t.term||"",0<this.maximumInputLength&&t.term.length>this.maximumInputLength?this.trigger("results:message",{message:"inputTooLong",args:{maximum:this.maximumInputLength,input:t.term,params:t}}):e.call(this,t,n)},e})),x.define("select2/data/maximumSelectionLength",[],(function(){function e(e,t,n){this.maximumSelectionLength=n.get("maximumSelectionLength"),e.call(this,t,n)}return e.prototype.bind=function(e,t,n){var s=this;e.call(this,t,n),t.on("select",(function(){s._checkIfMaximumSelected()}))},e.prototype.query=function(e,t,n){var s=this;this._checkIfMaximumSelected((function(){e.call(s,t,n)}))},e.prototype._checkIfMaximumSelected=function(e,t){var n=this;this.current((function(e){e=null!=e?e.length:0,0<n.maximumSelectionLength&&e>=n.maximumSelectionLength?n.trigger("results:message",{message:"maximumSelected",args:{maximum:n.maximumSelectionLength}}):t&&t()}))},e})),x.define("select2/dropdown",["jquery","./utils"],(function(e,t){function n(e,t){this.$element=e,this.options=t,n.__super__.constructor.call(this)}return t.Extend(n,t.Observable),n.prototype.render=function(){var t=e('<span class="select2-dropdown"><span class="select2-results"></span></span>');return t.attr("dir",this.options.get("dir")),this.$dropdown=t},n.prototype.bind=function(){},n.prototype.position=function(e,t){},n.prototype.destroy=function(){this.$dropdown.remove()},n})),x.define("select2/dropdown/search",["jquery"],(function(e){function t(){}return t.prototype.render=function(t){var n=t.call(this),s=this.options.get("translations").get("search");t=e('<span class="select2-search select2-search--dropdown"><input class="select2-search__field" type="search" tabindex="-1" autocorrect="off" autocapitalize="none" spellcheck="false" role="searchbox" aria-autocomplete="list" /></span>');return this.$searchContainer=t,this.$search=t.find("input"),this.$search.prop("autocomplete",this.options.get("autocomplete")),this.$search.attr("aria-label",s()),n.prepend(t),n},t.prototype.bind=function(t,n,s){var i=this,o=n.id+"-results";t.call(this,n,s),this.$search.on("keydown",(function(e){i.trigger("keypress",e),i._keyUpPrevented=e.isDefaultPrevented()})),this.$search.on("input",(function(t){e(this).off("keyup")})),this.$search.on("keyup input",(function(e){i.handleSearch(e)})),n.on("open",(function(){i.$search.attr("tabindex",0),i.$search.attr("aria-controls",o),i.$search.trigger("focus"),window.setTimeout((function(){i.$search.trigger("focus")}),0)})),n.on("close",(function(){i.$search.attr("tabindex",-1),i.$search.removeAttr("aria-controls"),i.$search.removeAttr("aria-activedescendant"),i.$search.val(""),i.$search.trigger("blur")})),n.on("focus",(function(){n.isOpen()||i.$search.trigger("focus")})),n.on("results:all",(function(e){null!=e.query.term&&""!==e.query.term||(i.showSearch(e)?i.$searchContainer[0].classList.remove("select2-search--hide"):i.$searchContainer[0].classList.add("select2-search--hide"))})),n.on("results:focus",(function(e){e.data._resultId?i.$search.attr("aria-activedescendant",e.data._resultId):i.$search.removeAttr("aria-activedescendant")}))},t.prototype.handleSearch=function(e){var t;this._keyUpPrevented||(t=this.$search.val(),this.trigger("query",{term:t})),this._keyUpPrevented=!1},t.prototype.showSearch=function(e,t){return!0},t})),x.define("select2/dropdown/hidePlaceholder",[],(function(){function e(e,t,n,s){this.placeholder=this.normalizePlaceholder(n.get("placeholder")),e.call(this,t,n,s)}return e.prototype.append=function(e,t){t.results=this.removePlaceholder(t.results),e.call(this,t)},e.prototype.normalizePlaceholder=function(e,t){return"string"==typeof t&&(t={id:"",text:t}),t},e.prototype.removePlaceholder=function(e,t){for(var n=t.slice(0),s=t.length-1;0<=s;s--){var i=t[s];this.placeholder.id===i.id&&n.splice(s,1)}return n},e})),x.define("select2/dropdown/infiniteScroll",["jquery"],(function(e){function t(e,t,n,s){this.lastParams={},e.call(this,t,n,s),this.$loadingMore=this.createLoadingMore(),this.loading=!1}return t.prototype.append=function(e,t){this.$loadingMore.remove(),this.loading=!1,e.call(this,t),this.showLoadingMore(t)&&(this.$results.append(this.$loadingMore),this.loadMoreIfNeeded())},t.prototype.bind=function(e,t,n){var s=this;e.call(this,t,n),t.on("query",(function(e){s.lastParams=e,s.loading=!0})),t.on("query:append",(function(e){s.lastParams=e,s.loading=!0})),this.$results.on("scroll",this.loadMoreIfNeeded.bind(this))},t.prototype.loadMoreIfNeeded=function(){var t=e.contains(document.documentElement,this.$loadingMore[0]);!this.loading&&t&&(t=this.$results.offset().top+this.$results.outerHeight(!1),this.$loadingMore.offset().top+this.$loadingMore.outerHeight(!1)<=t+50&&this.loadMore())},t.prototype.loadMore=function(){this.loading=!0;var t=e.extend({},{page:1},this.lastParams);t.page++,this.trigger("query:append",t)},t.prototype.showLoadingMore=function(e,t){return t.pagination&&t.pagination.more},t.prototype.createLoadingMore=function(){var t=e('<li class="select2-results__option select2-results__option--load-more"role="option" aria-disabled="true"></li>'),n=this.options.get("translations").get("loadingMore");return t.html(n(this.lastParams)),t},t})),x.define("select2/dropdown/attachBody",["jquery","../utils"],(function(e,t){function n(t,n,s){this.$dropdownParent=e(s.get("dropdownParent")||document.body),t.call(this,n,s)}return n.prototype.bind=function(e,t,n){var s=this;e.call(this,t,n),t.on("open",(function(){s._showDropdown(),s._attachPositioningHandler(t),s._bindContainerResultHandlers(t)})),t.on("close",(function(){s._hideDropdown(),s._detachPositioningHandler(t)})),this.$dropdownContainer.on("mousedown",(function(e){e.stopPropagation()}))},n.prototype.destroy=function(e){e.call(this),this.$dropdownContainer.remove()},n.prototype.position=function(e,t,n){t.attr("class",n.attr("class")),t[0].classList.remove("select2"),t[0].classList.add("select2-container--open"),t.css({position:"absolute",top:-999999}),this.$container=n},n.prototype.render=function(t){var n=e("<span></span>");t=t.call(this);return n.append(t),this.$dropdownContainer=n},n.prototype._hideDropdown=function(e){this.$dropdownContainer.detach()},n.prototype._bindContainerResultHandlers=function(e,t){var n;this._containerResultsHandlersBound||(n=this,t.on("results:all",(function(){n._positionDropdown(),n._resizeDropdown()})),t.on("results:append",(function(){n._positionDropdown(),n._resizeDropdown()})),t.on("results:message",(function(){n._positionDropdown(),n._resizeDropdown()})),t.on("select",(function(){n._positionDropdown(),n._resizeDropdown()})),t.on("unselect",(function(){n._positionDropdown(),n._resizeDropdown()})),this._containerResultsHandlersBound=!0)},n.prototype._attachPositioningHandler=function(n,s){var i=this,o="scroll.select2."+s.id,r="resize.select2."+s.id,a="orientationchange.select2."+s.id;(s=this.$container.parents().filter(t.hasScroll)).each((function(){t.StoreData(this,"select2-scroll-position",{x:e(this).scrollLeft(),y:e(this).scrollTop()})})),s.on(o,(function(n){var s=t.GetData(this,"select2-scroll-position");e(this).scrollTop(s.y)})),e(window).on(o+" "+r+" "+a,(function(e){i._positionDropdown(),i._resizeDropdown()}))},n.prototype._detachPositioningHandler=function(n,s){var i="scroll.select2."+s.id,o="resize.select2."+s.id;s="orientationchange.select2."+s.id;this.$container.parents().filter(t.hasScroll).off(i),e(window).off(i+" "+o+" "+s)},n.prototype._positionDropdown=function(){var t=e(window),n=this.$dropdown[0].classList.contains("select2-dropdown--above"),s=this.$dropdown[0].classList.contains("select2-dropdown--below"),i=null,o=this.$container.offset();o.bottom=o.top+this.$container.outerHeight(!1);var r={height:this.$container.outerHeight(!1)};r.top=o.top,r.bottom=o.top+r.height;var a=this.$dropdown.outerHeight(!1),l=t.scrollTop(),c=t.scrollTop()+t.height(),u=l<o.top-a;t=c>o.bottom+a,l={left:o.left,top:r.bottom};"static"===(c=this.$dropdownParent).css("position")&&(c=c.offsetParent()),o={top:0,left:0},(e.contains(document.body,c[0])||c[0].isConnected)&&(o=c.offset()),l.top-=o.top,l.left-=o.left,n||s||(i="below"),t||!u||n?!u&&t&&n&&(i="below"):i="above",("above"==i||n&&"below"!==i)&&(l.top=r.top-o.top-a),null!=i&&(this.$dropdown[0].classList.remove("select2-dropdown--below"),this.$dropdown[0].classList.remove("select2-dropdown--above"),this.$dropdown[0].classList.add("select2-dropdown--"+i),this.$container[0].classList.remove("select2-container--below"),this.$container[0].classList.remove("select2-container--above"),this.$container[0].classList.add("select2-container--"+i)),this.$dropdownContainer.css(l)},n.prototype._resizeDropdown=function(){var e={width:this.$container.outerWidth(!1)+"px"};this.options.get("dropdownAutoWidth")&&(e.minWidth=e.width,e.position="relative",e.width="auto"),this.$dropdown.css(e)},n.prototype._showDropdown=function(e){this.$dropdownContainer.appendTo(this.$dropdownParent),this._positionDropdown(),this._resizeDropdown()},n})),x.define("select2/dropdown/minimumResultsForSearch",[],(function(){function e(e,t,n,s){this.minimumResultsForSearch=n.get("minimumResultsForSearch"),this.minimumResultsForSearch<0&&(this.minimumResultsForSearch=1/0),e.call(this,t,n,s)}return e.prototype.showSearch=function(e,t){return!(function e(t){for(var n=0,s=0;s<t.length;s++){var i=t[s];i.children?n+=e(i.children):n++}return n}(t.data.results)<this.minimumResultsForSearch)&&e.call(this,t)},e})),x.define("select2/dropdown/selectOnClose",["../utils"],(function(e){function t(){}return t.prototype.bind=function(e,t,n){var s=this;e.call(this,t,n),t.on("close",(function(e){s._handleSelectOnClose(e)}))},t.prototype._handleSelectOnClose=function(t,n){if(n&&null!=n.originalSelect2Event){var s=n.originalSelect2Event;if("select"===s._type||"unselect"===s._type)return}(s=this.getHighlightedResults()).length<1||null!=(s=e.GetData(s[0],"data")).element&&s.element.selected||null==s.element&&s.selected||this.trigger("select",{data:s})},t})),x.define("select2/dropdown/closeOnSelect",[],(function(){function e(){}return e.prototype.bind=function(e,t,n){var s=this;e.call(this,t,n),t.on("select",(function(e){s._selectTriggered(e)})),t.on("unselect",(function(e){s._selectTriggered(e)}))},e.prototype._selectTriggered=function(e,t){var n=t.originalEvent;n&&(n.ctrlKey||n.metaKey)||this.trigger("close",{originalEvent:n,originalSelect2Event:t})},e})),x.define("select2/dropdown/dropdownCss",["../utils"],(function(e){function t(){}return t.prototype.render=function(t){var n=t.call(this);return-1!==(t=this.options.get("dropdownCssClass")||"").indexOf(":all:")&&(t=t.replace(":all:",""),e.copyNonInternalCssClasses(n[0],this.$element[0])),n.addClass(t),n},t})),x.define("select2/dropdown/tagsSearchHighlight",["../utils"],(function(e){function t(){}return t.prototype.highlightFirstItem=function(t){if(0<(n=this.$results.find(".select2-results__option--selectable:not(.select2-results__option--selected)")).length){var n,s=n.first();if((n=e.GetData(s[0],"data").element)&&n.getAttribute&&"true"===n.getAttribute("data-select2-tag"))return void s.trigger("mouseenter")}t.call(this)},t})),x.define("select2/i18n/en",[],(function(){return{errorLoading:function(){return"The results could not be loaded."},inputTooLong:function(e){var t=e.input.length-e.maximum;e="Please delete "+t+" character";return 1!=t&&(e+="s"),e},inputTooShort:function(e){return"Please enter "+(e.minimum-e.input.length)+" or more characters"},loadingMore:function(){return"Loading more results…"},maximumSelected:function(e){var t="You can only select "+e.maximum+" item";return 1!=e.maximum&&(t+="s"),t},noResults:function(){return"No results found"},searching:function(){return"Searching…"},removeAllItems:function(){return"Remove all items"},removeItem:function(){return"Remove item"},search:function(){return"Search"}}})),x.define("select2/defaults",["jquery","./results","./selection/single","./selection/multiple","./selection/placeholder","./selection/allowClear","./selection/search","./selection/selectionCss","./selection/eventRelay","./utils","./translation","./diacritics","./data/select","./data/array","./data/ajax","./data/tags","./data/tokenizer","./data/minimumInputLength","./data/maximumInputLength","./data/maximumSelectionLength","./dropdown","./dropdown/search","./dropdown/hidePlaceholder","./dropdown/infiniteScroll","./dropdown/attachBody","./dropdown/minimumResultsForSearch","./dropdown/selectOnClose","./dropdown/closeOnSelect","./dropdown/dropdownCss","./dropdown/tagsSearchHighlight","./i18n/en"],(function(e,t,n,s,i,o,r,a,l,c,u,d,p,h,f,g,m,v,y,_,b,w,$,x,A,D,S,O,L,E,C){function T(){this.reset()}return T.prototype.apply=function(u){var d;null==(u=e.extend(!0,{},this.defaults,u)).dataAdapter&&(null!=u.ajax?u.dataAdapter=f:null!=u.data?u.dataAdapter=h:u.dataAdapter=p,0<u.minimumInputLength&&(u.dataAdapter=c.Decorate(u.dataAdapter,v)),0<u.maximumInputLength&&(u.dataAdapter=c.Decorate(u.dataAdapter,y)),0<u.maximumSelectionLength&&(u.dataAdapter=c.Decorate(u.dataAdapter,_)),u.tags&&(u.dataAdapter=c.Decorate(u.dataAdapter,g)),null==u.tokenSeparators&&null==u.tokenizer||(u.dataAdapter=c.Decorate(u.dataAdapter,m))),null==u.resultsAdapter&&(u.resultsAdapter=t,null!=u.ajax&&(u.resultsAdapter=c.Decorate(u.resultsAdapter,x)),null!=u.placeholder&&(u.resultsAdapter=c.Decorate(u.resultsAdapter,$)),u.selectOnClose&&(u.resultsAdapter=c.Decorate(u.resultsAdapter,S)),u.tags&&(u.resultsAdapter=c.Decorate(u.resultsAdapter,E))),null==u.dropdownAdapter&&(u.multiple?u.dropdownAdapter=b:(d=c.Decorate(b,w),u.dropdownAdapter=d),0!==u.minimumResultsForSearch&&(u.dropdownAdapter=c.Decorate(u.dropdownAdapter,D)),u.closeOnSelect&&(u.dropdownAdapter=c.Decorate(u.dropdownAdapter,O)),null!=u.dropdownCssClass&&(u.dropdownAdapter=c.Decorate(u.dropdownAdapter,L)),u.dropdownAdapter=c.Decorate(u.dropdownAdapter,A)),null==u.selectionAdapter&&(u.multiple?u.selectionAdapter=s:u.selectionAdapter=n,null!=u.placeholder&&(u.selectionAdapter=c.Decorate(u.selectionAdapter,i)),u.allowClear&&(u.selectionAdapter=c.Decorate(u.selectionAdapter,o)),u.multiple&&(u.selectionAdapter=c.Decorate(u.selectionAdapter,r)),null!=u.selectionCssClass&&(u.selectionAdapter=c.Decorate(u.selectionAdapter,a)),u.selectionAdapter=c.Decorate(u.selectionAdapter,l)),u.language=this._resolveLanguage(u.language),u.language.push("en");for(var C=[],T=0;T<u.language.length;T++){var q=u.language[T];-1===C.indexOf(q)&&C.push(q)}return u.language=C,u.translations=this._processTranslations(u.language,u.debug),u},T.prototype.reset=function(){function t(e){return e.replace(/[^\u0000-\u007E]/g,(function(e){return d[e]||e}))}this.defaults={amdLanguageBase:"./i18n/",autocomplete:"off",closeOnSelect:!0,debug:!1,dropdownAutoWidth:!1,escapeMarkup:c.escapeMarkup,language:{},matcher:function n(s,i){if(null==s.term||""===s.term.trim())return i;if(i.children&&0<i.children.length){for(var o=e.extend(!0,{},i),r=i.children.length-1;0<=r;r--)null==n(s,i.children[r])&&o.children.splice(r,1);return 0<o.children.length?o:n(s,o)}var a=t(i.text).toUpperCase(),l=t(s.term).toUpperCase();return-1<a.indexOf(l)?i:null},minimumInputLength:0,maximumInputLength:0,maximumSelectionLength:0,minimumResultsForSearch:0,selectOnClose:!1,scrollAfterSelect:!1,sorter:function(e){return e},templateResult:function(e){return e.text},templateSelection:function(e){return e.text},theme:"default",width:"resolve"}},T.prototype.applyFromElement=function(e,t){var n=e.language,s=this.defaults.language,i=t.prop("lang");t=t.closest("[lang]").prop("lang"),t=Array.prototype.concat.call(this._resolveLanguage(i),this._resolveLanguage(n),this._resolveLanguage(s),this._resolveLanguage(t));return e.language=t,e},T.prototype._resolveLanguage=function(t){if(!t)return[];if(e.isEmptyObject(t))return[];if(e.isPlainObject(t))return[t];for(var n,s=Array.isArray(t)?t:[t],i=[],o=0;o<s.length;o++)i.push(s[o]),"string"==typeof s[o]&&0<s[o].indexOf("-")&&(n=s[o].split("-")[0],i.push(n));return i},T.prototype._processTranslations=function(t,n){for(var s=new u,i=0;i<t.length;i++){var o=new u,r=t[i];if("string"==typeof r)try{o=u.loadPath(r)}catch(t){try{r=this.defaults.amdLanguageBase+r,o=u.loadPath(r)}catch(t){n&&window.console&&console.warn&&console.warn('Select2: The language file for "'+r+'" could not be automatically loaded. A fallback will be used instead.')}}else o=e.isPlainObject(r)?new u(r):r;s.extend(o)}return s},T.prototype.set=function(t,n){var s={};s[e.camelCase(t)]=n,s=c._convertData(s),e.extend(!0,this.defaults,s)},new T})),x.define("select2/options",["jquery","./defaults","./utils"],(function(e,t,n){function s(e,n){this.options=e,null!=n&&this.fromElement(n),null!=n&&(this.options=t.applyFromElement(this.options,n)),this.options=t.apply(this.options)}return s.prototype.fromElement=function(t){var s=["select2"];null==this.options.multiple&&(this.options.multiple=t.prop("multiple")),null==this.options.disabled&&(this.options.disabled=t.prop("disabled")),null==this.options.autocomplete&&t.prop("autocomplete")&&(this.options.autocomplete=t.prop("autocomplete")),null==this.options.dir&&(t.prop("dir")?this.options.dir=t.prop("dir"):t.closest("[dir]").prop("dir")?this.options.dir=t.closest("[dir]").prop("dir"):this.options.dir="ltr"),t.prop("disabled",this.options.disabled),t.prop("multiple",this.options.multiple),n.GetData(t[0],"select2Tags")&&(this.options.debug&&window.console&&console.warn&&console.warn('Select2: The `data-select2-tags` attribute has been changed to use the `data-data` and `data-tags="true"` attributes and will be removed in future versions of Select2.'),n.StoreData(t[0],"data",n.GetData(t[0],"select2Tags")),n.StoreData(t[0],"tags",!0)),n.GetData(t[0],"ajaxUrl")&&(this.options.debug&&window.console&&console.warn&&console.warn("Select2: The `data-ajax-url` attribute has been changed to `data-ajax--url` and support for the old attribute will be removed in future versions of Select2."),t.attr("ajax--url",n.GetData(t[0],"ajaxUrl")),n.StoreData(t[0],"ajax-Url",n.GetData(t[0],"ajaxUrl")));var i={};function o(e,t){return t.toUpperCase()}for(var r=0;r<t[0].attributes.length;r++){var a=t[0].attributes[r].name,l="data-";a.substr(0,l.length)==l&&(a=a.substring(l.length),l=n.GetData(t[0],a),i[a.replace(/-([a-z])/g,o)]=l)}e.fn.jquery&&"1."==e.fn.jquery.substr(0,2)&&t[0].dataset&&(i=e.extend(!0,{},t[0].dataset,i));var c,u=e.extend(!0,{},n.GetData(t[0]),i);for(c in u=n._convertData(u))-1<s.indexOf(c)||(e.isPlainObject(this.options[c])?e.extend(this.options[c],u[c]):this.options[c]=u[c]);return this},s.prototype.get=function(e){return this.options[e]},s.prototype.set=function(e,t){this.options[e]=t},s})),x.define("select2/core",["jquery","./options","./utils","./keys"],(function(e,t,n,s){var i=function(e,s){null!=n.GetData(e[0],"select2")&&n.GetData(e[0],"select2").destroy(),this.$element=e,this.id=this._generateId(e),s=s||{},this.options=new t(s,e),i.__super__.constructor.call(this);var o=e.attr("tabindex")||0;n.StoreData(e[0],"old-tabindex",o),e.attr("tabindex","-1"),s=this.options.get("dataAdapter"),this.dataAdapter=new s(e,this.options),o=this.render(),this._placeContainer(o),s=this.options.get("selectionAdapter"),this.selection=new s(e,this.options),this.$selection=this.selection.render(),this.selection.position(this.$selection,o),s=this.options.get("dropdownAdapter"),this.dropdown=new s(e,this.options),this.$dropdown=this.dropdown.render(),this.dropdown.position(this.$dropdown,o),o=this.options.get("resultsAdapter"),this.results=new o(e,this.options,this.dataAdapter),this.$results=this.results.render(),this.results.position(this.$results,this.$dropdown);var r=this;this._bindAdapters(),this._registerDomEvents(),this._registerDataEvents(),this._registerSelectionEvents(),this._registerDropdownEvents(),this._registerResultsEvents(),this._registerEvents(),this.dataAdapter.current((function(e){r.trigger("selection:update",{data:e})})),e[0].classList.add("select2-hidden-accessible"),e.attr("aria-hidden","true"),this._syncAttributes(),n.StoreData(e[0],"select2",this),e.data("select2",this)};return n.Extend(i,n.Observable),i.prototype._generateId=function(e){return"select2-"+(null!=e.attr("id")?e.attr("id"):null!=e.attr("name")?e.attr("name")+"-"+n.generateChars(2):n.generateChars(4)).replace(/(:|\.|\[|\]|,)/g,"")},i.prototype._placeContainer=function(e){e.insertAfter(this.$element);var t=this._resolveWidth(this.$element,this.options.get("width"));null!=t&&e.css("width",t)},i.prototype._resolveWidth=function(e,t){var n=/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i;if("resolve"==t){var s=this._resolveWidth(e,"style");return null!=s?s:this._resolveWidth(e,"element")}if("element"==t)return(s=e.outerWidth(!1))<=0?"auto":s+"px";if("style"!=t)return"computedstyle"!=t?t:window.getComputedStyle(e[0]).width;if("string"!=typeof(e=e.attr("style")))return null;for(var i=e.split(";"),o=0,r=i.length;o<r;o+=1){var a=i[o].replace(/\s/g,"").match(n);if(null!==a&&1<=a.length)return a[1]}return null},i.prototype._bindAdapters=function(){this.dataAdapter.bind(this,this.$container),this.selection.bind(this,this.$container),this.dropdown.bind(this,this.$container),this.results.bind(this,this.$container)},i.prototype._registerDomEvents=function(){var e=this;this.$element.on("change.select2",(function(){e.dataAdapter.current((function(t){e.trigger("selection:update",{data:t})}))})),this.$element.on("focus.select2",(function(t){e.trigger("focus",t)})),this._syncA=n.bind(this._syncAttributes,this),this._syncS=n.bind(this._syncSubtree,this),this._observer=new window.MutationObserver((function(t){e._syncA(),e._syncS(t)})),this._observer.observe(this.$element[0],{attributes:!0,childList:!0,subtree:!1})},i.prototype._registerDataEvents=function(){var e=this;this.dataAdapter.on("*",(function(t,n){e.trigger(t,n)}))},i.prototype._registerSelectionEvents=function(){var e=this,t=["toggle","focus"];this.selection.on("toggle",(function(){e.toggleDropdown()})),this.selection.on("focus",(function(t){e.focus(t)})),this.selection.on("*",(function(n,s){-1===t.indexOf(n)&&e.trigger(n,s)}))},i.prototype._registerDropdownEvents=function(){var e=this;this.dropdown.on("*",(function(t,n){e.trigger(t,n)}))},i.prototype._registerResultsEvents=function(){var e=this;this.results.on("*",(function(t,n){e.trigger(t,n)}))},i.prototype._registerEvents=function(){var e=this;this.on("open",(function(){e.$container[0].classList.add("select2-container--open")})),this.on("close",(function(){e.$container[0].classList.remove("select2-container--open")})),this.on("enable",(function(){e.$container[0].classList.remove("select2-container--disabled")})),this.on("disable",(function(){e.$container[0].classList.add("select2-container--disabled")})),this.on("blur",(function(){e.$container[0].classList.remove("select2-container--focus")})),this.on("query",(function(t){e.isOpen()||e.trigger("open",{}),this.dataAdapter.query(t,(function(n){e.trigger("results:all",{data:n,query:t})}))})),this.on("query:append",(function(t){this.dataAdapter.query(t,(function(n){e.trigger("results:append",{data:n,query:t})}))})),this.on("keypress",(function(t){var n=t.which;e.isOpen()?n===s.ESC||n===s.UP&&t.altKey?(e.close(t),t.preventDefault()):n===s.ENTER||n===s.TAB?(e.trigger("results:select",{}),t.preventDefault()):n===s.SPACE&&t.ctrlKey?(e.trigger("results:toggle",{}),t.preventDefault()):n===s.UP?(e.trigger("results:previous",{}),t.preventDefault()):n===s.DOWN&&(e.trigger("results:next",{}),t.preventDefault()):(n===s.ENTER||n===s.SPACE||n===s.DOWN&&t.altKey)&&(e.open(),t.preventDefault())}))},i.prototype._syncAttributes=function(){this.options.set("disabled",this.$element.prop("disabled")),this.isDisabled()?(this.isOpen()&&this.close(),this.trigger("disable",{})):this.trigger("enable",{})},i.prototype._isChangeMutation=function(e){var t=this;if(e.addedNodes&&0<e.addedNodes.length){for(var n=0;n<e.addedNodes.length;n++)if(e.addedNodes[n].selected)return!0}else{if(e.removedNodes&&0<e.removedNodes.length)return!0;if(Array.isArray(e))return e.some((function(e){return t._isChangeMutation(e)}))}return!1},i.prototype._syncSubtree=function(e){e=this._isChangeMutation(e);var t=this;e&&this.dataAdapter.current((function(e){t.trigger("selection:update",{data:e})}))},i.prototype.trigger=function(e,t){var n=i.__super__.trigger;if(void 0===t&&(t={}),e in(o={open:"opening",close:"closing",select:"selecting",unselect:"unselecting",clear:"clearing"})){var s=o[e],o={prevented:!1,name:e,args:t};if(n.call(this,s,o),o.prevented)return void(t.prevented=!0)}n.call(this,e,t)},i.prototype.toggleDropdown=function(){this.isDisabled()||(this.isOpen()?this.close():this.open())},i.prototype.open=function(){this.isOpen()||this.isDisabled()||this.trigger("query",{})},i.prototype.close=function(e){this.isOpen()&&this.trigger("close",{originalEvent:e})},i.prototype.isEnabled=function(){return!this.isDisabled()},i.prototype.isDisabled=function(){return this.options.get("disabled")},i.prototype.isOpen=function(){return this.$container[0].classList.contains("select2-container--open")},i.prototype.hasFocus=function(){return this.$container[0].classList.contains("select2-container--focus")},i.prototype.focus=function(e){this.hasFocus()||(this.$container[0].classList.add("select2-container--focus"),this.trigger("focus",{}))},i.prototype.enable=function(e){this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("enable")` method has been deprecated and will be removed in later Select2 versions. Use $element.prop("disabled") instead.'),null!=e&&0!==e.length||(e=[!0]),e=!e[0],this.$element.prop("disabled",e)},i.prototype.data=function(){this.options.get("debug")&&0<arguments.length&&window.console&&console.warn&&console.warn('Select2: Data can no longer be set using `select2("data")`. You should consider setting the value instead using `$element.val()`.');var e=[];return this.dataAdapter.current((function(t){e=t})),e},i.prototype.val=function(e){if(this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("val")` method has been deprecated and will be removed in later Select2 versions. Use $element.val() instead.'),null==e||0===e.length)return this.$element.val();e=e[0],Array.isArray(e)&&(e=e.map((function(e){return e.toString()}))),this.$element.val(e).trigger("input").trigger("change")},i.prototype.destroy=function(){n.RemoveData(this.$container[0]),this.$container.remove(),this._observer.disconnect(),this._observer=null,this._syncA=null,this._syncS=null,this.$element.off(".select2"),this.$element.attr("tabindex",n.GetData(this.$element[0],"old-tabindex")),this.$element[0].classList.remove("select2-hidden-accessible"),this.$element.attr("aria-hidden","false"),n.RemoveData(this.$element[0]),this.$element.removeData("select2"),this.dataAdapter.destroy(),this.selection.destroy(),this.dropdown.destroy(),this.results.destroy(),this.dataAdapter=null,this.selection=null,this.dropdown=null,this.results=null},i.prototype.render=function(){var t=e('<span class="select2 select2-container"><span class="selection"></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>');return t.attr("dir",this.options.get("dir")),this.$container=t,this.$container[0].classList.add("select2-container--"+this.options.get("theme")),n.StoreData(t[0],"element",this.$element),t},i})),x.define("select2/dropdown/attachContainer",[],(function(){function e(e,t,n){e.call(this,t,n)}return e.prototype.position=function(e,t,n){n.find(".dropdown-wrapper").append(t),t[0].classList.add("select2-dropdown--below"),n[0].classList.add("select2-container--below")},e})),x.define("select2/dropdown/stopPropagation",[],(function(){function e(){}return e.prototype.bind=function(e,t,n){e.call(this,t,n),this.$dropdown.on(["blur","change","click","dblclick","focus","focusin","focusout","input","keydown","keyup","keypress","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseup","search","touchend","touchstart"].join(" "),(function(e){e.stopPropagation()}))},e})),x.define("select2/selection/stopPropagation",[],(function(){function e(){}return e.prototype.bind=function(e,t,n){e.call(this,t,n),this.$selection.on(["blur","change","click","dblclick","focus","focusin","focusout","input","keydown","keyup","keypress","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseup","search","touchend","touchstart"].join(" "),(function(e){e.stopPropagation()}))},e})),g=function(e){var t,n,s=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],i="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],o=Array.prototype.slice;if(e.event.fixHooks)for(var r=s.length;r;)e.event.fixHooks[s[--r]]=e.event.mouseHooks;var a=e.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var t=i.length;t;)this.addEventListener(i[--t],l,!1);else this.onmousewheel=l;e.data(this,"mousewheel-line-height",a.getLineHeight(this)),e.data(this,"mousewheel-page-height",a.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=i.length;t;)this.removeEventListener(i[--t],l,!1);else this.onmousewheel=null;e.removeData(this,"mousewheel-line-height"),e.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var n=e(t);return(t=n["offsetParent"in e.fn?"offsetParent":"parent"]()).length||(t=e("body")),parseInt(t.css("fontSize"),10)||parseInt(n.css("fontSize"),10)||16},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};function l(s){var i,r=s||window.event,l=o.call(arguments,1),d=0,p=0,h=0,f=0,g=0,m=0;if((s=e.event.fix(r)).type="mousewheel","detail"in r&&(h=-1*r.detail),"wheelDelta"in r&&(h=r.wheelDelta),"wheelDeltaY"in r&&(h=r.wheelDeltaY),"wheelDeltaX"in r&&(p=-1*r.wheelDeltaX),"axis"in r&&r.axis===r.HORIZONTAL_AXIS&&(p=-1*h,h=0),d=0===h?p:h,"deltaY"in r&&(d=h=-1*r.deltaY),"deltaX"in r&&(p=r.deltaX,0===h&&(d=-1*p)),0!==h||0!==p)return 1===r.deltaMode?(d*=i=e.data(this,"mousewheel-line-height"),h*=i,p*=i):2===r.deltaMode&&(d*=i=e.data(this,"mousewheel-page-height"),h*=i,p*=i),f=Math.max(Math.abs(h),Math.abs(p)),(!n||f<n)&&u(r,n=f)&&(n/=40),u(r,f)&&(d/=40,p/=40,h/=40),d=Math[1<=d?"floor":"ceil"](d/n),p=Math[1<=p?"floor":"ceil"](p/n),h=Math[1<=h?"floor":"ceil"](h/n),a.settings.normalizeOffset&&this.getBoundingClientRect&&(f=this.getBoundingClientRect(),g=s.clientX-f.left,m=s.clientY-f.top),s.deltaX=p,s.deltaY=h,s.deltaFactor=n,s.offsetX=g,s.offsetY=m,s.deltaMode=0,l.unshift(s,d,p,h),t&&clearTimeout(t),t=setTimeout(c,200),(e.event.dispatch||e.event.handle).apply(this,l)}function c(){n=null}function u(e,t){return a.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})},"function"==typeof x.define&&x.define.amd?x.define("jquery-mousewheel",["jquery"],g):"object"==typeof exports?module.exports=g:g(e),x.define("jquery.select2",["jquery","jquery-mousewheel","./select2/core","./select2/defaults","./select2/utils"],(function(e,t,n,s,i){var o;return null==e.fn.select2&&(o=["open","close","destroy"],e.fn.select2=function(t){if("object"==typeof(t=t||{}))return this.each((function(){var s=e.extend(!0,{},t);new n(e(this),s)})),this;if("string"!=typeof t)throw new Error("Invalid arguments for Select2: "+t);var s,r=Array.prototype.slice.call(arguments,1);return this.each((function(){var e=i.GetData(this,"select2");null==e&&window.console&&console.error&&console.error("The select2('"+t+"') method was called on an element that is not using Select2."),s=e[t].apply(e,r)})),-1<o.indexOf(t)?this:s}),null==e.fn.select2.defaults&&(e.fn.select2.defaults=s),n})),{define:x.define,require:x.require})).require("jquery.select2");return e.fn.select2.amd=g,x}));</script>
<script type="text/html" data-template-name="ha-api"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name">Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server">Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-protocol">Protocol</label> <select type="text" id="node-input-protocol" style="width:70%"><option value="websocket">WebSocket</option><option value="http">HTTP</option></select></div><div class="form-row http"><label for="node-input-method">Method</label> <select type="text" id="node-input-method" style="width:70%"><option value="get">GET</option><option value="post">POST</option></select></div><div class="form-row http"><label for="node-input-path">Path</label> <input type="text" id="node-input-path" placeholder="config"></div><div class="form-row"><label id="data-label" for="node-input-data">Data</label> <input type="text" id="node-input-data" style="width:70%"> <input type="hidden" id="node-input-dataType"></div><div class="form-row"><ol id="custom-outputs"></ol></div><div class="form-row http"><label for="node-input-responseType">Return</label> <select id="node-input-responseType" style="width:70%"><option value="text">a UTF-8 string</option><option value="arraybuffer">a binary buffer</option><option value="json">a parsed JSON object</option></select></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-debugenabled"> <label for="node-input-debugenabled">Show Debug Information</label></div></script>
<script type="text/html" data-template-name="api-call-service"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-dot-circle-o"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="service_domain"><i class="fa fa-cube"></i> Domain</label> <input type="text" id="service_domain"></div><div class="form-row"><label for="service"><i class="fa fa-cube"></i> Service</label> <input type="text" id="service"></div><div class="form-row"><label for="node-input-entityId"><i class="fa fa-cube"></i> Entity Id</label> <input type="text" id="node-input-entityId"></div><div class="form-row"><label for="node-input-data"><i class="fa fa-dot-circle-o"></i> Data</label> <input type="text" id="node-input-data" style="width:70%"> <input type="hidden" id="node-input-dataType"></div><div class="form-row checkbox-option" id="mustacheAltTags"><input type="checkbox" id="node-input-mustacheAltTags">&nbsp; <label for="node-input-mustacheAltTags">Use alternative template tags for the Data field</label></div><div class="form-row"><label for="node-input-mergecontext">Merge Context</label> <input type="text" id="node-input-mergecontext" placeholder="lightOptions"></div><div class="form-row"><ol id="custom-outputs"></ol></div><div class="form-row"><label for="node-input-queue"><i class="fa fa-stack-exchange"></i> <span data-i18n="api-call-service.label.queue"></span></label> <select type="text" id="node-input-queue" style="width:auto"><option value="none" data-i18n="api-call-service.label.queue_none"></option><option value="first" data-i18n="api-call-service.label.queue_first"></option><option value="all" data-i18n="api-call-service.label.queue_all"></option><option value="last" data-i18n="api-call-service.label.queue_last"></option></select></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-debugenabled"> <label for="node-input-debugenabled">Show Debug Information</label></div><div id="service-data-desc" class="form-row"><button id="example-data" style="float:right" class="red-ui-button red-ui-button-small">Load Example Data</button><h4>Service: <span class="title"></span></h4><div class="unknown-service">Unknown Service</div><div class="known-service"><p class="service-description"></p><table id="service-data-table" class="red-ui-info-table"><thead><tr><th>Property</th><th>Desc</th><th>Example</th></tr></thead><tbody></tbody></table></div></div></script>
<script type="text/javascript">var haMigrations=function(){"use strict";const e={"ha-api":[{version:0,up:e=>({...e,version:0})},{version:1,up:e=>{const t={...e,version:1,outputProperties:[],location:void 0,locationType:void 0};return"none"!==e.locationType&&(t.outputProperties=[{property:e.location,propertyType:e.locationType,value:"",valueType:"results"}]),t}}],"api-call-service":[{version:0,up:e=>({...e,version:0})},{version:1,up:e=>{const t={...e,version:1};try{const o=JSON.parse(e.data);o.entity_id?(t.entityId=o.entity_id,delete o.entity_id,t.data=Object.keys(o).length?JSON.stringify(o):""):t.entityId=""}catch(e){}return t}},{version:2,up:e=>{const t={...e,version:2,outputProperties:[]};return"none"!==e.output_location_type&&(t.outputProperties=[{property:e.output_location,propertyType:e.output_location_type,value:"",valueType:"data"}]),t}},{version:3,up:e=>({...e,version:3,queue:"none"})}],server:[{version:0,up:e=>({...e,version:0})},{version:1,up:e=>({...e,version:1,ha_boolean:e.ha_boolean||"y|yes|true|on|home|open",rejectUnauthorizedCerts:void 0===e.rejectUnauthorizedCerts||e.rejectUnauthorizedCerts,connectionDelay:void 0===e.connectionDelay||e.connectionDelay,cacheJson:void 0===e.cacheJson||e.cacheJson})}],"api-current-state":[{version:0,up:e=>({...e,version:0})},{version:1,up:e=>({...e,version:1,blockInputOverrides:!1,entity_location:"data",halt_if_compare:"is",override_payload:!1===e.override_payload?"none":"msg",override_data:!1===e.override_data?"none":"msg",state_location:"payload",state_type:"str"})},{version:2,up:e=>{const t={...e,version:2,outputProperties:[],state_location:void 0,override_payload:void 0,entity_location:void 0,override_data:void 0,override_topic:void 0};return"none"!==e.override_payload&&t.outputProperties.push({property:e.state_location,propertyType:e.override_payload,value:"",valueType:"entityState"}),"none"!==e.override_data&&t.outputProperties.push({property:e.entity_location,propertyType:e.override_data,value:"",valueType:"entity"}),!0===e.override_topic&&t.outputProperties.push({property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}),t}}],"ha-device":[{version:0,up:e=>({...e,version:0})}],"ha-entity":[{version:0,up:e=>({...e,version:0})},{version:1,up:e=>({...e,version:1,inputOverride:"allow"})}],"server-events":[{version:0,up:e=>({...e,version:0,waitForRunning:void 0===e.waitForRunning||e.waitForRunning})},{version:1,up:e=>({...e,version:1,outputProperties:[{property:"payload",propertyType:"msg",value:"",valueType:"eventData"},{property:"topic",propertyType:"msg",value:'$outputData("eventData").event_type',valueType:"jsonata"},{property:"event_type",propertyType:"msg",value:'$outputData("eventData").event_type',valueType:"jsonata"}]})}],"server-state-changed":[{version:0,up:e=>({...e,version:0,state_type:void 0!==e.state_type?e.state_type:"str",halt_if_type:void 0!==e.halt_if_type?e.halt_if_type:"str",halt_if_compare:void 0!==e.halt_if_compare?e.halt_if_compare:"is"})},{version:1,up:e=>({...e,version:1,ignorePrevStateNull:!1,ignorePrevStateUnknown:!1,ignorePrevStateUnavailable:!1,ignoreCurrentStateUnknown:!1,ignoreCurrentStateUnavailable:!1})},{version:2,up:e=>({...e,version:2,for:void 0!==e.for?e.for:"0",forType:e.forType||"num",forUnits:e.forUnits||"minutes"})},{version:3,up:e=>({...e,version:3,outputProperties:[{property:"payload",propertyType:"msg",value:"",valueType:"entityState"},{property:"data",propertyType:"msg",value:"",valueType:"eventData"},{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}]})}],"ha-fire-event":[{version:0,up:e=>({...e,version:0})}],"ha-get-entities":[{version:0,up:e=>({...e,version:0})}],"api-get-history":[{version:0,up:e=>{const t={...e,version:0,output_type:void 0===e.output_type?"array":e.output_type};return void 0===t.output_location&&(t.output_location="payload",t.output_location_type="msg"),t}}],"poll-state":[{version:0,up:e=>({...e,version:0})},{version:1,up:e=>({...e,version:1,state_type:"str",halt_if_type:"str",halt_if_compare:"is",updateIntervalUnits:"seconds"})}],"api-render-template":[{version:0,up:e=>{const t={...e,version:0};return void 0===t.templateLocationType&&(t.templateLocation="template",t.templateLocationType="msg"),void 0===t.resultsLocationType&&(t.resultsLocation="payload",t.resultsLocationType="msg"),t}}],"trigger-state":[{version:0,up:e=>({...e,version:0})}],"ha-tag":[{version:0,up:e=>({...e,version:0})}],"ha-time":[{version:0,up:e=>({...e,version:0})}],"ha-wait-until":[{version:0,up:e=>{const t={...e,version:0,entityIdFilterType:e.entityIdFilterType||"exact",timeoutType:e.timeoutType||"num"};return void 0===t.blockInputOverrides&&(t.blockInputOverrides=!0),void 0===t.checkCurrentState&&(t.checkCurrentState=!1),t}}],"ha-webhook":[{version:0,up:e=>({...e,version:0})},{version:1,up:e=>{const t={...e,version:1,outputProperties:[{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}],payloadLocation:void 0,payloadLocationType:void 0,headersLocation:void 0,headersLocationType:void 0};return"none"!==e.payloadLocationType&&t.outputProperties.push({property:e.payloadLocation,propertyType:e.payloadLocationType,value:"",valueType:"data"}),"none"!==e.headersLocationType&&t.outputProperties.push({property:e.headersLocation,propertyType:e.headersLocationType,value:"",valueType:"headers"}),t}}],"ha-zone":[{version:0,up:e=>({...e,version:0})}]};function t(t){return e[t]}function o(e){return(t(e)||[]).reduce(((e,t)=>t.version>e?t.version:e),0)}var r={getCurrentVersion:o,migrate:function e(r){const i=o(r.type);return void 0!==r.version&&r.version>=i?r:e((0,function(e,o=-1){const r=t(e);return r.find((e=>e.version===Number(o)+1))}(r.type,r.version).up)(r))}};const{migrate:i,getCurrentVersion:n}=r;return{getCurrentVersion:n,migrate:i}}();</script>
<style>#version-update{margin-bottom:1em;padding:.5em}#version-update p{margin:0}#version-update strong{padding-right:5px}#version-update a,#version-update a:hover{color:#555}.form-row.checkbox-option input{display:inline-block;margin-left:105px;margin-right:5px;vertical-align:top;width:auto}.form-row.checkbox-option label{width:auto}.form-row.checkbox-option-left input{display:inline-block;margin-right:5px;vertical-align:top;width:auto}.form-row.checkbox-option-left label{margin-right:20px;width:auto}.form-row.add-spacer{border-bottom:1px solid #c6c6c6}.form-row label{text-transform:capitalize}.editable-list-row{margin-bottom:4px}#constraint-list{min-width:446px}#constraint-list input{width:65%}#output-list input{width:62%}#clearIfState{margin-left:2px;position:absolute}.ha-node-label-legacy{fill:#fdfd96;stroke-width:0;font-size:14px;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}li span.property-type{color:#666;float:right;font-family:Helvetica Neue,Arial,Helvetica,sans-serif;font-size:11px;font-style:italic}.ha-alert-box,.ha-alpha-box,.ha-beta-box{border-radius:4px;margin-bottom:10px;padding:10px}.ha-alpha-box{background-color:#e78bb9;color:#702323}.ha-beta-box{background-color:#7d7;color:#853e3d}.custom-block .custom-block-title{font-weight:600}.custom-block.danger,.custom-block.tip,.custom-block.warning{border-left-style:solid;border-left-width:.5rem;margin:1rem 0;padding:.1rem 1.5rem}.custom-block.tip{background-color:#f3f5f7;border-color:#42b983;color:#2c3e50}.custom-block.tip a{color:#3eaf7c}.custom-block.warning{background-color:#fff6c6;border-color:#e7c000;color:#6b5900}.custom-block.warning .custom-block-title{color:#b29400}.custom-block.warning a{color:#2c3e50}.custom-block.danger{background-color:#ffe6e6;border-color:#c00;color:#4d0000}.custom-block.danger .custom-block-title{color:#900}.custom-block.danger a{color:#2c3e50}.button-box div.text-box{display:inline-block;height:20px;position:relative;width:70%}.button-box div.text-box div{left:0;position:absolute;right:40px}.button-box div.text-box div input{width:100%}.button-box div.text-box a{position:absolute;right:0;top:0}.badge{border-radius:3px;color:#fff;display:inline-block;font-size:12px;height:16px;line-height:16px;padding:0 6px}.badge,.badge.green,.badge.tip{background-color:#42b983}.badge.error{background-color:#da5961}.badge.warn,.badge.warning,.badge.yellow{background-color:#e7c000}.badge+.badge{margin-left:5px}#upgrade-ha-node{background:#41bdf5;border:0;color:#eee;display:inline-block;font-size:14px;line-height:22px;margin:0;padding:4px 12px;text-decoration:none}.ui-menu-item-wrapper .sublabel{color:#9c9c9c;font-size:smaller;margin:4px 0}</style>
<script type="text/html" data-template-name="server"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-config-input-name" style="width:120px"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-config-input-name"></div><div class="form-row"><input type="checkbox" id="node-config-input-addon" style="width:auto;margin-left:125px;vertical-align:top"> <label for="node-config-input-addon" style="width:auto">I use the Home Assistant Add-on</label></div><div class="form-row addon"><input type="checkbox" id="node-config-input-connectionDelay" style="width:auto;margin-left:125px;vertical-align:top"> <label for="node-config-input-connectionDelay" style="width:auto">Delay connection attempts</label></div><div id="server-info"><div class="form-row button-box"><label for="node-config-input-host" style="width:124px"><i class="fa fa-link"></i> Base URL</label><div class="text-box"><div><input type="text" id="node-config-input-host" placeholder="http://localhost:8123"></div><a id="discoverInstances" class="red-ui-button"><i class="fa fa-search"></i></a></div></div><div class="form-row"><label id="access-token-label" for="node-config-input-access_token" style="width:120px"><i class="fa fa-user-secret"></i> Access Token</label> <input type="text" id="node-config-input-access_token" placeholder="access token"></div><div class="form-row"><input type="checkbox" id="node-config-input-legacy" style="width:auto;margin-left:125px;vertical-align:top"> <label for="node-config-input-legacy" style="width:auto">Use Legacy API Password</label></div><div class="form-row"><input type="checkbox" id="accept_unauthorized_certs" style="width:auto;margin-left:125px;vertical-align:top"> <label for="accept_unauthorized_certs" style="width:auto">Accept Unauthorized SSL Certificates</label></div></div><div class="form-row"><label for="node-config-input-ha_boolean" style="width:120px"><i class="fa fa-link"></i> State Boolean</label> <input type="text" id="node-config-input-ha_boolean" placeholder="y|yes|true|on|home|open"></div><div class="form-row"><input type="checkbox" id="node-config-input-cacheJson" style="width:auto;margin-left:125px;vertical-align:top"> <label for="node-config-input-cacheJson" style="width:auto">Cache Autocomplete Results</label></div></script>
<style>#update-tag-list{margin-bottom:4px}#no-tags-found{display:none}</style>
<script type="text/html" data-template-name="api-current-state"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"> <input type="hidden" id="node-input-outputs"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-entity_id"><i class="fa fa-cube"></i> Entity ID</label> <input type="text" id="node-input-entity_id"></div><div class="form-row"><label for="node-input-halt_if_compare"><i class="fa fa-check-square"></i> If State</label> <select type="text" id="node-input-halt_if_compare" style="width:20%"><option value="is">is</option><option value="is_not">is not</option><option value="lt">&lt;</option><option value="lte">&lt;=</option><option value="gt">&gt;</option><option value="gte">&gt;=</option><option value="includes">in</option><option value="does_not_include">not in</option><option value="jsonata">JSONata</option></select> <input type="text" id="node-input-halt_if" style="width:50%"> <input type="hidden" id="node-input-halt_if_type"></div><div class="form-row"><label for="node-input-state_type"><i class="fa fa-tint"></i> State Type</label> <select type="text" id="node-input-state_type" style="width:auto"><option value="str">String</option><option value="num">Number</option><option value="habool">Boolean</option></select></div><div class="form-row"><ol id="custom-outputs"></ol></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-blockInputOverrides">&nbsp; <label for="node-input-blockInputOverrides">Block Input Overrides</label></div></script>
<script type="text/html" data-template-name="ha-device"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name" data-i18n="ha-device.label.name"><i class="fa fa-tag"></i></label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server" data-i18n="ha-device.label.server"><i class="fa fa-server"></i></label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-deviceType"><span data-i18n="ha-device.label.type"></span></label> <select id="node-input-deviceType" style="width:70%"><option value="trigger" data-i18n="ha-device.label.trigger"></option><option value="action" data-i18n="ha-device.label.action"></option></select></div><div class="form-row"><label for="node-input-device" data-i18n="ha-device.label.device"></label> <select id="node-input-device" style="width:70%"></select></div><div class="form-row"><label for="event" data-i18n="ha-device.label.trigger"></label> <select id="event" style="width:70%" disabled="disabled"></select></div><div class="form-row"><ol id="custom-outputs"></ol></div></script>
<script type="text/html" data-template-name="ha-entity"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><span data-i18n="ha-entity.label.name"></span></label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><span data-i18n="ha-entity.label.server"></span></label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-entityType"><span data-i18n="ha-entity.label.type"></span></label> <select id="node-input-entityType" style="width:70%"><option value="binary_sensor">Binary Sensor</option><option value="sensor">Sensor</option><option value="switch">Switch</option></select></div><div id="state-row" class="form-row optional-row"><label for="node-input-state"><span data-i18n="ha-entity.label.state"></span></label> <input type="text" id="node-input-state" style="width:70%"> <input type="hidden" id="node-input-stateType"></div><div id="attributes-row" class="form-row optional-row"><ol id="attributes"></ol></div><div id="config-row" class="form-row"><ol id="config"></ol></div><div id="output-location-row" class="form-row optional-row"><label for="node-input-outputLocation"><span data-i18n="ha-entity.label.output_location"></span></label> <input type="hidden" id="node-input-outputLocationType"> <input type="text" id="node-input-outputLocation" style="width:68%"></div><div id="input-override-row" class="form-row optional-row"><label for="node-input-inputOverride"><span data-i18n="ha-entity.label.input_override"></span></label> <select id="node-input-inputOverride" style="width:68%"><option value="allow">Allow</option><option value="merge">Merge</option><option value="block">Block</option></select></div><div id="resend-row" class="form-row optional-row checkbox-option"><input type="checkbox" id="node-input-resend"> <label for="node-input-resend"><span data-i18n="ha-entity.label.resend"></span></label></div><div id="output-on-state-change-row" class="form-row optional-row checkbox-option"><input type="checkbox" id="node-input-outputOnStateChange"> <label for="node-input-outputOnStateChange"><span data-i18n="ha-entity.label.on_state_change"></span></label></div><div id="output-payload-row" class="form-row"><label for="node-input-outputPayload"><span data-i18n="ha-entity.label.payload"></span></label> <input type="text" id="node-input-outputPayload"> <input type="hidden" id="node-input-outputPayloadType"></div><div id="debug-row" class="form-row optional-row checkbox-option"><input type="checkbox" id="node-input-debugenabled"> <label for="node-input-debugenabled"><span data-i18n="ha-entity.label.debug"></span></label></div></script>
<style>.select2-container--nodered{font-family:Helvetica Neue,Arial,Helvetica,sans-serif}.select2-container--nodered .select2-selection--single{background-color:#fff;border:1px solid #ccc;border-radius:4px;height:34px!important}.select2-container--nodered .select2-selection--single .select2-selection__rendered{color:#555;line-height:34px}.select2-container--nodered .select2-selection--single .select2-selection__clear{cursor:pointer;float:right;font-weight:700;height:34px;margin-right:20px;padding-right:0}.select2-container--nodered .select2-selection--single .select2-selection__placeholder{color:#999}.select2-container--nodered .select2-selection--single .select2-selection__arrow{height:34px;position:absolute;right:1px;top:1px;width:20px}.select2-container--nodered .select2-selection--single .select2-selection__arrow b{border-color:#888 transparent transparent;border-style:solid;border-width:5px 4px 0;height:0;left:50%;margin-left:-4px;margin-top:-2px;position:absolute;top:50%;width:0}.select2-container--nodered .select2-selection--single:focus{border-color:rgba(85,150,230,.8);outline-color:#555;outline:0}.select2-container--nodered[dir=rtl] .select2-selection--single .select2-selection__clear{float:left}.select2-container--nodered[dir=rtl] .select2-selection--single .select2-selection__arrow{left:1px;right:auto}.select2-container--nodered.select2-container--disabled .select2-selection--single{background-color:#eee;cursor:default}.select2-container--nodered.select2-container--disabled .select2-selection--single .select2-selection__clear{display:none}.select2-container--nodered.select2-container--open .select2-selection--single .select2-selection__arrow b{border-color:transparent transparent #888;border-width:0 4px 5px}.select2-container--nodered .select2-selection--multiple{background-color:#fff;border:1px solid #aaa;border-radius:4px;cursor:text;padding-bottom:5px;padding-right:5px;position:relative}.select2-container--nodered .select2-selection--multiple.select2-selection--clearable{padding-right:25px}.select2-container--nodered .select2-selection--multiple .select2-selection__clear{cursor:pointer;font-weight:700;height:20px;margin-right:10px;margin-top:5px;padding:1px;position:absolute;right:0}.select2-container--nodered .select2-selection--multiple .select2-selection__choice{background-color:#e4e4e4;border:1px solid #aaa;border-radius:4px;box-sizing:border-box;display:inline-block;margin-left:5px;margin-top:5px;max-width:100%;overflow:hidden;padding:0 0 0 20px;position:relative;text-overflow:ellipsis;vertical-align:bottom;white-space:nowrap}.select2-container--nodered .select2-selection--multiple .select2-selection__choice__display{cursor:default;padding-left:2px;padding-right:5px}.select2-container--nodered .select2-selection--multiple .select2-selection__choice__remove{background-color:transparent;border:none;border-bottom-left-radius:4px;border-right:1px solid #aaa;border-top-left-radius:4px;color:#999;cursor:pointer;font-size:1em;font-weight:700;left:0;padding:0 4px;position:absolute;top:0}.select2-container--nodered .select2-selection--multiple .select2-selection__choice__remove:focus,.select2-container--nodered .select2-selection--multiple .select2-selection__choice__remove:hover{background-color:#f1f1f1;color:#333;outline:none}.select2-container--nodered[dir=rtl] .select2-selection--multiple .select2-selection__choice{margin-left:5px;margin-right:auto}.select2-container--nodered[dir=rtl] .select2-selection--multiple .select2-selection__choice__display{padding-left:5px;padding-right:2px}.select2-container--nodered[dir=rtl] .select2-selection--multiple .select2-selection__choice__remove{border-bottom-left-radius:0;border-bottom-right-radius:4px;border-left:1px solid #aaa;border-right:none;border-top-left-radius:0;border-top-right-radius:4px}.select2-container--nodered[dir=rtl] .select2-selection--multiple .select2-selection__clear{float:left;margin-left:10px;margin-right:auto}.select2-container--nodered.select2-container--focus .select2-selection--multiple{border:1px solid #000;outline:0}.select2-container--nodered.select2-container--disabled .select2-selection--multiple{background-color:#eee;cursor:default}.select2-container--nodered.select2-container--disabled .select2-selection__choice__remove{display:none}.select2-container--nodered.select2-container--open.select2-container--above .select2-selection--multiple,.select2-container--nodered.select2-container--open.select2-container--above .select2-selection--single{border-top-left-radius:0;border-top-right-radius:0}.select2-container--nodered.select2-container--open.select2-container--below .select2-selection--multiple,.select2-container--nodered.select2-container--open.select2-container--below .select2-selection--single{border-bottom-left-radius:0;border-bottom-right-radius:0}.select2-container--nodered .select2-search--dropdown .select2-search__field{border:1px solid #aaa;color:#555}.select2-container--nodered .select2-search--dropdown .select2-search__field:focus{border-color:rgba(85,150,230,.8);outline-color:#555;outline:0}.select2-container--nodered .select2-search--inline .select2-search__field{-webkit-appearance:textfield;background:transparent;border:none;box-shadow:none;outline:0}.select2-container--nodered .select2-results>.select2-results__options{max-height:200px;overflow-y:auto}.select2-container--nodered .select2-results__option{color:#555;font-size:14px}.select2-container--nodered .select2-results__option .select2-results__option{padding-left:1em}.select2-container--nodered .select2-results__option .select2-results__option .select2-results__group{padding-left:0}.select2-container--nodered .select2-results__option .select2-results__option .select2-results__option{margin-left:-1em;padding-left:2em}.select2-container--nodered .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-2em;padding-left:3em}.select2-container--nodered .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-3em;padding-left:4em}.select2-container--nodered .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-4em;padding-left:5em}.select2-container--nodered .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-5em;padding-left:6em}.select2-container--nodered .select2-results__option--group{padding:0}.select2-container--nodered .select2-results__option--disabled{color:#999}.select2-container--nodered .select2-results__option--selected{background-color:#ddd}.select2-container--nodered .select2-results__option--highlighted.select2-results__option--selectable{background-color:#5897fb;color:#fff}.select2-container--nodered .select2-results__group{cursor:default;display:block;padding:6px}</style>
<script type="text/html" data-template-name="server-events"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-dot-circle-o"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-event_type"><i class="fa fa-tag"></i> Event Type</label> <input type="text" id="node-input-event_type" placeholder="leave empty for all events"></div><div id="eventAlert" class="ui-state-error ha-alert-box"><strong>Alert:</strong> Leaving Event Type empty and listening for all events may overload the websocket message queue.</div><div class="form-row"><ol id="custom-outputs"></ol></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-waitForRunning"> <label for="node-input-waitForRunning">Output only after Home Assistant is running</label></div></script>
<script type="text/html" data-template-name="server-state-changed"><input type="hidden" id="node-input-version"> <input type="hidden" id="node-input-outputs"><!-- Name --><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><!-- Server --><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><!-- Entity ID Filter and Filter Type --><div class="form-row"><label for="node-input-entityidfilter"><i class="fa fa-tag"></i> Entity ID</label> <input type="text" id="node-input-entityidfilter" style="width:50%"> <select type="text" id="node-input-entityidfiltertype" style="width:20%"><option value="exact">Exact</option><option value="substring">Substring</option><option value="regex">Regex</option></select></div><div class="form-row"><label for="node-input-haltifstate"><i class="fa fa-check-square"></i> If State</label> <select type="text" id="node-input-halt_if_compare" style="width:20%"><option value="is">is</option><option value="is_not">is not</option><option value="lt">&lt;</option><option value="lte">&lt;=</option><option value="gt">&gt;</option><option value="gte">&gt;=</option><option value="includes">in</option><option value="does_not_include">not in</option><option value="jsonata">JSONata</option></select> <input type="text" id="node-input-haltifstate" style="width:50%"> <input type="hidden" id="node-input-halt_if_type"></div><div class="form-row"><label for="node-input-for"><i class="fa fa-clock-o"></i> For</label> <input type="text" id="node-input-for" style="width:45%"> <input type="hidden" id="node-input-forType"> <select id="node-input-forUnits" style="width:25%"><option value="milliseconds">milliseconds</option><option value="seconds">seconds</option><option value="minutes">minutes</option><option value="hours">hours</option><option value="days">days</option></select></div><div class="form-row"><label for="node-input-state_type"><i class="fa fa-tint"></i> State Type</label> <select type="text" id="node-input-state_type" style="width:auto"><option value="str">String</option><option value="num">Number</option><option value="habool">Boolean</option></select></div><div class="form-row"><ol id="custom-outputs"></ol></div><div class="form-row checkbox-option add-spacer"><p><i class="fa fa-ban"></i> Ignore state change event when:</p><input type="checkbox" id="node-input-ignorePrevStateNull"> <label for="node-input-ignorePrevStateNull">Previous state doesn't exist</label><br><input type="checkbox" id="node-input-ignorePrevStateUnknown"> <label for="node-input-ignorePrevStateUnknown">Previous state is <code>unknown</code></label><br><input type="checkbox" id="node-input-ignorePrevStateUnavailable"> <label for="node-input-ignorePrevStateUnavailable">Previous state is <code>unavailable</code></label><br><input type="checkbox" id="node-input-ignoreCurrentStateUnknown"> <label for="node-input-ignoreCurrentStateUnknown">Current state is <code>unknown</code></label><br><input type="checkbox" id="node-input-ignoreCurrentStateUnavailable"> <label for="node-input-ignoreCurrentStateUnavailable">Current state is <code>unavailable</code></label><br><input type="checkbox" id="node-input-output_only_on_state_change"> <label for="node-input-output_only_on_state_change">Current state equals previous state</label></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-outputinitially"> <label for="node-input-outputinitially">Output on Connect</label></div></script>
<style>.select2-container{box-sizing:border-box;display:inline-block;margin:0;position:relative;vertical-align:middle}.select2-container .select2-selection--single{box-sizing:border-box;cursor:pointer;display:block;height:28px;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-user-select:none}.select2-container .select2-selection--single .select2-selection__rendered{display:block;overflow:hidden;padding-left:8px;padding-right:20px;text-overflow:ellipsis;white-space:nowrap}.select2-container .select2-selection--single .select2-selection__clear{background-color:transparent;border:none;font-size:1em}.select2-container[dir=rtl] .select2-selection--single .select2-selection__rendered{padding-left:20px;padding-right:8px}.select2-container .select2-selection--multiple{box-sizing:border-box;cursor:pointer;display:block;min-height:32px;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-user-select:none}.select2-container .select2-selection--multiple .select2-selection__rendered{display:inline;list-style:none;padding:0}.select2-container .select2-selection--multiple .select2-selection__clear{background-color:transparent;border:none;font-size:1em}.select2-container .select2-search--inline .select2-search__field{border:none;box-sizing:border-box;font-family:sans-serif;font-size:100%;height:18px;margin-left:5px;margin-top:5px;max-width:100%;overflow:hidden;padding:0;resize:none;vertical-align:bottom;word-break:keep-all}.select2-container .select2-search--inline .select2-search__field::-webkit-search-cancel-button{-webkit-appearance:none}.select2-dropdown{background-color:#fff;border:1px solid #aaa;border-radius:4px;box-sizing:border-box;display:block;left:-100000px;position:absolute;width:100%;z-index:1051}.select2-results{display:block}.select2-results__options{list-style:none;margin:0;padding:0}.select2-results__option{padding:6px;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-user-select:none}.select2-results__option--selectable{cursor:pointer}.select2-container--open .select2-dropdown{left:0}.select2-container--open .select2-dropdown--above{border-bottom:none;border-bottom-left-radius:0;border-bottom-right-radius:0}.select2-container--open .select2-dropdown--below{border-top:none;border-top-left-radius:0;border-top-right-radius:0}.select2-search--dropdown{display:block;padding:4px}.select2-search--dropdown .select2-search__field{box-sizing:border-box;padding:4px;width:100%}.select2-search--dropdown .select2-search__field::-webkit-search-cancel-button{-webkit-appearance:none}.select2-search--dropdown.select2-search--hide{display:none}.select2-close-mask{background-color:#fff;border:0;display:block;filter:alpha(opacity=0);height:auto;left:0;margin:0;min-height:100%;min-width:100%;opacity:0;padding:0;position:fixed;top:0;width:auto;z-index:99}.select2-hidden-accessible{clip:rect(0 0 0 0)!important;border:0!important;-webkit-clip-path:inset(50%)!important;clip-path:inset(50%)!important;height:1px!important;overflow:hidden!important;padding:0!important;position:absolute!important;white-space:nowrap!important;width:1px!important}.select2-container--default .select2-selection--single{background-color:#fff;border:1px solid #aaa;border-radius:4px}.select2-container--default .select2-selection--single .select2-selection__rendered{color:#444;line-height:28px}.select2-container--default .select2-selection--single .select2-selection__clear{cursor:pointer;float:right;font-weight:700;height:26px;margin-right:20px;padding-right:0}.select2-container--default .select2-selection--single .select2-selection__placeholder{color:#999}.select2-container--default .select2-selection--single .select2-selection__arrow{height:26px;position:absolute;right:1px;top:1px;width:20px}.select2-container--default .select2-selection--single .select2-selection__arrow b{border-color:#888 transparent transparent;border-style:solid;border-width:5px 4px 0;height:0;left:50%;margin-left:-4px;margin-top:-2px;position:absolute;top:50%;width:0}.select2-container--default[dir=rtl] .select2-selection--single .select2-selection__clear{float:left}.select2-container--default[dir=rtl] .select2-selection--single .select2-selection__arrow{left:1px;right:auto}.select2-container--default.select2-container--disabled .select2-selection--single{background-color:#eee;cursor:default}.select2-container--default.select2-container--disabled .select2-selection--single .select2-selection__clear{display:none}.select2-container--default.select2-container--open .select2-selection--single .select2-selection__arrow b{border-color:transparent transparent #888;border-width:0 4px 5px}.select2-container--default .select2-selection--multiple{background-color:#fff;border:1px solid #aaa;border-radius:4px;cursor:text;padding-bottom:5px;padding-right:5px;position:relative}.select2-container--default .select2-selection--multiple.select2-selection--clearable{padding-right:25px}.select2-container--default .select2-selection--multiple .select2-selection__clear{cursor:pointer;font-weight:700;height:20px;margin-right:10px;margin-top:5px;padding:1px;position:absolute;right:0}.select2-container--default .select2-selection--multiple .select2-selection__choice{background-color:#e4e4e4;border:1px solid #aaa;border-radius:4px;box-sizing:border-box;display:inline-block;margin-left:5px;margin-top:5px;max-width:100%;overflow:hidden;padding:0 0 0 20px;position:relative;text-overflow:ellipsis;vertical-align:bottom;white-space:nowrap}.select2-container--default .select2-selection--multiple .select2-selection__choice__display{cursor:default;padding-left:2px;padding-right:5px}.select2-container--default .select2-selection--multiple .select2-selection__choice__remove{background-color:transparent;border:none;border-bottom-left-radius:4px;border-right:1px solid #aaa;border-top-left-radius:4px;color:#999;cursor:pointer;font-size:1em;font-weight:700;left:0;padding:0 4px;position:absolute;top:0}.select2-container--default .select2-selection--multiple .select2-selection__choice__remove:focus,.select2-container--default .select2-selection--multiple .select2-selection__choice__remove:hover{background-color:#f1f1f1;color:#333;outline:none}.select2-container--default[dir=rtl] .select2-selection--multiple .select2-selection__choice{margin-left:5px;margin-right:auto}.select2-container--default[dir=rtl] .select2-selection--multiple .select2-selection__choice__display{padding-left:5px;padding-right:2px}.select2-container--default[dir=rtl] .select2-selection--multiple .select2-selection__choice__remove{border-bottom-left-radius:0;border-bottom-right-radius:4px;border-left:1px solid #aaa;border-right:none;border-top-left-radius:0;border-top-right-radius:4px}.select2-container--default[dir=rtl] .select2-selection--multiple .select2-selection__clear{float:left;margin-left:10px;margin-right:auto}.select2-container--default.select2-container--focus .select2-selection--multiple{border:1px solid #000;outline:0}.select2-container--default.select2-container--disabled .select2-selection--multiple{background-color:#eee;cursor:default}.select2-container--default.select2-container--disabled .select2-selection__choice__remove{display:none}.select2-container--default.select2-container--open.select2-container--above .select2-selection--multiple,.select2-container--default.select2-container--open.select2-container--above .select2-selection--single{border-top-left-radius:0;border-top-right-radius:0}.select2-container--default.select2-container--open.select2-container--below .select2-selection--multiple,.select2-container--default.select2-container--open.select2-container--below .select2-selection--single{border-bottom-left-radius:0;border-bottom-right-radius:0}.select2-container--default .select2-search--dropdown .select2-search__field{border:1px solid #aaa}.select2-container--default .select2-search--inline .select2-search__field{-webkit-appearance:textfield;background:transparent;border:none;box-shadow:none;outline:0}.select2-container--default .select2-results>.select2-results__options{max-height:200px;overflow-y:auto}.select2-container--default .select2-results__option .select2-results__option{padding-left:1em}.select2-container--default .select2-results__option .select2-results__option .select2-results__group{padding-left:0}.select2-container--default .select2-results__option .select2-results__option .select2-results__option{margin-left:-1em;padding-left:2em}.select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-2em;padding-left:3em}.select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-3em;padding-left:4em}.select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-4em;padding-left:5em}.select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-5em;padding-left:6em}.select2-container--default .select2-results__option--group{padding:0}.select2-container--default .select2-results__option--disabled{color:#999}.select2-container--default .select2-results__option--selected{background-color:#ddd}.select2-container--default .select2-results__option--highlighted.select2-results__option--selectable{background-color:#5897fb;color:#fff}.select2-container--default .select2-results__group{cursor:default;display:block;padding:6px}.select2-container--classic .select2-selection--single{background-color:#f7f7f7;background-image:linear-gradient(180deg,#fff 50%,#eee);background-repeat:repeat-x;border:1px solid #aaa;border-radius:4px;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr="#FFFFFFFF",endColorstr="#FFEEEEEE",GradientType=0);outline:0}.select2-container--classic .select2-selection--single:focus{border:1px solid #5897fb}.select2-container--classic .select2-selection--single .select2-selection__rendered{color:#444;line-height:28px}.select2-container--classic .select2-selection--single .select2-selection__clear{cursor:pointer;float:right;font-weight:700;height:26px;margin-right:20px}.select2-container--classic .select2-selection--single .select2-selection__placeholder{color:#999}.select2-container--classic .select2-selection--single .select2-selection__arrow{background-color:#ddd;background-image:linear-gradient(180deg,#eee 50%,#ccc);background-repeat:repeat-x;border:none;border-bottom-right-radius:4px;border-left:1px solid #aaa;border-top-right-radius:4px;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr="#FFEEEEEE",endColorstr="#FFCCCCCC",GradientType=0);height:26px;position:absolute;right:1px;top:1px;width:20px}.select2-container--classic .select2-selection--single .select2-selection__arrow b{border-color:#888 transparent transparent;border-style:solid;border-width:5px 4px 0;height:0;left:50%;margin-left:-4px;margin-top:-2px;position:absolute;top:50%;width:0}.select2-container--classic[dir=rtl] .select2-selection--single .select2-selection__clear{float:left}.select2-container--classic[dir=rtl] .select2-selection--single .select2-selection__arrow{border:none;border-radius:0;border-bottom-left-radius:4px;border-right:1px solid #aaa;border-top-left-radius:4px;left:1px;right:auto}.select2-container--classic.select2-container--open .select2-selection--single{border:1px solid #5897fb}.select2-container--classic.select2-container--open .select2-selection--single .select2-selection__arrow{background:transparent;border:none}.select2-container--classic.select2-container--open .select2-selection--single .select2-selection__arrow b{border-color:transparent transparent #888;border-width:0 4px 5px}.select2-container--classic.select2-container--open.select2-container--above .select2-selection--single{background-image:linear-gradient(180deg,#fff 0,#eee 50%);background-repeat:repeat-x;border-top:none;border-top-left-radius:0;border-top-right-radius:0;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr="#FFFFFFFF",endColorstr="#FFEEEEEE",GradientType=0)}.select2-container--classic.select2-container--open.select2-container--below .select2-selection--single{background-image:linear-gradient(180deg,#eee 50%,#fff);background-repeat:repeat-x;border-bottom:none;border-bottom-left-radius:0;border-bottom-right-radius:0;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr="#FFEEEEEE",endColorstr="#FFFFFFFF",GradientType=0)}.select2-container--classic .select2-selection--multiple{background-color:#fff;border:1px solid #aaa;border-radius:4px;cursor:text;outline:0;padding-bottom:5px;padding-right:5px}.select2-container--classic .select2-selection--multiple:focus{border:1px solid #5897fb}.select2-container--classic .select2-selection--multiple .select2-selection__clear{display:none}.select2-container--classic .select2-selection--multiple .select2-selection__choice{background-color:#e4e4e4;border:1px solid #aaa;border-radius:4px;display:inline-block;margin-left:5px;margin-top:5px;padding:0}.select2-container--classic .select2-selection--multiple .select2-selection__choice__display{cursor:default;padding-left:2px;padding-right:5px}.select2-container--classic .select2-selection--multiple .select2-selection__choice__remove{background-color:transparent;border:none;border-bottom-left-radius:4px;border-top-left-radius:4px;color:#888;cursor:pointer;font-size:1em;font-weight:700;padding:0 4px}.select2-container--classic .select2-selection--multiple .select2-selection__choice__remove:hover{color:#555;outline:none}.select2-container--classic[dir=rtl] .select2-selection--multiple .select2-selection__choice{margin-left:5px;margin-right:auto}.select2-container--classic[dir=rtl] .select2-selection--multiple .select2-selection__choice__display{padding-left:5px;padding-right:2px}.select2-container--classic[dir=rtl] .select2-selection--multiple .select2-selection__choice__remove{border-bottom-left-radius:0;border-bottom-right-radius:4px;border-top-left-radius:0;border-top-right-radius:4px}.select2-container--classic.select2-container--open .select2-selection--multiple{border:1px solid #5897fb}.select2-container--classic.select2-container--open.select2-container--above .select2-selection--multiple{border-top:none;border-top-left-radius:0;border-top-right-radius:0}.select2-container--classic.select2-container--open.select2-container--below .select2-selection--multiple{border-bottom:none;border-bottom-left-radius:0;border-bottom-right-radius:0}.select2-container--classic .select2-search--dropdown .select2-search__field{border:1px solid #aaa;outline:0}.select2-container--classic .select2-search--inline .select2-search__field{box-shadow:none;outline:0}.select2-container--classic .select2-dropdown{background-color:#fff;border:1px solid transparent}.select2-container--classic .select2-dropdown--above{border-bottom:none}.select2-container--classic .select2-dropdown--below{border-top:none}.select2-container--classic .select2-results>.select2-results__options{max-height:200px;overflow-y:auto}.select2-container--classic .select2-results__option--group{padding:0}.select2-container--classic .select2-results__option--disabled{color:grey}.select2-container--classic .select2-results__option--highlighted.select2-results__option--selectable{background-color:#3875d7;color:#fff}.select2-container--classic .select2-results__group{cursor:default;display:block;padding:6px}.select2-container--classic.select2-container--open .select2-dropdown{border-color:#5897fb}</style>
<script type="text/html" data-template-name="ha-fire-event"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-dot-circle-o"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-data"><i class="fa fa-cube"></i> Event</label> <input type="text" id="node-input-event"></div><div class="form-row"><label for="node-input-data"><i class="fa fa-dot-circle-o"></i> Data</label> <input type="text" id="node-input-data" style="width:70%"> <input type="hidden" id="node-input-dataType"></div></script>
<script type="text/html" data-template-name="ha-get-entities"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><ol id="logic"></ol></div><div class="form-row"><label for="node-input-output_type">Output Type</label> <select id="node-input-output_type" style="width:70%"><option value="array">Array</option><option value="count">Count</option><option value="random">Random</option><option value="split">Split</option></select></div><div class="form-row checkbox-option output-option" id="output_empty_results"><input type="checkbox" id="node-input-output_empty_results"> <label for="node-input-output_empty_results">Send Empty Results</label></div><div class="form-row output-option" id="output_results_count"><label for="node-input-output_results_count" style="width:160px">Max Number of Results</label> <input type="text" id="node-input-output_results_count" style="width:150px"></div><div class="form-row output-option" id="output_location"><label for="node-input-output_location">Output Location</label> <input type="hidden" id="node-input-output_location_type"> <input type="text" id="node-input-output_location" style="width:70%"></div></script>
<script type="text/html" data-template-name="api-get-history"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><!-- Comparator Selection --><div class="form-row"><label for="node-input-entityid"><i class="fa fa-date"></i> Entity ID</label> <select type="text" id="node-input-entityidtype" style="width:18%"><option value="is">Is</option><option value="includes">Includes</option></select> <input type="text" id="node-input-entityid" style="width:52%"></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-useRelativeTime"> <label for="node-input-useRelativeTime">Use Relative Time</label></div><div class="form-row relative_row"><label for="node-input-relativeTime"><i class="fa fa-date"></i> In the Last</label> <input type="text" id="node-input-relativeTime" autofocus="autofocus" placeholder="20 minutes"></div><div class="form-row date_row"><label for="node-input-startdate"><i class="fa fa-date"></i> Start Date</label> <input type="text" id="node-input-startdate" autofocus="autofocus"></div><div class="form-row date_row"><label for="node-input-enddate"><i class="fa fa-date"></i> End Date</label> <input type="text" id="node-input-enddate"></div><div class="form-row form-tips date_row"><ul><li>dates must be in ISO format</li><li>example: "2018-01-27T13:00:00+00:00"</li></ul></div><div class="form-row form-tips relative_row"><p><code>timestring</code> will parse the following keywords into time values:</p><ol><li><code>ms, milli, millisecond, milliseconds</code> - will parse to milliseconds</li><li><code>s, sec, secs, second, seconds</code> - will parse to seconds</li><li><code>m, min, mins, minute, minutes</code> - will parse to minutes</li><li><code>h, hr, hrs, hour, hours</code> - will parse to hours</li><li><code>d, day, days</code> - will parse to days</li><li><code>w, week, weeks</code> - will parse to weeks</li><li><code>mon, mth, mths, month, months</code> - will parse to months</li><li><code>y, yr, yrs, year, years</code> - will parse to years</li></ol></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-flatten"> <label for="node-input-flatten">Flatten Results</label></div><div class="form-row"><label for="node-input-output_type">Output Type</label> <select id="node-input-output_type" style="width:70%"><option value="array">Array</option><option value="split">Split</option></select></div><div class="form-row output-option" id="output_location"><label for="node-input-output_location">Output Location</label> <input type="hidden" id="node-input-output_location_type"> <input type="text" id="node-input-output_location" style="width:70%"></div></script>
<script type="text/html" data-template-name="poll-state"><input type="hidden" id="node-input-version"> <input type="hidden" id="node-input-outputs"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-entity_id"><i class="fa fa-cube"></i> Entity ID</label> <input type="text" id="node-input-entity_id"></div><div class="form-row"><label for="node-input-updateinterval"><i class="fa fa-clock-o"></i> Update Interval</label> <input type="text" id="node-input-updateinterval" style="text-align:end;width:50px!important"> <select id="node-input-updateIntervalUnits" style="width:auto!important"><option value="seconds">seconds</option><option value="minutes">minutes</option><option value="hours">hours</option></select></div><div class="form-row"><label for="node-input-halt_if_compare"><i class="fa fa-check-square"></i> If State</label> <select type="text" id="node-input-halt_if_compare" style="width:20%"><option value="is">is</option><option value="is_not">is not</option><option value="lt">&lt;</option><option value="lte">&lt;=</option><option value="gt">&gt;</option><option value="gte">&gt;=</option><option value="includes">in</option><option value="does_not_include">not in</option><option value="jsonata">JSONata</option></select> <input type="text" id="node-input-halt_if" style="width:50%"> <input type="hidden" id="node-input-halt_if_type"></div><div class="form-row"><label for="node-input-state_type"><i class="fa fa-tint"></i> State Type</label> <select type="text" id="node-input-state_type" style="width:auto"><option value="str">String</option><option value="num">Number</option><option value="habool">Boolean</option></select></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-outputonchanged"> <label for="node-input-outputonchanged">Output on Changed</label></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-outputinitially"> <label for="node-input-outputinitially">Output on Connect</label></div></script>
<script type="text/html" data-template-name="api-render-template"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row" style="position:relative;margin-bottom:0"><label for="node-input-template"><i class="fa fa-file-code-o"></i> Template</label> <input type="hidden" id="node-input-template" autofocus="autofocus"></div><div class="form-row node-text-editor-row"><div style="height:250px;min-height:150px" class="node-text-editor" id="node-input-template-editor"></div></div><div class="form-row"><label for="node-input-templateLocation">Template</label> <input type="text" id="node-input-templateLocation" style="width:70%"> <input type="hidden" id="node-input-templateLocationType"></div><div class="form-row"><label for="node-input-resultsLocation">Results</label> <input type="text" id="node-input-resultsLocation" style="width:70%"> <input type="hidden" id="node-input-resultsLocationType"></div></script>
<script type="text/html" data-template-name="ha-tag"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><div id="no-tags-found" class="ui-state-error ha-alert-box"><i class="fa fa-exclamation-triangle"></i> No tags found in Home Assistant</div><button id="update-tag-list" class="red-ui-button red-ui-button-small"><i class="fa fa-refresh"></i> Update Tag List</button><div class="form-row"><ol id="tags"></ol></div><div class="form-row"><ol id="devices"></ol></div></script>
<script type="text/html" data-template-name="ha-time"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="ha-time.label.name"></span></label> <input type="text" id="node-input-name" data-i18n="[placeholder]ha-time.label.name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> <span data-i18n="ha-time.label.server"></span></label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-entityId"><i class="fa fa-cube"></i> <span data-i18n="ha-time.label.entity_id"></span></label> <input type="text" id="node-input-entityId"></div><div class="form-row"><label for="node-input-property"><i class="fa fa-edit"></i> <span data-i18n="ha-time.label.property"></span></label> <input type="text" id="node-input-property" placeholder="state"></div><div class="form-row"><label for="node-input-offset"><i class="fa fa-clock-o"></i> <span data-i18n="ha-time.label.offset"></span></label> <input type="text" id="node-input-offset" style="width:43%"> <input type="hidden" id="node-input-offsetType"> <select id="node-input-offsetUnits" style="width:27%"><option value="seconds" data-i18n="ha-time.label.seconds"></option><option value="minutes" data-i18n="ha-time.label.minutes"></option><option value="hours" data-i18n="ha-time.label.hours"></option></select></div><div class="form-row checkbox-option"><label><input type="checkbox" id="node-input-randomOffset"> <span data-i18n="ha-time.label.randomize_offset"></span></label></div><div class="form-row" id="entitiesFound"></div><div class="form-row"><label for="node-input-payload"><i class="fa fa-cube"></i> <span data-i18n="ha-time.label.payload"></span></label> <input type="text" id="node-input-payload"> <input type="hidden" id="node-input-payloadType"></div><div class="form-row checkbox-option"><label><input type="checkbox" id="node-input-repeatDaily"> <span data-i18n="ha-time.label.repeat_daily"></span></label></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-debugenabled"> <label for="node-input-debugenabled">Show Debug Information</label></div></script>
<script type="text/html" data-template-name="trigger-state"><input type="hidden" id="node-input-version"><!-- Name --><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"> <input type="hidden" id="node-input-outputs"></div><!-- Server --><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><!-- Entity ID Filter and Filter Type --><div class="form-row"><label for="node-input-entityid"><i class="fa fa-tag"></i> Entity ID</label> <input type="text" id="node-input-entityid" style="width:50%"> <select type="text" id="node-input-entityidfiltertype" style="width:20%"><option value="exact">Exact</option><option value="substring">Substring</option><option value="regex">Regex</option></select></div><div class="form-row"><label for="node-input-state_type"><i class="fa fa-tint"></i> State Type</label> <select type="text" id="node-input-state_type" style="width:auto"><option value="str">String</option><option value="num">Number</option><option value="habool">Boolean</option></select></div><!-- Constraints List --><div class="form-row"><ol id="constraint-list"></ol></div><!-- Output List --><div class="form-row"><ol id="output-list"></ol></div><div class="form-row checkbox-option-left"><input type="checkbox" id="node-input-outputinitially"> <label for="node-input-outputinitially">Output on Connect</label></div><div class="form-row checkbox-option-left"><input type="checkbox" id="node-input-debugenabled"> <label for="node-input-debugenabled">Show Debug Information</label></div><div id="constraint-template" style="display:none"><!-- Target Selection --><div class="editable-list-row"><!-- Type --> <select type="text" class="target-type" style="width:140px"><option value="this_entity">This Entity</option><option value="entity_id">Entity ID</option></select><!-- Value --> <input type="text" class="target-value" disabled="disabled"></div><!-- Property Selection --><div class="editable-list-row"><!-- Type --> <select type="text" class="property-type" style="width:140px"><option value="current_state">Current State</option><option value="previous_state">Previous State</option><option value="property">Property</option></select><!-- Value --> <input type="text" class="property-value" disabled="disabled"></div><!-- Comparator Selection --><div class="editable-list-row"><!-- Type --> <select type="text" class="comparator-type" style="width:140px"><option value="is">is</option><option value="is_not">is not</option><option value=">">&gt;</option><option value=">=">&gt;=</option><option value="<">&lt;</option><option value="<=">&lt;=</option><option value="includes">in</option><option value="does_not_include">not in</option></select><!-- Value --> <input type="text" class="comparator-value" style="width:65%"></div></div><div id="output-template" style="display:none"><div class="editable-list-row"><!-- Type --> <select type="text" class="message-type" style="width:140px"><option value="default">Default Msg</option><option value="custom">Custom Msg</option><option value="payload">Custom Payload</option></select> <input type="text" class="message-value" style="width:62%"></div><!-- Output Comparator Selection --><div class="editable-list-row"><select type="text" class="comparator-property-type" style="width:140px"><option value="always">Send Always</option><option value="current_state">If State</option><option value="previous_state">If Prev State</option><option value="property">If Property</option></select> <input type="text" class="comparator-property-value" disabled="disabled"></div><div class="editable-list-row"><!-- Type --> <select type="text" class="comparator-type" style="width:140px" disabled="disabled"><option value="is">is</option><option value="is_not">is not</option><option value=">">&gt;</option><option value=">=">&gt;=</option><option value="<">&lt;</option><option value="<=">&lt;=</option><option value="includes">in</option><option value="does_not_include">not in</option></select> <input type="text" class="comparator-value" style="width:62%"></div></div></script>
<script type="text/html" data-template-name="ha-wait-until"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="entityId"><i class="fa fa-cube"></i> Entity ID</label> <input type="text" id="node-input-entityId" style="width:50%"> <select type="text" id="node-input-entityIdFilterType" style="width:20%"><option value="exact">Exact</option><option value="substring">Substring</option><option value="regex">Regex</option></select></div><div class="form-row"><label for="node-input-property"><i class="fa fa-hand-paper-o"></i> Wait Until</label> <input type="text" id="node-input-property" placeholder="property"></div><div class="form-row"><label></label> <select id="node-input-comparator" style="width:24%"><option value="is">is</option><option value="is_not">is not</option><option value="lt">&lt;</option><option value="lte">&lt;=</option><option value="gt">&gt;</option><option value="gte">&gt;=</option><option value="includes">in</option><option value="does_not_include">not in</option><option value="jsonata">JSONata</option></select> <input id="node-input-valueType" type="hidden"> <input id="node-input-value" type="text" placeholder="value" style="width:46%"></div><div class="form-row"><label for="node-input-timeout"><i class="fa fa-clock-o"></i> Timeout</label> <input type="text" id="node-input-timeout" style="width:43%"> <input type="hidden" id="node-input-timeoutType"> <select id="node-input-timeoutUnits" style="width:27%"><option value="milliseconds">milliseconds</option><option value="seconds">seconds</option><option value="minutes">minutes</option><option value="hours">hours</option><option value="days">days</option></select></div><div class="form-row"><label for="node-input-entityLocation">Entity Location</label> <input type="hidden" id="node-input-entityLocationType"> <input type="text" id="node-input-entityLocation" style="width:70%"></div><div class="form-row exact-only checkbox-option"><input type="checkbox" id="node-input-checkCurrentState" checked="checked"> <label for="node-input-checkCurrentState">Check against current state</label></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-blockInputOverrides">&nbsp; <label for="node-input-blockInputOverrides">Block Input Overrides</label></div></script>
<script type="text/html" data-template-name="ha-webhook"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"> <input type="hidden" id="node-input-outputs"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-webhookId"><i class="fa fa-cube"></i> ID</label><div style="display:inline-block;position:relative;width:70%;height:20px"><div style="position:absolute;left:0;right:80px"><input type="text" id="node-input-webhookId" style="width:100%"></div><a id="copyId" class="editor-button" style="position:absolute;right:0;top:0"><i class="fa fa-copy"></i></a> <a id="refresh" class="editor-button" style="position:absolute;right:40px;top:0"><i class="fa fa-refresh"></i></a></div></div><div class="form-row"><ol id="custom-outputs"></ol></div></script>
<script type="text/html" data-template-name="ha-zone"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><ol id="entities"></ol></div><div class="form-row"><label for="node-input-event"><i class="fa fa-sign-in"></i> Event</label> <select id="node-input-event"><option value="enter">Enter</option><option value="leave">Leave</option><option value="enter_leave">Enter or Leave</option></select></div><div class="form-row"><ol id="zones"></ol></div></script>
<script type="text/html" data-help-name="ha-api"><h3>Config</h3><dl class="message-properties"><dt>Protocol <span text="required" class="badge">required</span><span class="property-type">string</span></dt><ul><li>Values: <code>websocket|http</code></li><li>Default: <code>websocket</code></li></ul><dd>Protocol to use to access Home Assistant API.</dd><dt>Method<span class="property-type">string</span></dt><ul><li>Values: <code>get|post</code></li></ul><dd>Type of method to use to access the HTTP endpoint.</dd><dt>Path<span class="property-type">string</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a></li></ul><dd>URL of the API endpoint.</dd><dt>Params<span class="property-type">Object</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a></li></ul><dd>A JSON object with key/value pairs that will be converted into URL parameters.</dd><dt>Data<span class="property-type">Object</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a> when the data type is JSON</li></ul><dd>JSON Object to send for WebSocket requests and HTTP posts.</dd><dt>Results<span class="property-type">string</span></dt></dl><h3>Input</h3><dl class="message-properties"><dd>All properties need to be under <code>msg.payload</code>.</dd><dt>protocol<span class="property-type">string</span></dt><ul><li>Values: <code>websocket|http</code></li></ul><dd>Overrides or sets the protocol property of the config.</dd><dt>method<span class="property-type">string</span></dt><ul><li>Values: <code>get|post</code></li></ul><dd>Overrides or sets the method property of the config.</dd><dt>path<span class="property-type">string</span></dt><dd>Overrides or sets the path property of the config.</dd><dt>data<span class="property-type">Object|string</span></dt><dd>Overrides or sets the data/params property of the config.</dd><dt>location<span class="property-type">string</span></dt><dd>Overrides or sets the results property of the config.</dd><dt>locationType<span class="property-type">string</span></dt><ul><li>Values: <code>msg|flow|global</code></li></ul><dd>Overrides or sets the results type property of the config.</dd></dl><h3>Output</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>results</code>: results of the API request</li><li><code>config</code>: config properties of the node</li></ul></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://developers.home-assistant.io/docs/api/rest">http api</a></li><li><a href="https://developers.home-assistant.io/docs/api/websocket">websocket api</a></li></ul></dl></script>
<script type="text/html" data-help-name="api-call-service"><p>Sends a request to home assistant for any domain and service available (<code>light/turn_on</code>, <code>input_select/select_option</code>, etc..)</p><div class="custom-block tip"><p class="custom-block-title">Helpful Examples</p><p><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/call-service.html" rel="noopener noreferrer">Call Service Tips and Tricks</a></p></div><h3>Configuration</h3><dl class="message-properties"><dt>Domain <span text="required" class="badge">required</span><span class="property-type">string</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a></li></ul><dd>Service domain to call</dd><dt>Service <span text="required" class="badge">required</span><span class="property-type">string</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a></li></ul><dd>Service service to call</dd><dt>Entity Id<span class="property-type">string</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a></li></ul><dd>A comma-delimited list of entity ids.</dd><div class="custom-block tip"><p class="custom-block-title">NOTICE</p><p>If <code>entity_id</code> exists in the data property it will have precedence over this value.</p></div><dt>Data<span class="property-type">JSONata | JSON</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a> when data type is JSON</li></ul><dd>JSON object to pass along.</dd><dt>Merge Context<span class="property-type">string</span></dt><dd>If defined will attempt to merge the global and flow context variable into the config</dd><dt>Alternative Template Tags<span class="property-type">boolean</span></dt><dd>Will change the tags used for mustache template to <code>&lt;%</code> and <code>%&gt;</code></dd><dt>Queue<span class="property-type">none | first | all | last</span></dt><dd>Will store the first, last or all messages received while disconnected from Home Assistant and send them once connected again</dd></dl><h3>Input</h3><dl class="message-properties"><dd>All properties need to be under <code>msg.payload</code>.</dd><h5>Merging</h5><dd>If the incoming message has a <code>payload</code> property with <code>domain</code>, <code>service</code> set it will override any config values if set.</dd><dd>If the incoming message has a <code>payload.data</code> that is an object or parsable into an object these properties will be <strong>merged</strong> with any config values set.</dd><dd>If the node has a property value in its config for <code>Merge Context</code> then the <code>flow</code> and <code>global</code> contexts will be checked for this property which should be an object that will also be merged into the data payload.</dd><h5>Merge Resolution</h5><dd>As seen above the <code>data</code> property has a lot going on in the way of data merging, in the end, all of these are optional and the rightmost will win if a property exists in multiple objects</dd><dd>Config Data, Global Data, Flow Data, Payload Data ( payload data property always wins if provided</dd><dt>domain<span class="property-type">string</span></dt><dd>Service domain to call</dd><dt>service<span class="property-type">string</span></dt><dd>Service service to call</dd><dt>data<span class="property-type">Object</span></dt><dd>Service data to send with API call</dd></dl><h3>Output</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>sent data</code>: data sent to Home Assistant</li><li><code>config</code>: config properties of the node</li></ul></dl></script>
<script type="text/html" data-help-name="server"><p>Home Assistant connection configuration</p><h3>Config</h3><dl class="message-properties"><dt>Name<span class="property-type">string</span></dt><dd>Label for this configuration, see details below for implications</dd><dt>Hass.io<span class="property-type">boolean</span></dt><dd>If you&apos;re running Node-RED as a Hass.io Add-on check this. No other information is needed.</dd><dt>Base URL<span class="property-type">string</span></dt><dd>The base URL and port the home assistant instance can be reached at, for example: <code>http://192.168.0.100:8123</code> or <code>https://homeassistant.mysite.com</code></dd><dt>Access Token / Password<span class="property-type">string</span></dt><dd>Long-lived Access Token or Password used to contact the API</dd><dt>Legacy Password<span class="property-type">boolean</span></dt><dd>If you&apos;re using the legacy password to log into Home Assistant check this and enter your password in the password text box.</dd><dt>Unauthorized SSL Certificates<span class="property-type">boolean</span></dt><dd>This will allow you to use self-signed certificates. Only use this if you know what you&apos;re doing.</dd><dt>State Boolean<span class="property-type">string | delimited</span></dt><dd>A list of strings, not case sensitive, delimited by vertical pipe, |, that will return true for State Type Boolean.</dd><dt>Cache Autocomplete Results<span class="property-type"></span></dt><dd>Enables the caching of the JSON autocomplete requests. Enabling or disabling this may require a restart of Node-RED for it to take effect.</dd></dl><h3>Details</h3><dl class="message-properties"><dd>Every node requires a configuration attached to define how to contact Home Assistant, which is this config node&apos;s main purpose.</dd><dt>Context<span class="property-type"></span></dt><dd>Each config node will also make some data available on the global context, the <code>Name</code> value in this node is used as, camelcase, the namespace for those values</dd><dd>Currently <code>states</code>, <code>services</code> and <code>events</code> is made available on the global context. <code>states</code> is always set to all available states at startup and updated whenever state changes occur so it should be always up to date. <code>services</code> and <code>events</code> is only updated on initial deploy.</dd><dt>Context Example<span class="property-type"></span></dt><dd>Say we have a config node with the name <code>Home Assistant</code>, with an entity set up in Home Assistant as <code>switch.my_switch</code>. This state would be available within function nodes and you could fetch using something like the below code</dd><pre><code class="language-js">const haCtx = global.get(&quot;homeassistant&quot;);
const configCtx = haCtx.homeAssistant;
const entityState = configCtx.states[&quot;switch.my_switch&quot;];
return entityState.state === &quot;on&quot; ? true : false;
</code></pre></dl><h3>Connection Issues</h3><dl class="message-properties"><dd>Communication with Home Assistant is accomplished via a combination of WebSocket and the REST API if you are having troubles communicating with home assistant make sure you can access the API outside of node-red, but from the same server node-red is running on, using a REST client, curl, or any number of other methods to validate the connection</dd></dl><h3>References</h3><dl class="message-properties"><dd><a href="https://home-assistant.io/developers/rest_api">Home Assistant REST API</a></dd></dl></script>
<script type="text/html" data-help-name="api-current-state"><p>Returns the current state of an entity. Useful for using conditional logic to automation flows.</p><h3>Configuration</h3><dl class="message-properties"><dt>Entity ID <span text="required" class="badge">required</span><span class="property-type">string</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a></li></ul><dd>The id of the entity to return.</dd><dt>If State<span class="property-type">string</span></dt><dd>If the conditional statement is evaluated as true send the message to the first output otherwise send it to the second output. If blank there will only be one output.</dd><dd><strong>Also see:</strong></dd><ul><li><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/conditionals.html" rel="noopener noreferrer">Conditionals</a></li></ul><dt>State Type<span class="property-type">string</span></dt><ul><li>Values: <code>string|number|boolean</code></li><li>Default: <code>string</code></li></ul><dd>Convert the state of the entity to the selected type. Boolean will be converted to true based on if the string is equal by default to (<code>y|yes|true|on|home|open</code>). Original value stored in <code>msg.data.original_state</code></dd><dt>State Location<span class="property-type">string</span></dt><ul><li>Default: <code>msg.payload</code></li></ul><dd>Customizable location for the entity&#x2019;s state.</dd><dt>Entity Location<span class="property-type">string</span></dt><ul><li>Default: <code>msg.data</code></li></ul><dd>Customizable location for the entity object. Defaults to</dd><dt>Override Topic<span class="property-type">boolean</span></dt><ul><li>Default: <code>false</code></li></ul><dd>Write entity id to msg.topic</dd><dt>Block Input Overrides<span class="property-type">boolean</span></dt><ul><li>Default: <code>false</code></li></ul><dd>Stop msg.payload values from overriding local config</dd></dl><h3>Inputs</h3><dl class="message-properties"><dt>payload.entity_id<span class="property-type">string</span></dt></dl><h3>Outputs</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>entity</code>: full entity object</li><li><code>entity id</code>: entity id of the triggered entity</li><li><code>entity state</code>: entity state of the triggered entity</li><li><code>config</code>: config properties of the node</li></ul></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://home-assistant.io/docs/configuration/state_object/">Home Assistant State Objects</a></li></ul></dl></script>
<script type="text/html" data-help-name="ha-device"><h3>Configuration</h3><dl class="message-properties"><dt>Type<span class="property-type">string</span></dt><ul><li>Values: <code>trigger | action</code></li></ul><dt>Device<span class="property-type">string</span></dt><dd>Id of the device</dd><dt>Trigger<span class="property-type">object</span></dt><dd>Home Assistant object of the trigger</dd><dt>Action<span class="property-type">object</span></dt><dd>Home Assistant object of the action</dd><dt>Capabilities<span class="property-type">object</span></dt></dl><h3>Outputs</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>config</code>: config properties of the node</li><li><code>device id</code>: device id that triggered the node</li><li><code>event data</code>: event data received from Home Assistant</li><li><code>sent data</code>: data sent to Home Assistant</li></ul></dl></script>
<script type="text/html" data-help-name="ha-entity"><p>Creates an entity in Home Assistant which can be manipulated from this node.</p><p><code>binary sensor</code>, <code>sensor</code>, and <code>switch</code></p><div class="custom-block warning"><p class="custom-block-title">WARNING</p><p><em>Needs <a href="https://github.com/zachowj/hass-node-red">Custom Integration</a> installed in Home Assistant for this node to function</em></p></div><h3>Configuration</h3><dl class="message-properties"><dt>Type <span text="required" class="badge">required</span><span class="property-type">string</span></dt><ul><li>Values <code>binary_sensor|sensor|switch</code></li><li>Default: <code>sensor</code></li></ul><dd>The state the entity should be updated to</dd><dt>Home Assistant Config<span class="property-type">Object</span></dt><dd>Configuration options available for the selected entity</dd><div class="custom-block danger"><p class="custom-block-title">WARNING</p><p>Entity nodes will not work in a subflow due to the way they register themselves with Home Assistant. After a Node-RED restart, a new entity will be created in Home Assistant.</p></div></dl><h3>Sensor Configuration</h3><dl class="message-properties"><dt>State <span text="required" class="badge">required</span><span class="property-type">string | number | boolean</span></dt><dd>The state the entity should be updated to</dd><dt>Attributes<span class="property-type">Object</span></dt><dd>Key/Value pair of attributes to update. The key should be a string and the value can be a [string | number | boolean | object]</dd><dt>Input Override<span class="property-type">string</span></dt><ul><li>Values: <code>accept | merge | block</code></li></ul><dd>Determine how input values will be handled. When merge is selected the message object values will override the configuration values.</dd><dt>Resend state and attributes<span class="property-type">boolean</span></dt><dd>When creating the entity in Home Assistant this will also send the last updated state and attributes then node sent to Home Assistant</dd></dl><h3>Switch Configuration</h3><dl class="message-properties"><dt>Output on state change<span class="property-type">boolean</span></dt><dd>When the state of the switch changes it will output to the top if the switch is on or to the bottom if it is in the off position.</dd><dt>Payload<span class="property-type">str | num | bool | JSONata | timestamp</span></dt><dd>Customizable output set to <code>msg.payload</code> if <code>Output on state change</code> is enabled.</dd></dl><h3>Sensors Inputs</h3><dl class="message-properties"><dd>properties of <code>msg.payload</code></dd><dt>state<span class="property-type">string | number | boolean</span></dt><dd>The state the entity should be updated to</dd><dt>attributes<span class="property-type">Object</span></dt><dd>Key/Value pair of attributes to update. The key should be a string and the value can be a <code>[string | number | boolean | object]</code></dd></dl><h3>Switch Inputs</h3><dl class="message-properties"><dt>msg.enable<span class="property-type">boolean</span></dt><dd>Set to <code>true</code> to turn on the switch and <code>false</code> to turn off. If the message has a property <code>enable</code> set to the type <code>boolean</code> the node will not have any output.</dd></dl><h3>Outputs</h3><dl class="message-properties"><dd><strong>Status Color</strong></dd><ul><li>Green/Red: output from the node was due to input to the node</li><li>Blue: output from the node was due to the state of the node changing</li><li>Yellow: state of node changed but no output</li></ul></dl></script>
<script type="text/html" data-help-name="server-events"><p>Listens for all types of events from Home Assistant with the ability to filter by event type.</p><h3>Configuration</h3><dl class="message-properties"><dt>Name<span class="property-type">string</span></dt><dd>the name of the node</dd><dt>Event Type<span class="property-type">string</span></dt><dd>filter by event type or leave blank for all events</dd><div class="custom-block danger"><p class="custom-block-title">WARNING</p><p>Leaving this empty will listen for all events from Home Assistant which may overload the WebSocket message queue.</p><p><a href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/issues/153#issuecomment-539290950">GitHub Issue #153</a></p></div><dt>Output only after Home Assistant is running<span class="property-type">boolean</span></dt><dd>What until Home Assistant has reported its state as <code>running</code> before outputing events. Client events will always output.</dd><dt>Expose to Home Assistant<span class="property-type">boolean</span></dt><dd>Creates a switch within Home Assistant to enable/disable this node. This feature requires <a href="https://github.com/zachowj/hass-node-red">Node-RED custom integration</a> to be installed in Home Assistant</dd></dl><h3>Outputs</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>event data</code>: event received from Home Assistant</li><li><code>config</code>: config properties of the node</li></ul></dl><h3>Client Events</h3><dl class="message-properties"><dd>Use <code>home_assistant_client</code> as the event type to receive events from the Websocket client.</dd><dd>Events sent from the client:</dd><ul><li><strong>connecting</strong> - when trying to connect to HA</li><li><strong>connected</strong> - after the authorization has been accepted</li><li><strong>disconnected</strong> - when the socket stops attempting to connect or disconnected after having been connected</li><li><strong>error</strong> - when a disconnect happens of the WebSocket with an error</li><li><strong>states_loaded</strong> - the first time all states are loaded from HA</li><li><strong>services_loaded</strong> - the first time all services are loaded from HA</li><li><strong>running</strong> - when HA is in a running state and states have been loaded</li></ul></dl></script>
<script type="text/html" data-help-name="server-state-changed"><p>Outputs state_changed event types sent from Home Assistant</p><p>The autocomplete will open to allow easier selection in the case you want a specific entity however the actual match is a substring match so no validation is done</p><h3>Configuration:</h3><dl class="message-properties"><dt>Entity ID <span text="required" class="badge">required</span><span class="property-type">string|regex</span></dt><dd>matches for entity_id field</dd><dt>Entity ID Filter Types <span text="required" class="badge">required</span><span class="property-type">string</span></dt><ul><li>Values: <code>exact|substring|regex</code></li><li>Default: <code>exact</code></li></ul><dd>Substring can be a comma-delimited list.</dd><dt>If State<span class="property-type">string</span></dt><dd>If the conditional is evaluated as true send the message to the first output otherwise send it to the second output. If blank there will only be one output.</dd><dd><strong>Also see:</strong></dd><ul><li><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/conditionals.html" rel="noopener noreferrer">Conditionals</a></li></ul><dt>For<span class="property-type">number</span></dt><dd>An amount of time an entity&apos;s state needs to be in that state before triggering.</dd><div class="custom-block warning"><p class="custom-block-title">WARNING</p><p>Output on Connect state changes will not start a timer.</p></div><dt>State Type<span class="property-type">string</span></dt><ul><li>Values: <code>string|number|boolean</code></li><li>Default: <code>string</code></li></ul><dd>Convert the state of the entity to the selected type. Boolean will be converted to true based on if the string is equal by default to (<code>y|yes|true|on|home|open</code>). Original value stored in msg.data.original_state</dd><dt>Ignore state change event<span class="property-type">boolean</span></dt><dd>A list of possible states that will be ignore if seletected.</dd><dt>Output on Connect<span class="property-type">boolean</span></dt><dd>Output once on startup/deploy</dd><dt>Expose to Home Assistant<span class="property-type">boolean</span></dt><dd>Creates a switch within Home Assistant to enable/disable this node. This feature requires <a href="https://github.com/zachowj/hass-node-red">Node-RED custom integration</a> to be installed in Home Assistant</dd></dl><h3>Outputs</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>event data</code>: full event object</li><li><code>entity id</code>: entity id of the triggered entity</li><li><code>entity state</code>: entity state of the triggered entity</li><li><code>config</code>: config properties of the node</li></ul></dl></script>
<script type="text/html" data-help-name="ha-fire-event"><p>Fire an event to Home Assistants event bus</p><h3>Configuration</h3><dl class="message-properties"><dt>Event <span text="required" class="badge">required</span><span class="property-type">string</span></dt><dd>Event name to fire</dd><dt>data<span class="property-type">Object</span></dt><dd>JSON object to pass along</dd></dl><h3>Inputs</h3><dl class="message-properties"><dd>If the incoming message has a <code>payload</code> property with <code>event</code> set it will override any config values if set. If the incoming message has a <code>payload.data</code> that is an object or parsable into an object these properties will be <strong>merged</strong> with any config values set. If the node has a property value in its config for <code>Merge Context</code> then the <code>flow</code> and <code>global</code> contexts will be checked for this property which should be an object that will also be merged into the data payload.</dd><dt>payload.event<span class="property-type">string</span></dt><dd>Event to fire</dd><dt>payload.data<span class="property-type">Object</span></dt><dd>Event data to send</dd></dl><h3>Outputs</h3><dl class="message-properties"><dt>payload.event_type<span class="property-type">string</span></dt><dd>Event Type that was fired</dd><dt>payload.data<span class="property-type">Object</span></dt><dd>The event <code>data</code> sent if one was used</dd></dl><h3>References</h3><dl class="message-properties"><dd><a href="https://developers.home-assistant.io/docs/en/dev_101_events.html#firing-events">Home Assistant Events</a></dd></dl></script>
<script type="text/javascript">!function(e){e.fn.haAutocomplete=function(t){const a={init:function(t){return this.haAutocomplete.settings=e.extend({},this.haAutocomplete.defaults,t),this.each((function(){const t=e(this),a=t.haAutocomplete.settings.serverId,n=t.haAutocomplete.settings.type;t.autocomplete({source:(t,o)=>{const i=t.term.toLowerCase();o(haData.getAutocompleteData(e(a).val(),n).filter((e=>e.value.toLowerCase().includes(i)||e.label.toLowerCase().includes(i))))},minLength:0}).autocomplete("instance")._renderItem=function(t,a){return e("<li>").append(`<div>${a.label}<p class="sublabel">${a.value}</p></div>`).appendTo(t)}}))}};return a[t]?a[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error(`Method "${t}" does not exist in haAutocomplete plugin!`):a.init.apply(this,arguments)},e.fn.haAutocomplete.defaults={serverId:"#node-input-server",type:"entities"},e.fn.haAutocomplete.settings={}}(jQuery);const haData=(e=>{const t={},a={};function n(e){return e.split("/")[2]}function o(e,t){const a=e.label,n=t.label;return a===n?0:a.localeCompare(n)}function i(e,t=null,a="."){return Object.keys(e).reduce(((n,o)=>{const s=e[o],r=[t,o].filter(Boolean).join(a);return["object"==typeof s,null!==s,!(s instanceof Date),!(s instanceof RegExp),!(Array.isArray(s)&&0===s.length)].every(Boolean)?{...n,...i(s,r,a)}:{...n,[r]:s}}),{})}return e.comms.subscribe("homeassistant/devices/#",((e,t)=>{const o=n(e);a[o]=t})),e.comms.subscribe("homeassistant/entity/#",((e,a)=>{const o=n(e);t[o]||(t[o]={}),t[o][a.entity_id]=a})),e.comms.subscribe("homeassistant/entities/#",((e,a)=>{const o=n(e);t[o]=a})),{getAutocomplete:function(e,a){let n=[];switch(a){case"entities":if(!(e in t))return[];n=Object.keys(t[e]).sort()}return n},getAutocompleteData:function(e,a){let n=[];switch(a){case"entities":{if(!(e in t))return[];const a="attributes.friendly_name";n=Object.values(t[e]).map((e=>({value:e.entity_id,label:haUtils.deepFind(a,e)||e.entity_id}))).sort(o);break}case"properties":if(!(e in t))return[];n=Object.values(t[e]).map((e=>({value:e.entity_id,label:e.state}))).sort(o);break;case"trackers":{if(!(e in t))return[];const a="attributes.friendly_name";n=Object.values(t[e]).filter((e=>e.entity_id.startsWith("person.")||e.entity_id.startsWith("device_tracker."))).map((e=>({value:e.entity_id,label:haUtils.deepFind(a,e)||e.entity_id}))).sort(o);break}case"zones":{if(!(e in t))return[];const a="attributes.friendly_name";n=Object.values(t[e]).filter((e=>e.entity_id.startsWith("zone."))).map((e=>({value:e.entity_id,label:haUtils.deepFind(a,e)||e.entity_id}))).sort(o);break}}return n},getDevices:function(e){return a[e]},getEntity:function(e,a){return t[e][a]},getProperties:function(e,a){if(!(e in t))return[];const n=a in t[e]?Object.keys(i(t[e][a])):Object.values(t[e]).map((e=>Object.keys(i(e))));return[...new Set([].concat(...n))].sort(((e,t)=>!e.includes(".")&&t.includes(".")?-1:e.includes(".")&&!t.includes(".")?1:e<t?-1:e>t?1:0))}}})(RED),exposeNode=function(e,t,a){let n;const o={};function i(){const t=e("#node-input-server").val();if(t&&"_ADD_"!==t)return t}function s(){const e=i();return!(!o[e]||0===o[e])}function r(t){const a=void 0===t||haUtils.compareVersion(t,function(){const e=i();return o[e]&&0!==o[e]?o[e]:"0"}()),n=s()&&a;if(!e("#integrationAlert").length){const n=`\n            <div id="integrationAlert" class="ui-state-error ha-alert-box">\n                <strong>Attention:</strong> \n                This node requires <a href="https://github.com/zachowj/hass-node-red" target="_blank">Node-RED custom integration ${a?"":`version ${t}+`} <i class="fa fa-external-link external-link"></i></a> to be installed in Home Assistant for it to function.\n            </div>`;e("#dialog-form").prepend(n)}e("#integrationAlert").toggle(!n)}return t.comms.subscribe("homeassistant/integration/#",((e,t)=>{const a=e.split("/")[2];o[a]=t.version})),{getValues:function(){const t=[];return e("#haConfig").editableList("items").each((function(a){const n=e(this);t.push({property:n.find("input[name=property]").val(),value:n.find("input[name=value]").val()})})),t},init:function(t){n=t,function(){switch(n.type){case"ha-webhook":case"ha-entity":r();break;default:!function(){const t=e("<div />",{id:"exposeToHa",class:"form-row checkbox-option"+("trigger-state"===n.type?"-left":"")});e("<input />",{type:"checkbox",id:"node-input-exposeToHomeAssistant",checked:n.exposeToHomeAssistant}).on("change",(function(){e("#haConfigRow").toggle(!0===e("#node-input-exposeToHomeAssistant").is(":checked"))})).appendTo(t),e("<label />",{for:"node-input-exposeToHomeAssistant",text:"Expose to Home Assistant"}).appendTo(t);const a=e("<div />",{class:"form-row",id:"haConfigRow"}),o=e("<ol />",{id:"haConfig"}).appendTo(a),i=n.haConfig||[{property:"name",value:""},{property:"icon",value:""}];o.editableList({addButton:!1,header:e("<div>Home Assistant Config (optional)</div>"),addItem:function(t,a,n){const o=e("<div />").appendTo(t);e("<input />",{type:"text",name:"property",value:n.property,style:"width: 40%;",readonly:!0}).appendTo(o),e("<input />",{type:"text",name:"value",value:n.value,style:"margin-left: 10px;width: 55%;"}).attr("autocomplete","disable").appendTo(o)}}).editableList("addItems",i),e("#dialog-form").append(t).append(a),e("#node-input-exposeToHomeAssistant").trigger("change")}()}}(),e("#node-input-server").on("change",(()=>{switch(n.type){case"ha-webhook":case"ha-entity":r();break;case"ha-device":r("0.5.0");break;default:!function(){s()||e("#node-input-exposeToHomeAssistant").prop("checked",!1).trigger("change");e("#exposeToHa").toggle(s())}()}}))},isIntegrationLoaded:s}}(jQuery,RED),ha={alphaWarning:e=>$.parseHTML(`\n            <div class="ui-state-error ha-alpha-box">\n                Alpha version: At this point anything could change or not work.\n                <br />\n                Found an issue? Post it in\n                <a\n                    href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/issues"\n                    target="_blank"\n                    rel="noreferrer"\n                >\n                    issues\n                </a>\n                . Have questions or comments? Post them\n                <a\n                    href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/discussions/${e}"\n                    target="_blank"\n                    rel="noreferrer"\n                >\n                    here\n                </a>\n                .\n            </div>\n        `),betaWarning:e=>$.parseHTML(`\n            <div class="ui-state-error ha-beta-box">\n                Beta version: Config should be stable and hopefully not to many bugs.\n                <br />\n                Found an issue? Post it in\n                <a\n                    href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/issues"\n                    target="_blank"\n                    rel="noreferrer"\n                >\n                    issues\n                </a>\n                . Have questions or comments? Post them\n                <a\n                    href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/discussions/${e}"\n                    target="_blank"\n                    rel="noreferrer"\n                >\n                    here\n                </a>\n                .\n            </div>\n        `),i18n:e=>{let t=RED._(`node-red-contrib-home-assistant-websocket/all:${e}`);return-1!==t.indexOf("\n")&&(t=t.split("\n").map((e=>`<p>${e}</p>`)).join("")),t},labelStyle:function(){const e=[];return nodeVersion.isCurrentVersion(this)||e.push("ha-node-label-legacy"),this.name&&e.push("node_label_italic"),e.join(" ")},nodeColors:{action:"#46B1EF",alpha:"#E78BB9",api:"#7CDFFD",beta:"#77DD77",data:"#5BCBF7",event:"#399CDF",haBlue:"#41BDF5"}},haServer=function(e,t){let a,n,o,i=!1;function s(a,s){"_ADD_"!==n&&e.getJSON(`homeassistant/${a}/${n}`).done((e=>{s(e)})).fail((e=>{503===e.status&&!1===i&&(i=!0,t.notify(o._("config-server.errors.server_deploy")),setTimeout((()=>i=!1),2e3))}))}return{autocomplete:function(e,t){let i=a.val();(o.server||i&&"_ADD_"!==i)&&(n=o.server||i,s(e,t)),a.on("change",(()=>{n=a.val(),n!==i&&(i=n,s(e,t))}))},fetch:function(t,n={}){let o=`homeassistant/${t}/${a.val()}`;return e.isEmptyObject(n)||(o+=`?${e.param(n)}`),new Promise(((t,a)=>{e.getJSON(o).done((e=>t(e))).fail((e=>a(e)))}))},getJSON:function(t,n,{params:o={}}){let i=`homeassistant/${n}/${a.val()}`;e.isEmptyObject(o)||(i+=`?${e.param(o)}`),e.getJSON(i).done((e=>{t(e)}))},init:function(n,i){a=e(i),o=n,o.server||function(){let e;t.nodes.eachConfig((t=>{"server"!==t.type||e||(e=t.id)})),e&&a.val(e)}()}}}(jQuery,RED),ifState=function(e){let t;return{init:function(a,n,o){t=e(a);const i=e(n),s={value:"entity",label:"entity."},r=["str","num","bool","re","jsonata","msg","flow","global",s];"currentState"!==o&&r.splice(5,1),t.after(' <a id="clearIfState" class="editor-button"><i class="fa fa-remove"></i></a>');const l=e("#clearIfState");t.typedInput({default:"str",types:r,typeField:"#node-input-halt_if_type"}),i.on("change",(e=>{let a=r,n=["flow","global",s];switch(r.includes("msg")&&(n=["msg",...n]),e.target.value){case"is":case"is_not":break;case"lt":case"lte":case"gt":case"gte":a=["num","jsonata",...n];break;case"includes":case"does_not_include":a=["str","jsonata",...n];break;case"jsonata":a=["jsonata"]}t.typedInput("types",a)})),i.trigger("change"),t.on("change",(e=>{e.currentTarget.value&&l.show()})),l.on("click",(a=>{t.typedInput("type","str"),t.typedInput("value",""),e(a.currentTarget).hide()})),t.val()||l.hide()}}}(jQuery);!function(e){let t;e((()=>{!function(){const t="home-assistant.ui.migrations",a=ha.i18n(`${t}.title`),n=ha.i18n(`${t}.warning`),o=ha.i18n(`${t}.message`),i=ha.i18n(`${t}.button_label`),s=ha.i18n("home-assistant.ui.notifications.attention"),r=e.parseHTML(`<div id="ha-dialog-confirm" title="${a}">\n                ${o}\n                <div class="ui-state-error ha-alert-box"><strong>${s}:</strong> ${n}</div>\n            </div>`),l=e.parseHTML(`<li>\n                <button id="upgrade-ha-node"><i class="fa fa-refresh"></i> ${i}</button>\n            </li>`);e("body").append(r),e("#red-ui-header .red-ui-header-toolbar").prepend(l)}(),t=e("#upgrade-ha-node"),t.hide(),t.on("click",nodeVersion.migrateAllNodesConfirm)})),RED.events.on("nodes:add",(e=>{nodeVersion.isHomeAssistantNode(e)&&!nodeVersion.isCurrentVersion(e)&&t.show()})),RED.events.on("nodes:remove",(e=>{t.is(":visible")&&nodeVersion.isHomeAssistantNode(e)&&0===nodeVersion.getOldNodeCount()&&t.hide()}))}(jQuery);const nodeVersion=function(e,t,a){function n(t){const n={type:t.type},o=["x","y","z","d","g","l","id","type","wires","inputs","outputs"];for(const e in t._config)!o.includes(e)&&Object.prototype.hasOwnProperty.call(t._config,e)&&(n[e]=t[e]);const i=a.migrate(n);delete i.type;for(const e in i)t._def.defaults[e]&&void 0===t._def.defaults[e].value?delete t[e]:t[e]=i[e];t.dirty=!0,t.changed=!0;const r=e("#upgrade-ha-node");r.is(":visible")&&0===s()&&r.hide()}function o(e){return void 0!==e.version&&e.version>=e._def.defaults.version.value}function i(e){return"node-red-contrib-home-assistant-websocket"===e._def.set.module}function s(){let e=0;return t.nodes.eachNode((t=>{i(t)&&!o(t)&&e++})),t.nodes.eachConfig((t=>{i(t)&&!o(t)&&e++})),e}return{check:function(e){o(e)||function(e){n(e),t.nodes.dirty(!0),t.events.on("editor:close",(function a(){t.events.off("editor:close",a),t.editor.edit(e)})),t.tray.close(),t.notify(ha.i18n("home-assistant.ui.migrations.node_schema_updated"))}(e)},isCurrentVersion:o,isHomeAssistantNode:i,migrateAllNodesConfirm:function(){const a="home-assistant.ui.migrations",s=ha.i18n(`${a}.button_ok`),r=ha.i18n(`${a}.button_cancel`);e("#ha-dialog-confirm").dialog({resizable:!1,height:"auto",width:400,modal:!0,buttons:{[s]:function(){e(this).dialog("close"),t.nodes.eachNode((e=>{i(e)&&!o(e)&&n(e)})),t.nodes.eachConfig((e=>{i(e)&&!o(e)&&n(e)})),t.nodes.dirty(!0),t.notify(ha.i18n("home-assistant.ui.migrations.all_nodes_updated")),t.view.redraw()},[r]:function(){e(this).dialog("close")}}})},getOldNodeCount:s}}(jQuery,RED,haMigrations),haOutputs=function(e){const t="#custom-outputs";let a,n=[];const o={config:{value:"config",label:"config.",hasValue:!0},deviceId:{value:"triggerId",label:"device id",hasValue:!1},entity:{value:"entity",label:"entity",hasValue:!1},entityId:{value:"triggerId",label:"entity id",hasValue:!1},entityState:{value:"entityState",label:"entity state",hasValue:!1},eventData:{value:"eventData",label:"event data",hasValue:!1},headers:{value:"headers",label:"headers",hasValue:!1},params:{value:"params",label:"params",hasValue:!1},prevEntity:{value:"prevEntity",label:"previous entity",hasValue:!1},results:{value:"results",label:"results",hasValue:!1},receivedData:{value:"data",label:"received data",hasValue:!1},sentData:{value:"data",label:"sent data",hasValue:!1},timeSinceChangedMs:{value:"timeSinceChangedMs",label:"timeSinceChangedMs",hasValue:!1},triggerId:{value:"triggerId",label:"trigger id",hasValue:!1}},i=[o.config,"flow","global","str","num","bool","date","jsonata"];function s(){let e=n.reduce(((e,t)=>t in o?[...e,o[t]]:e),[]);if(e=[...e,...i],n.includes("msg")){const t=e.indexOf("flow");e.splice(t,0,"msg")}return e}return{empty:function(){a.empty()},createOutputs:function(t=[],{element:o="#custom-outputs",extraTypes:i=[]}={}){a=e(o),n=i,a.editableList({addButton:!0,removable:!0,sortable:!0,height:"auto",header:e("<div>").append(ha.i18n("home-assistant.label.output_properties")),addItem:function(t,a,n){t.css({overflow:"hidden",whiteSpace:"nowrap"});const o=e("<div />").appendTo(t),i=e("<input/>",{class:"property-name",type:"text"}).css("width","30%").appendTo(o).typedInput({types:["msg","flow","global"]});e("<div/>",{style:"display:inline-block; padding:0px 6px;"}).text("=").appendTo(o);const r=e("<input/>",{class:"property-value",type:"text"}).css("width","calc(70% - 30px)").appendTo(o).typedInput({default:"str",types:s()});i.typedInput("value",n.property),i.typedInput("type",n.propertyType),r.typedInput("value",n.value),r.typedInput("type",n.valueType)}}),a.editableList("addItems",t)},getOutputs:function(){const a=e(t).editableList("items"),n=[];return a.each((function(){const t=e(this).find(".property-name"),a=e(this).find(".property-value"),o=t.typedInput("value"),i=t.typedInput("type"),s=a.typedInput("value"),r=a.typedInput("type");n.push({property:o,propertyType:i,value:s,valueType:r})})),n},loadData:function(e){a.editableList("empty").editableList("addItems",e)},setTypes:function(e){n=e},validate:function(e){return void 0===e||Array.isArray(e)&&!e.some((e=>0===e.property.length))}}}(jQuery),haUtils={compareObjects:function e(t,a){if(t===a)return!0;if("object"!=typeof t||"object"!=typeof a||null==t||null==a)return!1;const n=Object.keys(t),o=Object.keys(a);if(n.length<o.length)return!1;for(const i of o){if(!n.includes(i))return!1;if(!e(t[i],a[i]))return!1}return!0},compareVersion:function(e,t){return(e=e.split(".").map((e=>e.padStart(5))).join("."))<=(t=t.split(".").map((e=>e.padStart(5))).join("."))},deepFind:function(e,t){return e.split(".").reduce(((e,t)=>e[t]),t)}};RED.nodes.registerType("ha-api",{category:"home_assistant",color:ha.nodeColors.haBlue,inputs:1,outputs:1,icon:"font-awesome/fa-paper-plane-o",paletteLabel:"API",label:function(){return this.name||"API"},labelStyle:ha.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.haApiVersion},debugenabled:{value:!1},protocol:{value:"websocket"},method:{value:"get"},path:{value:""},data:{value:""},dataType:{value:"jsonata"},responseType:{value:"json"},outputProperties:{value:[{property:"payload",propertyType:"msg",value:"",valueType:"results"}],validate:haOutputs.validate},location:{value:void 0},locationType:{value:void 0}},oneditprepare:function(){nodeVersion.check(this),haServer.init(this,"#node-input-server"),$("#node-input-data").typedInput({types:["json","jsonata"],typeField:"#node-input-dataType"}),$("#node-input-protocol").on("change",(function(){const e="http"===$(this).val();$(".http").toggle(e),$("#node-input-method").trigger("change")})).trigger("change"),$("#node-input-method").on("change",(function(){const e="http"===$("#node-input-protocol").val()&&"get"===$("#node-input-method").val()?"Params":"Data";$("#data-label").text(e)})),$("#node-input-location").typedInput({types:["msg","flow","global",{value:"none",label:"None",hasValue:!1}],typeField:"#node-input-locationType"}),haOutputs.createOutputs(this.outputProperties,{extraTypes:["results"]})},oneditsave:function(){this.outputProperties=haOutputs.getOutputs()}}),RED.nodes.registerType("api-call-service",{category:"home_assistant",color:ha.nodeColors.haBlue,inputs:1,outputs:1,icon:"ha-call-service.svg",align:"right",paletteLabel:"call service",label:function(){return this.name||`svc: ${this.service_domain}:${this.service}`},labelStyle:ha.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.apiCallServiceVersion},debugenabled:{value:!1},service_domain:{value:""},service:{value:""},entityId:{value:""},data:{value:""},dataType:{value:"jsonata"},mergecontext:{value:null},mustacheAltTags:{value:!1},outputProperties:{value:[],validate:haOutputs.validate},queue:{value:"none"},output_location:{value:void 0},output_location_type:{value:void 0}},oneditprepare:function(){nodeVersion.check(this);const e=this,t=$("#service_domain"),a=$("#service"),n=$("#node-input-entityId"),o=$("#node-input-data"),i=$("#node-input-dataType"),s=$("#service-data-desc"),r=$(".service-description",s),l=$("tbody",s),u=$(".unknown-service",s),p=$(".known-service",s),d=$("#example-data");function c({event:t,serviceText:a}){let n=a;if(!n&&t&&(n=$(t.target).val()),n)if(e.selectedService=e.selectedDomain.services[n],e.selectedService){const t=e.selectedService.description?e.selectedService.description:"No description provided by home assistant",a=e.selectedService.fields;let o=Object.keys(a).reduce(((e,t)=>{const n=a[t];return n.description||n.example?(e.push(`<tr><td><code>${t}</code></td><td>${a[t].description||""}</td><td>${a[t].example||""}</td></tr>`),e):e}),[]);o=o.length>0?o.join(""):"",r.html(t),$("#service-data-desc .title").html(e.selectedDomain.name+"."+n),o?($("#service-data-table").show(),d.show(),l.html(o)):($("#service-data-table").hide(),d.hide(),r.append("<p>No fields documented by home-assistant<p>")),u.hide(),p.show()}else u.show(),p.hide(),d.hide(),$("#service-data-desc .title").val("");else u.show(),p.hide(),d.hide(),$("#service-data-desc .title").val("")}function v({event:t,domainText:n}){let o=n;!o&&t&&(o=$(t.target).val());const i=e.allDomains.indexOf(o)>-1;e.selectedDomain=i?{services:e.allServices[o],name:o}:e.selectedDomain={services:{}},a.autocomplete({source:Object.keys(e.selectedDomain.services).sort(),create:(e,t)=>c({event:e}),change:(e,t)=>c({event:e}),select:(e,t)=>c({event:e}),focus:(e,t)=>c({event:e}),minLength:0}).focus((function(){a.autocomplete("search")}))}t.val(e.service_domain),a.val(e.service),o.typedInput({default:"jsonata",types:["jsonata","json"],typeField:"#node-input-dataType"}),o.on("change",(function(){$("#mustacheAltTags").toggle("json"===i.val())})),haServer.init(e,"#node-input-server"),haServer.autocomplete("entities",(t=>{function a(e){return e.split(/,\s*/)}e.availableEntities=t,n.on("keydown",(function(e){e.keyCode===$.ui.keyCode.TAB&&$(this).autocomplete().data("uiAutocomplete").menu.active&&e.preventDefault()})).autocomplete({minLength:0,source:function(t,n){n($.ui.autocomplete.filter(e.availableEntities,a(t.term).pop()))},focus:function(){return!1},select:function(e,t){const n=a(this.value);return n.pop(),n.push(t.item.value),n.push(""),this.value=n.join(", "),!1}})})),haServer.autocomplete("services",(a=>(e.allServices=a,e.allDomains=Object.keys(e.allServices).sort(),t.autocomplete({source:e.allDomains,create:(e,t)=>v({event:e}),change:(e,t)=>v({event:e}),select:(e,t)=>v({event:e}),minLength:0}).focus((function(){t.autocomplete("search")})),v({domainText:e.service_domain||""}),c({serviceText:e.service||""}),e))),d.on("click",(()=>{const t=e.selectedService.fields,a=Object.keys(t).reduce(((e,a)=>{const o=t[a].example;if("entity_id"===a)return n.val(o),e;if("["===o[0]&&"]"===o[o.length-1])try{e[a]=JSON.parse(o)}catch(e){}else isNaN(o)?'"'===o[0]&&'"'===o[o.length-1]?e[a]=o.substring(1,o.length-1):e[a]=o:e[a]=Number(o);return e}),{});Object.keys(a).length&&o.typedInput("value",JSON.stringify(a))})),haOutputs.createOutputs(this.outputProperties,{extraTypes:["sentData","msg"]})},oneditsave:function(){const e=$("#node-input-entityId"),t=e.val();this.service_domain=$("#service_domain").val(),this.service=$("#service").val(),t.length&&e.val(t.replace(/\s*,\s*$/,"")),this.outputProperties=haOutputs.getOutputs()}}),RED.nodes.registerType("server",{category:"config",defaults:{name:{value:"Home Assistant",required:!1},version:{value:RED.settings.serverVersion},legacy:{value:!1},addon:{value:!1},rejectUnauthorizedCerts:{value:!0},ha_boolean:{value:"y|yes|true|on|home|open"},connectionDelay:{value:!0},cacheJson:{value:!0}},credentials:{host:{value:"",required:!0},access_token:{value:"",required:!1}},icon:"font-awesome/fa-home",label:function(){return this.name||this.url},oneditprepare:function(){nodeVersion.check(this);const e=$("#node-config-input-addon"),t=$("#node-config-input-host"),a=$("#node-config-input-legacy");!1===this.rejectUnauthorizedCerts&&$("#accept_unauthorized_certs").prop("checked",!0);function n(){$("#server-info").toggle(!e.prop("checked")),$(".addon").toggle(e.prop("checked"))}function o(){const e=a.prop("checked")?"Password":"Access Token";$("#access-token-label").html('<i class="fa fa-user-secret"></i> '+e),$("#node-config-input-access_token").attr("placeholder",e.toLowerCase())}["http://hassio/homeassistant","http://supervisor/core"].includes(t.val())&&e.prop("checked",!0),n(),e.on("click",(function(){n()})),o(),a.on("click",(function(){o()}));try{t.autocomplete("destroy")}catch(e){}const i=$("#discoverInstances");i.on("click",(function(){if($(this).hasClass("disabled"))return;const e=$("i",this).removeClass("fa-search").addClass("spinner");i.addClass("disabled"),t.autocomplete({source:(e,t)=>{$.ajax({dataType:"json",url:"/homeassistant/discover",cache:!1}).done((e=>{t(e)}))},minLength:0,response:()=>{e.addClass("fa-search").removeClass("spinner"),i.removeClass("disabled")},close:(e,a)=>{t.autocomplete("destroy")}}).autocomplete("search","")}))},oneditsave:function(){const e=$("#node-config-input-addon").is(":checked"),t=$("#node-config-input-host").val();if(e)this.addon=!0,this.legacy=!1,this.rejectUnauthorizedCerts=!0;else{const e=document.createElement("a");e.href=t,t!==e.origin&&RED.notify("Invalid format of Base URL: "+t),this.rejectUnauthorizedCerts=!$("#accept_unauthorized_certs").prop("checked"),this.connectionDelay=!1}}}),RED.nodes.registerType("api-current-state",{category:"home_assistant",color:ha.nodeColors.haBlue,inputs:1,outputs:1,outputLabels:function(e){if(this.halt_if||this.haltifstate){if(0===e)return"'If State' is true";if(1===e)return"'If State' is false"}},icon:"ha-current-state.svg",paletteLabel:"current state",label:function(){return this.name||`current_state: ${this.entity_id}`},labelStyle:ha.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.apiCurrentStateVersion},outputs:{value:1},halt_if:{value:""},halt_if_type:{value:"str"},halt_if_compare:{value:"is"},entity_id:{value:""},state_type:{value:"str"},blockInputOverrides:{value:!1},outputProperties:{value:[{property:"payload",propertyType:"msg",value:"",valueType:"entityState"},{property:"data",propertyType:"msg",value:"",valueType:"entity"}],validate:haOutputs.validate},override_topic:{value:!1},state_location:{value:"payload"},override_payload:{value:"msg"},entity_location:{value:"data"},override_data:{value:"msg"}},oneditprepare:function(){nodeVersion.check(this);const e=$("#node-input-entity_id");haServer.init(this,"#node-input-server"),e.haAutocomplete(),ifState.init("#node-input-halt_if","#node-input-halt_if_compare","currentState"),haOutputs.createOutputs(this.outputProperties,{extraTypes:["entity","entityId","entityState"]})},oneditsave:function(){const e=$("#node-input-halt_if").val()?2:1;$("#node-input-outputs").val(e),this.outputProperties=haOutputs.getOutputs()}});const haDeviceTrigger={inputCount:0,getCapabilitiesList:async e=>await haServer.fetch("deviceTriggerCapabilities",{trigger:e}),getEventList:async e=>await haServer.fetch("deviceTriggers",{deviceId:e}),setDefaultOutputs:e=>e},haDeviceAction={inputCount:1,getCapabilitiesList:async e=>await haServer.fetch("deviceActionCapabilities",{action:e}),getEventList:async e=>await haServer.fetch("deviceActions",{deviceId:e}),setDefaultOutputs:()=>[]},haDevice=function(e,t){return{getDevice:a=>"action"===a?e:t,validateCapabilities:e=>{if(!Array.isArray(e))return!0;for(const t of e)switch(t.type){case"float":if(!Number.isFinite(Number(t.value)))return!1;break;case"positive_time_period_dict":if(-1===Math.sign(t.value))return!1;break}return!0}}}(haDeviceAction,haDeviceTrigger),haDeviceUI=function(e){function t(e,t=[]){return`<div class="form-row ${t.join(" ")}">${e}</div>`}return{createDeviceExtraFields:function(e=[],a){let n="";return e.forEach((e=>{const o=a&&a.find((t=>t.name===e.name));let i;switch(e.type){case"float":i=function(e,a){const n=`deviceExtra-${e.name}`,o=a?a.value:"",i=["above","below"].includes(e.name)?`<i class="fa fa-angle-double-${"above"===e.name?"up":"down"}"></i> `:"";let s=`\n        <label for="${n}">\n            ${i}${e.name}\n        </label>\n        <input type="text" id="${n}" style="width: 35%" value="${o}"/>        \n        `;e.description&&e.description.suffix&&(s+=`<span>${e.description.suffix}</span>`);return t(s,["deviceExtra"])}(e,o);break;case"positive_time_period_dict":i=function(e,a){const n=`deviceExtra-${e.name}`,o=a?a.value:"",i=e=>a&&e===a.unit?"selected":"",s="ha-device.label",r={seconds:ha.i18n(`${s}.seconds`),minutes:ha.i18n(`${s}.minutes`),hours:ha.i18n(`${s}.hours`)};return t(`\n        <label for="${n}">\n            <i class="fa fa-clock-o"></i> ${e.name}\n        </label>\n        <input type="text" id="${n}" style="width: 35%" value="${o}"/>\n        <select id="${n}Units" style="width: 35%">\n            <option value="seconds" ${i("seconds")}>${r.seconds}</option>\n            <option value="minutes" ${i("minutes")}>${r.minutes}</option>\n            <option value="hours" ${i("hours")}>${r.hours}</option>\n        </select>`,["deviceExtra"])}(e,o);break;case"string":i=function(e,a){const n=`deviceExtra-${e.name}`,o=a?a.value:"";return t(`\n        <label for="${n}">${e.name}</label>\n        <input type="text" id="${n}" style="width: 70%" value="${o}"/>\n        `,["deviceExtra"])}(e,o)}i&&(n+=i)})),n},createOption:function(e){},getCapabilities:function(t=[]){return t.reduce(((t,a)=>{const n=`deviceExtra-${a.name}`,o=e(`#${n}`).val();switch(a.type){case"float":case"positive_time_period_dict":if(o&&o.length&&!isNaN(o)){const i={name:a.name,type:a.type,value:Number(o)};"positive_time_period_dict"===a.type&&(i.unit=e(`#${n}Units`).val()),t.push(i)}break;case"string":o.length&&t.push({name:a.name,type:a.type,value:o})}return t}),[])}}}(jQuery);function generateId(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return Array.from({length:e},(()=>t[Math.floor(Math.random()*t.length)])).join("")}RED.nodes.registerType("ha-device",{category:"home_assistant",color:ha.nodeColors.alpha,inputs:0,outputs:1,icon:"font-awesome/fa-cube",paletteLabel:"device",label:function(){return this.name||`device ${this.deviceType}`},labelStyle:ha.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.haDeviceVersion},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},inputs:{value:0},deviceType:{value:"trigger"},device:{value:""},event:{value:void 0,validate:e=>void 0!==e},capabilities:{value:[],validate:haDevice.validateCapabilities},outputProperties:{value:[{property:"payload",propertyType:"msg",value:"",valueType:"eventData"},{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}],validate:haOutputs.validate}},oneditprepare:function(){nodeVersion.check(this),haServer.init(this,"#node-input-server"),exposeNode.init(this);const e="_ADD_",t="trigger",a=$("#node-input-server"),n=$("#node-input-deviceType"),o=$("#node-input-device"),i=$("#event");let s,r=haDevice.getDevice(n.val());o.select2({theme:"nodered"}).on("select2:select",(e=>m(e.target.value))),i.on("change",(function(e){const t=e.target.value;if("__NONE__"===t)return;const a=i.data("events");g(a[t])}));const l=(e,t)=>{const a=haUtils.deepFind("name",e),n=haUtils.deepFind("name",t);return a===n?0:"string"!=typeof a?1:a.localeCompare(n)},u=()=>{h(),y()},p=async()=>{const e=RED.i18n.lang();s=await haServer.fetch("translations",{cat:"device_automation",lang:e}).catch((()=>{RED.notify("Error retrieving translations.","error")}))},d=t=>{const n=a.val();if(n===e)return;const i=haData.getDevices(n);if(!i)return;const s=i.map((e=>({id:e.id,name:e.name_by_user||e.name}))).sort(l).reduce(((e,a)=>{const n=a.id===t;return e.push(new Option(a.name,a.id,n,n)),e}),[]);o.empty().append(s)},c=async()=>{u(),a.val()!==e&&(p(),d(),m(o.val()))},v=e=>{const a=o.val(),n=e.target.value;y(),a&&(r=haDevice.getDevice(n),m(a)),haOutputs.setTypes(b(n));const i=n===t?this._def.defaults.outputProperties.value:[],s=r.setDefaultOutputs(i);haOutputs.loadData(s),$("#event").prev().text(n),$("#haConfigRow").toggle(n===t)};a.one("change",(()=>{u(),d(this.device),a.val()!==e&&(p(),m(this.device,this.event,this.capabilities)),setTimeout((()=>{a.on("change",c),n.on("change",v)}),100)}));const h=()=>{i.html(`<option value="__NONE__">No ${n.val()}s</option>`).trigger("change").prop("disabled",!0)},y=()=>{$(".deviceExtra").remove()},m=async(e,t,a)=>{if(!e)return;const o=await r.getEventList(e);let s;if(0===o.length)h(),y(),s=0;else{const e=n.val();i.data("events",o).empty().prop("disabled",!1);const r=[];for(let t=0;t<o.length;t++){const a=await f(e,o[t]);r.push(new Option(a,t))}i.append(r),s=o.findIndex((e=>haUtils.compareObjects(t,e))),s=-1===s?0:s,g(o[s],a)}$("option",i).eq(s).prop("selected",!0)},g=async(e,t)=>{y();const a=await r.getCapabilitiesList(e);if(a.extra_fields&&a.extra_fields.length){i.data("capabilities",a.extra_fields);const e=haDeviceUI.createDeviceExtraFields(a.extra_fields,t);i.parent().after(e)}},f=async(e,t)=>{const n=(a="type")=>`component.${t.domain}.device_automation.${e}_${a}.${t[a]}`;let o=s&&s[n()]||(t.subtype?`"${t.subtype}" ${t.type}`:t.type);const i={entity_name:async()=>{if(!t.entity_id)return"<unknown>";const e=haData.getEntity(a.val(),t.entity_id);return e?e.attributes&&void 0!==e.attributes.friendly_name?e.attributes.friendly_name||"":t.entity_id.split(".")[1].replace(/_/g," "):""},subtype:()=>s[n("subtype")]||t.subtype};for(const e in i){const t=`{${e}}`;if(-1!==o.indexOf(t)){const a=await i[e]();o=o.replace(t,a)}}return o},b=e=>({action:["sentData"],trigger:["eventData","deviceId"]}[e]);$("#dialog-form").prepend(ha.alphaWarning(367)),haOutputs.createOutputs(this.outputProperties,{extraTypes:b(n.val())}),$("#haConfigRow").toggle(n.val()===t),$("#exposeToHa").remove()},oneditsave:function(){const e=haDevice.getDevice($("#node-input-deviceType").val()),t=$("#event"),a=t.val();if(this.inputs=e.inputCount,"__NONE__"!==a){const e=t.data("events"),n=t.data("capabilities");this.event=e[a],this.capabilities=haDeviceUI.getCapabilities(n)}this.haConfig=exposeNode.getValues(),this.outputProperties=haOutputs.getOutputs()}}),RED.nodes.registerType("ha-entity",{category:"home_assistant",color:ha.nodeColors.haBlue,inputs:1,outputs:1,icon:function(){return"switch"===this.entityType?"ha-entity-switch.svg":"font-awesome/fa-genderless"},align:"right",paletteLabel:"entity",label:function(){return this.name||`type: ${this.entityType}`},labelStyle:ha.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.haEntityVersion},debugenabled:{value:!1},outputs:{value:1},entityType:{value:"sensor"},config:{value:[{property:"name",value:""},{property:"device_class",value:""},{property:"icon",value:""},{property:"unit_of_measurement",value:""}]},state:{value:"payload"},stateType:{value:"msg"},attributes:{value:[]},resend:{value:!0},outputLocation:{value:"payload"},outputLocationType:{value:"none"},inputOverride:{value:"allow"},outputOnStateChange:{value:!1},outputPayload:{value:'$entity().state ? "on": "off"'},outputPayloadType:{value:"jsonata"}},oneditprepare:function(){nodeVersion.check(this);const e=this,t={binary_sensor:["msg","flow","global","jsonata","str","num","bool"],sensor:["msg","flow","global","jsonata","str","num","bool","date"],switch:["msg"]},a={binary_sensor:["name","device_class","icon","unit_of_measurement"],sensor:["name","device_class","icon","unit_of_measurement"],switch:["name","icon"]},n=["str","num","bool","date","jsonata","msg","flow","global"],o={binary_sensor:["state","attributes","output-location","input-override","resend","debug"],sensor:["state","attributes","output-location","input-override","resend","debug"],switch:["output-on-state-change","output-payload"]};haServer.init(e,"#node-input-server"),exposeNode.init(e),$("#node-input-state").typedInput({types:t[$("#node-input-entityType").val()],typeField:"#node-input-stateType",type:e.stateType}),$("#attributes").editableList({removable:!0,addButton:"add attribute",header:$("<div>").append($.parseHTML("<div style='width:40%; display: inline-grid'>Attribute Key</div><div style='display: inline-grid'>Value</div>")),addItem:function(e,t,a){const o=$("<div />").appendTo(e);$("<input />",{type:"text",name:"property",style:"width: 40%;margin-right: 5px;"}).attr("autocomplete","disable").appendTo(o).val(a.property);$("<input />",{type:"text",name:"value",style:"width: 55%;"}).appendTo(o).val(a.value).typedInput({types:n}).typedInput("type",a.valueType)}}).editableList("addItems",e.attributes),$("#config").editableList({addButton:!1,header:$("<div>Home Assistant Config (optional)</div>"),addItem:function(e,t,a){const n=$("<div />").appendTo(e);$("<input />",{type:"text",name:"property",value:a.property,style:"width: 40%;",readonly:!0}).appendTo(n),$("<input />",{type:"text",name:"value",value:a.value,style:"margin-left: 10px;width: 55%;"}).attr("autocomplete","disable").appendTo(n)}}).editableList("addItems",e.config);const i={value:"none",label:"none",hasValue:!1};$("#node-input-outputLocation").typedInput({types:["msg","flow","global",i],typeField:"#node-input-outputLocationType"}),$("#node-input-outputPayload").typedInput({types:["str","num","bool","jsonata","date",i],typeField:"#node-input-outputPayloadType"}),$("#node-input-entityType").on("change",(function(){const n=$(this).val();switch($("#node-input-state").typedInput("types",t[n]),$("#dialog-form .form-row").each((function(){const e=$(this);if(e.attr("class").split(" ").includes("optional-row")){const t=e.attr("id");e.toggle(o[n].includes(t.replace(/-row$/,"")))}})),n){case"switch":e.outputs=2,$("#config").editableList("filter",(e=>a[n].includes(e.property)));break;case"binary_sensor":case"sensor":default:e.outputs=1,$("#config").editableList("filter",null),$("#node-input-outputOnStateChange").prop("checked",!1).trigger("change")}})).trigger("change"),$("#node-input-outputOnStateChange").on("change",(function(){"switch"===$("#node-input-entityType").val()&&$(this).prop("checked")?$("#output-payload-row").show():$("#output-payload-row").hide()})).trigger("change")},oneditsave:function(){const e=this;e.attributes=[],e.config=[],$("#attributes").editableList("items").each((function(t){const a=$(this);e.attributes.push({property:a.find("input[name=property]").val(),value:a.find("input[name=value]").typedInput("value"),valueType:a.find("input[name=value]").typedInput("type")})})),$("#config").editableList("items").each((function(t){const a=$(this);e.config.push({property:a.find("input[name=property]").val(),value:a.find("input[name=value]").val()})}))}}),RED.nodes.registerType("server-events",{category:"home_assistant",color:ha.nodeColors.haBlue,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.serverEventsVersion},event_type:{value:"",required:!1},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},waitForRunning:{value:!0},outputProperties:{value:[{property:"payload",propertyType:"msg",value:"",valueType:"eventData"},{property:"topic",propertyType:"msg",value:'$outputData("eventData").event_type',valueType:"jsonata"}],validate:haOutputs.validate}},inputs:0,outputs:1,icon:"ha-events-all.svg",paletteLabel:"events: all",label:function(){return this.name||`events: ${this.event_type||"all"}`},labelStyle:ha.labelStyle,oneditprepare:function(){nodeVersion.check(this),haServer.init(this,"#node-input-server"),exposeNode.init(this),$("#node-input-event_type").on("change keyup",(function(){$("#eventAlert").toggle(0===$(this).val().length)})),haOutputs.createOutputs(this.outputProperties,{extraTypes:["eventData"]})},oneditsave:function(){this.haConfig=exposeNode.getValues(),this.outputProperties=haOutputs.getOutputs()}}),RED.nodes.registerType("server-state-changed",{category:"home_assistant",color:ha.nodeColors.haBlue,inputs:0,outputs:1,outputLabels:["'If State' is true","'If State' is false"],icon:"ha-events-state-changed.svg",paletteLabel:"events: state",label:function(){return this.name||`state_changed: ${this.entityidfilter||"all entities"}`},labelStyle:ha.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.serverStateChangedVersion},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},entityidfilter:{value:"",required:!0},entityidfiltertype:{value:"exact"},outputinitially:{value:!1},state_type:{value:"str"},haltifstate:{value:""},halt_if_type:{value:"str"},halt_if_compare:{value:"is"},outputs:{value:1},output_only_on_state_change:{value:!0},for:{value:0},forType:{value:"num"},forUnits:{value:"minutes"},ignorePrevStateNull:{value:!1},ignorePrevStateUnknown:{value:!1},ignorePrevStateUnavailable:{value:!1},ignoreCurrentStateUnknown:{value:!1},ignoreCurrentStateUnavailable:{value:!1},outputProperties:{value:[{property:"payload",propertyType:"msg",value:"",valueType:"entityState"},{property:"data",propertyType:"msg",value:"",valueType:"eventData"},{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}],validate:haOutputs.validate}},oneditprepare:function(){nodeVersion.check(this);const e=$("#node-input-entityidfilter"),t=this;haServer.init(t,"#node-input-server"),exposeNode.init(t),haServer.autocomplete("entities",(a=>{t.availableEntities=a,e.autocomplete({source:t.availableEntities,minLength:0})})),ifState.init("#node-input-haltifstate","#node-input-halt_if_compare"),$("#node-input-for").typedInput({default:"num",types:["num","jsonata","flow","global"],typeField:"#node-input-forType"}),haOutputs.createOutputs(this.outputProperties,{extraTypes:["eventData","entityId","entityState"]})},oneditsave:function(){const e=$("#node-input-haltifstate").val()?2:1;$("#node-input-outputs").val(e),this.haConfig=exposeNode.getValues(),this.outputProperties=haOutputs.getOutputs()}}),RED.nodes.registerType("ha-fire-event",{category:"home_assistant",color:ha.nodeColors.haBlue,inputs:1,outputs:1,icon:"ha-fire-event.svg",align:"right",paletteLabel:"fire event",label:function(){return this.name||`Event: ${this.event}`},labelStyle:ha.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.haFireEventVersion},event:{value:""},data:{value:""},dataType:{value:"jsonata"}},oneditprepare:function(){nodeVersion.check(this);haServer.init(this,"#node-input-server"),$("#node-input-data").typedInput({types:["json","jsonata"],typeField:"#node-input-dataType"})}}),RED.nodes.registerType("ha-get-entities",{category:"home_assistant",color:ha.nodeColors.haBlue,inputs:1,outputs:1,icon:"ha-get-entities.svg",paletteLabel:"get entities",label:function(){return this.name||"get entities"},labelStyle:ha.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.haGetEntitiesVersion},rules:{value:[{property:"",logic:"is",value:"",valueType:"str"}]},output_type:{value:"array"},output_empty_results:{value:!1},output_location_type:{value:"msg"},output_location:{value:"payload"},output_results_count:{value:1,validate:function(e){return"random"!==$("#node-input-output_type").val()||Number.isInteger(Number(e))}}},oneditprepare:function(){nodeVersion.check(this);const e=[{value:"is",text:"is"},{value:"is_not",text:"is not"},{value:"lt",text:"<"},{value:"lte",text:"<="},{value:"gt",text:">"},{value:"gte",text:">="},{value:"includes",text:"in"},{value:"does_not_include",text:"not in"},{value:"starts_with",text:"starts with"},{value:"in_group",text:"in group"},{value:"jsonata",text:"JSONata"}],t={value:"entity",label:"entity."},a=["str","num","bool","re","jsonata","msg","flow","global",t],n=$("#logic");let o=[];haServer.init(this,"#node-input-server"),haServer.autocomplete("properties",(e=>{o=e,$(".input-property").autocomplete({source:o,minLength:0})})),n.editableList({addButton:!0,removable:!0,height:"auto",addItem:function(n,i,s){const r=$("<div />",{class:"editable-list-row"}).appendTo(n),l=$("<div />",{class:"editable-list-row"}).appendTo(n);Object.prototype.hasOwnProperty.call(s,"logic")||(s.logic="is"),$("<span />",{text:"Property",style:"padding-right: 47px;"}).appendTo(r);const u=$("<input />",{type:"text",class:"input-property",style:"margin-left: 5px;"}).appendTo(r).val(s.property);u.autocomplete({source:o,minLength:0});const p=$("<select/>",{style:"margin-right: 5px;width: auto;"}).appendTo(l).change((function(e){let n=a;switch(u.prop("disabled","jsonata"===e.target.value),e.target.value){case"is":case"is_not":break;case"lt":case"lte":case"gt":case"gte":n=["num","jsonata","msg","flow","global",t];break;case"includes":case"does_not_include":case"starts_with":case"in_group":n=["str","jsonata","msg","flow","global",t];break;case"jsonata":n=["jsonata"]}d.typedInput("types",n)}));for(const t in e)p.append($("<option></option>").val(e[t].value).text(e[t].text));const d=$("<input />",{class:"input-value",type:"text",style:"width: 70%;"}).appendTo(l).val(s.value).typedInput({types:a});d.typedInput("type",s.valueType),p.val(s.logic).trigger("change")}}),n.editableList("addItems",this.rules),$("#node-input-output_location").typedInput({types:["msg","flow","global"],typeField:"#node-input-output_location_type"}),$("#node-input-output_results_count").spinner({min:1}),$("#node-input-output_type").on("change",(function(e){switch($(".output-option").hide(),e.target.value){case"array":$("#output_empty_results").show(),$("#output_location").show();break;case"count":$("#output_location").show();break;case"random":$("#output_results_count").show(),$("#output_location").show()}})).trigger("change")},oneditsave:function(){const e=$("#logic").editableList("items"),t=this;t.rules=[],e.each((function(e){const a=$(this),n=a.find(".input-property").val(),o=a.find("select").val(),i=a.find(".input-value").typedInput("value"),s=a.find(".input-value").typedInput("type");t.rules.push({property:n,logic:o,value:i,valueType:s})}))}}),RED.nodes.registerType("api-get-history",{category:"home_assistant",color:ha.nodeColors.haBlue,inputs:1,outputs:1,icon:"ha-get-history.svg",paletteLabel:"get history",label:function(){if(this.name)return this.name;if(this.useRelativeTime&&this.relativeTime)return this.relativeTime;if(this.startdate){const e=new Date(this.startdate);return`${e.toLocaleDateString()} ${e.toLocaleTimeString()}`}return"get history"},labelStyle:ha.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.apiGetHistoryVersion},startdate:{value:""},enddate:{value:""},entityid:{value:""},entityidtype:{value:""},useRelativeTime:{value:!1},relativeTime:{value:""},flatten:{value:!0},output_type:{value:"array"},output_location_type:{value:"msg"},output_location:{value:"payload"}},oneditprepare:function(){nodeVersion.check(this),this.entityidtype=this.entityidtype||"is",$("#node-input-entityidtype").val(this.entityidtype),haServer.init(this,"#node-input-server"),$("#node-input-entityid").haAutocomplete(),$("#node-input-useRelativeTime").on("change",(function(){this.checked?($(".relative_row").show(),$(".date_row").hide()):($(".relative_row").hide(),$(".date_row").show())})),$("#node-input-output_location").typedInput({types:["msg","flow","global"],typeField:"#node-input-output_location_type"}),$("#node-input-output_type").on("change",(e=>$(".output-option").toggle("array"===e.target.value))).trigger("change")}}),RED.nodes.registerType("poll-state",{category:"home_assistant",color:ha.nodeColors.haBlue,inputs:0,outputs:1,outputLabels:["'If State' is true","'If State' is false"],icon:"ha-poll-state.svg",paletteLabel:"poll state",label:function(){return this.name||`poll state: ${this.entity_id}`},labelStyle:ha.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.pollStateVersion},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},updateinterval:{value:"60",validate:e=>!isNaN(e)},updateIntervalUnits:{value:"seconds"},outputinitially:{value:!1},outputonchanged:{value:!1},entity_id:{value:"",required:!0},state_type:{value:"str"},halt_if:{value:""},halt_if_type:{value:"str"},halt_if_compare:{value:"is"},outputs:{value:1}},oneditprepare:function(){nodeVersion.check(this);haServer.init(this,"#node-input-server"),$("#node-input-entity_id").haAutocomplete(),$("#node-input-updateinterval").spinner({min:1}),ifState.init("#node-input-halt_if","#node-input-halt_if_compare"),exposeNode.init(this)},oneditsave:function(){const e=$("#node-input-halt_if").val()?2:1;$("#node-input-outputs").val(e),this.haConfig=exposeNode.getValues()}}),RED.nodes.registerType("api-render-template",{category:"home_assistant",color:ha.nodeColors.haBlue,inputs:1,outputs:1,icon:"ha-render-template.svg",paletteLabel:"render template",label:function(){return this.name||`template: ${this.template||""}`},labelStyle:ha.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.apiRenderTemplateVersion},template:{value:""},resultsLocation:{value:"payload"},resultsLocationType:{value:"msg"},templateLocation:{value:"template"},templateLocationType:{value:"msg"}},oneditprepare:function(){nodeVersion.check(this);const e=$("#node-input-server"),t=function(){let t;RED.nodes.eachConfig((e=>{"server"!==e.type||t||(t=e.id)})),t&&e.val(t)};this.server||t();const a=$("#node-input-template");$("#node-input-templateLocation").typedInput({types:["msg","flow","global",{value:"none",label:"none",hasValue:!1}],typeField:"#node-input-templateLocationType"}),$("#node-input-resultsLocation").typedInput({types:["msg","flow","global",{value:"none",label:"none",hasValue:!1}],typeField:"#node-input-resultsLocationType"}),this.editor=RED.editor.createEditor({id:"node-input-template-editor",value:a.val()}),this.editor.focus()},oneditresize:function(e){const t=$("#dialog-form>div:not(.node-text-editor-row)"),a=$("#dialog-form>div.node-text-editor-row"),n=$(".node-text-editor");let o=$("#dialog-form").height();for(let e=0;e<t.size();e++)o-=$(t[e]).outerHeight(!0);o-=parseInt(a.css("marginTop"))+parseInt(a.css("marginBottom")),n.css("height",`${o}px`),this.editor.resize()},oneditcancel:function(){this.editor.destroy(),delete this.editor},oneditsave:function(){const e=this.editor.getValue();$("#node-input-template").val(e),this.editor.destroy(),delete this.editor}}),RED.nodes.registerType("ha-tag",{category:"home_assistant",color:ha.nodeColors.beta,outputs:1,icon:"font-awesome/fa-tag",paletteLabel:"tag",label:function(){return this.name||"tag"},labelStyle:ha.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.haTagVersion},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},tags:{value:[""],required:!0,validate:function(e){return e.length}},devices:{value:[]}},oneditprepare:function(){nodeVersion.check(this);const e=$("#tags"),t=$("#devices");let a=[];haServer.init(this,"#node-input-server"),haServer.autocomplete("tags",(t=>{a=t,e.editableList("addItems",this.tags),n()})),exposeNode.init(this),$("#dialog-form").prepend(ha.betaWarning(348));const n=()=>{$("#no-tags-found").toggle(0===a.length)},o=t=>{a=t;const o=new Set;e.editableList("items").each((function(){const e=$(this).find("select").val();o.add(e)}));const i=Array.from(o).filter((e=>a.find((t=>t.id===e))));e.editableList("empty").editableList("addItems",i),n()};$("#update-tag-list").on("click",(()=>{haServer.getJSON(o,"tags",{params:{update:!0}})}));e.editableList({addButton:!0,removable:!0,height:"auto",header:$("<div>").append("Tags"),addItem:function(e,t,n){const o=$("<div />").appendTo(e);$("<span />",{text:"Tag",style:"padding-right: 74px;"}).appendTo(o),((e,t)=>{const n=$("<select>").appendTo(e);a.forEach((e=>{$("<option>").attr({value:e.id,selected:e.id===t}).text(e.name).appendTo(n)}))})(o,n)}}),t.editableList({addButton:!0,removable:!0,height:"auto",header:$("<div>").append("Devices"),addItem:function(e,t,a){const n=$("<div />").appendTo(e);$("<span />",{text:"Device ID",style:"padding-right: 35px;"}).appendTo(n);const o=$.isEmptyObject(a)?"":a;$("<input />",{type:"text",class:"input-device"}).appendTo(n).val(o)}}),t.editableList("addItems",this.devices)},oneditsave:function(){const e=$("#tags").editableList("items"),t=$("#devices").editableList("items"),a=new Set,n=new Set;e.each((function(){const e=$(this).find("select").val();a.add(e)})),t.each((function(){const e=$(this).find(".input-device").val().replace(/\s/g,"");e.length&&n.add(e)})),this.tags=Array.from(a),this.devices=Array.from(n),this.haConfig=exposeNode.getValues()}}),RED.nodes.registerType("ha-time",{category:"home_assistant",color:ha.nodeColors.beta,outputs:1,icon:"font-awesome/fa-clock-o",paletteLabel:"time",label:function(){return this.name||(this.entityId?`${this.entityId}.${this.property||"state"}`:"time")},labelStyle:ha.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.haTimeVersion},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},entityId:{value:"",required:!0},property:{value:""},offset:{value:0},offsetType:{value:"num"},offsetUnits:{value:"minutes"},randomOffset:{value:!1},repeatDaily:{value:!1},payload:{value:"$entity().state"},payloadType:{value:"jsonata"},debugenabled:{value:!0}},oneditprepare:function(){nodeVersion.check(this);const e=$("#node-input-server"),t=$("#node-input-entityId");haServer.init(this,"#node-input-server"),t.haAutocomplete(),$("#node-input-property").autocomplete({source:(a,n)=>{const o=haData.getProperties(e.val(),t.val());n($.ui.autocomplete.filter(o,a.term))},minLength:0}),exposeNode.init(this),$("#dialog-form").prepend(ha.betaWarning(380)),$("#node-input-offset").typedInput({types:["num","jsonata"],typeField:"#node-input-offsetType"}),$("#node-input-payload").typedInput({types:["str","num","bool","jsonata","date"],typeField:"#node-input-payloadType"})},oneditsave:function(){this.haConfig=exposeNode.getValues()}}),RED.nodes.registerType("trigger-state",{category:"home_assistant",color:ha.nodeColors.haBlue,inputs:1,outputs:2,outputLabels:function(e){if(0===e)return"allowed";if(1===e)return"blocked";const t=this.customoutputs[e-2];let a;return a="always"===t.comparatorPropertyType?"always sent":`${t.comparatorPropertyType.replace("_"," ")} ${t.comparatorType.replace("_","")} ${t.comparatorValue}`,a},icon:"font-awesome/fa-map-signs",paletteLabel:"trigger: state",label:function(){return this.name||`trigger-state: ${this.entityid}`},labelStyle:ha.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.triggerStateVersion},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},entityid:{value:"",required:!0},entityidfiltertype:{value:"exact"},debugenabled:{value:!1},constraints:{value:[{targetType:"this_entity",targetValue:"",propertyType:"current_state",propertyValue:"new_state.state",comparatorType:"is",comparatorValueDatatype:"str",comparatorValue:""}]},outputs:{value:2},customoutputs:{value:[]},outputinitially:{value:!1},state_type:{value:"str"}},oneditprepare:function(){nodeVersion.check(this);const e=$("#constraint-list"),t=$("#output-list");let a=[],n=[],o=[];haServer.init(this,"#node-input-server"),haServer.autocomplete("entities",(e=>{a=e,$("#node-input-entityid").autocomplete({source:e,minLength:0})})),haServer.autocomplete("properties",(e=>{n=e,o=[...e.map((e=>`new_state.${e}`)),...e.map((e=>`old_state.${e}`))].sort()})),exposeNode.init(this);const i=$("#node-input-outputs").val('{"0": 0, "1": 1}'),s=()=>JSON.parse(i.val()),r=e=>{i.val(JSON.stringify(e))},l=e=>{t.editableList("items").each((function(t){const a=$(this).data("data");e[Object.prototype.hasOwnProperty.call(a,"index")?a.index:a._index]=t+2}))};e.on("change",".target-type",(function(){const e=$(this),t="this_entity"===e.val(),a=e.parent().parent(),n=e.next(),o=a.find(".property-type");t?n.attr("disabled","disabled").val(""):n.removeAttr("disabled"),o.find("option[value=previous_state]").toggle(t),"previous_state"===o.val()&&o.val("current_state").trigger("change")})),e.on("change",".property-type",(function(e){const t=e.target.value;"current_state"===t||"previous_state"===t?$(this).next().attr("disabled","disabled").val(""):$(this).next().removeAttr("disabled")})),t.on("change",".comparator-property-type",(function(e){const t=e.target.value,a=$(this).parent().parent(),n=a.find(".comparator-type"),o=a.find(".comparator-value"),i=a.find(".comparator-property-value");switch(t){case"always":i.attr("disabled","disabled"),n.attr("disabled","disabled"),o.attr("disabled","disabled"),i.val("");break;case"previous_state":case"current_state":i.attr("disabled","disabled"),n.removeAttr("disabled"),o.removeAttr("disabled"),i.val("");break;case"property":i.removeAttr("disabled"),n.removeAttr("disabled"),o.removeAttr("disabled")}}));e.editableList({addButton:!0,removable:!0,height:"auto",header:$("<div>").append("Conditions"),addItem:(e,t,i)=>{$("#constraint-template").children().clone().appendTo(e),e.find(".target-value").autocomplete({source:(e,t)=>{const n=e.term.toLowerCase();t(a.filter((e=>e.includes(n))))},minLength:0}),e.find(".property-value").autocomplete({source:(t,a)=>{const i=t.term.toLowerCase();a(("this_entity"===e.find(".target-type").val()?o:n).filter((e=>e.includes(i))))},minLength:0}),e.find(".comparator-value").typedInput({default:"str",types:["str","num","bool","re","jsonata",{value:"entity",label:"entity."},{value:"prevEntity",label:"prev entity."}]}),$.isEmptyObject(i)||(e.find(".target-type").val(i.targetType).trigger("change"),e.find(".target-value").val(i.targetValue),e.find(".property-type").val(i.propertyType).trigger("change"),"property"===i.propertyType&&e.find(".property-value").val(i.propertyValue),e.find(".comparator-type").val(i.comparatorType),e.find(".comparator-value").typedInput("type",i.comparatorValueDatatype).typedInput("value",i.comparatorValue))}}),e.editableList("addItems",this.constraints.length?this.constraints:{}),t.on("change",".message-type",(function(e){const t=e.target.value;$(this).parent().find(".message-value").typedInput("default"===t?"hide":"show")})),t.on("change",".comparator-property-type",(function(e){const t=e.target.value,a=$(this).parent().parent(),n=a.find(".comparator-property-value"),o=a.find(".comparator-type"),i=a.find(".comparator-value");switch(t){case"always":n.attr("disabled","disabled"),o.attr("disabled","disabled"),i.typedInput("hide"),n.val("");break;case"previous_state":case"current_state":n.attr("disabled","disabled"),o.removeAttr("disabled"),i.typedInput("show"),n.val("");break;case"property":n.removeAttr("disabled"),o.removeAttr("disabled"),i.typedInput("show")}})),t.editableList({addButton:!0,removable:!0,sortable:!0,height:"auto",header:$("<div>").append("Custom outputs"),addItem:function(e,t,a){Object.prototype.hasOwnProperty.call(a,"condition")||(a.condition={});const n=a.condition;Object.prototype.hasOwnProperty.call(a,"index")||(a._index=Math.floor(563609*Math.random()).toString()),$("#output-template").children().clone().appendTo(e),e.css({overflow:"hidden",whiteSpace:"nowrap"}),e.find(".message-value").typedInput({default:"json",types:["str","num","bool","json"]}),e.find(".comparator-property-value").autocomplete({source:(e,t)=>{const a=e.term.toLowerCase();t(o.filter((e=>e.includes(a))))},minLength:0}),e.find(".comparator-value").typedInput({default:"str",types:["str","num","bool","re","jsonata",{value:"entity",label:"entity."},{value:"prevEntity",label:"prev entity."}]});const i=s();i[Object.prototype.hasOwnProperty.call(a,"index")?a.index:a._index]=t+2,r(i),$.isEmptyObject(n)?e.find(".message-type,.comparator-property-type").trigger("change"):(e.find(".message-type").val(n.messageType).trigger("change"),e.find(".message-value").typedInput("value",n.messageValue).typedInput("type",n.messageValueType),e.find(".comparator-property-type").val(n.comparatorPropertyType).trigger("change"),"property"===n.comparatorPropertyType&&e.find(".comparator-property-value").val(n.comparatorPropertyValue),e.find(".comparator-type").val(n.comparatorType),e.find(".comparator-value").typedInput("value",n.comparatorValue).typedInput("type",n.comparatorValueDataType))},removeItem:function(e){const t=s();Object.prototype.hasOwnProperty.call(e,"index")?t[e.index]=-1:delete t[e._index],l(t),r(t)},sortItems:function(){const e=s();l(e),r(e)}}),this.customoutputs.forEach(((e,a)=>t.editableList("addItem",{condition:e,index:a+2})))},oneditsave:function(){const e=$("#constraint-list").editableList("items"),t=$("#output-list").editableList("items"),a=[],n=[];e.each((function(){const e=$(this),t=e.find(".comparator-value"),n={targetType:e.find(".target-type").val(),targetValue:e.find(".target-value").val(),propertyType:e.find(".property-type").val(),comparatorType:e.find(".comparator-type").val(),comparatorValueDatatype:t.typedInput("type"),comparatorValue:t.typedInput("value")};"current_state"===n.propertyType?n.propertyValue="new_state.state":"previous_state"===n.propertyType?n.propertyValue="old_state.state":n.propertyValue=e.find(".property-value").val(),"includes"!==n.comparatorType&&"does_not_include"!==n.comparatorType||(n.comparatorValueDatatype="list"),a.push(n)})),t.each((function(){const e=$(this),t=e.find(".message-value"),a=e.find(".comparator-value"),o={messageType:e.find(".message-type").val(),messageValue:t.typedInput("value"),messageValueType:t.typedInput("type"),comparatorPropertyType:e.find(".comparator-property-type").val(),comparatorType:e.find(".comparator-type").val(),comparatorValue:a.typedInput("value"),comparatorValueDataType:a.typedInput("type")};"current_state"===o.comparatorPropertyType?o.comparatorPropertyValue="new_state.state":"previous_state"===o.comparatorPropertyType?o.comparatorPropertyValue="old_state.state":o.comparatorPropertyValue=e.find(".comparator-property-value").val(),"includes"!==o.comparatorType&&"does_not_include"!==o.comparatorType||(o.comparatorValueDataType="list"),n.push(o)})),this.constraints=a,this.customoutputs=n,this.haConfig=exposeNode.getValues()}}),RED.nodes.registerType("ha-wait-until",{category:"home_assistant",color:ha.nodeColors.haBlue,inputs:1,outputs:1,outputLabels:["","timed out"],icon:"ha-wait-until.svg",paletteLabel:"wait until",label:function(){return this.name||"wait until"},labelStyle:ha.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.haWaitUntilVersion},outputs:{value:1},entityId:{value:""},entityIdFilterType:{value:"exact"},property:{value:""},comparator:{value:"is"},value:{value:""},valueType:{value:"str"},timeout:{value:0},timeoutType:{value:"num"},timeoutUnits:{value:"seconds"},entityLocation:{value:"data"},entityLocationType:{value:"none"},checkCurrentState:{value:!0},blockInputOverrides:{value:!0}},oneditprepare:function(){nodeVersion.check(this);const e=this;haServer.init(e,"#node-input-server");let t=[],a=[];haServer.autocomplete("entities",(e=>{t=e,$("#node-input-entityId").autocomplete({source:t,minLength:0})})),haServer.autocomplete("properties",(e=>{a=e,$("#node-input-property").autocomplete({source:a,minLength:0})}));const n={value:"entity",label:"entity."},o=["str","num","bool","re","jsonata","msg","flow","global",n];$("#node-input-value").typedInput({default:"str",types:o,typeField:"#node-input-valueType"}),$("#node-input-comparator").change((function(e){let t=o;switch($("#node-input-property").prop("disabled","jsonata"===e.target.value),e.target.value){case"is":case"is_not":break;case"lt":case"lte":case"gt":case"gte":t=["num","jsonata","msg","flow","global",n];break;case"includes":case"does_not_include":t=["str","jsonata","msg","flow","global"];break;case"jsonata":t=["jsonata"]}$("#node-input-value").typedInput("types",t)})),$("#node-input-timeout").typedInput({default:"num",types:["num","jsonata"],typeField:"#node-input-timeoutType"}).on("change",(function(t,a){!0!==a&&(e.outputs="jsonata"===a||"num"===a&&this.value>0?2:1)}));$("#node-input-entityLocation").typedInput({types:["msg","flow","global",{value:"none",label:"None",hasValue:!1}],typeField:"#node-input-entityLocationType"});const i=$("#node-input-entityIdFilterType");i.on("change",(function(){$(".exact-only").toggle("exact"===i.val())}))}}),RED.nodes.registerType("ha-webhook",{category:"home_assistant",color:ha.nodeColors.haBlue,outputs:1,outputLabels:"",icon:"ha-webhook.svg",paletteLabel:"webhook",label:function(){return this.name||"webhook"},labelStyle:ha.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.haWebhookVersion},outputs:{value:1},webhookId:{value:generateId(32),required:!0},outputProperties:{value:[{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"},{property:"payload",propertyType:"msg",value:"",valueType:"data"}],validate:haOutputs.validate},payloadLocation:{},payloadLocationType:{},headersLocation:{},headersLocationType:{}},oneditprepare:function(){nodeVersion.check(this);haServer.init(this,"#node-input-server");const e=$("#node-input-webhookId");exposeNode.init(this),$("#copyId").on("click",(function(){const t=e[0],a=t.value;t.value=`https://<ip>:<port>/api/webhook/${a}`,t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),t.value=a})),$("#refresh").on("click",(function(){e.val(generateId(32))})),haOutputs.createOutputs(this.outputProperties,{extraTypes:["receivedData","headers","params","triggerId"]})},oneditsave:function(){this.outputProperties=haOutputs.getOutputs()}}),RED.nodes.registerType("ha-zone",{category:"home_assistant",color:ha.nodeColors.haBlue,outputs:1,icon:"font-awesome/fa-map-marker",paletteLabel:"zone",label:function(){return this.name||"zone"},labelStyle:ha.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.haZoneVersion},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},entities:{value:[""],required:!0,validate:function(e){return e.length}},event:{value:"enter"},zones:{value:[""],required:!0,validate:function(e){return e.length}}},oneditprepare:function(){nodeVersion.check(this);const e=$("#entities"),t=$("#zones");haServer.init(this,"#node-input-server"),exposeNode.init(this),e.editableList({addButton:!0,removable:!0,height:"auto",header:$("<div>").append("Entities"),addItem:function(e,t,a){const n=$("<div />").appendTo(e);$("<span />",{text:"Entity",style:"padding-right: 35px;"}).appendTo(n);const o=$.isEmptyObject(a)?"":a;$("<input />",{type:"text",class:"input-entity"}).appendTo(n).val(o).haAutocomplete({type:"trackers"})}}),e.editableList("addItems",this.entities),t.editableList({addButton:!0,removable:!0,height:"auto",header:$("<div>").append("zones"),addItem:function(e,t,a){const n=$("<div />").appendTo(e);$("<span />",{text:"Zone",style:"padding-right: 35px;"}).appendTo(n);const o=$.isEmptyObject(a)?"":a;$("<input />",{type:"text",class:"input-zone"}).appendTo(n).val(o).haAutocomplete({type:"zones"})}}),t.editableList("addItems",this.zones)},oneditsave:function(){const e=$("#entities").editableList("items"),t=$("#zones").editableList("items"),a=new Set,n=new Set;e.each((function(){const e=$(this).find(".input-entity").val().replace(/\s/g,"");e.length&&a.add(e)})),t.each((function(){const e=$(this).find(".input-zone").val().replace(/\s/g,"");e.length&&n.add(e)})),this.entities=Array.from(a),this.zones=Array.from(n),this.haConfig=exposeNode.getValues()}});</script>
<script type="text/html" data-help-name="ha-get-entities"><p>Get Entities based on search criteria</p><h3>Configuration</h3><dl class="message-properties"><dt>Search Criteria<span class="property-type"></span></dt><dd>All search criteria have to be true for an entity to be valid.</dd><dt>Property<span class="property-type"></span></dt><dd>Has autocompleted with all properties currently set on all loaded entities.</dd></dl><h3>Inputs</h3><dl class="message-properties"><dt>payload<span class="property-type">Object</span></dt><dd>Override config values by passing in a property with a valid value.</dd><ul><li>rules array<ul><li>property string</li><li>logic string</li><li>value string</li><li>valueType string</li></ul></li><li>outputType string</li><li>outputEmptyResults boolean</li><li>outputLocationType string</li><li>outputLocation string</li><li>outputResultscount number</li></ul></dl><h3>Outputs</h3><dl class="message-properties"><dt>Array<span class="property-type">Array</span></dt><dd>Sends an array of state objects from search criteria to the Output Location.</dd><dt>Count<span class="property-type">number</span></dt><dd>Return the total count of valid entities.</dd><dt>Random<span class="property-type">Object|Array</span></dt><dd>Return a random object or array from the available state objects to the Output Location. When <code>One Max Results</code> is selected it will return an object and when more than one is selected will always return an array of state objects.</dd><dt>Split<span class="property-type">msg</span></dt><dd>Sends a message for each state object. In the same format as if the split node was used.</dd></dl><h3>State Object Format</h3><dl class="message-properties"><dd>Sample output when the Output Type is an array:</dd><pre><code class="language-json">[
  {
    &quot;entity_id&quot;: &quot;light.kitchen&quot;,
    &quot;state&quot;: &quot;on&quot;,
    &quot;attributes&quot;: {
      &quot;brightness&quot;: 243,
      &quot;friendly_name&quot;: &quot;Kitchen Light&quot;,
      &quot;supported_features&quot;: 33,
      &quot;icon&quot;: &quot;mdi:light-switch&quot;
    },
    &quot;last_changed&quot;: &quot;2019-12-29T05:38:53.016984+00:00&quot;,
    &quot;last_updated&quot;: &quot;2019-12-29T05:38:53.016984+00:00&quot;,
    &quot;context&quot;: {
      &quot;id&quot;: &quot;6c16e348494c42fb8c8e8bda92b20fb2&quot;,
      &quot;parent_id&quot;: null,
      &quot;user_id&quot;: null
    },
    &quot;timeSinceChangedMs&quot;: 3466747
  }
]
</code></pre><dt>entity_id<span class="property-type">string</span></dt><dd>The entity to which this state belongs</dd><dt>state<span class="property-type">string</span></dt><dd>Main attribute state value, examples: &apos;on&apos;, &apos;off&apos;, &apos;home&apos;, &apos;open&apos;, &apos;closed&apos;, etc...</dd><dt>attributes<span class="property-type">Object</span></dt><dd>Supported attributes of state set by Home Assistant</dd><dt>last_changed<span class="property-type">string</span></dt><dd>ISO Date string of last time entity state changed</dd><dt>timeSinceChangedMs<span class="property-type">number</span></dt><dd>Milliseconds since last time entity state changed</dd><dt>last_updated<span class="property-type">string</span></dt><dd>ISO Date string of last time entity state was updated</dd><dt>context<span class="property-type">Object</span></dt><dd>Information on who/what changed the state of this object last.</dd></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://home-assistant.io/docs/configuration/state_object/">Home Assistant State Objects</a></li></ul></dl></script>
<script type="text/html" data-help-name="api-get-history"><p>Fetches history from Home Assistant (all history for the past day by default)</p><h3>Configuration</h3><dl class="message-properties"><dt>Entity ID<span class="property-type">string</span></dt><dd>Exact entity_id to fetch history for must be an exact match as is passed directly to the Home Assistant.</dd><dt>Entity ID Type<span class="property-type">string</span></dt><ul><li>Values: <code>is</code> | <code>includes</code></li><li>Default: <code>is</code></li></ul><dd><code>is</code> or <code>includes</code> depending on the match type.</dd><div class="custom-block warning"><p class="custom-block-title">WARNING</p><p><code>includes</code> fetches all history for the time period then filters according to the value, this will be less performant than exact <code>is</code> matching</p></div><dt>Start Date<span class="property-type">string</span></dt><ul><li>Values: ISO Format Date</li><li>Default: 24 hours prior</li></ul><dd>Date to start fetching history from. Will override the configuration if passed in</dd><dd><strong>Also See:</strong></dd><ul><li><a href="https://en.wikipedia.org/wiki/ISO_8601">https://en.wikipedia.org/wiki/ISO_8601</a></li></ul><dt>End Date<span class="property-type">string</span></dt><ul><li>Values: ISO Format Date</li><li>Default: 24 hours from start date</li></ul><dd>The end date to fetch history too. Will override the configuration if passed in</dd><dd><strong>Also See:</strong></dd><ul><li><a href="https://en.wikipedia.org/wiki/ISO_8601">https://en.wikipedia.org/wiki/ISO_8601</a></li></ul><dt>Use Relative Time<span class="property-type">boolean</span></dt><ul><li>Default: <code>false</code></li></ul><dd>A checkbox to use relative time or not.</dd><dt>In the Last<span class="property-type">string</span></dt><dd>A time string that will be parsed the following keywords into time values.</dd><dd>Example: <code>4h 30m</code> = The last 4 hours and 30 minutes</dd><pre><code>ms, milli, millisecond, milliseconds - will parse to milliseconds
s, sec, secs, second, seconds - will parse to seconds
m, min, mins, minute, minutes - will parse to minutes
h, hr, hrs, hour, hours - will parse to hours
d, day, days - will parse to days
w, week, weeks - will parse to weeks
mon, mth, mths, month, months - will parse to months
y, yr, yrs, year, years - will parse to years
</code></pre><dt>Flatten Results<span class="property-type"></span></dt><dd>Instead of returning the data from home assistant ( array for each entity_id ) return one flattened array of one item per history entry</dd><dt>Output Types<span class="property-type">string</span></dt><ul><li>Values: <code>array</code> | <code>split</code></li><li>Default: <code>array</code></li></ul></dl><h3>Inputs</h3><dl class="message-properties"><dd>All properties of <code>msg.payload</code></dd><dt>entity_id<span class="property-type">string</span></dt><ul><li>Alias: <code>msg.entityid</code> <span type="warning" text="deprecated" class="badge warning">deprecated</span></li></ul><dt>startdate<span class="property-type">string</span></dt><ul><li>Values: ISO Format Date</li><li>Alias: <code>msg.startdate</code> <span type="warning" text="deprecated" class="badge warning">deprecated</span></li></ul><dt>enddate<span class="property-type">string</span></dt><ul><li>Values: ISO Format Date</li><li>Alias: <code>msg.enddate</code> <span type="warning" text="deprecated" class="badge warning">deprecated</span></li></ul><dt>relativetime<span class="property-type">string</span></dt><ul><li>Alias: <code>msg.relativetime</code> <span type="warning" text="deprecated" class="badge warning">deprecated</span></li></ul><dd>If <code>relativetime</code> exists <code>startdate</code> and <code>enddate</code> will be ignored.</dd><dt>flatten<span class="property-type">boolean</span></dt><ul><li>Alias: <code>msg.flatten</code> <span type="warning" text="deprecated" class="badge warning">deprecated</span></li></ul></dl><h3>Outputs</h3><dl class="message-properties"><dt>payload<span class="property-type">array</span></dt><dd>The history returned by home-assistant, which is an array of arrays where each array entry contains history objects for one particular entity</dd><dt>startdate<span class="property-type">string</span></dt><dd>ISO date string used to fetch history</dd><dt>enddate<span class="property-type">string</span></dt><dd>ISO date string used to fetch history</dd><dt>entity_id<span class="property-type">string</span></dt><dd>The entity id string used during fetch history call</dd><dd>Example output of <code>msg</code>:</dd><pre><code class="language-json">{
  &quot;startdate&quot;: &quot;2020-01-11T16:41:31.086Z&quot;,
  &quot;enddate&quot;: &quot;2020-01-14T16:41:31.086Z&quot;,
  &quot;entityid&quot;: &quot;light.kitchen_light&quot;,
  &quot;payload&quot;: [
    {
      &quot;attributes&quot;: {
        &quot;friendly_name&quot;: &quot;Kitchen Light&quot;,
        &quot;icon&quot;: &quot;mdi:light-switch&quot;,
      },
      &quot;context&quot;: {
        &quot;id&quot;: &quot;850e510e36fb494c9abc79e01e897d54&quot;,
        &quot;parent_id&quot;: null,
        &quot;user_id&quot;: null
      },
      &quot;entity_id&quot;: &quot;light.kitchen_light&quot;,
      &quot;last_changed&quot;: &quot;2019-12-28T06:47:28.618000+00:00&quot;,
      &quot;last_updated&quot;: &quot;2019-12-28T06:47:28.618000+00:00&quot;,
      &quot;state&quot;: &quot;off&quot;
    },
    {
      &quot;attributes&quot;: {
        &quot;brightness&quot;: 28,
        &quot;friendly_name&quot;: &quot;Kitchen Light&quot;,
        &quot;icon&quot;: &quot;mdi:light-switch&quot;,
      },
      &quot;context&quot;: {
        &quot;id&quot;: &quot;4d4abe29f2bc43dab39101193f1fefe4&quot;,
        &quot;parent_id&quot;: null,
        &quot;user_id&quot;: null
      },
      &quot;entity_id&quot;: &quot;light.kitchen_light&quot;,
      &quot;last_changed&quot;: &quot;2019-12-28T07:48:11.514137+00:00&quot;,
      &quot;last_updated&quot;: &quot;2019-12-28T07:48:11.514137+00:00&quot;,
      &quot;state&quot;: &quot;on&quot;
    },
    ...
  ]
}
</code></pre></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://www.home-assistant.io/integrations/history">Home Assistant History Component</a></li><li><a href="https://developers.home-assistant.io/docs/en/external_api_rest.html#get-apihistoryperiodlttimestamp">Home Assistant API: /api/history/period</a></li></ul></dl></script>
<script type="text/html" data-help-name="poll-state"><p>Polls for the state at regular intervals, optionally also outputting at the start and when the state changes. Useful for either alert for non-communicating devices (time since change &gt; 1 day for example) or dashboard graphs with consistent interval charts</p><h3>Configuration</h3><dl class="message-properties"><dt>Entity ID <span text="required" class="badge">required</span><span class="property-type"></span></dt><dd>The entity id of the entity to poll for.</dd><dt>Update Interval<span class="property-type">number</span></dt><dd>The amount of time between checking/sending updates.</dd><dt>If State<span class="property-type">string</span></dt><dd>If the conditional statement is evaluated as true send the message to the first output otherwise send it to the second output. If blank there will only be one output.</dd><dd><strong>Also see:</strong></dd><ul><li><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/conditionals.html" rel="noopener noreferrer">Conditionals</a></li></ul><dt>State Type<span class="property-type">string</span></dt><dd>Convert the state of the entity to the selected type. Boolean will be converted to true based on if the string is equal by default to (y|yes|true|on|home|open). Original value stored in msg.data.original_state</dd><dt>Output Initially<span class="property-type">boolean</span></dt><dd>Output once on startup/deploy then on each interval</dd><dt>Expose to Home Assistant<span class="property-type">boolean</span></dt><dd>Creates a switch within Home Assistant to enable/disable this node. This feature requires <a href="https://github.com/zachowj/hass-node-red">Node-RED custom integration</a> to be installed in Home Assistant</dd></dl><h3>Outputs</h3><dl class="message-properties"><dt>topic<span class="property-type">string</span></dt><dd>entity_id of changed entity</dd><dt>payload.data<span class="property-type">object</span></dt><dd>The last known state of the entity</dd><dt>payload.data.timeSinceChanged<span class="property-type">string</span></dt><dd>Human readable format string of time since last updated, example &quot;1 hour ago&quot;</dd><dt>payload.data.timeSinceChangedMs<span class="property-type">number</span></dt><dd>Number of milliseconds since last changed</dd></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://home-assistant.io/docs/configuration/state_object/">Home Assistant State Objects</a></li></ul></dl></script>
<script type="text/html" data-help-name="api-render-template"><p>Can either set the template in the node configuration or pass in the <code>msg.template</code> property of the incoming message. Passing template via <code>msg.template</code> will override the template string set in node configuration.</p><div class="custom-block tip"><p class="custom-block-title">NOTE:</p><p>The node will output any Home Assistant API errors for catching with the &apos;catch-all&apos; node</p></div><h3>Configuration</h3><dl class="message-properties"><dt>template<span class="property-type">string</span></dt><dd>Jinja template to be rendered, discarded if <code>msg.template</code> is provided via input msg</dd><dt>Template Location<span class="property-type"></span></dt><dd>Customizable location to output original template</dd><dt>Results<span class="property-type"></span></dt><dd>Customizable location to output rendered template</dd></dl><h3>Inputs</h3><dl class="message-properties"><dt>template<span class="property-type">string</span></dt><dd>Jinja template to be rendered</dd></dl><h3>Outputs</h3><dl class="message-properties"><dt>template<span class="property-type">string</span></dt><dd>The original template sent to Home Assistant for rendering</dd><dt>payload<span class="property-type">string</span></dt><dd>The rendered template</dd></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://home-assistant.io/docs/configuration/templating/">Home Assistant Template Docs</a></li><li><a href="http://jinja.pocoo.org/docs/dev/templates/">Jinja Docs</a></li></ul></dl></script>
<script type="text/html" data-help-name="ha-tag"><p>Sends an output when Home Assistant receives a tag scanned event for a configured tag id.</p><h3>Configuration</h3><dl class="message-properties"><dt>Tags<span class="property-type">array</span></dt><dd>An array of tag ids to monitor for tag scanned events.</dd><dt>Devices<span class="property-type">array</span></dt><dd>An array of device ids to check when a configured tag is scanned.</dd></dl><h3>Outputs</h3><dl class="message-properties"><dt>topic<span class="property-type">string</span></dt><dd>The tag id of the tag that was scanned.</dd><dt>payload<span class="property-type">object</span></dt><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td>device_id</td><td>ID of the device that scanned the tag</td></tr><tr><td>tag_id</td><td>ID of the tag that was scanned</td></tr><tr><td>tag_name</td><td>Home Assistant name of the tag that was scanned</td></tr><tr><td>user_id</td><td>Home Assistant user ID on device that scanned the tag</td></tr></tbody></table></dl></script>
<script type="text/html" data-help-name="ha-time"><p>A node that can be scheduled to trigger at a future date and time from a Home Assistant entity.</p><h3>Configuration</h3><dl class="message-properties"><dt>Entity Id<span class="property-type">string</span></dt><dd>A Home Assistant entity to be used when scheduling the node.</dd><dt>Property<span class="property-type">string</span></dt><dd>Which property of the entity to use to schedule the node.</dd><dd>The node will accept any date string that the javascript object accepts as a valid date. It will also accept a 24-hour time format with the seconds place optional.</dd><dd>examples:</dd><ul><li><code>2020-12-31T02:47:54.837Z</code></li><li><code>1609382842709</code></li><li><code>13:40</code></li><li><code>23:59:02</code></li></ul><dt>Offset<span class="property-type">number</span></dt><dd>A negative or positive number that will be added to the scheduled time.</dd><dt>Randomize time within the offset<span class="property-type">boolean</span></dt><dd>When selected the time to trigger will be random selected from the scheduled time to the +/- offset.</dd><dt>Payload<span class="property-type">string | number | boolean | object</span></dt><dd>The payload is fully customizable. The default will be a JSONata expression that outputs the entity state.</dd><dt>Repeat Daily<span class="property-type">boolean</span></dt><dd>If selected the node will only use the time portion of the date string to schedule the node and will trigger at that time each day. Otherwise, the node will only trigger once at the given day and time.</dd></dl><h3>Outputs</h3><dl class="message-properties"><dt>topic<span class="property-type">string</span></dt><dd>The entity id in the configuration.</dd><dt>payload<span class="property-type">string | number | boolean | object</span></dt><dt>data<span class="property-type">object</span></dt><dd>The entity object of the entity in the configuration.</dd></dl></script>
<script type="text/html" data-help-name="trigger-state"><p>Much like the <code>State Changed Node</code> however, provides some advanced functionality around common automation use cases.</p><p>An advanced version of <code>server:state-changed</code> node</p><!-- TODO: Needs a total rework --><h3>Configuration</h3><dl class="message-properties"><dt>Conditions<span class="property-type"></span></dt><dd>This node has two default outputs &quot;allowed&quot; and &quot;blocked&quot;. If all the conditions are true the default message will be sent to the &quot;allowed&quot; output otherwise it will be sent to the &quot;blocked&quot; output.</dd><dd><strong>See Also:</strong></dd><ul><li><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/conditionals.html" rel="noopener noreferrer">Conditionals</a></li></ul><dt>Custom Outputs<span class="property-type"></span></dt><dd>All the above conditions need to be true for any custom outputs to be sent, having zero conditions is a valid option. Each custom output can send the default message or a custom message. Also, each one can have its constraint on whether or not to be sent.</dd></dl><h3>Input</h3><dl class="message-properties"><dt>Enable / Disable<span class="property-type">string</span></dt><dd>If incoming payload or message is a string and equal to <code>enable</code> or <code>disable</code> then set the node accordingly. Saves over restarts.</dd><dt>Output Initially<span class="property-type">boolean</span></dt><dd>Output once on startup/deploy.</dd></dl><h3>Output</h3><dl class="message-properties"><dt>topic<span class="property-type">string</span></dt><dd>The entity_id that triggered the node</dd><dt>payload<span class="property-type">string</span></dt><dd>The state as sent by home assistant</dd><dt>data<span class="property-type">object</span></dt><dd>The original home assistant event containing <code>entity_id</code> <code>new_state</code> and <code>old_state</code> properties</dd></dl><h3>Testing</h3><dl class="message-properties"><dd>To test automation without having to manually change state in-home assistant send an input <code>payload</code> as an object which contains <code>entity_id</code>, <code>new_state</code>, and <code>old_state</code> properties. This will trigger the node as if the event came from Home Assistant.</dd><pre><code class="language-json">{
  &quot;entity_id&quot;: &quot;test_entity&quot;,
  &quot;old_state&quot;: {
    &quot;state&quot;: &quot;on&quot;
  },
  &quot;new_state&quot;: {
    &quot;state&quot;: &quot;off&quot;
  }
}
</code></pre></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://home-assistant.io/docs/configuration/state_object">HA State Object</a></li></ul></dl></script>
<script type="text/html" data-help-name="ha-wait-until"><p>When an input is received the node will wait until the condition is met or the timeout occurs then will pass on the last received message. Any new input will reset the timeout timer.</p><h3>Configuration</h3><dl class="message-properties"><dt>Entity ID <span text="required" class="badge">required</span><span class="property-type">string</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a></li></ul><dd>The id of an entity to use for the comparison.</dd><dt>Entity ID Filter Types <span text="required" class="badge">required</span><span class="property-type">string</span></dt><ul><li>Values: <code>exact|substring|regex</code></li><li>Default: <code>exact</code></li></ul><dd>Substring can be a comma-delimited list.</dd><dt>Wait Until <span text="required" class="badge">required</span><span class="property-type">string</span></dt><dd>The <code>property</code> field will be checked against the <code>value</code> field using the comparator.</dd><dt>Timeout<span class="property-type">number</span></dt><dd>The amount of time to wait for the condition to become true before deactivating the node and passing the message object to the second output. If the timeout is equal to zero the node will wait indefinitely for the condition to be met.</dd><dt>Entity Location<span class="property-type">string</span></dt><dd>The entity object can also be pass with the message object.</dd><dt>Check against the current state<span class="property-type">boolean</span></dt><dd>When an input is received it will check the comparator against the current state instead of waiting for a state change.</dd></dl><h3>Input</h3><dl class="message-properties"><dt>reset<span class="property-type"></span></dt><dd>If the received message has this property set to any value the node will be set to inactive and the timeout cleared.</dd><dt>payload<span class="property-type">object</span></dt><dd>Override config values by passing in a property with a valid value.</dd><ul><li><code>entity_id</code></li><li><code>entityId</code> <span type="warning" text="deprecated" class="badge warning">deprecated</span></li><li><code>entityIdFilterType</code></li><li><code>property</code></li><li><code>comparator</code></li><li><code>value</code></li><li><code>valueType</code></li><li><code>timeout</code></li><li><code>timeoutUnits</code></li><li><code>entityLocation</code></li><li><code>entityLocationType</code></li><li><code>checkCurrentState</code></li></ul></dl><h3>Output</h3><dl class="message-properties"><dd>Will output the last received message when the condition is true or the timeout occurs. If the condition becomes true the message will be pass to the first output. If the timeout passes the message will be sent to the second output.</dd></dl></script>
<script type="text/html" data-help-name="ha-webhook"><p>Outputs the data received from the created webhook in Home Assistant</p><div class="custom-block warning"><p class="custom-block-title">WARNING</p><p><em>Needs <a href="https://github.com/zachowj/hass-node-red">Custom Integration</a> installed in Home Assistant for this node to function</em></p></div><h3>Configuration</h3><dl class="message-properties"><dt>ID<span class="property-type">string</span></dt><dd>A string to be used for the webhook URL in Home Assistant.</dd><dt>Payload<span class="property-type">string</span></dt><dd>Customizable location for the webhook payload. Defaults to msg.payload</dd><dt>Headers<span class="property-type">number</span></dt><dd>Customizable location for the webhook request headers.</dd></dl><h3>Outputs</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>received data</code>: The parsed body from the webhook request</li><li><code>trigger id</code>: webhook id</li><li><code>headers</code>: entity state of the triggered entity</li><li><code>params</code>: Query string parameters</li><li><code>config</code>: config properties of the node</li></ul></dl></script>
<script type="text/html" data-help-name="ha-zone"><p>Outputs when one of the configured entities enter or leaves one of the defined zones.</p><h3>Configuration</h3><dl class="message-properties"><dt>Entities<span class="property-type">array</span></dt><dd>An array of entity ids to monitor for zone changes.</dd><dt>Event<span class="property-type">string</span></dt><dd>Set when to check an entity. Either entering or leaving a zone.</dd><dt>Zones<span class="property-type">array</span></dt><dd>An array of zone ids to check when a configured entity updates.</dd></dl><h3>Outputs</h3><dl class="message-properties"><dt>topic<span class="property-type">string</span></dt><dd>The entity id of the device/person that triggered the update.</dd><dt>payload<span class="property-type">string</span></dt><dd>The state of the device/person entity that triggered the update.</dd><dt>data<span class="property-type">object</span></dt><dd>The entity object of the device/person that triggered the update.</dd><dt>zones<span class="property-type">array</span></dt><dd>An array of zone entities where the device/person entity entered/left after an update of location.</dd></dl></script>