<script type="text/javascript">var ha={nodeColors:{action:"#46B1EF",alpha:"#E78BB9",api:"#7CDFFD",beta:"#77DD77",data:"#5BCBF7",event:"#399CDF"}};</script>
<script type="text/javascript">var exposeNode=function(e){let t;function n(){const t=e("#node-input-server").val();if(t&&"_ADD_"!==t)return t}function o(){if(!e("#integrationAlert").length){const t='<div id="integrationAlert" class="ui-state-error ha-alert-box"><strong>Attention:</strong> This node requires <a href="https://github.com/zachowj/hass-node-red" target="_blank">Node-RED custom integration <i class="fa fa-external-link external-link"></i></a> to be installed in Home Assistant for it to function.</strong></div>';e("#dialog-form").prepend(t)}e("#integrationAlert").toggle(0===t.integrationVersion)}function i(){0===t.integrationVersion&&e("#node-input-exposeToHomeAssistant").prop("checked",!1).trigger("change"),e("#exposeToHa").toggle(0!==t.integrationVersion)}return{init:function(a){t=a,function(){switch(t.type){case"ha-webhook":case"ha-entity":o();break;default:!function(){const n=e("<div />",{id:"exposeToHa",class:"form-row checkbox-option"+("trigger-state"===t.type?"-left":"")});e("<input />",{type:"checkbox",id:"node-input-exposeToHomeAssistant",checked:t.exposeToHomeAssistant}).on("change",(function(){e("#haConfigRow").toggle(!0===e("#node-input-exposeToHomeAssistant").is(":checked"))})).appendTo(n),e("<label />",{for:"node-input-exposeToHomeAssistant",text:"Expose to Home Assistant"}).appendTo(n);const o=e("<div />",{class:"form-row",id:"haConfigRow"}),i=e("<ol />",{id:"haConfig"}).appendTo(o),a=t.haConfig||[{property:"name",value:""},{property:"icon",value:""}];i.editableList({addButton:!1,header:e("<div>Home Assistant Config (optional)</div>"),addItem:function(t,n,o){const i=e("<div />").appendTo(t);e("<input />",{type:"text",name:"property",value:o.property,style:"width: 40%;",readonly:!0}).appendTo(i),e("<input />",{type:"text",name:"value",value:o.value,style:"margin-left: 10px;width: 55%;"}).attr("autocomplete","disable").appendTo(i)}}).editableList("addItems",a),e("#dialog-form").append(n).append(o),e("#node-input-exposeToHomeAssistant").trigger("change")}()}}();const s=function(){switch(t.type){case"ha-webhook":case"ha-entity":return o;default:return i}}();e("#node-input-server").on("change",(()=>function(o){n()?e.getJSON(`homeassistant/${n()}/version?_=${Date.now()}`).done((e=>{t.integrationVersion=e.version,o&&o(t)})):o(t)}(s)))},getValues:function(){const t=[];return e("#haConfig").editableList("items").each((function(n){const o=e(this);t.push({property:o.find("input[name=property]").val(),value:o.find("input[name=value]").val()})})),t}}}(jQuery);</script>
<script type="text/javascript">var haServer=function(e,n){let o,t,r;function a(r,a){"_ADD_"!==t&&e.getJSON(`homeassistant/${t}/${r}`).done((e=>{a(e)})).fail((e=>{const t=n.nodes.node(o.val());t&&!0===t.dirty&&n.notify(`You probably haven't deployed since adding a server. Do that for autocomplete to work.\n${e.responseText}`,"error")}))}return{init:function(t,a){o=e(a),r=t,r.server||function(){let e;n.nodes.eachConfig((n=>{"server"!==n.type||e||(e=n.id)})),e&&o.val(e)}()},autocomplete:function(e,n){const i=o.val();(r.server||i&&"_ADD_"!==i)&&(t=r.server||i,a(e,n)),o.change((()=>{t=o.val(),a(e,n)}))}}}(jQuery,RED);</script>
<script type="text/javascript">var ifState=function(e){let t;return{init:function(a,n,s){t=e(a);const c=e(n),l={value:"entity",label:"entity."},r=["str","num","bool","re","jsonata","msg","flow","global",l];"currentState"!==s&&r.splice(5,1),t.after(' <a id="clearIfState" class="editor-button"><i class="fa fa-remove"></i></a>');const o=e("#clearIfState");t.typedInput({default:"str",types:r,typeField:"#node-input-halt_if_type"}),c.on("change",(e=>{let a=r,n=["flow","global",l];switch(r.includes("msg")&&(n=["msg",...n]),e.target.value){case"is":case"is_not":break;case"lt":case"lte":case"gt":case"gte":a=["num","jsonata",...n];break;case"includes":case"does_not_include":a=["str","jsonata",...n];break;case"jsonata":a=["jsonata"]}t.typedInput("types",a)})),c.trigger("change"),t.on("change",(e=>{e.currentTarget.value&&o.show()})),o.on("click",(a=>{t.typedInput("type","str"),t.typedInput("value",""),e(a.currentTarget).hide()})),t.val()||o.hide()}}}(jQuery);</script>
<script type="text/javascript">var nodeVersion=function(e){return{check:function(t){t.version=void 0===t.version?0:Number(t.version);const r=`<div id="version-update" class="ui-state-error ha-alert-box"><p><strong>Alert:</strong>This node will be updated to version ${t._def.defaults.version.value} from ${t.version} (<a href="${function(e){let t="";switch(e){case"api-current-state":t="current-state";break;case"api-call-service":t="call-service";break;case"poll-state":t="poll-state";break;case"server-state-changed":t="events-state"}return`https://zachowj.github.io/node-red-contrib-home-assistant-websocket/node/${t}.html#changelog`}(t.type)}#version" target="_blank" rel="noreferrer">changes</a>)</p></div>`;t.version<t._def.defaults.version.value&&e("#dialog-form").prepend(r)},ifStateLabels:function(e){if(this.halt_if||this.haltifstate){if(0===Number(this.version)||void 0===this.version){if(0===e)return"'If State' is false";if(1===e)return"'If State' is true"}if(0===e)return"'If State' is true";if(1===e)return"'If State' is false"}},labelStyle:function(){return`${this._def.defaults.version&&Number(this.version)!==this._def.defaults.version.value?"ha-node-label-legacy ":""}${this.name?"node_label_italic":""}`},update:function(t){t.version<t._def.defaults.version.value&&e("#node-input-version").val(t._def.defaults.version.value)}}}(jQuery);</script>
<script type="text/javascript">RED.nodes.registerType("ha-entity",{category:"home_assistant",color:"#46B1EF",inputs:1,outputs:1,icon:function(){return"switch"===this.entityType?"ha-entity-switch.svg":"font-awesome/fa-genderless"},align:"right",paletteLabel:"entity",label:function(){return this.name||`type: ${this.entityType}`},labelStyle:nodeVersion.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:1},debugenabled:{value:!1},outputs:{value:1},entityType:{value:"sensor"},config:{value:[{property:"name",value:""},{property:"device_class",value:""},{property:"icon",value:""},{property:"unit_of_measurement",value:""}]},state:{value:"payload"},stateType:{value:"msg"},attributes:{value:[]},resend:{value:!0},outputLocation:{value:"payload"},outputLocationType:{value:"none"},inputOverride:{value:"allow"},outputOnStateChange:{value:!1},outputPayload:{value:'$entity().state ? "on": "off"'},outputPayloadType:{value:"jsonata"}},oneditprepare:function(){nodeVersion.check(this);const t=this,e={binary_sensor:["msg","flow","global","jsonata","str","num","bool"],sensor:["msg","flow","global","jsonata","str","num","bool","date"],switch:["msg"]},n={binary_sensor:["name","device_class","icon","unit_of_measurement"],sensor:["name","device_class","icon","unit_of_measurement"],switch:["name","icon"]},a=["str","num","bool","date","jsonata","msg","flow","global"],o={binary_sensor:["state","attributes","output-location","input-override","resend","debug"],sensor:["state","attributes","output-location","input-override","resend","debug"],switch:["output-on-state-change","output-payload"]};haServer.init(t,"#node-input-server"),exposeNode.init(t),$("#node-input-state").typedInput({types:e[$("#node-input-entityType").val()],typeField:"#node-input-stateType",type:t.stateType}),$("#attributes").editableList({removable:!0,addButton:"add attribute",header:$("<div>").append($.parseHTML("<div style='width:40%; display: inline-grid'>Attribute Key</div><div style='display: inline-grid'>Value</div>")),addItem:function(t,e,n){const o=$("<div />").appendTo(t);$("<input />",{type:"text",name:"property",style:"width: 40%;margin-right: 5px;"}).attr("autocomplete","disable").appendTo(o).val(n.property);$("<input />",{type:"text",name:"value",style:"width: 55%;"}).appendTo(o).val(n.value).typedInput({types:a}).typedInput("type",n.valueType)}}).editableList("addItems",t.attributes),$("#config").editableList({addButton:!1,header:$("<div>Home Assistant Config (optional)</div>"),addItem:function(t,e,n){const a=$("<div />").appendTo(t);$("<input />",{type:"text",name:"property",value:n.property,style:"width: 40%;",readonly:!0}).appendTo(a),$("<input />",{type:"text",name:"value",value:n.value,style:"margin-left: 10px;width: 55%;"}).attr("autocomplete","disable").appendTo(a)}}).editableList("addItems",t.config);const i={value:"none",label:"none",hasValue:!1};$("#node-input-outputLocation").typedInput({types:["msg","flow","global",i],typeField:"#node-input-outputLocationType"}),$("#node-input-outputPayload").typedInput({types:["str","num","bool","jsonata","date",i],typeField:"#node-input-outputPayloadType"}),$("#node-input-entityType").on("change",(function(){const a=$(this).val();switch($("#node-input-state").typedInput("types",e[a]),$("#dialog-form .form-row").each((function(){const t=$(this);if(t.attr("class").split(" ").includes("optional-row")){const e=t.attr("id");t.toggle(o[a].includes(e.replace(/-row$/,"")))}})),a){case"switch":t.outputs=2,$("#config").editableList("filter",(t=>n[a].includes(t.property)));break;case"binary_sensor":case"sensor":default:t.outputs=1,$("#config").editableList("filter",null),$("#node-input-outputOnStateChange").prop("checked",!1).trigger("change")}})).trigger("change"),$("#node-input-outputOnStateChange").on("change",(function(){"switch"===$("#node-input-entityType").val()&&$(this).prop("checked")?$("#output-payload-row").show():$("#output-payload-row").hide()})).trigger("change")},oneditsave:function(){const t=this;t.attributes=[],t.config=[],nodeVersion.update(this),$("#attributes").editableList("items").each((function(e){const n=$(this);t.attributes.push({property:n.find("input[name=property]").val(),value:n.find("input[name=value]").typedInput("value"),valueType:n.find("input[name=value]").typedInput("type")})})),$("#config").editableList("items").each((function(e){const n=$(this);t.config.push({property:n.find("input[name=property]").val(),value:n.find("input[name=value]").val()})}))}});</script>
<script type="text/x-red" data-template-name="ha-entity"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><span data-i18n="ha-entity.label.name"></span></label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><span data-i18n="ha-entity.label.server"></span></label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-entityType"><span data-i18n="ha-entity.label.type"></span></label> <select id="node-input-entityType" style="width:70%"><option value="binary_sensor">Binary Sensor</option><option value="sensor">Sensor</option><option value="switch">Switch</option></select></div><div id="state-row" class="form-row optional-row"><label for="node-input-state"><span data-i18n="ha-entity.label.state"></span></label> <input type="text" id="node-input-state" style="width:70%"> <input type="hidden" id="node-input-stateType"></div><div id="attributes-row" class="form-row optional-row"><ol id="attributes"></ol></div><div id="config-row" class="form-row"><ol id="config"></ol></div><div id="output-location-row" class="form-row optional-row"><label for="node-input-outputLocation"><span data-i18n="ha-entity.label.output_location"></span></label> <input type="hidden" id="node-input-outputLocationType"> <input type="text" id="node-input-outputLocation" style="width:68%"></div><div id="input-override-row" class="form-row optional-row"><label for="node-input-inputOverride"><span data-i18n="ha-entity.label.input_override"></span></label> <select id="node-input-inputOverride" style="width:68%"><option value="allow">Allow</option><option value="merge">Merge</option><option value="block">Block</option></select></div><div id="resend-row" class="form-row optional-row checkbox-option"><input type="checkbox" id="node-input-resend"> <label for="node-input-resend"><span data-i18n="ha-entity.label.resend"></span></label></div><div id="output-on-state-change-row" class="form-row optional-row checkbox-option"><input type="checkbox" id="node-input-outputOnStateChange"> <label for="node-input-outputOnStateChange"><span data-i18n="ha-entity.label.on_state_change"></span></label></div><div id="output-payload-row" class="form-row"><label for="node-input-outputPayload"><span data-i18n="ha-entity.label.payload"></span></label> <input type="text" id="node-input-outputPayload"> <input type="hidden" id="node-input-outputPayloadType"></div><div id="debug-row" class="form-row optional-row checkbox-option"><input type="checkbox" id="node-input-debugenabled"> <label for="node-input-debugenabled"><span data-i18n="ha-entity.label.debug"></span></label></div></script>
<script type="text/x-red" data-help-name="ha-entity"><p>Creates an entity in Home Assistant which can be manipulated from this node.</p><p><code>binary sensor</code>, <code>sensor</code>, and <code>switch</code></p><div class="custom-block warning"><p class="custom-block-title">WARNING</p><p><em>Needs <a href="https://github.com/zachowj/hass-node-red">Custom Integration</a> installed in Home Assistant for this node to function</em></p></div><h3>Configuration</h3><dl class="message-properties"><dt>Type <span text="required" class="badge">required</span><span class="property-type">string</span></dt><ul><li>Values <code>binary_sensor|sensor|switch</code></li><li>Default: <code>sensor</code></li></ul><dd>The state the entity should be updated to</dd><dt>Home Assistant Config<span class="property-type">Object</span></dt><dd>Configuration options available for the selected entity</dd><div class="custom-block danger"><p class="custom-block-title">WARNING</p><p>Entity nodes will not work in a subflow due to the way they register themselves with Home Assistant. After a Node-RED restart, a new entity will be created in Home Assistant.</p></div></dl><h3>Sensor Configuration</h3><dl class="message-properties"><dt>State <span text="required" class="badge">required</span><span class="property-type">string | number | boolean</span></dt><dd>The state the entity should be updated to</dd><dt>Attributes<span class="property-type">Object</span></dt><dd>Key/Value pair of attributes to update. The key should be a string and the value can be a [string | number | boolean | object]</dd><dt>Input Override<span class="property-type">string</span></dt><ul><li>Values: <code>accept | merge | block</code></li></ul><dd>Determine how input values will be handled. When merge is selected the message object values will override the configuration values.</dd><dt>Resend state and attributes<span class="property-type">boolean</span></dt><dd>When creating the entity in Home Assistant this will also send the last updated state and attributes then node sent to Home Assistant</dd></dl><h3>Switch Configuration</h3><dl class="message-properties"><dt>Output on state change<span class="property-type">boolean</span></dt><dd>When the state of the switch changes it will output to the top if the switch is on or to the bottom if it is in the off position.</dd><dt>Payload<span class="property-type">str | num | bool | JSONata | timestamp</span></dt><dd>Customizable output set to <code>msg.payload</code> if <code>Output on state change</code> is enabled.</dd></dl><h3>Sensors Inputs</h3><dl class="message-properties"><dd>properties of <code>msg.payload</code></dd><dt>state<span class="property-type">string | number | boolean</span></dt><dd>The state the entity should be updated to</dd><dt>attributes<span class="property-type">Object</span></dt><dd>Key/Value pair of attributes to update. The key should be a string and the value can be a <code>[string | number | boolean | object]</code></dd></dl><h3>Switch Inputs</h3><dl class="message-properties"><dt>msg.enable<span class="property-type">boolean</span></dt><dd>Set to <code>true</code> to turn on the switch and <code>false</code> to turn off. If the message has a property <code>enable</code> set to the type <code>boolean</code> the node will not have any output.</dd></dl><h3>Outputs</h3><dl class="message-properties"><dd><strong>Status Color</strong></dd><ul><li>Green/Red: output from the node was due to input to the node</li><li>Blue: output from the node was due to the state of the node changing</li><li>Yellow: state of node changed but no output</li></ul></dl></script>
<style>#version-update{padding:.5em;margin-bottom:1em}#version-update p{margin:0}#version-update strong{padding-right:5px}#version-update a,#version-update a:hover{color:#555}.form-row.checkbox-option input{margin-left:105px;margin-right:5px;display:inline-block;width:auto;vertical-align:top}.form-row.checkbox-option label{width:auto}.form-row.checkbox-option-left input{display:inline-block;margin-right:5px;width:auto;vertical-align:top}.form-row.checkbox-option-left label{width:auto;margin-right:20px}.editable-list-row{margin-bottom:4px}#constraint-list{min-width:446px}#constraint-list input{width:65%}#output-list input{width:62%}#clearIfState{position:absolute;margin-left:2px}.ha-node-label-legacy{fill:#fdfd96;stroke-width:0;font-size:14px;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}li span.property-type{font-family:Helvetica Neue,Arial,Helvetica,sans-serif;color:#666;font-style:italic;font-size:11px;float:right}.ha-alert-box{padding:10px;margin-bottom:10px}.custom-block .custom-block-title{font-weight:600}.custom-block.danger,.custom-block.tip,.custom-block.warning{padding:.1rem 1.5rem;border-left-width:.5rem;border-left-style:solid;margin:1rem 0}.custom-block.tip{background-color:#f3f5f7;border-color:#42b983;color:#2c3e50}.custom-block.tip a{color:#3eaf7c}.custom-block.warning{background-color:#fff6c6;border-color:#e7c000;color:#6b5900}.custom-block.warning .custom-block-title{color:#b29400}.custom-block.warning a{color:#2c3e50}.custom-block.danger{background-color:#ffe6e6;border-color:#c00;color:#4d0000}.custom-block.danger .custom-block-title{color:#900}.custom-block.danger a{color:#2c3e50}.button-box div.text-box{display:inline-block;position:relative;width:70%;height:20px}.button-box div.text-box div{position:absolute;left:0;right:40px}.button-box div.text-box div input{width:100%}.button-box div.text-box a{position:absolute;right:0;top:0}.badge{display:inline-block;font-size:12px;height:16px;line-height:16px;border-radius:3px;padding:0 6px;color:#fff}.badge,.badge.green,.badge.tip{background-color:#42b983}.badge.error{background-color:#da5961}.badge.warn,.badge.warning,.badge.yellow{background-color:#e7c000}.badge+.badge{margin-left:5px}</style>